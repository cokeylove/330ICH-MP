C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE CORE_XLT
OBJECT MODULE PLACED IN Code\CORE\CORE_XLT.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\CORE\CORE_XLT.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\I
                    -NCLUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: CORE_XLT.C - Scan Matrix handler at CORE level
   3           *
   4           * The procedure Send_Scan2 of this module is called to translate keyboard
   5           * scanner contact events into set 2 scan codes.
   6           *
   7           * Copyright (c) 1983-2007, Insyde Software Corporation. All Rights Reserved.
   8           *
   9           * You may not reproduce, distribute, publish, display, perform, modify, adapt,
  10           * transmit, broadcast, present, recite, release, license or otherwise exploit
  11           * any part of this publication in any form, by any means, without the prior
  12           * written permission of Insyde Software Corporation.
  13           *---------------------------------------------------------------------------*/
  14           
  15          #include <CORE_INCLUDE.H>
  16          #include <OEM_INCLUDE.H>
  17          
  18          /* ----------------------------------------------------------------------------
  19           * FUNCTION: Send_Scan2
  20           *
  21           * Input: key   = Row/Column number
  22           *                key.field.output = 0 - 15
  23           *                key.field.input  = 0 - 7
  24           *
  25           *        event = Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
  26           *
  27           *        Scanner_State byte
  28           *
  29           *        Ext_Cb3_OVL_STATE
  30           *
  31           * On return, Scanner_State byte and Ext_Cb3_OVL_STATE are updated.
  32           *
  33           * Combination flag for each row/column
  34           *     0 = Insyde Software key number 2 in Row/Column Table
  35           *     1 = index for control_ptr_table in Row/Column Table
  36           *
  37           * Insyde Software Key Number 2
  38           *     01-7F = Same as Scan Code, Set 2
  39           *     80-FF = E0-prefix, cursor, printscreen, pause/break, special key
  40           * ------------------------------------------------------------------------- */
  41          void Send_Scan2(union KEY key, BYTE event)
  42          {
  43   1              if(IS_MASK_SET(UtilityFlag,KBDebug))
  44   1              {
  45   2                      if(KeyScanACK==KU_ACK_Start)
  46   2                      {
  47   3                              if(event==MAKE_EVENT)
  48   3                              {
  49   4                                      KeyScanKSI = key.field.input;
  50   4                                      KeyScanKSO = key.field.output;
  51   4                                      KeyScanACK = KU_ACK_Keyboard;
  52   4                              }
  53   3                      }
  54   2              }
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 2   

  55   1              else
  56   1              {
  57   2                      #if SUPPORT_KB_RAM_TABLE
  58   2                  //Scanner_RAM_Pntr     = &Rc_RAM_Table;
  59   2                  //Extendkey_RAM_Pntr   = &Rc_RAM_Table18;
  60   2      
  61   2                  ITempB04 = (key.field.input << 4) | key.field.output;
  62   2                  ITempB03 = *(Scanner_RAM_Pntr + ITempB04);
  63   2                      #else
                          //Scanner_Table_Pntr   = &Rc_ROM_Tables;
                          //Extendkey_Table_Pntr = &EtKey_ROM_Tables;
              
                      ITempB04 = (key.field.input << 4) | key.field.output;
                              ITempB03 = *(Scanner_Table_Pntr + ITempB04);
                              #endif
  70   2      
  71   2                      Hook_keyboard(key.field.input, key.field.output);
  72   2              Send_Key(ITempB03, event);
  73   2              }
  74   1      }
  75          
  76          
  77          /* ----------------------------------------------------------------------------
  78           * FUNCTION: Send_Key
  79           * ------------------------------------------------------------------------- */
  80          void Send_Key(BYTE table_entry, BYTE event)
  81          {
  82   1          BYTE temp;
  83   1          const BYTE code *pntr;
  84   1          BYTE temp_table_entry;
  85   1      
  86   1          OEM_Hook_Send_Key(table_entry,event);
  87   1      
  88   1          if(OEM_Hook_Skip_Send_Key()==0xFF)
  89   1          {
  90   2              return;
  91   2          }
  92   1      
  93   1          temp_table_entry = table_entry;
  94   1      
  95   1          Buffer_Mark();                                                                      // Mark Buffer in case of overrun.
  96   1          temp_scanner_state.byte = Scanner_State;
  97   1          if (table_entry >= SSKEY2_OVL_CODE)                         // Fn key + any key.
  98   1          {   
  99   2              /*
 100   2                      temp = (table_entry - SSKEY2_OVL_CODE);
 101   2                      temp = temp << 1;                                               // Multiply 2 because each entry takes 2 bytes 
 102   2                      if (temp_scanner_state.field.tFN)
 103   2                      {                                                                               // Fn key
 104   2                              temp++; // Increment index to get the odd byte of table entry 
 105   2                      }
 106   2               table_entry = sskey2_overlay_table[temp];      // Get a sskey2 value. 
 107   2                      */
 108   2              
 109   2              temp = (table_entry - SSKEY2_OVL_CODE);
 110   2              temp = temp << 1;// Multiply 2 because each entry takes 2 bytes 
 111   2      
 112   2              #if KB_FnStickKey
                      if(FnStickKey)
                      {  
                          temp++; // Increment index to get the odd byte of table entry 
                      }
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 3   

                      else
                      #endif
 119   2              {
 120   3                      if (temp_scanner_state.field.tFN)
 121   3                      {// Fn key
 122   4                      temp++; // Increment index to get the odd byte of table entry 
 123   4                              table_entry_bk =temp_table_entry;
 124   4                  }
 125   3                  else
 126   3                  {
 127   4                      if(event==BREAK_EVENT)
 128   4                      {
 129   5                                      if(table_entry_bk==temp_table_entry)                            
 130   5                          {
 131   6                              temp++;     // Increment index to get the odd byte of table entry 
 132   6                          }
 133   5                          table_entry_bk = 0x00;
 134   5                      }
 135   4                      else    //MAKE_EVENT
 136   4                      {
 137   5                          if(table_entry_bk==temp_table_entry)
 138   5                                      {
 139   6                              temp++;     // Increment index to get the odd byte of table entry 
 140   6                          }
 141   5                          else
 142   5                          {
 143   6                              table_entry_bk = 0x00;
 144   6                          }
 145   5                      }
 146   4                  }
 147   3              }
 148   2                      //Modify hotkey(F1-F12) implement method.
 149   2                      //if(IS_MASK_CLEAR(ACPI_HOTKEY, HotkeyDisable)) //ANGELAG029: remove
 150   2                      if(IS_MASK_CLEAR(ACPI_HOTKEY, HotkeyDisable) && (IS_MASK_SET(SYS_MISC1,ACPI_OS)) && ((SYS_STATUS & 0x07)
             - != 0))  //ANGELAG036: add os type check  ////ANGELAG029: add
 151   2                      {
 152   3                      table_entry = sskey2_overlay_table1[temp];      // Get a sskey2 value. 
 153   3                      }
 154   2                      else
 155   2                      {
 156   3                              table_entry = sskey2_overlay_table[temp];       // Get a sskey2 value. 
 157   3                      }
 158   2             //Modify hotkey(F1-F12) implement method. 
 159   2          }
 160   1          else if (table_entry >= SSKEY2_SPE_CODE)            // Combination Key
 161   1          {  
 162   2              temp = (table_entry - SSKEY2_SPE_CODE);         // Get index into table. 
 163   2              table_entry = sskey2_A2_table[temp].comb;       // table_entry contains the combination table entry. 
 164   2              pntr = sskey2_A2_table[temp].pntr;                      // pntr points to the first key byte. 
 165   2              //pntr += calc_index_comb(table_entry);         // Check combination.  Point to the correct byte. 
 166   2              pntr += calc_index_comb(table_entry,temp_table_entry,event);
 167   2              table_entry = *pntr;                                    // Get a sskey2. 
 168   2          }
 169   1      
 170   1          sskey3_proc(table_entry, event);                    // Generate scan code, set 2.
 171   1      
 172   1              Scanner_State = temp_scanner_state.byte;        // Update scanner state. 
 173   1      
 174   1          #if KB_FnStickKey
                  if(FnStickKey)
                  {   
                      if(event==BREAK_EVENT)
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 4   

                      {
                          if(temp_table_entry!=0x8E)  // Fn key
                          {
                              FnStickKey=0;
                          }
                      }
                  }
              
                  if(event==BREAK_EVENT)
                  {
                      if(table_entry_bk==temp_table_entry)
                      {
                          table_entry_bk=0x00;
                      }
                  }
                  #endif
 194   1      }
 195          
 196          /* ----------------------------------------------------------------------------
 197           * FUNCTION: Clear_Fn_Keys
 198           * ------------------------------------------------------------------------- */
 199          void Clear_Fn_Keys(void)
 200          {
 201   1          //Fn_Make_Key1 = 0;
 202   1      }
 203          
 204          /* ----------------------------------------------------------------------------
 205           * FUNCTION: sskey3_proc
 206           *
 207           * Input: sskey2 = Insyde Software Key 2
 208           *        event =  Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
 209           *
 210           * Note: FUNCT_PTR_V_BS is a pointer to a function that returns nothing (V for
 211           *       void) and takes a BYTE and a BYTE for parameters (B for BYTE, S for
 212           *       BYTE).
 213           * ------------------------------------------------------------------------- */
 214          // Key Code Process Table.
 215          const FUNCT_PTR_V_BS code kcp_vector_table[] =
 216          {
 217              simple_code,        // index 00h DO_SIMPLE_CODE IBM key number 83,84 
 218              e0_prefix_code,     // index 01h DO_E0_PREFIX_CODE
 219              cursor_shift,       // index 02h DO_CURSOR_SHIFT
 220              cursor_numlock,     // index 03h DO_CURSOR_NUMLOCK
 221              special_code,       // index 04h DO_SPECIAL_CODE IBM key number 126 
 222              control_effect,     // index 05h DO_CONTROL_EFFECT Shift, Ctrl, Alt, Numlock 
 223              control_effect_e0,  // index 06h DO_CONTROL_EFFECT_E0 Ctrl, Alt 
 224              costomer_function   // index 07h DO_COSTOMER_FUNCTION costomer function key
 225          };
 226          
 227          static void sskey3_proc(BYTE sskey2, BYTE event)
 228          {
 229   1          BYTE code_byte;
 230   1          BYTE index;
 231   1          FLAG quick_key = 0;
 232   1      
 233   1          if (sskey2 == 0)                            // Null code 
 234   1          {                           
 235   2              ;                                        
 236   2          }
 237   1          else if ((sskey2 & 0x80) == 0)
 238   1          {
 239   2              simple_code(sskey2, event);     // 01h through 7Fh = scan code. 
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 5   

 240   2          }
 241   1          else                                                        // 80h through FFh. 
 242   1          {   
 243   2              sskey2 &= 0x7F;
 244   2              sskey2 = sskey2 << 1;
 245   2              code_byte = sskey3_80_table[sskey2+0];
 246   2              index = sskey3_80_table[sskey2+1];
 247   2              (kcp_vector_table[index])(code_byte, event); // Do procedure 
 248   2          } 
 249   1      }
 250          
 251          
 252          /* ----------------------------------------------------------------------------
 253           * FUNCTION: calc_index_comb
 254           *
 255           * Input: combination setting
 256           *             Bit   Meaning
 257           *             ---   --------
 258           *             7     reserved
 259           *             6     reserved
 260           *             5     Fn
 261           *             4     Num Lock
 262           *             3     Ctrl
 263           *             2     Alt
 264           *             1     Shift
 265           *             0     reserved
 266           *
 267           *       temp_scanner_state
 268           *
 269           * Return: offset.
 270           * ------------------------------------------------------------------------- */
 271          //static BYTE calc_index_comb(BYTE comb)
 272          static BYTE calc_index_comb(BYTE comb, BYTE table_entry, BYTE event)
 273          {
 274   1          BYTE offset;
 275   1          BYTE bit_num;
 276   1      
 277   1          offset  = 0;
 278   1          bit_num = 0;
 279   1      
 280   1          if (comb & BIT(1))
 281   1          {                                                                           // Combination has Shift. 
 282   2              if (temp_scanner_state.field.tLEFT | temp_scanner_state.field.tRIGHT)
 283   2                      {                                                               // Either left or right shift is pressed. 
 284   3                  offset |= Byte_Mask(bit_num);
 285   3              }
 286   2              bit_num++;                                              // Increment bit position. 
 287   2          }
 288   1      
 289   1          if (comb & BIT(2))
 290   1          {                                                                           // Combination has Alt. 
 291   2                      if (temp_scanner_state.field.tALT)
 292   2              {                                                               // Alt is pressed. 
 293   3                  offset |= Byte_Mask(bit_num);
 294   3              }
 295   2              bit_num++;                                              // Increment bit position. 
 296   2          }
 297   1      
 298   1              if (comb & BIT(3))
 299   1          {                                                                           // Combination has Ctrl. 
 300   2                      if (temp_scanner_state.field.tCONTROL)
 301   2              {                                                                       // Ctrl is pressed. 
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 6   

 302   3                  offset |= Byte_Mask(bit_num);
 303   3              }
 304   2              bit_num++;                                              // Increment bit position. 
 305   2          }
 306   1      
 307   1          if (comb & BIT(4))
 308   1          {                                                                           // Combination has Num Lock. 
 309   2              if (temp_scanner_state.field.tNUM_LOCK)
 310   2              {                                                               // NumLock has been pressed. 
 311   3                  offset |= Byte_Mask(bit_num);
 312   3              }
 313   2              bit_num++;                                                      // Increment bit position. 
 314   2          }
 315   1      
 316   1          if (comb & BIT(5))
 317   1          {                                                                           // Combination has Fn. 
 318   2              //if (temp_scanner_state.field.tFN)
 319   2              //{                                                             // Fn is pressed. 
 320   2              //    offset |= Byte_Mask(bit_num);
 321   2              //}
 322   2              /*if((table_entry - SSKEY2_SPE_CODE) >= 0x11 && (table_entry - SSKEY2_SPE_CODE) <= 0x1C)
 323   2              {
 324   2                  if(IS_MASK_CLEAR(ACPI_HOTKEY, HotkeyDisable))
 325   2                  {
 326   2                        if (!temp_scanner_state.field.tFN) // no has Fn.
 327   2                         {
 328   2                              offset |= Byte_Mask(bit_num);
 329   2                          }
 330   2                   }
 331   2                   else //HotKey_Mode = 0
 332   2                   {
 333   2                          if (temp_scanner_state.field.tFN)  //has Fn.
 334   2                          {                                                                   // Fn is pressed. 
 335   2                              offset |= Byte_Mask(bit_num);
 336   2                          }
 337   2                    }
 338   2             }
 339   2             else
 340   2              {*/
 341   2               if (temp_scanner_state.field.tFN)
 342   2               {                                                              // Fn is pressed. 
 343   3                   offset |= Byte_Mask(bit_num);
 344   3                   table_entry_bk = table_entry;
 345   3               }
 346   2               else
 347   2               {
 348   3                  if(event==BREAK_EVENT)
 349   3                  {
 350   4                      if(table_entry_bk==table_entry)
 351   4                      {
 352   5                          offset |= Byte_Mask(bit_num);  
 353   5                      }
 354   4                      table_entry_bk = 0x00;
 355   4                  }
 356   3                  else
 357   3                  {
 358   4                      if(table_entry_bk==table_entry)
 359   4                      {
 360   5                          offset |= Byte_Mask(bit_num);
 361   5                      }
 362   4                      else
 363   4                      {
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 7   

 364   5                          table_entry_bk = 0x00;
 365   5                      }
 366   4                  }
 367   3                }
 368   2              #if KB_FnStickKey
                      if(FnStickKey)
                      {                                                               // Fn is pressed. 
                          offset |= Byte_Mask(bit_num);
                      }
                      #endif
 374   2              
 375   2              bit_num++;                                              // Increment bit position. 
 376   2          }
 377   1      
 378   1          if (comb & BIT(6))
 379   1          {                                                                           // Combination has Hook_calc_index_comb_BIT6 
 380   2              if(Hook_calc_index_comb_BIT6()==0xFF)
 381   2              {
 382   3                  offset |= Byte_Mask(bit_num);
 383   3              }
 384   2              bit_num++;                                              // Increment bit position. 
 385   2          }
 386   1      
 387   1          if (comb & BIT(7))
 388   1          {                                                                           // Combination has Hook_calc_index_comb_BIT7 
 389   2              if(Hook_calc_index_comb_BIT7()==0xFF)
 390   2              {
 391   3                  offset |= Byte_Mask(bit_num);
 392   3              }
 393   2              bit_num++;                                              // Increment bit position. 
 394   2          }
 395   1          
 396   1          return(offset);
 397   1      }
 398          
 399          /* ----------------------------------------------------------------------------
 400           * FUNCTION: simple_code
 401           *
 402           * Input: scan_code, Set 2
 403           *        event = Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
 404           * ------------------------------------------------------------------------- */
 405          void simple_code(BYTE scan_code, BYTE event)
 406          {
 407   1          if (event == BREAK_EVENT)
 408   1          {  
 409   2              Buffer_Key(0xF0);       // Buffer break prefix for break contact. F0h is break prefix. 
 410   2          }
 411   1          Buffer_Key(scan_code);  // Buffer base code. 
 412   1      }
 413          
 414          /* ----------------------------------------------------------------------------
 415           * FUNCTION: e0_prefix_code
 416           *
 417           * Input: scan_code, Set 2
 418           *        event = Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
 419           * ------------------------------------------------------------------------- */
 420          void e0_prefix_code(BYTE scan_code, BYTE event)
 421          {
 422   1          Buffer_Key(0xE0);           // Buffer E0h prefix. 
 423   1          if (event == BREAK_EVENT)
 424   1          {                                           // Buffer break prefix for break contact. F0h is break prefix. 
 425   2              Buffer_Key(0xF0);
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 8   

 426   2          }
 427   1          Buffer_Key(scan_code);  // Buffer base code. 
 428   1      }
 429          
 430          /* ----------------------------------------------------------------------------
 431           * FUNCTION: cursor_shift
 432           *
 433           * Input: scan_code, Set 2
 434           *        event = Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
 435           *        temp_scanner_state
 436           * ------------------------------------------------------------------------- */
 437          /* BREAK_EVENT key string for cursor_shift and cursor_numlock. */
 438          const BYTE code csr_brk1[] = {0xE0,0xF0,0x00};
 439          
 440          static void cursor_shift(BYTE scan_code, BYTE event)
 441          {
 442   1          static const BYTE code csr_sftl_mk[]   = {0xE0,0xF0,0x12,0x00};
 443   1          static const BYTE code csr_sftr_mk[]   = {0xE0,0xF0,0x59,0x00};
 444   1          static const BYTE code csr_sftl_brk2[] = {0xE0,0x12,0x00};
 445   1          static const BYTE code csr_sftr_brk2[] = {0xE0,0x59,0x00};
 446   1      
 447   1          if (event == BREAK_EVENT)
 448   1          {   /* Key has just been released. This is a "break event". */
 449   2              Buffer_String(csr_brk1);                /* Buffer pre-string. */
 450   2              Buffer_Key(scan_code);                  /* Buffer base code. */
 451   2      
 452   2              if (temp_scanner_state.field.tLEFT)
 453   2              {                                                                       /* Left shift has been pressed. */
 454   3                  Buffer_String(csr_sftl_brk2);   /* Buffer tail-string. */
 455   3              }
 456   2      
 457   2              if (temp_scanner_state.field.tRIGHT)
 458   2              {                                                                       /* Right shift has been pressed. */
 459   3                  Buffer_String(csr_sftr_brk2);   /* Buffer tail-string. */
 460   3              }
 461   2          }
 462   1          else if (event == MAKE_EVENT)
 463   1          {   /* Key is pressed for the first time, a "make event". */
 464   2                                                                                      /* Left and/or Right SHIFT is pressed. */
 465   2              if (temp_scanner_state.field.tLEFT)
 466   2              {                                                                       /* Left SHIFT is pressed. */
 467   3                  Buffer_String(csr_sftl_mk);         /* Buffer pre-string. */
 468   3              }
 469   2      
 470   2              if (temp_scanner_state.field.tRIGHT)
 471   2              {                                                                       /* Right SHIFT is pressed. */
 472   3                  Buffer_String(csr_sftr_mk);         /* Buffer pre-string. */
 473   3              }
 474   2      
 475   2              Buffer_Key(0xE0);                               /* Buffer end of pre-string. */
 476   2              Buffer_Key(scan_code);                          /* Buffer base code. */
 477   2          }
 478   1          else
 479   1          {   /* Key is being held pressed for a length of time, a "repeat event". */
 480   2              Buffer_Key(0xE0);                               /* Buffer E0h prefix */
 481   2              Buffer_Key(scan_code);                          /* Buffer base code */
 482   2          } 
 483   1      }
 484          
 485          /* ----------------------------------------------------------------------------
 486           * FUNCTION: cursor_numlock
 487           *
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 9   

 488           * Input: scan_code, Set 2
 489           *        event = Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
 490           * ------------------------------------------------------------------------- */
 491          static void cursor_numlock(BYTE scan_code, BYTE event)
 492          {
 493   1          static const BYTE code csr_numlock_mk[]   = {0xE0,0x12,0xE0,0x00};
 494   1          static const BYTE code csr_numlock_brk2[] = {0xE0,0xF0,0x12,0x00};
 495   1      
 496   1          if (event == BREAK_EVENT)
 497   1          { 
 498   2              Buffer_String(csr_brk1);            // Buffer pre-string. 
 499   2              Buffer_Key(scan_code);              // Buffer base code. 
 500   2              Buffer_String(csr_numlock_brk2);    // Buffer tail-string. 
 501   2          }
 502   1          else if (event == MAKE_EVENT)
 503   1          {  
 504   2                                                                                      // The Num Lock key is pressed. 
 505   2              Buffer_String(csr_numlock_mk);          // Buffer pre-string. 
 506   2              Buffer_Key(scan_code);                  // Buffer base code. 
 507   2          }
 508   1          else
 509   1          {  
 510   2              Buffer_Key(0xE0);                               // Buffer E0h prefix. 
 511   2              Buffer_Key(scan_code);                          // Buffer base code. 
 512   2          } 
 513   1      }
 514          
 515          
 516          /* ----------------------------------------------------------------------------
 517           * FUNCTION: special_code
 518           *
 519           * For IBM Key Number 126. This key generates only make code.
 520           *
 521           * Input: code
 522           *        event = Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
 523           * ------------------------------------------------------------------------- */
 524          void special_code(BYTE code_byte, BYTE event)
 525          {
 526   1          static const BYTE code key126_normal_mk[] = {0xE1,0x14,0x77,0xE1,0xF0,0x14,0xF0,0x77,0x00};
 527   1          //static const BYTE code key126_ctrl_mk[]   = {0xE0,0x7E,0xE0,0xF0,0x7E,0x00};    //MARTINA012:Remove
 528   1          static const BYTE code key126_ctrl_mk[]   = {0x14,0xE0,0x7E,0xE0,0xF0,0x7E,0xF0,0x14,0x00};    //MARTI
             -NA012:add
 529   1      
 530   1          if (event == MAKE_EVENT)
 531   1          {
 532   2              if (code_byte == 0) 
 533   2                      {   
 534   3                      Buffer_String(key126_normal_mk);// Buffer normal code string.
 535   3              }
 536   2              else 
 537   2                      {  
 538   3                  Buffer_String(key126_ctrl_mk);      // Buffer Ctrl case string.
 539   3              }
 540   2          }
 541   1      }
 542          
 543          /* ----------------------------------------------------------------------------
 544           * FUNCTION: costomer_function
 545           *
 546           * Input: code
 547           *        event = Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
 548           * ------------------------------------------------------------------------- */
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 10  

 549          
 550          //----------------------------------------------------------------------------
 551          // The function of hotkey Fn + Fx
 552          //----------------------------------------------------------------------------
 553          static void costomer_function(BYTE code_byte, BYTE event)
 554          {
 555   1              (HotKey_Fn_Fx[code_byte])(event);
 556   1              if (scan.kbf_head != scan.kbf_tail)
 557   1              {
 558   2              SetServiceSendFlag();
 559   2              }
 560   1      }
 561          
 562          /* ----------------------------------------------------------------------------
 563           * FUNCTION: control_effect
 564           *
 565           * Generate scan code set 2 and update scanner status.
 566           *
 567           * Input: state flags
 568           *        event = Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
 569           *        temp_scanner_state
 570           *
 571           *  The following bits are defined for state flags and temp_scanner_state:
 572           *       NUM_LOCK
 573           *       LEFT
 574           *       RIGHT
 575           *       ALT
 576           *       CONTROL
 577           *       OVERLAY
 578           *       FN
 579           *       
 580           *
 581           * Returns: Updated temp_scanner_state
 582           * ------------------------------------------------------------------------- */
 583          static void control_effect(BYTE state, BYTE event)
 584          {
 585   1          if ((event == MAKE_EVENT)||(event == BREAK_EVENT))
 586   1          {
 587   2              if (state & LShift)                             // First generate scan code set 2.
 588   2                      {
 589   3                      simple_code(0x12, event);
 590   3                              //T057A + s
 591   3                              /*   //T057B +
 592   3                      if(event == MAKE_EVENT)
 593   3                      {
 594   3                              SET_MASK(EM9_NEWFUN,b7_ShiftPress);
 595   3                      }
 596   3                      else if(event == BREAK_EVENT)
 597   3                         {
 598   3                                      CLEAR_MASK(EM9_NEWFUN,b7_ShiftPress);
 599   3                         }
 600   3                              */  //T057B +                     
 601   3                              //T057A + e
 602   3              }
 603   2                      else if (state & LAlt)
 604   2                      {
 605   3                      simple_code(0x11, event);
 606   3              }
 607   2                      else if (state & LCtrl) 
 608   2                      {
 609   3                      simple_code(0x14, event);
 610   3              }
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 11  

 611   2              else if (state & RShift) 
 612   2                      {
 613   3                  simple_code(0x59, event);
 614   3                              //T057A + s
 615   3                              /*   //T057B+
 616   3                          if(event == MAKE_EVENT)
 617   3                          {
 618   3                              SET_MASK(EM9_NEWFUN,b7_ShiftPress);
 619   3                          }
 620   3                          else if(event == BREAK_EVENT)
 621   3                          {
 622   3                                      CLEAR_MASK(EM9_NEWFUN,b7_ShiftPress);
 623   3                          }
 624   3                              */   //T057B+                     
 625   3                              //T057A + e                
 626   3              }
 627   2                      //else if (state & FN) 
 628   2                      //{
 629   2              //      e0_prefix_code(0x63, event);
 630   2              //}
 631   2          }
 632   1         
 633   1          if (event == MAKE_EVENT)                    // Then update scanner state.
 634   1          {   // Key is pressed for the first time. This is a "make event".
 635   2                      // Set scanner state for SHIFT, Alt, Ctrl, or Fn.
 636   2              temp_scanner_state.byte |= state;
 637   2              if (state & FN) 
 638   2              {
 639   3                  Hook_Fn_Key_Make();
 640   3                  #if KB_FnStickKey
                          FnStickKey = 1;
                          #endif
 643   3              }
 644   2          }
 645   1          else if (event == BREAK_EVENT)
 646   1          {   
 647   2              if (state & FN) 
 648   2              {
 649   3                  Hook_Fn_Key_Break();
 650   3              }
 651   2              temp_scanner_state.byte &= ~state;
 652   2          }
 653   1          else
 654   1          { 
 655   2              ;   // Do nothing for repeat event. 
 656   2          }
 657   1      }
 658          
 659          
 660          /* ----------------------------------------------------------------------------
 661           * FUNCTION: control_effect_e0
 662           *
 663           * Generate scan code set 2 and update scanner status.
 664           * Only for Alt-Right and Ctrl-Right.
 665           *
 666           * Input: state flags
 667           *        event = Contact event (MAKE_EVENT, BREAK_EVENT, or REPEAT_EVENT)
 668           *        temp_scanner_state
 669           *
 670           * The following bits are defined for state_flags and temp_scanner_state:
 671           *       NUM_LOCK
 672           *       LEFT
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 12  

 673           *       RIGHT
 674           *       ALT
 675           *       CONTROL
 676           *       OVERLAY
 677           *       FN
 678           *
 679           * Return: Updated temp_scanner_state
 680           * ------------------------------------------------------------------------- */
 681          static void control_effect_e0(BYTE state, BYTE event)
 682          {   // This is only called for Alt-Right and Ctrl-Right. 
 683   1          if ((event == MAKE_EVENT)||(event == BREAK_EVENT))
 684   1          {
 685   2              // First setup to generate scan code set 2. 
 686   2              if (state & RAlt) 
 687   2                      {
 688   3                              e0_prefix_code(0x11, event);
 689   3              }
 690   2                      if (state & RCtrl) 
 691   2                      {
 692   3                              e0_prefix_code(0x14, event);
 693   3              }
 694   2              }
 695   1      
 696   1              if (event == MAKE_EVENT)
 697   1              {       // Key is pressed for the first time. This is a "make event". 
 698   2                  // Set one flag in scanner state flags. 
 699   2              temp_scanner_state.byte |= state;
 700   2              }
 701   1              else if (event == BREAK_EVENT)
 702   1              {       // Key has just been released. This is a "break event". 
 703   2                  // Clear one flag in scanner state flags. 
 704   2              temp_scanner_state.byte &= ~state;
 705   2              }
 706   1              else
 707   1              {   
 708   2              ;   // Do nothing for repeat event. 
 709   2              }               
 710   1      }
 711          
 712          
 713          
 714          
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 13  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com007D (BEGIN)
0000         L?0126:
0000         L?0127:
0000 900000      R     MOV     DPTR,#offset
0003         L?0128:
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 A3                INC     DPTR
0006 E0                MOVX    A,@DPTR
0007 FE                MOV     R6,A
0008 7401              MOV     A,#01H
000A C8                XCH     A,R0
000B EE                MOV     A,R6
000C C8                XCH     A,R0
000D 08                INC     R0
000E 22                RET     
000F         L?0129:
000F         L?0130:
000F 900000      R     MOV     DPTR,#bit_num
0012 E0                MOVX    A,@DPTR
0013 04                INC     A
0014 F0                MOVX    @DPTR,A
0015 22                RET     
0016         L?0131:
0016 900000      R     MOV     DPTR,#temp_table_entry
0019 E0                MOVX    A,@DPTR
001A FF                MOV     R7,A
001B 900000      E     MOV     DPTR,#table_entry_bk
001E E0                MOVX    A,@DPTR
001F 6F                XRL     A,R7
0020 22                RET     
0021         L?0132:
0021 120000      E     LCALL   ?C?PLDCODE
0024 8982              MOV     DPL,R1
0026 8A83              MOV     DPH,R2
0028 020000      E     LJMP    ?C?ICALL2
002B         L?0133:
002B         L?0134:
002B 900000      R     MOV     DPTR,#key
002E E0                MOVX    A,@DPTR
002F 5407              ANL     A,#07H
0031 22                RET     
0032         L?0135:
0032         L?0136:
0032 7800        E     MOV     R0,#LOW temp_scanner_state
0034 E6                MOV     A,@R0
0035 FF                MOV     R7,A
0036 13                RRC     A
0037 13                RRC     A
0038 22                RET     
             ; FUNCTION Com007D (END)

             ; FUNCTION Send_Scan2 (BEGIN)
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 43
0000 900000      E     MOV     DPTR,#UtilityFlag
0003 E0                MOVX    A,@DPTR
0004 30E626            JNB     ACC.6,?C0001
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 14  

                                           ; SOURCE LINE # 44
                                           ; SOURCE LINE # 45
0007 900000      E     MOV     DPTR,#KeyScanACK
000A E0                MOVX    A,@DPTR
000B F4                CPL     A
000C 7059              JNZ     ?C0005
                                           ; SOURCE LINE # 46
                                           ; SOURCE LINE # 47
000E 900000      R     MOV     DPTR,#event
0011 E0                MOVX    A,@DPTR
0012 7053              JNZ     ?C0005
                                           ; SOURCE LINE # 48
                                           ; SOURCE LINE # 49
0014 120000      R     LCALL   L?0133
0017 900000      E     MOV     DPTR,#KeyScanKSI
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 50
001B 900000      R     MOV     DPTR,#key
001E E0                MOVX    A,@DPTR
001F C4                SWAP    A
0020 540F              ANL     A,#0FH
0022 900000      E     MOV     DPTR,#KeyScanKSO
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 51
0026 900000      E     MOV     DPTR,#KeyScanACK
0029 7433              MOV     A,#033H
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 52
                                           ; SOURCE LINE # 53
                                           ; SOURCE LINE # 54
002C 22                RET     
002D         ?C0001:
                                           ; SOURCE LINE # 56
                                           ; SOURCE LINE # 61
002D 120000      R     LCALL   L?0133
0030 C4                SWAP    A
0031 54F0              ANL     A,#0F0H
0033 FF                MOV     R7,A
0034 E0                MOVX    A,@DPTR
0035 C4                SWAP    A
0036 540F              ANL     A,#0FH
0038 4F                ORL     A,R7
0039 F500        E     MOV     ITempB04,A
                                           ; SOURCE LINE # 62
003B AF00        E     MOV     R7,ITempB04
003D 7800        E     MOV     R0,#LOW Scanner_RAM_Pntr
003F E6                MOV     A,@R0
0040 FC                MOV     R4,A
0041 08                INC     R0
0042 E6                MOV     A,@R0
0043 8C83              MOV     DPH,R4
0045 2F                ADD     A,R7
0046 F582              MOV     DPL,A
0048 E4                CLR     A
0049 3583              ADDC    A,DPH
004B F583              MOV     DPH,A
004D E0                MOVX    A,@DPTR
004E F500        E     MOV     ITempB03,A
                                           ; SOURCE LINE # 71
0050 120000      R     LCALL   L?0134
0053 FF                MOV     R7,A
0054 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 15  

0055 FE                MOV     R6,A
0056 C4                SWAP    A
0057 540F              ANL     A,#0FH
0059 FD                MOV     R5,A
005A 120000      E     LCALL   _Hook_keyboard
                                           ; SOURCE LINE # 72
005D 900000      R     MOV     DPTR,#event
0060 E0                MOVX    A,@DPTR
0061 FD                MOV     R5,A
0062 AF00        E     MOV     R7,ITempB03
0064 120000      R     LCALL   _Send_Key
                                           ; SOURCE LINE # 73
                                           ; SOURCE LINE # 74
0067         ?C0005:
0067 22                RET     
             ; FUNCTION Send_Scan2 (END)

             ; FUNCTION _Send_Key (BEGIN)
                                           ; SOURCE LINE # 80
0000 900000      R     MOV     DPTR,#table_entry
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 81
                                           ; SOURCE LINE # 86
0008 120000      E     LCALL   _OEM_Hook_Send_Key
                                           ; SOURCE LINE # 88
000B 120000      E     LCALL   OEM_Hook_Skip_Send_Key
000E EF                MOV     A,R7
000F F4                CPL     A
0010 7003              JNZ     $ + 5H
0012 020000      R     LJMP    ?C0007
                                           ; SOURCE LINE # 89
                                           ; SOURCE LINE # 91
0015         ?C0006:
                                           ; SOURCE LINE # 93
0015 900000      R     MOV     DPTR,#table_entry
0018 E0                MOVX    A,@DPTR
0019 900000      R     MOV     DPTR,#temp_table_entry
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 95
001D 120000      E     LCALL   Buffer_Mark
                                           ; SOURCE LINE # 96
0020 7800        E     MOV     R0,#LOW temp_scanner_state
0022 A600        E     MOV     @R0,Scanner_State
                                           ; SOURCE LINE # 97
0024 900000      R     MOV     DPTR,#table_entry
0027 E0                MOVX    A,@DPTR
0028 FF                MOV     R7,A
0029 C3                CLR     C
002A 94E0              SUBB    A,#0E0H
002C 406C              JC      ?C0008
                                           ; SOURCE LINE # 98
                                           ; SOURCE LINE # 109
002E EF                MOV     A,R7
002F 2420              ADD     A,#020H
0031 900000      R     MOV     DPTR,#temp
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 110
0035 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 16  

0036 25E0              ADD     A,ACC
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 119
                                           ; SOURCE LINE # 120
0039 E6                MOV     A,@R0
003A C4                SWAP    A
003B 13                RRC     A
003C 13                RRC     A
003D 5403              ANL     A,#03H
003F 30E009            JNB     ACC.0,?C0009
                                           ; SOURCE LINE # 121
                                           ; SOURCE LINE # 122
0042 E0                MOVX    A,@DPTR
0043 04                INC     A
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 123
0045 900000      R     MOV     DPTR,#temp_table_entry
0048 E0                MOVX    A,@DPTR
                                           ; SOURCE LINE # 124
0049 8023              SJMP    ?C0115
004B         ?C0009:
                                           ; SOURCE LINE # 126
                                           ; SOURCE LINE # 127
004B 900000      R     MOV     DPTR,#event
004E E0                MOVX    A,@DPTR
004F B4010E            CJNE    A,#01H,?C0011
                                           ; SOURCE LINE # 128
                                           ; SOURCE LINE # 129
0052 120000      R     LCALL   L?0131
0055 7006              JNZ     ?C0012
                                           ; SOURCE LINE # 130
                                           ; SOURCE LINE # 131
0057 900000      R     MOV     DPTR,#temp
005A E0                MOVX    A,@DPTR
005B 04                INC     A
005C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 132
005D         ?C0012:
                                           ; SOURCE LINE # 133
005D E4                CLR     A
005E         ?C0114:
                                           ; SOURCE LINE # 134
005E 800E              SJMP    ?C0115
0060         ?C0011:
                                           ; SOURCE LINE # 136
                                           ; SOURCE LINE # 137
0060 120000      R     LCALL   L?0131
0063 7008              JNZ     ?C0014
                                           ; SOURCE LINE # 138
                                           ; SOURCE LINE # 139
0065 900000      R     MOV     DPTR,#temp
0068 E0                MOVX    A,@DPTR
0069 04                INC     A
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 140
006B 8005              SJMP    ?C0010
006D         ?C0014:
                                           ; SOURCE LINE # 142
                                           ; SOURCE LINE # 143
006D E4                CLR     A
006E         ?C0115:
006E 900000      E     MOV     DPTR,#table_entry_bk
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 17  

0071 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 144
                                           ; SOURCE LINE # 145
                                           ; SOURCE LINE # 146
0072         ?C0010:
                                           ; SOURCE LINE # 147
                                           ; SOURCE LINE # 150
0072 900000      E     MOV     DPTR,#ACPI_HOTKEY
0075 E0                MOVX    A,@DPTR
0076 20E318            JB      ACC.3,?C0016
0079 900000      E     MOV     DPTR,#SYS_MISC1
007C E0                MOVX    A,@DPTR
007D 30E711            JNB     ACC.7,?C0016
0080 900000      E     MOV     DPTR,#SYS_STATUS
0083 E0                MOVX    A,@DPTR
0084 5407              ANL     A,#07H
0086 6009              JZ      ?C0016
                                           ; SOURCE LINE # 151
                                           ; SOURCE LINE # 152
0088 900000      R     MOV     DPTR,#temp
008B E0                MOVX    A,@DPTR
008C 900000      E     MOV     DPTR,#sskey2_overlay_table1
                                           ; SOURCE LINE # 153
008F 8064              SJMP    ?C0117
0091         ?C0016:
                                           ; SOURCE LINE # 155
                                           ; SOURCE LINE # 156
0091 900000      R     MOV     DPTR,#temp
0094 E0                MOVX    A,@DPTR
0095 900000      E     MOV     DPTR,#sskey2_overlay_table
0098         ?C0116:
                                           ; SOURCE LINE # 157
                                           ; SOURCE LINE # 159
0098 805B              SJMP    ?C0117
009A         ?C0008:
                                           ; SOURCE LINE # 160
009A 900000      R     MOV     DPTR,#table_entry
009D E0                MOVX    A,@DPTR
009E FF                MOV     R7,A
009F C3                CLR     C
00A0 949C              SUBB    A,#09CH
00A2 4056              JC      ?C0018
                                           ; SOURCE LINE # 161
                                           ; SOURCE LINE # 162
00A4 EF                MOV     A,R7
00A5 2464              ADD     A,#064H
00A7 900000      R     MOV     DPTR,#temp
00AA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 163
00AB E0                MOVX    A,@DPTR
00AC FE                MOV     R6,A
00AD 75F003            MOV     B,#03H
00B0 900000      E     MOV     DPTR,#sskey2_A2_table
00B3 120000      E     LCALL   ?C?OFFXADD
00B6 E4                CLR     A
00B7 93                MOVC    A,@A+DPTR
00B8 FF                MOV     R7,A
00B9 900000      R     MOV     DPTR,#table_entry
00BC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 164
00BD 75F003            MOV     B,#03H
00C0 EE                MOV     A,R6
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 18  

00C1 900000      E     MOV     DPTR,#sskey2_A2_table+01H
00C4 120000      E     LCALL   ?C?OFFXADD
00C7 E4                CLR     A
00C8 93                MOVC    A,@A+DPTR
00C9 FD                MOV     R5,A
00CA 7401              MOV     A,#01H
00CC 93                MOVC    A,@A+DPTR
00CD 900000      R     MOV     DPTR,#pntr
00D0 CD                XCH     A,R5
00D1 F0                MOVX    @DPTR,A
00D2 A3                INC     DPTR
00D3 ED                MOV     A,R5
00D4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 166
00D5 A3                INC     DPTR
00D6 E0                MOVX    A,@DPTR
00D7 FD                MOV     R5,A
00D8 900000      R     MOV     DPTR,#event
00DB E0                MOVX    A,@DPTR
00DC FB                MOV     R3,A
00DD 120000      R     LCALL   _calc_index_comb
00E0 900000      R     MOV     DPTR,#pntr
00E3 E4                CLR     A
00E4 8FF0              MOV     B,R7
00E6 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 167
00E9 900000      R     MOV     DPTR,#pntr
00EC E0                MOVX    A,@DPTR
00ED FE                MOV     R6,A
00EE A3                INC     DPTR
00EF E0                MOVX    A,@DPTR
00F0 F582              MOV     DPL,A
00F2 8E83              MOV     DPH,R6
00F4 E4                CLR     A
00F5         ?C0117:
00F5 93                MOVC    A,@A+DPTR
00F6 900000      R     MOV     DPTR,#table_entry
00F9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 168
00FA         ?C0018:
                                           ; SOURCE LINE # 170
00FA 900000      R     MOV     DPTR,#table_entry
00FD E0                MOVX    A,@DPTR
00FE FF                MOV     R7,A
00FF A3                INC     DPTR
0100 E0                MOVX    A,@DPTR
0101 FD                MOV     R5,A
0102 120000      R     LCALL   _sskey3_proc
                                           ; SOURCE LINE # 172
0105 7800        E     MOV     R0,#LOW temp_scanner_state
0107 E6                MOV     A,@R0
0108 F500        E     MOV     Scanner_State,A
                                           ; SOURCE LINE # 194
010A         ?C0007:
010A 22                RET     
             ; FUNCTION _Send_Key (END)

             ; FUNCTION Clear_Fn_Keys (BEGIN)
                                           ; SOURCE LINE # 199
                                           ; SOURCE LINE # 200
                                           ; SOURCE LINE # 202
0000 22                RET     
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 19  

             ; FUNCTION Clear_Fn_Keys (END)

             ; FUNCTION _sskey3_proc (BEGIN)
                                           ; SOURCE LINE # 227
0000 900000      R     MOV     DPTR,#sskey2
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 228
                                           ; SOURCE LINE # 231
0008 E4                CLR     A
0009 A3                INC     DPTR
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 233
000B 900000      R     MOV     DPTR,#sskey2
000E E0                MOVX    A,@DPTR
000F FF                MOV     R7,A
0010 603B              JZ      ?C0025
                                           ; SOURCE LINE # 234
                                           ; SOURCE LINE # 236
0012         ?C0021:
                                           ; SOURCE LINE # 237
0012 EF                MOV     A,R7
0013 20E708            JB      ACC.7,?C0023
                                           ; SOURCE LINE # 238
                                           ; SOURCE LINE # 239
0016 900000      R     MOV     DPTR,#event
0019 E0                MOVX    A,@DPTR
001A FD                MOV     R5,A
001B 020000      R     LJMP    _simple_code
                                           ; SOURCE LINE # 240
001E         ?C0023:
                                           ; SOURCE LINE # 242
                                           ; SOURCE LINE # 243
001E 900000      R     MOV     DPTR,#sskey2
0021 E0                MOVX    A,@DPTR
0022 547F              ANL     A,#07FH
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 244
0025 E0                MOVX    A,@DPTR
0026 25E0              ADD     A,ACC
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 245
0029 E0                MOVX    A,@DPTR
002A FF                MOV     R7,A
002B 900000      E     MOV     DPTR,#sskey3_80_table
002E 93                MOVC    A,@A+DPTR
002F FE                MOV     R6,A
;---- Variable 'code_byte' assigned to Register 'R6' ----
                                           ; SOURCE LINE # 246
0030 EF                MOV     A,R7
0031 A3                INC     DPTR
0032 93                MOVC    A,@A+DPTR
;---- Variable 'index' assigned to Register 'R4' ----
0033 FC                MOV     R4,A
                                           ; SOURCE LINE # 247
0034 CF                XCH     A,R7
0035 EE                MOV     A,R6
0036 CF                XCH     A,R7
0037 900000      R     MOV     DPTR,#event
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 20  

003A E0                MOVX    A,@DPTR
003B FD                MOV     R5,A
003C EC                MOV     A,R4
003D 75F003            MOV     B,#03H
0040 A4                MUL     AB
0041 2400        R     ADD     A,#LOW kcp_vector_table
0043 F582              MOV     DPL,A
0045 E4                CLR     A
0046 3400        R     ADDC    A,#HIGH kcp_vector_table
0048 F583              MOV     DPH,A
004A 120000      R     LCALL   L?0132
                                           ; SOURCE LINE # 248
                                           ; SOURCE LINE # 249
004D         ?C0025:
004D 22                RET     
             ; FUNCTION _sskey3_proc (END)

             ; FUNCTION _calc_index_comb (BEGIN)
                                           ; SOURCE LINE # 272
;---- Variable 'table_entry' assigned to Register 'R5' ----
;---- Variable 'event' assigned to Register 'R3' ----
0000 900000      R     MOV     DPTR,#comb
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 273
                                           ; SOURCE LINE # 277
0005 E4                CLR     A
0006 A3                INC     DPTR
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 278
0008 A3                INC     DPTR
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 280
000A EF                MOV     A,R7
000B 30E122            JNB     ACC.1,?C0026
                                           ; SOURCE LINE # 281
                                           ; SOURCE LINE # 282
000E 7800        E     MOV     R0,#LOW temp_scanner_state
0010 E6                MOV     A,@R0
0011 13                RRC     A
0012 13                RRC     A
0013 5401              ANL     A,#01H
0015 FF                MOV     R7,A
0016 E6                MOV     A,@R0
0017 FE                MOV     R6,A
0018 C3                CLR     C
0019 13                RRC     A
001A 5401              ANL     A,#01H
001C 4F                ORL     A,R7
001D 600E              JZ      ?C0027
                                           ; SOURCE LINE # 283
                                           ; SOURCE LINE # 284
001F 120000      R     LCALL   L?0126
0022 8002              SJMP    ?C0097
0024         ?C0096:
0024 C3                CLR     C
0025 33                RLC     A
0026         ?C0097:
0026 D8FC              DJNZ    R0,?C0096
0028 4F                ORL     A,R7
0029 900000      R     MOV     DPTR,#offset
002C F0                MOVX    @DPTR,A
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 21  

                                           ; SOURCE LINE # 285
002D         ?C0027:
                                           ; SOURCE LINE # 286
002D 120000      R     LCALL   L?0129
                                           ; SOURCE LINE # 287
0030         ?C0026:
                                           ; SOURCE LINE # 289
0030 900000      R     MOV     DPTR,#comb
0033 E0                MOVX    A,@DPTR
0034 FC                MOV     R4,A
0035 30E21B            JNB     ACC.2,?C0028
                                           ; SOURCE LINE # 290
                                           ; SOURCE LINE # 291
0038 120000      R     LCALL   L?0135
003B 13                RRC     A
003C 541F              ANL     A,#01FH
003E 30E00F            JNB     ACC.0,?C0029
                                           ; SOURCE LINE # 292
                                           ; SOURCE LINE # 293
0041 A3                INC     DPTR
0042 120000      R     LCALL   L?0128
0045 8002              SJMP    ?C0099
0047         ?C0098:
0047 C3                CLR     C
0048 33                RLC     A
0049         ?C0099:
0049 D8FC              DJNZ    R0,?C0098
004B 4F                ORL     A,R7
004C 900000      R     MOV     DPTR,#offset
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 294
0050         ?C0029:
                                           ; SOURCE LINE # 295
0050 120000      R     LCALL   L?0129
                                           ; SOURCE LINE # 296
0053         ?C0028:
                                           ; SOURCE LINE # 298
0053 EC                MOV     A,R4
0054 30E31B            JNB     ACC.3,?C0030
                                           ; SOURCE LINE # 299
                                           ; SOURCE LINE # 300
0057 7800        E     MOV     R0,#LOW temp_scanner_state
0059 E6                MOV     A,@R0
005A FF                MOV     R7,A
005B C4                SWAP    A
005C 540F              ANL     A,#0FH
005E 30E00E            JNB     ACC.0,?C0031
                                           ; SOURCE LINE # 301
                                           ; SOURCE LINE # 302
0061 120000      R     LCALL   L?0126
0064 8002              SJMP    ?C0101
0066         ?C0100:
0066 C3                CLR     C
0067 33                RLC     A
0068         ?C0101:
0068 D8FC              DJNZ    R0,?C0100
006A 4F                ORL     A,R7
006B 900000      R     MOV     DPTR,#offset
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 303
006F         ?C0031:
                                           ; SOURCE LINE # 304
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 22  

006F 120000      R     LCALL   L?0130
                                           ; SOURCE LINE # 305
0072         ?C0030:
                                           ; SOURCE LINE # 307
0072 900000      R     MOV     DPTR,#comb
0075 E0                MOVX    A,@DPTR
0076 30E418            JNB     ACC.4,?C0032
                                           ; SOURCE LINE # 308
                                           ; SOURCE LINE # 309
0079 7800        E     MOV     R0,#LOW temp_scanner_state
007B E6                MOV     A,@R0
007C 30E00F            JNB     ACC.0,?C0033
                                           ; SOURCE LINE # 310
                                           ; SOURCE LINE # 311
007F A3                INC     DPTR
0080 120000      R     LCALL   L?0128
0083 8002              SJMP    ?C0103
0085         ?C0102:
0085 C3                CLR     C
0086 33                RLC     A
0087         ?C0103:
0087 D8FC              DJNZ    R0,?C0102
0089 4F                ORL     A,R7
008A 900000      R     MOV     DPTR,#offset
008D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 312
008E         ?C0033:
                                           ; SOURCE LINE # 313
008E 120000      R     LCALL   L?0130
                                           ; SOURCE LINE # 314
0091         ?C0032:
                                           ; SOURCE LINE # 316
0091 900000      R     MOV     DPTR,#comb
0094 E0                MOVX    A,@DPTR
0095 FC                MOV     R4,A
0096 30E55C            JNB     ACC.5,?C0034
                                           ; SOURCE LINE # 317
                                           ; SOURCE LINE # 341
0099 7800        E     MOV     R0,#LOW temp_scanner_state
009B E6                MOV     A,@R0
009C FF                MOV     R7,A
009D C4                SWAP    A
009E 13                RRC     A
009F 13                RRC     A
00A0 5403              ANL     A,#03H
00A2 30E016            JNB     ACC.0,?C0035
                                           ; SOURCE LINE # 342
                                           ; SOURCE LINE # 343
00A5 A3                INC     DPTR
00A6 120000      R     LCALL   L?0128
00A9 8002              SJMP    ?C0105
00AB         ?C0104:
00AB C3                CLR     C
00AC 33                RLC     A
00AD         ?C0105:
00AD D8FC              DJNZ    R0,?C0104
00AF 4F                ORL     A,R7
00B0 900000      R     MOV     DPTR,#offset
00B3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 344
00B4 900000      E     MOV     DPTR,#table_entry_bk
00B7 ED                MOV     A,R5
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 23  

00B8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 345
00B9 8037              SJMP    ?C0036
00BB         ?C0035:
                                           ; SOURCE LINE # 347
                                           ; SOURCE LINE # 348
00BB EB                MOV     A,R3
00BC B40117            CJNE    A,#01H,?C0037
                                           ; SOURCE LINE # 349
                                           ; SOURCE LINE # 350
00BF 900000      E     MOV     DPTR,#table_entry_bk
00C2 E0                MOVX    A,@DPTR
00C3 6D                XRL     A,R5
00C4 7027              JNZ     ?C0118
                                           ; SOURCE LINE # 351
                                           ; SOURCE LINE # 352
00C6 120000      R     LCALL   L?0127
00C9 8002              SJMP    ?C0107
00CB         ?C0106:
00CB C3                CLR     C
00CC 33                RLC     A
00CD         ?C0107:
00CD D8FC              DJNZ    R0,?C0106
00CF 4F                ORL     A,R7
00D0 900000      R     MOV     DPTR,#offset
00D3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 353
00D4         ?C0038:
                                           ; SOURCE LINE # 354
                                           ; SOURCE LINE # 355
00D4 8017              SJMP    ?C0118
00D6         ?C0037:
                                           ; SOURCE LINE # 357
                                           ; SOURCE LINE # 358
00D6 900000      E     MOV     DPTR,#table_entry_bk
00D9 E0                MOVX    A,@DPTR
00DA 6D                XRL     A,R5
00DB 7010              JNZ     ?C0040
                                           ; SOURCE LINE # 359
                                           ; SOURCE LINE # 360
00DD 120000      R     LCALL   L?0127
00E0 8002              SJMP    ?C0109
00E2         ?C0108:
00E2 C3                CLR     C
00E3 33                RLC     A
00E4         ?C0109:
00E4 D8FC              DJNZ    R0,?C0108
00E6 4F                ORL     A,R7
00E7 900000      R     MOV     DPTR,#offset
00EA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 361
00EB 8005              SJMP    ?C0036
00ED         ?C0040:
                                           ; SOURCE LINE # 363
                                           ; SOURCE LINE # 364
00ED         ?C0118:
00ED E4                CLR     A
00EE 900000      E     MOV     DPTR,#table_entry_bk
00F1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 365
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 367
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 24  

00F2         ?C0036:
                                           ; SOURCE LINE # 375
00F2 120000      R     LCALL   L?0130
                                           ; SOURCE LINE # 376
00F5         ?C0034:
                                           ; SOURCE LINE # 378
00F5 EC                MOV     A,R4
00F6 30E617            JNB     ACC.6,?C0042
                                           ; SOURCE LINE # 379
                                           ; SOURCE LINE # 380
00F9 120000      E     LCALL   Hook_calc_index_comb_BIT6
00FC BFFF0E            CJNE    R7,#0FFH,?C0043
                                           ; SOURCE LINE # 381
                                           ; SOURCE LINE # 382
00FF 120000      R     LCALL   L?0127
0102 8002              SJMP    ?C0111
0104         ?C0110:
0104 C3                CLR     C
0105 33                RLC     A
0106         ?C0111:
0106 D8FC              DJNZ    R0,?C0110
0108 4F                ORL     A,R7
0109 900000      R     MOV     DPTR,#offset
010C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 383
010D         ?C0043:
                                           ; SOURCE LINE # 384
010D 120000      R     LCALL   L?0130
                                           ; SOURCE LINE # 385
0110         ?C0042:
                                           ; SOURCE LINE # 387
0110 900000      R     MOV     DPTR,#comb
0113 E0                MOVX    A,@DPTR
0114 30E717            JNB     ACC.7,?C0044
                                           ; SOURCE LINE # 388
                                           ; SOURCE LINE # 389
0117 120000      E     LCALL   Hook_calc_index_comb_BIT7
011A BFFF0E            CJNE    R7,#0FFH,?C0045
                                           ; SOURCE LINE # 390
                                           ; SOURCE LINE # 391
011D 120000      R     LCALL   L?0127
0120 8002              SJMP    ?C0113
0122         ?C0112:
0122 C3                CLR     C
0123 33                RLC     A
0124         ?C0113:
0124 D8FC              DJNZ    R0,?C0112
0126 4F                ORL     A,R7
0127 900000      R     MOV     DPTR,#offset
012A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 392
012B         ?C0045:
                                           ; SOURCE LINE # 393
012B 120000      R     LCALL   L?0130
                                           ; SOURCE LINE # 394
012E         ?C0044:
                                           ; SOURCE LINE # 396
012E 900000      R     MOV     DPTR,#offset
0131 E0                MOVX    A,@DPTR
0132 FF                MOV     R7,A
                                           ; SOURCE LINE # 397
0133         ?C0046:
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 25  

0133 22                RET     
             ; FUNCTION _calc_index_comb (END)

             ; FUNCTION _simple_code (BEGIN)
                                           ; SOURCE LINE # 405
0000 900000      R     MOV     DPTR,#scan_code
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
;---- Variable 'event' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 407
0005 ED                MOV     A,R5
0006 B40105            CJNE    A,#01H,?C0047
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 409
0009 7FF0              MOV     R7,#0F0H
000B 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 410
000E         ?C0047:
                                           ; SOURCE LINE # 411
000E 900000      R     MOV     DPTR,#scan_code
0011 E0                MOVX    A,@DPTR
0012 FF                MOV     R7,A
0013 020000      E     LJMP    _Buffer_Key
             ; FUNCTION _simple_code (END)

             ; FUNCTION _e0_prefix_code (BEGIN)
                                           ; SOURCE LINE # 420
0000 900000      R     MOV     DPTR,#scan_code
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
0008 7FE0              MOV     R7,#0E0H
000A 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 423
000D 900000      R     MOV     DPTR,#event
0010 E0                MOVX    A,@DPTR
0011 B40105            CJNE    A,#01H,?C0049
                                           ; SOURCE LINE # 424
                                           ; SOURCE LINE # 425
0014 7FF0              MOV     R7,#0F0H
0016 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 426
0019         ?C0049:
                                           ; SOURCE LINE # 427
0019 900000      R     MOV     DPTR,#scan_code
001C E0                MOVX    A,@DPTR
001D FF                MOV     R7,A
001E 020000      E     LJMP    _Buffer_Key
             ; FUNCTION _e0_prefix_code (END)

             ; FUNCTION _cursor_shift (BEGIN)
                                           ; SOURCE LINE # 440
0000 900000      R     MOV     DPTR,#scan_code
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 26  

0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 441
                                           ; SOURCE LINE # 447
0008 6401              XRL     A,#01H
000A 7034              JNZ     ?C0051
                                           ; SOURCE LINE # 448
                                           ; SOURCE LINE # 449
000C 7BFF              MOV     R3,#0FFH
000E 7A00        R     MOV     R2,#HIGH csr_brk1
0010 7900        R     MOV     R1,#LOW csr_brk1
0012 120000      E     LCALL   _Buffer_String
                                           ; SOURCE LINE # 450
0015 900000      R     MOV     DPTR,#scan_code
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 452
001D 7800        E     MOV     R0,#LOW temp_scanner_state
001F E6                MOV     A,@R0
0020 FF                MOV     R7,A
0021 C3                CLR     C
0022 13                RRC     A
0023 30E009            JNB     ACC.0,?C0052
                                           ; SOURCE LINE # 453
                                           ; SOURCE LINE # 454
0026 7BFF              MOV     R3,#0FFH
0028 7A00        R     MOV     R2,#HIGH csr_sftl_brk2
002A 7900        R     MOV     R1,#LOW csr_sftl_brk2
002C 120000      E     LCALL   _Buffer_String
                                           ; SOURCE LINE # 455
002F         ?C0052:
                                           ; SOURCE LINE # 457
002F 120000      R     LCALL   L?0135
0032 543F              ANL     A,#03FH
0034 30E041            JNB     ACC.0,?C0059
                                           ; SOURCE LINE # 458
                                           ; SOURCE LINE # 459
0037 7BFF              MOV     R3,#0FFH
0039 7A00        R     MOV     R2,#HIGH csr_sftr_brk2
003B 7900        R     MOV     R1,#LOW csr_sftr_brk2
003D 020000      E     LJMP    _Buffer_String
                                           ; SOURCE LINE # 460
                                           ; SOURCE LINE # 461
0040         ?C0051:
                                           ; SOURCE LINE # 462
0040 900000      R     MOV     DPTR,#event
0043 E0                MOVX    A,@DPTR
0044 7025              JNZ     ?C0055
                                           ; SOURCE LINE # 463
                                           ; SOURCE LINE # 465
0046 7800        E     MOV     R0,#LOW temp_scanner_state
0048 E6                MOV     A,@R0
0049 FF                MOV     R7,A
004A C3                CLR     C
004B 13                RRC     A
004C 30E009            JNB     ACC.0,?C0056
                                           ; SOURCE LINE # 466
                                           ; SOURCE LINE # 467
004F 7BFF              MOV     R3,#0FFH
0051 7A00        R     MOV     R2,#HIGH csr_sftl_mk
0053 7900        R     MOV     R1,#LOW csr_sftl_mk
0055 120000      E     LCALL   _Buffer_String
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 27  

                                           ; SOURCE LINE # 468
0058         ?C0056:
                                           ; SOURCE LINE # 470
0058 120000      R     LCALL   L?0136
005B 543F              ANL     A,#03FH
005D 30E00B            JNB     ACC.0,?C0119
                                           ; SOURCE LINE # 471
                                           ; SOURCE LINE # 472
0060 7BFF              MOV     R3,#0FFH
0062 7A00        R     MOV     R2,#HIGH csr_sftr_mk
0064 7900        R     MOV     R1,#LOW csr_sftr_mk
0066 120000      E     LCALL   _Buffer_String
                                           ; SOURCE LINE # 473
0069         ?C0057:
                                           ; SOURCE LINE # 475
                                           ; SOURCE LINE # 476
                                           ; SOURCE LINE # 477
0069 8000              SJMP    ?C0119
006B         ?C0055:
                                           ; SOURCE LINE # 479
                                           ; SOURCE LINE # 480
006B         ?C0119:
006B 7FE0              MOV     R7,#0E0H
006D 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 481
0070 900000      R     MOV     DPTR,#scan_code
0073 E0                MOVX    A,@DPTR
0074 FF                MOV     R7,A
0075 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 483
0078         ?C0059:
0078 22                RET     
             ; FUNCTION _cursor_shift (END)

             ; FUNCTION _cursor_numlock (BEGIN)
                                           ; SOURCE LINE # 491
0000 900000      R     MOV     DPTR,#scan_code
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 492
                                           ; SOURCE LINE # 496
0008 BD011A            CJNE    R5,#01H,?C0060
                                           ; SOURCE LINE # 497
                                           ; SOURCE LINE # 498
000B 7BFF              MOV     R3,#0FFH
000D 7A00        R     MOV     R2,#HIGH csr_brk1
000F 7900        R     MOV     R1,#LOW csr_brk1
0011 120000      E     LCALL   _Buffer_String
                                           ; SOURCE LINE # 499
0014 900000      R     MOV     DPTR,#scan_code
0017 E0                MOVX    A,@DPTR
0018 FF                MOV     R7,A
0019 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 500
001C 7BFF              MOV     R3,#0FFH
001E 7A00        R     MOV     R2,#HIGH csr_numlock_brk2
0020 7900        R     MOV     R1,#LOW csr_numlock_brk2
0022 020000      E     LJMP    _Buffer_String
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 28  

                                           ; SOURCE LINE # 501
0025         ?C0060:
                                           ; SOURCE LINE # 502
0025 900000      R     MOV     DPTR,#event
0028 E0                MOVX    A,@DPTR
0029 700B              JNZ     ?C0062
                                           ; SOURCE LINE # 503
                                           ; SOURCE LINE # 505
002B 7BFF              MOV     R3,#0FFH
002D 7A00        R     MOV     R2,#HIGH csr_numlock_mk
002F 7900        R     MOV     R1,#LOW csr_numlock_mk
0031 120000      E     LCALL   _Buffer_String
                                           ; SOURCE LINE # 506
                                           ; SOURCE LINE # 507
0034 8005              SJMP    ?C0120
0036         ?C0062:
                                           ; SOURCE LINE # 509
                                           ; SOURCE LINE # 510
0036 7FE0              MOV     R7,#0E0H
0038 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 511
003B         ?C0120:
003B 900000      R     MOV     DPTR,#scan_code
003E E0                MOVX    A,@DPTR
003F FF                MOV     R7,A
0040 120000      E     LCALL   _Buffer_Key
                                           ; SOURCE LINE # 512
                                           ; SOURCE LINE # 513
0043         ?C0064:
0043 22                RET     
             ; FUNCTION _cursor_numlock (END)

             ; FUNCTION _special_code (BEGIN)
                                           ; SOURCE LINE # 524
;---- Variable 'event' assigned to Register 'R5' ----
;---- Variable 'code_byte' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 525
                                           ; SOURCE LINE # 530
0000 ED                MOV     A,R5
0001 7012              JNZ     ?C0068
                                           ; SOURCE LINE # 531
                                           ; SOURCE LINE # 532
0003 EF                MOV     A,R7
0004 7BFF              MOV     R3,#0FFH
0006 7006              JNZ     ?C0066
                                           ; SOURCE LINE # 533
                                           ; SOURCE LINE # 534
0008 7A00        R     MOV     R2,#HIGH key126_normal_mk
000A 7900        R     MOV     R1,#LOW key126_normal_mk
                                           ; SOURCE LINE # 535
000C 8004              SJMP    ?C0121
000E         ?C0066:
                                           ; SOURCE LINE # 537
                                           ; SOURCE LINE # 538
000E 7A00        R     MOV     R2,#HIGH key126_ctrl_mk
0010 7900        R     MOV     R1,#LOW key126_ctrl_mk
0012         ?C0121:
0012 120000      E     LCALL   _Buffer_String
                                           ; SOURCE LINE # 539
                                           ; SOURCE LINE # 540
                                           ; SOURCE LINE # 541
0015         ?C0068:
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 29  

0015 22                RET     
             ; FUNCTION _special_code (END)

             ; FUNCTION _costomer_function (BEGIN)
                                           ; SOURCE LINE # 553
;---- Variable 'event' assigned to Register 'R5' ----
;---- Variable 'code_byte' assigned to Register 'R6' ----
0000 CE                XCH     A,R6
0001 EF                MOV     A,R7
0002 CE                XCH     A,R6
                                           ; SOURCE LINE # 554
                                           ; SOURCE LINE # 555
0003 CF                XCH     A,R7
0004 ED                MOV     A,R5
0005 CF                XCH     A,R7
0006 75F003            MOV     B,#03H
0009 EE                MOV     A,R6
000A 900000      E     MOV     DPTR,#HotKey_Fn_Fx
000D 120000      E     LCALL   ?C?OFFXADD
0010 120000      R     LCALL   L?0132
                                           ; SOURCE LINE # 556
0013 AF00        E     MOV     R7,scan
0015 EF                MOV     A,R7
0016 C4                SWAP    A
0017 540F              ANL     A,#0FH
0019 FF                MOV     R7,A
001A E500        E     MOV     A,scan
001C 540F              ANL     A,#0FH
001E 6F                XRL     A,R7
001F 6003              JZ      ?C0070
                                           ; SOURCE LINE # 557
                                           ; SOURCE LINE # 558
0021 120000      E     LCALL   SetServiceSendFlag
                                           ; SOURCE LINE # 559
                                           ; SOURCE LINE # 560
0024         ?C0070:
0024 22                RET     
             ; FUNCTION _costomer_function (END)

             ; FUNCTION _control_effect (BEGIN)
                                           ; SOURCE LINE # 583
0000 900000      R     MOV     DPTR,#state
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 584
                                           ; SOURCE LINE # 585
0008 6005              JZ      ?C0072
000A E0                MOVX    A,@DPTR
000B 6401              XRL     A,#01H
000D 7039              JNZ     ?C0071
000F         ?C0072:
                                           ; SOURCE LINE # 586
                                           ; SOURCE LINE # 587
000F 900000      R     MOV     DPTR,#state
0012 E0                MOVX    A,@DPTR
0013 30E107            JNB     ACC.1,?C0073
                                           ; SOURCE LINE # 588
                                           ; SOURCE LINE # 589
0016 A3                INC     DPTR
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 30  

0017 E0                MOVX    A,@DPTR
0018 FD                MOV     R5,A
0019 7F12              MOV     R7,#012H
                                           ; SOURCE LINE # 602
001B 8028              SJMP    ?C0124
001D         ?C0073:
                                           ; SOURCE LINE # 603
001D 900000      R     MOV     DPTR,#state
0020 E0                MOVX    A,@DPTR
0021 30E307            JNB     ACC.3,?C0075
                                           ; SOURCE LINE # 604
                                           ; SOURCE LINE # 605
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 FD                MOV     R5,A
0027 7F11              MOV     R7,#011H
0029         ?C0122:
                                           ; SOURCE LINE # 606
0029 801A              SJMP    ?C0124
002B         ?C0075:
                                           ; SOURCE LINE # 607
002B 900000      R     MOV     DPTR,#state
002E E0                MOVX    A,@DPTR
002F 30E407            JNB     ACC.4,?C0077
                                           ; SOURCE LINE # 608
                                           ; SOURCE LINE # 609
0032 A3                INC     DPTR
0033 E0                MOVX    A,@DPTR
0034 FD                MOV     R5,A
0035 7F14              MOV     R7,#014H
0037         ?C0123:
                                           ; SOURCE LINE # 610
0037 800C              SJMP    ?C0124
0039         ?C0077:
                                           ; SOURCE LINE # 611
0039 900000      R     MOV     DPTR,#state
003C E0                MOVX    A,@DPTR
003D 30E208            JNB     ACC.2,?C0071
                                           ; SOURCE LINE # 612
                                           ; SOURCE LINE # 613
0040 A3                INC     DPTR
0041 E0                MOVX    A,@DPTR
0042 FD                MOV     R5,A
0043 7F59              MOV     R7,#059H
0045         ?C0124:
0045 120000      R     LCALL   _simple_code
                                           ; SOURCE LINE # 626
                                           ; SOURCE LINE # 631
0048         ?C0071:
                                           ; SOURCE LINE # 633
0048 900000      R     MOV     DPTR,#event
004B E0                MOVX    A,@DPTR
004C 7010              JNZ     ?C0080
                                           ; SOURCE LINE # 634
                                           ; SOURCE LINE # 636
004E 900000      R     MOV     DPTR,#state
0051 E0                MOVX    A,@DPTR
0052 FF                MOV     R7,A
0053 7800        E     MOV     R0,#LOW temp_scanner_state
0055 46                ORL     A,@R0
0056 F6                MOV     @R0,A
                                           ; SOURCE LINE # 637
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 31  

0057 EF                MOV     A,R7
0058 30E61D            JNB     ACC.6,?C0086
                                           ; SOURCE LINE # 638
                                           ; SOURCE LINE # 639
005B 020000      E     LJMP    Hook_Fn_Key_Make
                                           ; SOURCE LINE # 643
                                           ; SOURCE LINE # 644
005E         ?C0080:
                                           ; SOURCE LINE # 645
005E 900000      R     MOV     DPTR,#event
0061 E0                MOVX    A,@DPTR
0062 B40113            CJNE    A,#01H,?C0086
                                           ; SOURCE LINE # 646
                                           ; SOURCE LINE # 647
0065 900000      R     MOV     DPTR,#state
0068 E0                MOVX    A,@DPTR
0069 30E603            JNB     ACC.6,?C0084
                                           ; SOURCE LINE # 648
                                           ; SOURCE LINE # 649
006C 120000      E     LCALL   Hook_Fn_Key_Break
                                           ; SOURCE LINE # 650
006F         ?C0084:
                                           ; SOURCE LINE # 651
006F 900000      R     MOV     DPTR,#state
0072 E0                MOVX    A,@DPTR
0073 F4                CPL     A
0074 7800        E     MOV     R0,#LOW temp_scanner_state
0076 56                ANL     A,@R0
0077 F6                MOV     @R0,A
                                           ; SOURCE LINE # 652
                                           ; SOURCE LINE # 654
                                           ; SOURCE LINE # 656
                                           ; SOURCE LINE # 657
0078         ?C0086:
0078 22                RET     
             ; FUNCTION _control_effect (END)

             ; FUNCTION _control_effect_e0 (BEGIN)
                                           ; SOURCE LINE # 681
0000 900000      R     MOV     DPTR,#state
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 682
                                           ; SOURCE LINE # 683
0008 6005              JZ      ?C0088
000A E0                MOVX    A,@DPTR
000B 6401              XRL     A,#01H
000D 701E              JNZ     ?C0087
000F         ?C0088:
                                           ; SOURCE LINE # 684
                                           ; SOURCE LINE # 686
000F 900000      R     MOV     DPTR,#state
0012 E0                MOVX    A,@DPTR
0013 30E308            JNB     ACC.3,?C0089
                                           ; SOURCE LINE # 687
                                           ; SOURCE LINE # 688
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 FD                MOV     R5,A
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 32  

0019 7F11              MOV     R7,#011H
001B 120000      R     LCALL   _e0_prefix_code
                                           ; SOURCE LINE # 689
001E         ?C0089:
                                           ; SOURCE LINE # 690
001E 900000      R     MOV     DPTR,#state
0021 E0                MOVX    A,@DPTR
0022 30E408            JNB     ACC.4,?C0087
                                           ; SOURCE LINE # 691
                                           ; SOURCE LINE # 692
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FD                MOV     R5,A
0028 7F14              MOV     R7,#014H
002A 120000      R     LCALL   _e0_prefix_code
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 694
002D         ?C0087:
                                           ; SOURCE LINE # 696
002D 900000      R     MOV     DPTR,#event
0030 E0                MOVX    A,@DPTR
0031 FF                MOV     R7,A
0032 7009              JNZ     ?C0091
                                           ; SOURCE LINE # 697
                                           ; SOURCE LINE # 699
0034 900000      R     MOV     DPTR,#state
0037 E0                MOVX    A,@DPTR
0038 7800        E     MOV     R0,#LOW temp_scanner_state
003A 46                ORL     A,@R0
003B F6                MOV     @R0,A
                                           ; SOURCE LINE # 700
003C 22                RET     
003D         ?C0091:
                                           ; SOURCE LINE # 701
003D EF                MOV     A,R7
003E B40109            CJNE    A,#01H,?C0095
                                           ; SOURCE LINE # 702
                                           ; SOURCE LINE # 704
0041 900000      R     MOV     DPTR,#state
0044 E0                MOVX    A,@DPTR
0045 F4                CPL     A
0046 7800        E     MOV     R0,#LOW temp_scanner_state
0048 56                ANL     A,@R0
0049 F6                MOV     @R0,A
                                           ; SOURCE LINE # 705
                                           ; SOURCE LINE # 707
                                           ; SOURCE LINE # 709
                                           ; SOURCE LINE # 710
004A         ?C0095:
004A 22                RET     
             ; FUNCTION _control_effect_e0 (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1314    ----
   CONSTANT SIZE    =     67    ----
   XDATA SIZE       =   ----      25
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V8.12   CORE_XLT                                                              07/28/2018 12:03:37 PAGE 33  

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
