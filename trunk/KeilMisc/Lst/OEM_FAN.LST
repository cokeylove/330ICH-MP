C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE OEM_FAN
OBJECT MODULE PLACED IN Code\OEM\OEM_FAN.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\OEM\OEM_FAN.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\INC
                    -LUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_FAN.C
   3           *
   4           * Author : Dino
   5           *
   6           * Note : These functions are reference only.
   7           *        Please follow your project software specification to do some modification.
   8           *---------------------------------------------------------------------------*/
   9          
  10          #include <CORE_INCLUDE.H>
  11          #include <OEM_INCLUDE.H>
  12          
  13          
  14          
  15          /*****************************************************************************/
  16          // Procedure: PWM_TimeCount                                                                     TimeDiv: 50mSec
  17          // Description: PWM Beep function.
  18          // GPIO:
  19          // Referrals: Service short time PWM output, base on 50ms.
  20          /*****************************************************************************/
  21          void PWM_TimeCount(void)
  22          {
  23   1              if (uReserve07.fbit.uACInOutBeep == 0)
  24   1              {
  25   2                      if( PWM_LEDBeep_CNT == 0x00 )
  26   2                      {
  27   3                              BEEP_INIT;
  28   3                              PWM_BEEP = 0x00;
  29   3                              return;
  30   3                      }
  31   2      
  32   2                      BEEP_ALT;
  33   2                      PWM_LEDBeep_CNT--;              // decrease timer
  34   2                      // AC IN/OUT beep time
  35   2                      if( PWM_LEDBeep_CNT == 0x00 )
  36   2                      {
  37   3                              BEEP_INIT;
  38   3                              PWM_BEEP = 0x00;
  39   3                      }
  40   2              }
  41   1              else
  42   1              {
  43   2                      PWM_LEDBeep_CNT = 0;
  44   2                      BEEP_INIT;
  45   2                      PWM_BEEP = 0x00;
  46   2              }
  47   1      }
  48          
  49          /*****************************************************************************/
  50          // Procedure: ThmIC_Temperature                                                         TimeDiv: 500mSec
  51          // Description: Read RAM temperature
  52          // GPIO:
  53          // Referrals:
  54          /*****************************************************************************/
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 2   

  55          extern void TempProtect_VRAM(void);
  56          void ThmIC_Temperature(void)
  57          {
  58   1              BYTE BsData,BTmlCmd;
  59   1      
  60   1              if( SystemNotS0 || (PwrOnDly5Sec!=0) )   //T089: add PwrOnDly5Sec judge.
  61   1              { return; }
  62   1              //Tml_SMLink();
  63   1              //TempProtect_VRAM();   
  64   1          //return; 
  65   1      
  66   1              switch( TmlICStep & 0x03 )  //  Change TmlICStep from 7 to 3
  67   1              {
  68   2              case 0:
  69   2                      BTmlCmd = VRAM_Temp;
  70   2                      break;
  71   2              /*case 1:
  72   2              BTmlCmd = SSD_Temp; 
  73   2              BTmlCmd =TmlIC_Temp;
  74   2              break;*///Remove thermal IC read remote 2 temperature
  75   2              case 1:
  76   2                      BTmlCmd =TmlIC_Temp;
  77   2                      break;
  78   2              //case 3:  //change  2 to 3
  79   2                      //Tml_SMLink();
  80   2                      //return;
  81   2                      //break;
  82   2              default:
  83   2                      TmlICStep = 0;
  84   2                      return;
  85   2              }
  86   1              //bWSMBusBlock(SMbusCh4, SMbusWBK, TmlIC_Addr, 0x01, &BATchallenger, 20, TRUE);
  87   1      
  88   1              if(!bRWSMBus(SMbusCh4, SMbusRB, TmlIC_Addr, BTmlCmd, &BsData, 0))  
  89   1              //if((!bRWSMBus(SMbusCh4, SMbusRB, TmlIC_Addr, BTmlCmd, &BsData, 0))&&MBID_READY&&(!((uMBID&0x10)&&(uMBID
             -&0x20)))&&((uMBID&0x20)&&(!(uMBID&0x10))&&(VRAM_Temp==BTmlCmd)))
  90   1              {      //  1. SMBus fail; 2. MBID OK; 3.  no UMA 37W ; 4.  no UMA 47W VRAM sensor  
  91   2                      TMErrCnt++;
  92   2                      if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
  93   2                      {
  94   3                              if ( TMErrCnt > 7 )             // 3 Sec.
  95   3                              {
  96   4                                      SET_MASK(ERR_THMSTS, b0ThmICError);     // Set bit0 Thermal IC read temperature error.
  97   4                              }
  98   3                      }
  99   2                      else
 100   2                      {
 101   3                              if ( TMErrCnt > 68 )    // 30 Sec.
 102   3                              {
 103   4                                      ProcessSID(THERMALCOMMFAIL_ID); // 0x0B shutdown ID.
 104   4                                      TMErrCnt = 0;                                   // Clear error count.
 105   4                                      //RSMRST_LOW();  
 106   4                                      //Delay1MS(1); //ANGELAS050:remove
 107   4                                      //RSMRST_HI();   
 108   4                                      //TmlICStep++;
 109   4                              }
 110   3                      }
 111   2                      ResetSMBus(SMbusCh4);
 112   2              }
 113   1              else
 114   1              { 
 115   2      //ANGELAG023: remove start
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 3   

 116   2              /*      if(BsData == 0x00)      // read 0'C  
 117   2                      //if((BsData == 0x00)&&MBID_READY&&(!((uMBID&0x10)&&(uMBID&0x20)))&&((uMBID&0x20)&&(!(uMBID&0x10))&&(VRA
             -M_Temp==BTmlCmd)))
 118   2                      {
 119   2                              TMErrCnt++;
 120   2                              if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
 121   2                              {
 122   2                                      if ( TMErrCnt > 7 )             // 3 Sec.
 123   2                                      {
 124   2                                              SET_MASK(ERR_THMSTS, b0ThmICError);     // Set bit0 Thermal IC read temperature error.
 125   2                                      }
 126   2                              }
 127   2                              else
 128   2                              {
 129   2                                      if ( TMErrCnt > 68 )    // 30 Sec.
 130   2                                      {
 131   2                                              ProcessSID(THERMALCOMMFAIL_ID); // 0x0B shutdown ID.
 132   2                                              TMErrCnt = 0;                                   // Clear error count.
 133   2                                          //RSMRST_LOW(); 
 134   2                                          //Delay1MS(1); //ANGELAS050:remove
 135   2                                          //RSMRST_HI();  
 136   2                                          //TmlICStep++;
 137   2                                      }
 138   2                              }
 139   2                      }
 140   2                      
 141   2                      else
 142   2                      
 143   2                      {
 144   2                      */ //ANGELAG023: remove end
 145   2                              switch( TmlICStep & 0x03 )
 146   2                              {
 147   3                              case 0:
 148   3                                      nVramTemp = BsData;     // Save VRAM temperature.
 149   3                                      TMErrCnt = 00;          // Clear error count.
 150   3                                      CLEAR_MASK(ERR_THMSTS,b0ThmICError);    // Clear bit0.
 151   3                                      TmlICStep++;            // next step 1.
 152   3                                      break;
 153   3                              /*case 1:
 154   3                                      nNBTemp = BsData;       // Save SSD temperature.
 155   3                                      EXTVGA_TEMP=nNBTemp; //T034+
 156   3                                      TMErrCnt = 00;          // Clear error count.
 157   3                                      CLEAR_MASK(ERR_THMSTS,b0ThmICError);    // Clear bit0.
 158   3                                      TmlICStep++;            // next step 2.
 159   3                                      break;*/      //Remove thermal IC read remote 2 temperature
 160   3                              case 1:
 161   3                                      nRamTemp = BsData;      // Save RAM temperature.
 162   3                                      TMErrCnt = 00;          // Clear error count.
 163   3                                      CLEAR_MASK(ERR_THMSTS,b0ThmICError);    // Clear bit0.
 164   3                                      TmlICStep++;            // next step 2.
 165   3                                      break;
 166   3                              default:
 167   3                                      break;
 168   3                              }
 169   2                      // } //ANGELAG023: remove
 170   2              }
 171   1      
 172   1      }
 173          //-----------------------------------------------------------------------------
 174          // Service short time PWM output, base on 50ms.
 175          //-----------------------------------------------------------------------------
 176          /* //ANGELAS050:remove start
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 4   

 177          void Tml_SMLink(void)
 178          {
 179                  if( !bRSMBusBlock(SMbusCh4, SMbusRBK, 0x96, 0x40, &MaxCPU_MCHTemp))//, 0x14, TRUE))
 180                  {
 181                          TMErrCnt++;
 182                          if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
 183                          {
 184                                  if ( TMErrCnt > 35 )    //change 7 to 35        // 3 Sec.
 185                                  {
 186                                          SET_MASK(ERR_THMSTS, b0ThmICError);     // Set bit0 Thermal IC read temperature error.
 187                                  }
 188                          }
 189                          else
 190                          {
 191                                  if ( TMErrCnt > 254 ) //change 68 to 254        // 30 Sec.
 192                                  {
 193                                          //ProcessSID(THERMALCOMMFAIL_ID);       // 0x0B shutdown ID.
 194                                          TMErrCnt = 0;                                   // Clear error count.
 195                                          //RSMRST_LOW();
 196                                          //Delay1MS(1);
 197                                          //RSMRST_HI();
 198                                  }
 199                          }
 200                          ResetSMBus(SMbusCh4);
 201                  }
 202                  else
 203                  {
 204                          nOSShutdownTemp3 = MaxCPU_MCHTemp;              // Save PCH temperature.
 205                          CLEAR_MASK(ERR_THMSTS,b0ThmICError);    // Clear bit0.
 206                          TMErrCnt = 0;                                                   // Clear error count.
 207                          TmlICStep = 0;                                                  // Reset Step.
 208                  }
 209          }
 210          *///ANGELAS050:remove end
 211          /*****************************************************************************/
 212          // Procedure:                                                   TimeDiv: 500mSec
 213          // Description:  
 214          // GPIO:  
 215          // Referrals:
 216          /*****************************************************************************/
 217          /* ANGELAS050:remove start
 218          void TempProtect_VRAM(void)
 219          {
 220                          BYTE BsData,BTmlCmd;
 221                          BTmlCmd = SSD_Temp;//change SSD_Temp to SSD_Temp
 222                  
 223          
 224          
 225                          //if((!bRWSMBus(SMbusCh4, SMbusRB, TmlIC_Addr, BTmlCmd, &BsData, 0))&&MBID_READY&&(!(uMBID&0x20)))
 226                          if(!bRWSMBus(SMbusCh4, SMbusRB, TmlIC_Addr, BTmlCmd, &BsData, 0))// REMOVE MBID_READY judge
 227                          {        
 228                                  TMErrCnt++;
 229                                  if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
 230                                  {
 231                                          if ( TMErrCnt > 7 )     // 3 Sec.
 232                                          {
 233                                                  SET_MASK(ERR_THMSTS, b0ThmICError); // Set bit0 Thermal IC read temperature error.
 234                                          }
 235                                  }
 236                                  else
 237                                  {
 238                                          if ( TMErrCnt > 68 )    // 30 Sec.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 5   

 239                                          {
 240                                                  //ProcessSID(THERMALCOMMFAIL_ID); // 0x0B shutdown ID.
 241                                                  TMErrCnt = 0;                                   // Clear error count.
 242                                                  //RSMRST_LOW();  
 243                                                  //Delay1MS(1);
 244                                                  //RSMRST_HI();
 245                                          }
 246                                  }
 247                                  ResetSMBus(SMbusCh4);
 248                          }
 249                          else
 250                          { 
 251                          if(BsData == 0x00)// REMOVE MBID_READY judge
 252                                  //if((BsData == 0x00)&&MBID_READY&&(!(uMBID&0x20)))
 253                                  {
 254                                          TMErrCnt++;
 255                                          if( IS_MASK_CLEAR(ERR_THMSTS, b0ThmICError) )// Check bit0 is Error.
 256                                          {
 257                                                  if ( TMErrCnt > 7 )     // 3 Sec.
 258                                                  {
 259                                                          SET_MASK(ERR_THMSTS, b0ThmICError); // Set bit0 Thermal IC read temperature error.
 260                                                  }
 261                                          }
 262                                          else
 263                                          {
 264                                                  if ( TMErrCnt > 68 )    // 30 Sec.
 265                                                  {
 266                                                          //ProcessSID(THERMALCOMMFAIL_ID); // 0x0B shutdown ID.
 267                                                          TMErrCnt = 0;                                   // Clear error count.
 268                                                            // RSMRST_LOW(); 
 269                                                           //  Delay1MS(1);
 270                                                           //  RSMRST_HI();       
 271                                                  }
 272                                          }
 273                                  }
 274                                  else
 275                                  {
 276          
 277                                                          //nVramTemp = BsData; // Save VRAM temperature.  
 278                                                          nNBTemp=BsData;  
 279                                                          TMErrCnt = 00;          // Clear error count.
 280                                                          CLEAR_MASK(ERR_THMSTS,b0ThmICError);    // Clear bit0.
 281                                                          if(nNBTemp>=85) //change nVramTemp to nNBTemp
 282                                                          {
 283                                                            // ProcessSID(ThermalICOVerTEPM_ID); // 0x0B shutdown ID.
 284                                                             //RSMRST_LOW(); 
 285                                                            // Delay1MS(1);
 286                                                            // RSMRST_HI();               
 287                                                          }
 288                                  }
 289                            }
 290          }
 291          
 292          *///ANGELAS050:remove end
 293          /*****************************************************************************/
 294          // Procedure: VGA_Temperature                                                           TimeDiv: 500mSec
 295          // Description: Read VGA temperature(M/B)
 296          // GPIO: GPIOF6(118)
 297          // Referrals:
 298          /*****************************************************************************/
 299          void VGA_Temperature(void)
 300          {
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 6   

 301   1              BYTE BsData;
 302   1              //Add read AMD GPU thermal temperature  start
 303   1      //      BYTE INIT_GPU_REG2[4] = {0x0f, 0x00, 0x01, 0xC5}; //ANGELAG016: remove
 304   1      //ANGELAG016: add start
 305   1               BYTE INIT_GPU_REG2[4] = {0x0f, 0x00, 0x00, 0x8f};
 306   1              BYTE INIT_GPU_REG1[4] = {0x0f, 0x00, 0x00, 0x8e};
 307   1              BYTE INIT_GPU_REG0[4] = {0xc0, 0x30, 0x00, 0x14};
 308   1      //ANGELAG016: add end
 309   1              if ( (CPU_TYPE & 0xC0) == 0x00 )        // Isn't check VGA support optimus?
 310   1              { nHybridGraphicsDIS;}                          // No optimus status.
 311   1              else
 312   1              { nHybridGraphicsEN; }                          // optimus status.
 313   1      
 314   1              //if( SystemNotS0 || (PwrOnDly5Sec!=0) )         //T089: add PwrOnDly5Sec judge.
 315   1      
 316   1              // Check S0 and  VGA into.
 317   1              if( SystemNotS0 || !(nHybridGraphicsGET)|| (PwrOnDly5Sec!=0) ) //== to != // add PwrOnDly5Sec judge.modif
             -y nHybridGraphicsGET not take a reverse value 
 318   1              {  
 319   2              VGAErrCnt = 00;  
 320   2              //VGA_TEMP=0; //ANGELAG018: remove
 321   2              //VGA_TBuff3=0; //ANGELAG018: remove
 322   2              VGA_TEMP = VGA_TBuff3 = VGA_TBuff2 = VGA_TBuff1 = 0x00; //ANGELAG018: add
 323   2              CLEAR_MASK(ERR_THMSTS,b1VGATempEr); 
 324   2              return; 
 325   2          }
 326   1           
 327   1              if((CPU_TYPE &0xc0)==0x40)
 328   1              {
 329   2      //ANGELAG016: add start
 330   2              if(!bWSMBusBlock(SMbusCh4, SMbusWBK, VGA_Addr, 0x01,( BYTE* )&INIT_GPU_REG1,4,0))//load GPU register offs
             -et to SMB_ADDR
 331   2                      {
 332   3                      VGAErrCnt++;
 333   3                      }
 334   2              if(!bWSMBusBlock(SMbusCh4, SMbusWBK, VGA_Addr, 0x02,( BYTE* )&INIT_GPU_REG0,4,0))//sent data to be writt
             -en into the DGPU rgister
 335   2                      {
 336   3                      VGAErrCnt++;
 337   3                      }
 338   2      
 339   2              if(!bWSMBusBlock(SMbusCh4, SMbusWBK, VGA_Addr, 0x01,( BYTE* )&INIT_GPU_REG2,4,0))//load GPU register offs
             -et to SMB_ADDR
 340   2                      {
 341   3                      VGAErrCnt++;
 342   3                      }
 343   2      //ANGELAG016: add end
 344   2      //ANGELAG016: remove start
 345   2              /*      if(!bWSMBusBlock(SMbusCh4, SMbusWBK, VGA_Addr, 0x01, &INIT_GPU_REG2, 4,0))
 346   2                      {
 347   2                              VGAErrCnt++;
 348   2                      }*/
 349   2      //ANGELAG016: remove end
 350   2                              
 351   2                      //vgaok=1;
 352   2                      
 353   2                      if(!bRSMBusBlock(SMbusCh4, SMbusRBK, VGA_Addr, 0x03, &sdAMDTH0))
 354   2                      {
 355   3                              VGAErrCnt++;
 356   3                              if( IS_MASK_CLEAR(ERR_THMSTS, b1VGATempEr) )// Check bit1 is Error.
 357   3                              {
 358   4                                      if ( VGAErrCnt > 35 )   //change 7 to 35  // 3 Sec.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 7   

 359   4                                      {
 360   5                                              SET_MASK(ERR_THMSTS, b1VGATempEr);      // Set bit1 Thermal IC read temperature error.
 361   5                                      }
 362   4                              }
 363   3                              else
 364   3                              {
 365   4                                      if ( VGAErrCnt > 254 )          // from 68 to 255       // 30 Sec.
 366   4                                      {
 367   5                                              SET_MASK(SysStatus,ERR_ShuntDownFlag);
 368   5                                              ProcessSID(VGACOMMFAIL_ID);     // 0x20 shutdown ID.
 369   5                                              VGAErrCnt = 00;                         // Clear error count.
 370   5                                              RSMRST_LOW();
 371   5                                              Delay1MS(1);
 372   5                                              RSMRST_HI();
 373   5                                      }
 374   4                              }
 375   3                              ResetSMBus(SMbusCh4);
 376   3                      }
 377   2                      //sdAMDTH0=sdAMDTH0<<24;
 378   2                      else
 379   2                      {
 380   3                              //VGA_TEMP=sdAMDTH0&0xff; //ANGELAG018: remove
 381   3                              VGA_TEMP=((sdAMDTH2>>1)+((sdAMDTH3<<8)&0XFF)); //ANGELAG018: add
 382   3                              VGAErrCnt = 00;         // Clear error count.
 383   3                              CLEAR_MASK(ERR_THMSTS,b1VGATempEr);     // Clear bit1,bit5.
 384   3      
 385   3                              if ( IS_MASK_CLEAR(Fan_Debug_Temp,b1VGA_Temp) ) // Debug VGA Temperature, Engineer myself control.
 386   3                              {
 387   4                              if((VGA_TEMP&0x80)==0x80)//Filter the value of the GPU temperature greater than 128 // optimize G69
             -.
 388   4                              {
 389   5                                      return;
 390   5                              }  
 391   4                              else
 392   4                                      {
 393   5                                              VGA_TBuff3 = VGA_TBuff2;
 394   5                                              VGA_TBuff2 = VGA_TBuff1;
 395   5                                              VGA_TBuff1 = VGA_TEMP;
 396   5                                              VGA_TBuff3 = (VGA_TBuff1 + VGA_TBuff2 + VGA_TBuff3)/3;          // VGA average temperature.
 397   5                      }
 398   4                              }
 399   3                      }
 400   2              }
 401   1              //Add read AMD GPU thermal temperature end
 402   1              if((CPU_TYPE &0xc0)==0x80)
 403   1              {
 404   2                      if(!bRWSMBus(SMbusCh4, SMbusRB, EXTVGA_Addr, 0x00, &BsData, 0))// REMOVE MBID_READY judge
 405   2      
 406   2                      //if((!bRWSMBus(SMbusCh4, SMbusRB, VGA_Addr, TmlIC_Temp, &BsData, 0))&&MBID_READY&&(!(uMBID&0x20))) //ad
             -d MBID judge.
 407   2                      {
 408   3                      VGAErrCnt++;
 409   3                              if( IS_MASK_CLEAR(ERR_THMSTS, b1VGATempEr) )// Check bit1 is Error.
 410   3                              {
 411   4                                      if ( VGAErrCnt > 35 )   //change 7 to 35  // 3 Sec.
 412   4                                      {
 413   5                                              SET_MASK(ERR_THMSTS, b1VGATempEr);      // Set bit1 Thermal IC read temperature error.
 414   5                                      }
 415   4                              }
 416   3                              else
 417   3                              {
 418   4                                      if ( VGAErrCnt > 254 )          // from 68 to 255       // 30 Sec.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 8   

 419   4                                      {
 420   5                                              SET_MASK(SysStatus,ERR_ShuntDownFlag);
 421   5                                              ProcessSID(VGACOMMFAIL_ID);     // 0x20 shutdown ID.
 422   5                                              VGAErrCnt = 00;                         // Clear error count.
 423   5                                              RSMRST_LOW();
 424   5                                              Delay1MS(1);
 425   5                                              RSMRST_HI();
 426   5                                      }
 427   4                              }
 428   3                              ResetSMBus(SMbusCh4);
 429   3                      }
 430   2                      else
 431   2                      {
 432   3                      /* //ANGELAG023: remove start
 433   3                              if(BsData == 0x00)      // read 0'C  // REMOVE MBID_READY judge
 434   3                              //if((BsData == 0x00)&&MBID_READY&&(!(uMBID&0x20)))// read 0'C 
 435   3                              {
 436   3                      VGA_TEMP = BsData;      
 437   3                                      VGAErrCnt++;
 438   3                                      if( IS_MASK_CLEAR(ERR_THMSTS, b1VGATempEr) )// Check bit1 is Error.
 439   3                                      {
 440   3                                              if ( VGAErrCnt > 7 )    // 3 Sec.
 441   3                                              {
 442   3                                                      SET_MASK(ERR_THMSTS, b1VGATempEr);      // Set bit1 Thermal IC read temperature error.
 443   3                                              }
 444   3                                      }
 445   3                                      else
 446   3                                      {
 447   3                                              if ( VGAErrCnt > 68 )                   // 30 Sec.
 448   3                                              {
 449   3                                                      SET_MASK(SysStatus,ERR_ShuntDownFlag);
 450   3                                                      ProcessSID(VGACOMMFAIL_ID);     // 0x20 shutdown ID.
 451   3                                                      VGAErrCnt = 00;                         // Clear error count.
 452   3                                                      RSMRST_LOW();
 453   3                                                      Delay1MS(1);
 454   3                                                      RSMRST_HI();
 455   3                                              }
 456   3                                      }
 457   3                              }
 458   3                              else
 459   3                              
 460   3                              {
 461   3                              */ ////ANGELAG023: remove end
 462   3                                      VGA_TEMP = BsData;
 463   3                                      VGAErrCnt = 00;         // Clear error count.
 464   3                                      CLEAR_MASK(ERR_THMSTS,b1VGATempEr);     // Clear bit1,bit5.
 465   3      
 466   3                                      if ( IS_MASK_CLEAR(Fan_Debug_Temp,b1VGA_Temp) ) // Debug VGA Temperature, Engineer myself control.
 467   3                                      {
 468   4                                              if((VGA_TEMP&0x80)==0x80)//Filter the value of the GPU temperature greater than 128// optimize G69
 469   4                              {
 470   5                                      return;
 471   5                              }  
 472   4                                      else
 473   4                                              {
 474   5                                                      VGA_TBuff3 = VGA_TBuff2;
 475   5                                                      VGA_TBuff2 = VGA_TBuff1;
 476   5                                                      VGA_TBuff1 = VGA_TEMP;
 477   5                                                      VGA_TBuff3 = (VGA_TBuff1 + VGA_TBuff2 + VGA_TBuff3)/3;          // VGA average temperature.
 478   5                                              }
 479   4                                      }
 480   3                              // }  ////ANGELAG023: remove
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 9   

 481   3                      }
 482   2              }
 483   1          
 484   1      }
 485          
 486          
 487          
 488          /*****************************************************************************/
 489          // Procedure: Oem_Thermal_Control                                                               TimeDiv: 1 Sec
 490          // Description: Read CPU temperature
 491          // GPIO: GPIOF6(118)
 492          // Referrals:
 493          /*****************************************************************************/
 494          void Oem_Thermal_Control(void)
 495          {
 496   1              //if(SystemIsS0&& (PwrOnDly5Sec==0)) //add PwrOnDly5Sec judge.
 497   1              //if(SystemIsS0&& (PwrOnDly5Sec==0)&&Read_SLPS3() && Read_SLPS4()&&(PECIBIOSTEST==0)) //add PwrOnDly5Sec 
             -judge.//owhen enter S3/S4/CB,BIOS sent B4 CMD to EC from 66port for peci fail.// Remove PECI workaround.
 498   1              if(SystemIsS0&& (PwrOnDly5Sec==0)&&Read_SLPS3() && Read_SLPS4())// PECI workaround.
 499   1              {
 500   2                      if(TJMAX == 0x00)
 501   2                      {
 502   3                              PECI_ReadCPUTJMAX();
 503   3                              CPU_TYPE = CPU_TYPE & 0xFC; //
 504   3                              if (TJMAX == 105)                       //105
 505   3                                      CPU_TYPE |= 0x03;
 506   3                              else if (TJMAX == 100)          //100
 507   3                                      CPU_TYPE |= 0x02;
 508   3                              else if (TJMAX == 90)           //90
 509   3                                      CPU_TYPE |= 0x01;
 510   3                      }
 511   2                      else
 512   2                      { PECI_ReadCPUTemp(); }
 513   2                      //Optimize read CPU temperature function.
 514   2                      if( IS_MASK_SET(ERR_THMSTS, b3PECITempEr) )
 515   2                      {
 516   3                              DTS_ReadCPUTemp();
 517   3                      }
 518   2                      //0ptimize read CPU temperature function.
 519   2              }
 520   1      }
 521          
 522          
 523          
 524          
 525          
 526          
 527          
 528          
 529          
 530          /*****************************************************************************/
 531          // Procedure: OEM_Throttling_Ctrl                                                               TimeDiv: 1 Sec
 532          // Description: System CPU/GPU Throttling Data
 533          // GPIO:
 534          // Referrals:  CPU/GPU Temperature
 535          /*****************************************************************************/
 536          //-----------------------------------------------------------------------------
 537          /*const CPUTHRstruct code CPUTHRTable[]= //ANGELAG006: remove start
 538          { //      Thr_Off  Thr_On  Turbo_Rem   Turbo_Off    Thr_Shut           Step  Tjxx  Throttling Table
 539          //-----------------------------------------------------------------------------
 540                  {       90,     98,             55,     60,             100 },  // 0 for DIS CPU 14'  //MEILING019:modify fan table start.  //MEILING024:c
             -hange cpu turbo off from 70 to 65.  //MEILING040:modify turbo on/off start.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 10  

 541                  {       92,     99,             57,     61,             105 },  // 1 for DIS GPU 14'
 542                  
 543                  {       90,     98,             59,     64,             100 },  // 2 for UMA CPU 14'  //MEILING024:change cpu turbo on from 60 to 65. //ME
             -ILING033:modify turbo on/off.
 544                  {       100,    100,            100,    100,            100 },  // 3 for UMA GPU 14'
 545          
 546                  {       90,     98,             55,     60,             100 },  // 4 for DIS CPU 15'  //MEILING024:change cpu turbo off from 70 to 65.  //
             -MEILING033:modify turbo on/off.
 547                  {       92,     99,             57,     61,             105 },  // 5 for DIS GPU 15'  //MEILING033:modify turbo on/off.
 548                  
 549                  {       90,     98,             58,     62,             100 },  // 6 for UMA CPU 15'  //MEILING024:change cpu turbo off from 60 to 65.  //
             -MEILING033:modify turbo on/off.  //MEILING040:modify turbo on/off end.
 550                  {       100,    100,            100,    100,            100 },  // 7 for UMA GPU 15'
 551          
 552                  {       90,             98,                     55,             60,                     100     },  // 8 for DIS CPU 17'
 553                  {       92,         99,         57,             61,                     105     },  // 9 for DIS GPU 17'
 554          
 555                  {       90,             98,                     58,             62,                     100     },  // 10 for UMA CPU 17'
 556                  {       100,    100,            100,    100,            100     }   // 11 for UMA GPU 17'  //MEILING019:modify fan table end.
 557          
 558          };*/ //ANGELAG006: remove end
 559          
 560          //ANGELAG006: add start
 561          const CPUTHRstruct code CPUTHRTable[]=
 562          { //      Thr_Off  Thr_On  Turbo_Rem   Turbo_Off    Thr_Shut           Step  Tjxx  Throttling Table
 563          //-----------------------------------------------------------------------------
 564                  {       92,     97,             80,             85,             99 },   // 0 for DIS CPU 14' //ANGELAG028: 68 to 65 //ANGELAG027: modify to 60/68 
             -//MEILING019:modify fan table start.  //MEILING024:change cpu turbo off from 70 to 65.  //MEILING040:modify turbo on/off
             - start.//COKEYXU006:refer to Fan table v02_1220.
 565                  {       92,     97,             60,             65,             99 },   // 1 for DIS GPU 14' //ANGELAG046: modify 65/70 to 62/67 //ANGELAG043: 60/
             -65 to 65/70  //COKEYXU006:refer to Fan table v02_1220.
 566                  
 567                  {       88,     97,             77,             82,             100 },  // 2 for UMA CPU 14'  //MEILING024:change cpu turbo on from 60 to 65. //M
             -EILING033:modify turbo on/off.
 568                  {       100,    100,            100,            100,            100 },  // 3 for UMA GPU 14' 
 569          
 570                  {       92,     97,             80,             85,             99 },   // 4 for DIS CPU 15' //ANGELAG028: 68 to 65  //ANGELAG027: modify to 60/68
             - //MEILING024:change cpu turbo off from 70 to 65.  //MEILING033:modify turbo on/off. //COKEYXU006:refer to Fan table v02
             -_1220.
 571                  {       92,     97,             60,             65,             99 },   // 5 for DIS GPU 15'  //ANGELAG046: modify 65/70 to 62/67  //ANGELAG043: 6
             -0/65 to 65/70 //MEILING033:modify turbo on/off. //COKEYXU006:refer to Fan table v02_1220.
 572                  
 573                  {       88,     97,             77,             82,             100 },  // 6 for UMA CPU 15'  //MEILING024:change cpu turbo off from 60 to 65.  /
             -/MEILING033:modify turbo on/off.  //MEILING040:modify turbo on/off end.
 574                  {       100,    100,            100,            100,            100 },  // 7 for UMA GPU 15'
 575          
 576                  {       92,     97,             80,             85,             99 },  // 8 for DIS CPU 17' //ANGELAG028: 68 to 65  //ANGELAG027: modify to 60/6
             -8   //COKEYXU006:refer to Fan table v02_1220.
 577                  {       92,     97,             60,             65,             99 },  // 9 for DIS GPU 17' //ANGELAG046: modify 65/70 to 62/67  //ANGELAG043: 6
             -0/65 to 65/70   //COKEYXU006:refer to Fan table v02_1220.
 578          
 579                  {       88,             97,                     77,                     82,                     100     },  // 10 for UMA CPU 17'
 580                  {       100,    100,            100,            100,            100     }   // 11 for UMA GPU 17'  //MEILING019:modify fan table end.
 581          
 582          };
 583          //ANGELAG006: add end
 584          
 585          void OEM_Throttling_Ctrl(void)
 586          {
 587   1              BYTE BTemp_Type,BTbStep;
 588   1              
 589   1              BTbStep = 0;//MEILING023:add.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 11  

 590   1      
 591   1              if( SystemNotS0 ) // modify cpu keep max p_state,when battery RSOC>5% under DC mode.
 592   1              //if( (SystemNotS0&&IS_MASK_SET(SYS_STATUS,AC_ADP))|| ((BAT1PERCL>0x05)&&IS_MASK_CLEAR(SYS_STATUS,AC_ADP)
             -)) 
 593   1              {
 594   2                  H_PROCHOT_OFF();
 595   2                      return;
 596   2              }
 597   1      #if FAN_TABLE_Already
 598   1              //MEILING019:modify fan table start.
 599   1              if(uMBID == 0x14) //for 14'
 600   1              {
 601   2                      if(uMBGPU&0x02) //DIS
 602   2                      {
 603   3                              BTbStep = 0;
 604   3                      }
 605   2                      else
 606   2                      {
 607   3                              BTbStep = 2;
 608   3                      }
 609   2              }
 610   1              else if(uMBID == 0x15)//for 15'
 611   1              {
 612   2                  if(uMBGPU&0x02)
 613   2                      {
 614   3                              BTbStep = 4;
 615   3                      }
 616   2                      else
 617   2                      {
 618   3                              BTbStep = 6;
 619   3                      }
 620   2              }
 621   1              else if(uMBID == 0x17)//for 17'
 622   1              {
 623   2                  if(uMBGPU&0x02)
 624   2                      {
 625   3                              BTbStep = 8;
 626   3                      }
 627   2                      else
 628   2                      {
 629   3                              BTbStep = 10;
 630   3                      }
 631   2              }
 632   1              //MEILING019:modify fan table end.
 633   1              
 634   1              //if ( IS_MASK_CLEAR(SYS_MISC1, ACPI_OS) )
 635   1              //{ Thro_DOS_Mode(BTbStep); }
 636   1              //  always std mode.
 637   1          // else
 638   1          // { 
 639   1                      Thro_Std_Mode(BTbStep); 
 640   1          // }  
 641   1      
 642   1              /*  
 643   1              else if ( IS_MASK_SET(EM7FUNCTION, QIUETMODE) )                 // bit5:QIUETMODE, Check Quite mode.
 644   1              { Thro_Quite_Mode(BTbStep); }                                           // Quite
 645   1              else if ( IS_MASK_SET(EM7FUNCTION, LSPRUNNING) )        // bit3:LSPRUNNING, Check Super performance mode.
 646   1              { Thro_Super_Mode(BTbStep); }                           // Super performance Mode.
 647   1              else
 648   1              { Thro_Std_Mode(BTbStep); }
 649   1              */  
 650   1              nOSThrottlingTemp = THR_PRO_ON; // For OS throttling temperature.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 12  

 651   1              nOSShutdownTemp = THR_Tab_Shut; // For OS Shutdown temperature.
 652   1              nShutDownTemp = THR_Tab_Shut;   // Shutdown temperature.
 653   1      #endif 
 654   1      }
 655          
 656          //-----------------------------------------------------------------------------
 657          // Throttling: Standard Mode.
 658          //-----------------------------------------------------------------------------
 659          void Thro_Std_Mode(BYTE BMBStep)
 660          {
 661   1      /* ANGELAG046: remove start
 662   1      //      switch( (CPU_TYPE & 0x03) ) //ANGELAG018: remove start
 663   1      //      {
 664   1      //      #if Support_TJ100
 665   1      //      case 2:  //ANGELAG018: remove end       // Tj100 Step8 and VGA Step16.
 666   1                      THRTab_ToRAM((0+BMBStep));      //:8 to 0  // Throttle Standard table save to RAM.
 667   1                      Thro_Shut_Status((0+BMBStep),TEMP_TYPE_CPU); //:8 to 0  // Check Throttle and Shutdown status.
 668   1                      // Check CPU Turbo function.
 669   1                      Thro_Turbo(CPUTHRTable[(0+BMBStep)].Turbo_Rem,CPUTHRTable[(0+BMBStep)].Turbo_Off,TEMP_TYPE_CPU); //:8 to
             - 0 
 670   1              //      break; //ANGELAG018: remove start
 671   1              //#endif        // Support_TJ100
 672   1      
 673   1              //default:      // Tj90 Step4 and VGA Step16 Default.
 674   1              //      THRTab_ToRAM((0+BMBStep));//T14H:4 to 2 // Throttle Standard table save to RAM.
 675   1              //      Thro_Shut_Status((0+BMBStep),TEMP_TYPE_CPU);    //:4 to 2               // Check Throttle and Shutdown status.
 676   1              //      // Check CPU Turbo function.
 677   1              //      Thro_Turbo(CPUTHRTable[(0+BMBStep)].Turbo_Rem,CPUTHRTable[(0+BMBStep)].Turbo_Off,TEMP_TYPE_CPU); //:4 
             -to 2        
 678   1              //      break;
 679   1              //} //ANGELAG018: remove end
 680   1      
 681   1              VTHRTab_ToRAM((1+BMBStep));//:16 to 4   // VGA Throttle Standard table save to RAM.
 682   1              Thro_Shut_Status((1+BMBStep),TEMP_TYPE_VGA); //:16 to 4  // Check Throttle and Shutdown status.
 683   1              // Check GPU Turbo function.
 684   1              Thro_Turbo(CPUTHRTable[(1+BMBStep)].Turbo_Rem,CPUTHRTable[(1+BMBStep)].Turbo_Off,TEMP_TYPE_VGA);//:16 to 
             -4
 685   1      
 686   1          Thro_Shut_Status(0,TEMP_TYPE_local);//:Add thermal IC local and remote  over temperature protect.
 687   1          if(uMBGPU&0x02)//DIS  //ANGELAG012:add.
 688   1          {
 689   1          Thro_Shut_Status(0,TEMP_TYPE_remote);//:Add thermal IC local and remote  over temperature protect.
 690   1          }
 691   1      */ //ANGELAG046: remove end
 692   1      
 693   1              //ANGELAG046: add start
 694   1              THRTab_ToRAM((0+BMBStep));      //load cpu table to RAM
 695   1              VTHRTab_ToRAM((1+BMBStep)); //load VGA table to RAM
 696   1              
 697   1              Thro_Shut_Status((0+BMBStep),TEMP_TYPE_CPU); // Check CPU Throttle and Shutdown status.
 698   1              Thro_Turbo(CPUTHRTable[(0+BMBStep)].Turbo_Rem,CPUTHRTable[(0+BMBStep)].Turbo_Off,TEMP_TYPE_CPU); //Check 
             -CPU turbo
 699   1          Thro_Shut_Status(0,TEMP_TYPE_local); //check cpu thermistor shutdown
 700   1      
 701   1              if(uMBGPU&0x02) //only DIS do these action
 702   1          {
 703   2                      Thro_Shut_Status((1+BMBStep),TEMP_TYPE_VGA); // Check VGA Throttle and Shutdown status.
 704   2                      Thro_Turbo(CPUTHRTable[(1+BMBStep)].Turbo_Rem,CPUTHRTable[(1+BMBStep)].Turbo_Off,TEMP_TYPE_VGA); //check
             - VGA turbo
 705   2              Thro_Shut_Status(0,TEMP_TYPE_remote); //check VGA thermistor shutdown
 706   2          }
 707   1      
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 13  

 708   1              ////ANGELAG046: add end
 709   1      
 710   1      }
 711          
 712          //COKEYXU044: add disable CPU turbo for 90s function
 713          void disCPUturbo90s(void)
 714          {
 715   1              if(DisCPUTurboFor90s > 0) //COKEYXU029: add 
 716   1              {
 717   2                      DisCPUTurboFor90s--; 
 718   2              }
 719   1      }
 720          
 721          /* //ANGELAS050:remove start
 722          //-----------------------------------------------------------------------------
 723          // Throttling: DOS Mode.
 724          //-----------------------------------------------------------------------------
 725          void Thro_DOS_Mode(BYTE BMBStep)
 726          {
 727                  switch( (CPU_TYPE & 0x03) )
 728                  {
 729                  #if Support_TJ100
 730                  case 2:         // Tj100 Step10.
 731                          THRTab_ToRAM((1+BMBStep));//T14H:10 to 1        // Throttle Standard table save to RAM.
 732                          Thro_Shut_Status((1+BMBStep),TEMP_TYPE_CPU);  //T14H:10 to 1    
 733                          break;
 734                  #endif          // Support_TJ100
 735          
 736                  default:        // Tj90 Step6 Default.
 737                          THRTab_ToRAM((3+BMBStep));//:6 to 3      // Throttle Standard table save to RAM.
 738                          Thro_Shut_Status((3+BMBStep),TEMP_TYPE_CPU);  //:6 to 3
 739                          break;
 740                  }
 741                  VTHRTab_ToRAM((5+BMBStep)); //:18 to 5  // VGA Throttle Standard table save to RAM.
 742                  Thro_Shut_Status((5+BMBStep),TEMP_TYPE_VGA);//:18 to 5  // Check Throttle and Shutdown status.
 743          
 744          }
 745          //-----------------------------------------------------------------------------
 746          // Throttling: Quite Mode.
 747          //-----------------------------------------------------------------------------
 748          void Thro_Quite_Mode(BYTE BMBStep)
 749          {
 750                  VTHRTab_ToRAM((17+BMBStep));    // VGA Throttle Standard table save to RAM.
 751                  switch( (CPU_TYPE & 0x03) )
 752                  {
 753                  case 3:         // Tj105 Step13 and VGA Step 17.
 754                          THRTab_ToRAM((13+BMBStep));                     // Throttle Standard table save to RAM.
 755                          Thro_Shut_Status((13+BMBStep),TEMP_TYPE_CPU);   // Check Throttle and Shutdown status.
 756                          // Check CPU Turbo function.
 757                          Thro_Turbo(CPUTHRTable[(13+BMBStep)].Turbo_Rem,CPUTHRTable[(13+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
 758                          break;
 759          
 760                  #if Support_TJ100
 761                  case 2:         // Tj100 Step9 and VGA Step 17.
 762                          THRTab_ToRAM((9+BMBStep));                      // Throttle Standard table save to RAM.
 763                          Thro_Shut_Status((9+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
 764                          // Check CPU Turbo function.
 765                          Thro_Turbo(CPUTHRTable[(9+BMBStep)].Turbo_Rem,CPUTHRTable[(9+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
 766                          break;
 767                  #endif          // Support_TJ100
 768          
 769                  case 1:         // Tj90 Step5 and VGA Step 17.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 14  

 770                  #if Support_TJ85
 771                  #else
 772                  default:        // Tj90 Step5 and VGA Step 17 Default.
 773                  #endif          // Support_TJ85
 774                          THRTab_ToRAM((5+BMBStep));      // Throttle Standard table save to RAM.
 775                          Thro_Shut_Status((5+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
 776                          // Check CPU Turbo function.
 777                          Thro_Turbo(CPUTHRTable[(5+BMBStep)].Turbo_Rem,CPUTHRTable[(5+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
 778                          break;
 779          
 780                  #if Support_TJ85
 781                  default:        // Tj85 Step1 and VGA Step 17 Default.
 782                          THRTab_ToRAM((1+BMBStep));                      // Throttle Standard table save to RAM.
 783                          Thro_Shut_Status((1+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
 784                          // Check CPU Turbo function.
 785                          Thro_Turbo(CPUTHRTable[(1+BMBStep)].Turbo_Rem,CPUTHRTable[(1+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
 786                          break;
 787                          #endif  // Support_TJ85
 788                  }
 789                  Thro_Shut_Status((17+BMBStep),TEMP_TYPE_VGA);   // Check Throttle and Shutdown status.
 790                  // Check GPU Turbo function.
 791                  Thro_Turbo(CPUTHRTable[(17+BMBStep)].Turbo_Rem,CPUTHRTable[(17+BMBStep)].Turbo_Off,TEMP_TYPE_VGA);
 792          }
 793          
 794          
 795          
 796          //-----------------------------------------------------------------------------
 797          // Throttling: Super performance Mode.
 798          //-----------------------------------------------------------------------------
 799          void Thro_Super_Mode(BYTE BMBStep)
 800          {
 801                  switch( (CPU_TYPE & 0x03) )
 802                  {
 803                  case 3: // Tj105 Step15 and VGA Step18.
 804          
 805                          THRTab_ToRAM((15+BMBStep));                     // Throttle Standard table save to RAM.
 806                          Thro_Shut_Status((15+BMBStep),TEMP_TYPE_CPU);           // Check Throttle and Shutdown status.
 807                          Thro_Street((15+BMBStep),TEMP_TYPE_CPU);                // Check VGA Street status.
 808                          // Check CPU Turbo function.
 809                          Thro_Turbo(CPUTHRTable[(15+BMBStep)].Turbo_Rem,CPUTHRTable[(15+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
 810                          break;
 811          
 812                  #if Support_TJ100
 813                  case 2:         // Tj100 Step11 and VGA Step18.
 814                          THRTab_ToRAM((11+BMBStep));                     // Throttle Standard table save to RAM.
 815                          Thro_Shut_Status((11+BMBStep),TEMP_TYPE_CPU);           // Check Throttle and Shutdown status.
 816                          Thro_Street((11+BMBStep),TEMP_TYPE_CPU);                // Check VGA Street status.
 817                          // Check CPU Turbo function.
 818                          Thro_Turbo(CPUTHRTable[(11+BMBStep)].Turbo_Rem,CPUTHRTable[(11+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
 819                          break;
 820                  #endif          // Support_TJ100
 821          
 822                  case 1:         // Tj90 Step7 and VGA Step18.
 823                  #if Support_TJ85
 824                  #else
 825                  default:        // Tj90 Step7 and VGA Step18 Default.
 826                  #endif          // Support_TJ85
 827          
 828                          THRTab_ToRAM((7+BMBStep));                      // Throttle Standard table save to RAM.
 829                          Thro_Shut_Status((7+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
 830                          Thro_Street((7+BMBStep),TEMP_TYPE_CPU);         // Check VGA Street status.
 831                          // Check CPU Turbo function.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 15  

 832                          Thro_Turbo(CPUTHRTable[(7+BMBStep)].Turbo_Rem,CPUTHRTable[(7+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
 833                          break;
 834          
 835                  #if Support_TJ85
 836                  default:        // Tj85 Step3 and VGA Step18 Default.
 837                          THRTab_ToRAM((3+BMBStep));                      // Throttle Standard table save to RAM.
 838                          Thro_Shut_Status((3+BMBStep),TEMP_TYPE_CPU);            // Check Throttle and Shutdown status.
 839                          Thro_Street((3+BMBStep),TEMP_TYPE_CPU);         // Check VGA Street status.
 840                          // Check CPU Turbo function.
 841                          Thro_Turbo(CPUTHRTable[(3+BMBStep)].Turbo_Rem,CPUTHRTable[(3+BMBStep)].Turbo_Off,TEMP_TYPE_CPU);
 842                          break;
 843                          #endif  // Support_TJ85
 844                   }
 845          
 846                  VTHRTab_ToRAM((19+BMBStep));    // VGA Throttle Standard table save to RAM.
 847                  Thro_Shut_Status((19+BMBStep),TEMP_TYPE_VGA);   // Check Throttle and Shutdown status.
 848                  Thro_Street((19+BMBStep),TEMP_TYPE_VGA);                // Check VGA Street status.
 849                  // Check GPU Turbo function.
 850                  Thro_Turbo(CPUTHRTable[(19+BMBStep)].Turbo_Rem,CPUTHRTable[(19+BMBStep)].Turbo_Off,TEMP_TYPE_VGA);
 851          }
 852          *///ANGELAS050:remove end
 853          //-----------------------------------------------------------------------------
 854          // Throttling: Check throttling and Shutdown status.
 855          //-----------------------------------------------------------------------------
 856          void Thro_Shut_Status(BYTE BStep, BYTE BTType)
 857          {
 858   1              BYTE BAvgTemp;
 859   1      
 860   1              if ( BTType == 2 )
 861   1              {       // Set External FAN.
 862   2                      //if ( EXT_VGA_Buff3 <= CPUTHRTable[BStep].Thr_Off )            // Check prochot turn OFF.
 863   2                      if ( EXT_VGA_Buff3 < THR_PRO_OFF)               //T14K+
 864   2                      { CLR_MASK(Thro_Status, b2ProCH_EXTVGA); }
 865   2                      //else if ( EXT_VGA_Buff3 >= CPUTHRTable[BStep].Thr_On )        // Check prochot turn ON.
 866   2                      else if ( EXT_VGA_Buff3 >= THR_PRO_ON)  //T14K+
 867   2                      { SET_MASK(Thro_Status, b2ProCH_EXTVGA); }
 868   2      
 869   2                      //if ( EXT_VGA_Buff3 >= CPUTHRTable[BStep].Thr_Shut )   // Check shutdown status.
 870   2                      if ( EXT_VGA_Buff3 >=THR_Tab_Shut)      //T14K+
 871   2                      { Thro_Count_Shut(&EXTVGA_Shut_Cnt,TEMP_TYPE_EXT); }    // Check x times for shutdown protection.
 872   2                      else
 873   2                      { EXTVGA_Shut_Cnt = 0; }
 874   2              }
 875   1              else if ( BTType == 1 )
 876   1              {       // Set Internal VGA.
 877   2                      //if ( VGA_TBuff3 <= CPUTHRTable[BStep].Thr_Off )               // Check prochot turn OFF.
 878   2                              
 879   2                      /*if ( VGA_TBuff3 < THR_PRO_OFF)                //+
 880   2                              { CLR_MASK(Thro_Status, b1ProCH_VGA); }
 881   2                              //else if ( VGA_TBuff3 >= CPUTHRTable[BStep].Thr_On )   // Check prochot turn ON.
 882   2                              else if ( VGA_TBuff3 >= THR_PRO_ON )    //+
 883   2                               { SET_MASK(Thro_Status, b1ProCH_VGA); }*/
 884   2                               //ANGLEAG020: add start
 885   2                               if ( VGA_TBuff3 < VTHR_PRO_OFF)                
 886   2                              { CLR_MASK(GPU_Prochot, b0_Thermal); }
 887   2                              else if ( VGA_TBuff3 >= VTHR_PRO_ON )   
 888   2                               { SET_MASK(GPU_Prochot, b0_Thermal); }
 889   2                               //ANGELAG020: add end
 890   2      
 891   2                              //if ( VGA_TBuff3 >= CPUTHRTable[BStep].Thr_Shut )      // Check shutdown status.
 892   2                              if ( VGA_TBuff3 >= VTHR_Tab_Shut )  //T14K+ //G87:Modify the GPU shutdown temperature  registers
 893   2                              { Thro_Count_Shut(&VGA_Shut_Cnt,TEMP_TYPE_VGA); }       // Check x times for shutdown protection.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 16  

 894   2                              else
 895   2                              { VGA_Shut_Cnt = 0; }
 896   2              }
 897   1              else if ( BTType == 4 ) //G90:Add thermal IC local and remote  over temperature protect.
 898   1          {
 899   2              // if ( nVramTemp >= nVramoverTemp )  //ANGELAS070:remove
 900   2              if ( ThermistorCPU_TEMP >= nCPUthermistoroverTemp )  //ANGELAS070:add
 901   2              { Thro_Count_Shut(&local_Shut_Cnt,TEMP_TYPE_local); }   // Check x times for shutdown protection.
 902   2              else
 903   2              { local_Shut_Cnt = 0; }
 904   2          }
 905   1          else if ( BTType == 5 )//G90:Add thermal IC local and remote  over temperature protect.
 906   1          {
 907   2              //if ( nRamTemp >= nRamoverTemp )  //ANGELAS070:remove
 908   2                      if ( EXTVGA_TEMP >= nGPUthermistoroverTemp )  //ANGELAS070:add
 909   2              { Thro_Count_Shut(&remote_Shut_Cnt,TEMP_TYPE_remote); }   // Check x times for shutdown protection
             -.
 910   2              else
 911   2              { remote_Shut_Cnt = 0; }
 912   2          }
 913   1              else
 914   1              {       // Set Internal CPU.
 915   2                      //if ( TEMP_Buff_3 <= CPUTHRTable[BStep].Thr_Off ) //-  // Check prochot turn OFF.
 916   2                      if ( TEMP_Buff_3 < THR_PRO_OFF) //-
 917   2                      { CLR_MASK(Thro_Status, b0ProCH_CPU); }
 918   2                      //else if ( TEMP_Buff_3 >= CPUTHRTable[BStep].Thr_On )  //- // Check prochot turn ON.
 919   2                      else if ( TEMP_Buff_3 >= THR_PRO_ON)  //-
 920   2                      { SET_MASK(Thro_Status, b0ProCH_CPU); }
 921   2      
 922   2                      //if ( TEMP_Buff_3 >= CPUTHRTable[BStep].Thr_Shut )     //-// Check shutdown status.
 923   2                      if ( TEMP_Buff_3 >= THR_Tab_Shut )      //+
 924   2                      { Thro_Count_Shut(&CPU_Shut_Cnt,TEMP_TYPE_CPU); }       // Check x times for shutdown protection.
 925   2                      else
 926   2                      { CPU_Shut_Cnt = 0; }
 927   2              }
 928   1              
 929   1      }
 930          
 931          //-----------------------------------------------------------------------------
 932          // Throttling: Check CPU/VGA Turbo status.
 933          //-----------------------------------------------------------------------------
 934          void Thro_Turbo(BYTE BTurboRem, BYTE BTurboOff, BYTE BTType)
 935          {
 936   1              BYTE BAvgTemp;
 937   1      
 938   1              if ( IS_MASK_CLEAR(SYS_MISC1, ACPI_OS) ) { return; }
 939   1              //if((CPU_TYPE &0xc0)!=0x80){return;}//G45:Add judge AMD GPU and NV GPU, AMD GPU not support torbo.//ANGE
             -LAS096:-Add CPU turbo enable/disable Q_event.
 940   1      
 941   1              if ( BTType == 2 )
 942   1              {       // Set External FAN.
 943   2                      if ( EXT_VGA_Buff3 <= BTurboRem )                               // Check turbo resume.
 944   2                      { CLR_MASK(Thro_Status, b5Turbo_EXTVGA); }
 945   2                      else if ( EXT_VGA_Buff3 >= BTurboOff )                  // Check turbo Off.
 946   2                      { SET_MASK(Thro_Status, b5Turbo_EXTVGA); }
 947   2              }
 948   1              else if ( BTType == 1 )
 949   1              {       // Set Internal VGA.
 950   2                      //if ( TEMP_Buff_3 <= BTurboRem ) // Check turbo resume.  //MEILING024:remove.
 951   2                      //ANGELAG032: add start
 952   2                      if(Read_AC_IN())
 953   2                      {
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 17  

 954   3                      //ANGELAG032: add end
 955   3                              if ( VGA_TBuff3 <= BTurboRem ) // Check turbo resume.  //MEILING024:change to VGA temp.
 956   3                              { CLR_MASK(Thro_Status, b4Turbo_VGA); }
 957   3                              //else if ( TEMP_Buff_3 >= BTurboOff )    // Check turbo Off.  //MEILING024:remove.
 958   3                              else if ( VGA_TBuff3 >= BTurboOff ) // Check turbo Off.  //MEILING024:change to VGA temp.
 959   3                              { SET_MASK(Thro_Status, b4Turbo_VGA); }
 960   3                      //ANGELAG032: add start
 961   3                      }
 962   2                      else
 963   2                      {
 964   3                              if ( VGA_TBuff3 <= (BTurboRem-5) ) // Check turbo resume.  //MEILING024:change to VGA temp.
 965   3                              { CLR_MASK(Thro_Status, b4Turbo_VGA); }
 966   3                              //else if ( TEMP_Buff_3 >= BTurboOff )    // Check turbo Off.  //MEILING024:remove.
 967   3                              else if ( VGA_TBuff3 >= (BTurboOff-5) ) // Check turbo Off.  //MEILING024:change to VGA temp.
 968   3                              { SET_MASK(Thro_Status, b4Turbo_VGA); }
 969   3                      }
 970   2                      //ANGELAG032: add end
 971   2              }
 972   1              else
 973   1              {       // Set Internal CPU.
 974   2      
 975   2      //JERRYCH005:s+Add cpu turbo enable/disable event.              
 976   2                      if (( TEMP_Buff_3 <= BTurboRem )&&      ( VGA_TBuff3 <=60))// Check turbo resume. //COKEYXU027: enable CPU tu
             -rbo when GPU temp <= 60
 977   2                      { CLR_MASK(Thro_Status, b3Turbo_CPU); }
 978   2                      else
 979   2                      {
 980   3                              if (( TEMP_Buff_3 >= BTurboOff )||(VGA_TBuff3 >=65))//COKEYXU027: disable CPU turbo when GPU temp > = 6
             -5.
 981   3                              {
 982   4                                      SET_MASK(Thro_Status, b3Turbo_CPU);
 983   4                              }
 984   3                      }
 985   2              }
 986   1                      
 987   1          if ( IS_MASK_CLEAR(Thro_Status, b3Turbo_CPU ) && (DisCPUTurboFor90s == 0) && (DisCPUTurboForLTP == 0) 
             -&& IS_MASK_CLEAR(Adapter90WWA,b1_DisCPUturbo) && (nAtmFanSpeed > 5))//COKEYXU029: add fan1 speed > 500 and system start 
             -after 90s,then enable CPU turbo. //COKEYXU046: when low temp protectdisable CPU turbo.
 988   1              {                                                                                                        
             -                                  //COKEYXU030: add W/A for 90W adapter,cannot charge battery RSOC up when system consum
             -ption is very high.              
 989   2                      if ( IS_MASK_SET(uVGATurboFun,uDisCPUTurboOK) )         
 990   2                      {
 991   3                              CLR_MASK(uVGATurboFun, uDisCPUTurboOK); 
 992   3                  ECQEvent(EN_CPUTURBO_67);  //MEILING036:add.
 993   3                      }
 994   2              }
 995   1              else
 996   1              {
 997   2                      if ( IS_MASK_CLEAR(uVGATurboFun,uDisCPUTurboOK) )       // bit3.
 998   2                      {
 999   3                              SET_MASK(uVGATurboFun, uDisCPUTurboOK);                 // Set bit3. 
1000   3                  ECQEvent(DIS_CPUTURBO_66);  //MEILING036:add.
1001   3                      }
1002   2              }
1003   1      //JERRYCH005:e+Add cpu turbo enable/disable event.
1004   1      }
1005          
1006          //-----------------------------------------------------------------------------
1007          // Throttling: Check VGA Street status.
1008          //-----------------------------------------------------------------------------
1009          /* //ANGELAS050:remove start
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 18  

1010          void Thro_Street(BYTE BStep, BYTE BTType)
1011          {
1012                  #if Support_Steering_Fun
1013                  BYTE BAvgTemp;
1014          
1015                  if ( IS_MASK_SET(SYS_MISC1, ACPI_OS) ) { return; }
1016          
1017                  if ( BTType == 2 )
1018                  {
1019                          if ( EXT_VGA_Buff3 <= VGA_Steer_On )                            // Check VGA steering On.
1020                          { CLR_MASK(Thro_Status2, b2Steer_EXTVGA); }
1021                          else if ( EXT_VGA_Buff3 >= VGA_Steer_Off )                      // Check VGA steering Off.
1022                          { SET_MASK(Thro_Status2, b2Steer_EXTVGA); }
1023                  }
1024                  else if ( BTType == 1 )
1025                  {
1026                           if ( VGA_TBuff3 <= VGA_Steer_On )                              // Check VGA steering On.
1027                          { CLR_MASK(Thro_Status2, b1Steer_VGA); }
1028                          else if ( VGA_TBuff3 >= VGA_Steer_Off )
1029                          { SET_MASK(Thro_Status2, b1Steer_VGA); }        // Check VGA steering Off.
1030                  }
1031                  else
1032                  {       // CPU Type.
1033                          switch( (CPU_TYPE & 0x03) )
1034                          {
1035                          case 3:         // Tj105
1036                          case 2:         // Tj100
1037                                  if ( TEMP_Buff_3 <= VGA_Steer_On )              // Check VGA steering On.
1038                                  { CLR_MASK(Thro_Status2, b0Steer_CPU); }
1039                                  else if ( TEMP_Buff_3 >= VGA_Steer_Off )// Check VGA steering Off.
1040                                  { SET_MASK(Thro_Status2, b0Steer_CPU); }
1041                                  break;
1042                          case 1:         // Tj90
1043                          default:        // Tj85 Default.
1044                                  if ( TEMP_Buff_3 <= VGA_Steer85_On )    // Check VGA steering On.
1045                                  { CLR_MASK(Thro_Status2, b0Steer_CPU); }
1046                                  else if ( TEMP_Buff_3 >= VGA_Steer_Off )// Check VGA steering Off.
1047                                  { SET_MASK(Thro_Status2, b0Steer_CPU); }
1048                                  break;
1049                          }
1050                  }
1051          
1052                  if ( IS_MASK_CLEAR(Thro_Status2, (b0Steer_CPU+b1Steer_VGA+b2Steer_EXTVGA)) )
1053                  {
1054                          if ( IS_MASK_SET(uVGATurboFun,uDisPowerSteeringOK) )    // bit1.
1055                          {
1056                                  CLR_MASK(uVGATurboFun, uDisPowerSteeringOK);            // Clear bit1.
1057                                  //ECQEvent(DIS_TURBO_63);       // 0x63 Disable VGA Steering. G24:remove GPU turbo Q event
1058                          }
1059                  }
1060                  else
1061                  {
1062                          if ( IS_MASK_CLEAR(uVGATurboFun,uDisPowerSteeringOK) )  // bit1.
1063                          {
1064                                  SET_MASK(uVGATurboFun, uDisPowerSteeringOK);            // Set bit1.
1065                                  ECQEvent(EN_PWRSTEER_64); // 0x64 Enable VGA Steering.
1066                          }
1067                  }
1068                  #endif  // Support_Steering_Fun
1069          }
1070          */ //ANGELAS050:remove end
1071          //-----------------------------------------------------------------------------
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 19  

1072          // Throttling: Shutdown count used.
1073          //-----------------------------------------------------------------------------
1074          void Thro_Count_Shut(XBYTE *BShut_Cnt, BYTE TempType)
1075          {
1076   1              if ( *BShut_Cnt >= Thro_Shut_Cnt )      // Read 3 times.
1077   1              {
1078   2                      if ( TempType == 2 )
1079   2                      { ProcessSID(EXTVGAOVERTEMP_ID); }              // EXT VGAShutdown ID 0x1C.
1080   2                      else if ( TempType == 1 )
1081   2                      { ProcessSID(VGAOVERTEMP_ID); } // VGA Shutdown ID 0x12.
1082   2                      else if ( TempType == 4 )
1083   2                      { ProcessSID(CPUthermistoroverTemp_ID); }       //ANGELAS082: ThermalIClocalOVerTEPM_ID to CPUthermistoroverTe
             -mp_ID//30 to33
1084   2                      else if ( TempType == 5 )
1085   2                      { ProcessSID(GPUthermistoroverTemp_ID); }       //ANGELAS082: ThermalICremoteOVerTEPM_ID to GPUthermistoroverT
             -emp_ID//31 to 34
1086   2                      else
1087   2                      { ProcessSID(DTSOVERTEMP_ID); } // CPU Shutdown ID 0x11.
1088   2      
1089   2              SET_MASK(SysStatus,ERR_ShuntDownFlag);
1090   2                  CKCON &= 0x3F;                      // set 26 bit counter // bit7-6 00=14ms,01=113ms, 10=911ms, 11(1/9.2MHz)*2'26=7.2S
1091   2                  CKCON |= 0x10;                      // set 26 bit counter // bit7-6 00=14ms,01=113ms, 10=911ms, 11(1/9.2MHz)*2'26=7.2S
1092   2              WDTCON|=0x01;                   /* WDTRST = 1 Reset watch dog timer.*/
1093   2              WDTCON|=0x02;                   /* WDTEN  = 1 Enable watch dog.     */
1094   2              while(1);                       /* Wait for watch dog time-out      */
1095   2                      PWSeqStep = 1;
1096   2              PowSeqDelay = 0x00;
1097   2              RamDebug(0x0F);  
1098   2                      SysPowState = SYSTEM_S0_S5;                     // EC force Shutdown.
1099   2      
1100   2                      *BShut_Cnt = 0;
1101   2                      //RSMRST_LOW();
1102   2                      //Delay1MS(1);
1103   2                      //RSMRST_HI();
1104   2                      SET_MASK(USB_Charger, b2USB_TmlDis);    // Disable USB charger.
1105   2              }
1106   1              else
1107   1              { (*BShut_Cnt)++; }
1108   1      }
1109          
1110          //-----------------------------------------------------------------------------
1111          // Throttle table save to ram.
1112          //-----------------------------------------------------------------------------
1113          void THRTab_ToRAM(BYTE BStep)
1114          {
1115   1          if(IS_MASK_SET(TEST_FLAG, Fan_Control_Auto))
1116   1          {
1117   2             return;
1118   2          }
1119   1              THR_PRO_OFF     = CPUTHRTable[BStep].Thr_Off;
1120   1              THR_PRO_ON              = CPUTHRTable[BStep].Thr_On;
1121   1              THR_Turo_Rem    = CPUTHRTable[BStep].Turbo_Rem;
1122   1              THR_Turo_OFF    = CPUTHRTable[BStep].Turbo_Off;
1123   1              THR_Tab_Shut    = CPUTHRTable[BStep].Thr_Shut;
1124   1      }
1125          //-----------------------------------------------------------------------------
1126          // VGA Throttle table save to ram.
1127          //-----------------------------------------------------------------------------
1128          void VTHRTab_ToRAM(BYTE BStep)
1129          {
1130   1          if(IS_MASK_SET(TEST_FLAG, Fan_Control_Auto))
1131   1          {
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 20  

1132   2             return;
1133   2          }
1134   1              VTHR_PRO_OFF    = CPUTHRTable[BStep].Thr_Off;
1135   1              VTHR_PRO_ON             = CPUTHRTable[BStep].Thr_On;
1136   1              VTHR_Turo_Rem   = CPUTHRTable[BStep].Turbo_Rem;
1137   1              VTHR_Turo_OFF   = CPUTHRTable[BStep].Turbo_Off;
1138   1              VTHR_Tab_Shut   = CPUTHRTable[BStep].Thr_Shut;
1139   1      }
1140          
1141          /*****************************************************************************/
1142          // Procedure: ODDPowerSaving                                                                    TimeDiv: 50mSec
1143          // Description: ODD zero power control.
1144          // GPIO: GPIOA4, GPIOD7
1145          // Referrals:
1146          /*****************************************************************************/
1147          /*//ANGELAS050:remove start
1148          void ODDPowerSaving(void)
1149          {
1150                  #if Support_ODDZeroPower
1151                  // Check S0 status and ODD and ACPI Mode.
1152                  if(IS_MASK_CLEAR(SYS_MISC1, ACPI_OS))
1153                  { return; }
1154          
1155                  if( IS_MASK_SET(LENOVODEVICE, ODDPWRON) )       // Check bit6: ODD power on.
1156                  {
1157                          uVPCeventSource = 0x00;                                 // for Levono AP used.
1158                          uVPCeventSource2 = VPCeventODD;                 // for Levono AP used.
1159                          ECQEvent(SDV_VPC_notify);                               // 0x44 for Levono used.
1160                          SET_MASK(uODDPWRsaving, uODD_PWRon);    // Set bit0: uODD_PWRon.
1161                          CLEAR_MASK(LENOVODEVICE, ODDPWRON);             // Clear bit6: ODD power on.
1162                  }
1163          
1164                  if( SystemIsS0 )        // Check S0 status.
1165                  {
1166                          // Power off
1167                          //if( IS_MASK_SET(LENOVODEVICE,ODDPWROFF) )
1168                          //{
1169                          //      uVPCeventSource = 0x00;                                 // for Levono AP used.
1170                          //      uVPCeventSource2 = VPCeventODD;                 // for Levono AP used.
1171                          //      ECQEvent(SDV_VPC_notify);                               // 0x44 for Levono used.
1172                          //      SET_MASK(uODDPWRsaving, uODD_PWRoff1);  // Set bit2: uODD_PWRoff1.
1173                          //      CLEAR_MASK(LENOVODEVICE, ODDPWROFF);    // Clear bit0: ODD power off.
1174                          //      }
1175          
1176                          // Power on by hotkey
1177                          if( IS_MASK_SET(LENOVODEVICE, ODDPWRKEYON) )// Check bit2: ODD hotkey.
1178                          {
1179                                  uVPCeventSource = 0x00;
1180                                  uVPCeventSource2 = VPCeventODDEject;
1181                                  ECQEvent(SDV_VPC_notify);                               // 0x44 for Levono used.
1182                                  CLEAR_MASK(LENOVODEVICE, ODDPWRKEYON);  // Clear bit2: ODD hotkey status.
1183                          }
1184          
1185                          // Power on by button
1186                          if( (ODD_DA()) && (IS_MASK_CLEAR(uODDPWRsaving, uODD_ejectbtn)) )       // open   // bit6: ODD button.
1187                          {
1188                                  if (IS_MASK_CLEAR(SysStatus,FnF3PKeyUp))
1189                                  {
1190                                          uODDtimeCnt++;
1191                                          if( uODDtimeCnt >= 3)
1192                                          {
1193                                                  SET_MASK(SysStatus,FnF3PKeyUp);
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 21  

1194                                                  uODDtimeCnt = 0;
1195                                          }
1196                                  }
1197                          }
1198                          else if ((!ODD_DA())&& (IS_MASK_CLEAR(uODDPWRsaving, uODD_ejectbtn)))
1199                          {  
1200                                  if (IS_MASK_SET(SysStatus,FnF3PKeyUp))
1201                                  {
1202                                          uODDtimeCnt++;
1203                                          if( uODDtimeCnt >= 3 )
1204                                          {
1205                                                  CLEAR_MASK(uODDPWRsaving, uODD_BtnLowPluse);    // Clear bit1: ODD button low pulse.
1206                                                  CLEAR_MASK(uODDPWRsaving, uODD_low100ms);               // Clear bit4: ODD 100mSec.
1207                                                  SET_MASK(uODDPWRsaving, uODD_PWRon);                    // Set bit0: ODD power on.
1208                                                  SET_MASK(uODDPWRsaving, uODD_ejectbtn);                 // Set bit5: ODD eject button.
1209                                                  ECQEvent(ODD_BTN_EVENT);                                                // 0x53 for Levono used.
1210                                                  uODDtimeCnt = 0;
1211                                                  CLEAR_MASK(SysStatus, FnF3PKeyUp);   
1212                                          }                                                               
1213                                  }
1214                          }
1215                          else
1216                          { uODDtimeCnt = 0; }
1217          
1218                          if( IS_MASK_SET(LENOVODEVICE, ODDPWRStatus) )   // Check bit7: ODD Status.
1219                          {
1220                                  CLEAR_MASK(uODDPWRsaving, uODD_ejectbtn);       // Set bit5: ODD eject button.
1221                                  CLEAR_MASK(LENOVODEVICE, ODDPWRStatus);         // Clear bit7: ODD Status.
1222                          }
1223          
1224                          if ( IS_MASK_SET(LENOVODEVICE, ODDPWRBTNON) )   // Check bit1: ODD power button.
1225                          {
1226                                  if( IS_MASK_CLEAR(uODDPWRsaving, uODD_BtnLowPluse))     // Check bit1:ODD low pulse.
1227                                  {
1228                                          uVPCeventSource = 0x00;
1229                                          uVPCeventSource2 = VPCeventODD;
1230                                          ECQEvent(SDV_VPC_notify);       // 0x44 for Levono used.
1231                                          SET_MASK(uODDPWRsaving, uODD_BtnLowPluse);      // Set bit1: ODD button low pulse.
1232          
1233                                          ODD_DAOUT;                                                    
1234                                          ODD_DA_HI();         
1235                                          
1236                                  }
1237                                  else
1238                                  {
1239                                          if( IS_MASK_CLEAR(uODDPWRsaving, uODD_low100ms) )       // Check bit4:ODD 100mSec low pulse.
1240                                          {
1241                                                  switch( uODDdelaytimeStep )
1242                                                  {
1243                                                  case 0:
1244                                                          if( ChkTimeScale(&uODDlowCnt, (Timer_10 +Timer_1)) )    // Delay 830mSec. //:change Timer_7 to Timer_1
1245                                                         {
1246                                                                  ODD_DAOUT;              
1247                                                                  //ODD_DA_HI();
1248                                                                  ODD_DA_LOW();    
1249                                                                  uODDdelaytimeStep++;
1250                                                          }
1251                                                          break;
1252                                                  case 1:
1253                                                          if( ChkTimeScale(&uODDlowCnt, Timer_1) )        // Delay 100mSec.  // change Timer_3 to Timer_1
1254                                                          {
1255                                                                  ODD_DAOUT;              
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 22  

1256                                                                  //ODD_DA_LOW();
1257                                                                  ODD_DA_HI();      
1258                                                                  SET_MASK(uODDPWRsaving, uODD_low100ms); // Set bit4: ODD 100mSec.
1259                                                                  uODDdelaytimeStep++;
1260                                                          }
1261                                                          break;
1262                                                  default:
1263                                                          break;
1264                                                  }
1265                                          }
1266                                          else
1267                                          {
1268                                                  uVPCeventSource = 0x00;
1269                                                  uVPCeventSource2 = VPCeventODD;
1270                                                  ECQEvent(SDV_VPC_notify);       // 0x44 for Levono used.
1271                                                  ODD_DA_INPUT;    //T038 open 
1272                                                  SET_MASK(uODDPWRsaving, uODD_InitEnd);          // Set bit6: ODD initial End.
1273                                                  CLEAR_MASK(uODDPWRsaving, uODD_ejectbtn);       // Clear bit5: ODD eject button.
1274                                                  CLEAR_MASK(LENOVODEVICE, ODDPWRBTNON);          // Clear bit1: ODD power button.
1275                                                  uODDdelaytimeStep = 0;
1276                                          }
1277                                  }
1278                          }
1279                  }
1280                  #endif  // Support_ODDZeroPower.
1281          }*/
1282          
1283          
1284          //martin0616 add start  //MARTINH179
1285          //-----------------------------------------------------------------------------
1286          // Smart Fan control
1287          //-----------------------------------------------------------------------------
1288          //-----------------------------------------------------------------------------
1289          // Fan table 1   2009/08/18 Rev.01
1290          //-----------------------------------------------------------------------------
1291          const thermalstruct code ThermalTalbe1CPU[]= //UMA //MARTINH185 //MARTINH162 //MARTINH150 //MARTINH147;//M
             -ARTINH118: change content //MARTINH079:change content // martin0616: change 'ThermalTalbe1' to 'ThermalTalbe1CPU'//COKEY
             -XU006:refer to Fan table v02_1220.
1292          {
1293              {0, 44,     40,     0,      &Fan1On_Step1,  &Fan1Off_Step1, &Fan1RPM_Step1  },      // Level 0      
1294              {1, 48,     40,     18,     &Fan1On_Step2,  &Fan1Off_Step2, &Fan1RPM_Step2  },      // Level 1      
1295              {2, 60,     44,     20,     &Fan1On_Step3,  &Fan1Off_Step3, &Fan1RPM_Step3  },      // Level 2      
1296              {3, 65,     56,     22,     &Fan1On_Step4,  &Fan1Off_Step4, &Fan1RPM_Step4  },      // Level 3      
1297              {4, 70,     61,     25,     &Fan1On_Step5,  &Fan1Off_Step5, &Fan1RPM_Step5  },      // Level 4      
1298              {5, 74,     66,     28,     &Fan1On_Step6,  &Fan1Off_Step6, &Fan1RPM_Step6  },      // Level 5      
1299              {6,128,     70,     32,     &Fan1On_Step7,  &Fan1Off_Step7, &Fan1RPM_Step7  },      // Level 6      
1300              //{7,127, 63, 56, &Fan1On_Step8,    &Fan1Off_Step8, &Fan1RPM_Step8  },      // Level 7              
1301          };
1302          //MARTINH079:add start
1303          const thermalstruct code ThermalTalbe1CPU_DIS[]= //DIS //MARTINH185 //MARTINH175 //MARTINH172 //MARTINH166
             - //MARTINH079:change content // martin0616: change 'ThermalTalbe1' to 'ThermalTalbe1CPU' //COKEYXU006:refer to Fan table
             - v02_1220.
1304          {
1305              {0, 44,     40,     0,      &Fan1On_Step1,  &Fan1Off_Step1, &Fan1RPM_Step1  },      // Level 0      
1306              {1, 48,     40,     18,     &Fan1On_Step2,  &Fan1Off_Step2, &Fan1RPM_Step2  },      // Level 1      
1307              {2, 60,     44,     20,     &Fan1On_Step3,  &Fan1Off_Step3, &Fan1RPM_Step3  },      // Level 2      
1308              {3, 65,     56,     22,     &Fan1On_Step4,  &Fan1Off_Step4, &Fan1RPM_Step4  },      // Level 3      
1309              {4, 70,     61,     25,     &Fan1On_Step5,  &Fan1Off_Step5, &Fan1RPM_Step5  },      // Level 4      
1310              {5, 74,     66,     28,     &Fan1On_Step6,  &Fan1Off_Step6, &Fan1RPM_Step6  },      // Level 5      
1311              {6,128,     70,     32,     &Fan1On_Step7,  &Fan1Off_Step7, &Fan1RPM_Step7  },      // Level 6      
1312              //{7,127, 55, 48, &Fan1On_Step8,    &Fan1Off_Step8, &Fan1RPM_Step8  },      // Level 7              
1313          };
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 23  

1314          //martin0616 add start
1315          const thermalstruct code ThermalTalbe1VGA[]=  //MARTINH185 //MARTINH172  //MARTINH175 //MARTINH166  //COKE
             -YXU006:refer to Fan table v02_1220.
1316          {
1317              {0, 45,     41,     0,      &Fan1OnVGA_Step1,       &Fan1OffVGA_Step1,      &Fan1RPMVGA_Step1       },      // Level 0      
1318              {1, 48,     41,     18,     &Fan1OnVGA_Step2,       &Fan1OffVGA_Step2,      &Fan1RPMVGA_Step2       },      // Level 1      
1319              {2, 52,     44,     20,     &Fan1OnVGA_Step3,       &Fan1OffVGA_Step3,      &Fan1RPMVGA_Step3       },      // Level 2      
1320              {3, 56,     48,     22,     &Fan1OnVGA_Step4,       &Fan1OffVGA_Step4,      &Fan1RPMVGA_Step4       },      // Level 3      
1321              {4, 60,     52,     25,     &Fan1OnVGA_Step5,       &Fan1OffVGA_Step5,      &Fan1RPMVGA_Step5       },      // Level 4      
1322              {5, 64,     56,     28,     &Fan1OnVGA_Step6,       &Fan1OffVGA_Step6,      &Fan1RPMVGA_Step6       },      // Level 5      
1323              {6,128, 60, 32,     &Fan1OnVGA_Step7,       &Fan1OffVGA_Step7,      &Fan1RPMVGA_Step7       },      // Level 6      
1324              //{7,127, 55, 48, &Fan1OnVGA_Step8, &Fan1OffVGA_Step8,      &Fan1RPMVGA_Step8       },      // Level 7              
1325          };
1326          //martin0616 add end
1327          //-----------------------------------------------------------------------------
1328          // Fan table 2
1329          //-----------------------------------------------------------------------------
1330          const thermalstruct code ThermalTalbe2CPU[]= //MARTINH185 //MARTINH079:change content // martin0616: chang
             -e 'ThermalTalbe2' to 'ThermalTalbe2CPU' //COKEYXU006:refer to Fan table v02_1220.
1331          {
1332                  {0,     44,     40,     0,      &Fan2On_Step1,  &Fan2Off_Step1, &Fan2RPM_Step1  },      // Level 0      
1333                  {1,     48,     40,     20,     &Fan2On_Step2,  &Fan2Off_Step2, &Fan2RPM_Step2  },      // Level 1      
1334                  {2,     60,     44,     23,     &Fan2On_Step3,  &Fan2Off_Step3, &Fan2RPM_Step3  },      // Level 2      
1335                  {3,     65,     56,     26,     &Fan2On_Step4,  &Fan2Off_Step4, &Fan2RPM_Step4  },      // Level 3      
1336                  {4,     70,     61,     31,     &Fan2On_Step5,  &Fan2Off_Step5, &Fan2RPM_Step5  },      // Level 4      
1337                  {5, 74, 66,     36,     &Fan2On_Step6,  &Fan2Off_Step6, &Fan2RPM_Step6  },      // Level 5      
1338                  {6,128, 70,     42,     &Fan2On_Step7,  &Fan2Off_Step7, &Fan2RPM_Step7  },      // Level 6      
1339                  //{7,127, 63,   56,     &Fan2On_Step8,  &Fan2Off_Step8, &Fan2RPM_Step8  },      // Level 7              
1340          };
1341          //MARTINH079:add start
1342          const thermalstruct code ThermalTalbe2CPU_DIS[]= //DIS //MARTINH185  //MARTINH175 //MARTINH172  //MARTINH1
             -66 //MARTINH079:change content // martin0616: change 'ThermalTalbe1' to 'ThermalTalbe1CPU'
1343          {
1344                  {0,     44,     40,     0,      &Fan2On_Step1,  &Fan2Off_Step1, &Fan2RPM_Step1  },      // Level 0      
1345                  {1,     48,     40,     20,     &Fan2On_Step2,  &Fan2Off_Step2, &Fan2RPM_Step2  },      // Level 1      
1346                  {2,     60,     44,     23,     &Fan2On_Step3,  &Fan2Off_Step3, &Fan2RPM_Step3  },      // Level 2      
1347                  {3,     65,     56,     26,     &Fan2On_Step4,  &Fan2Off_Step4, &Fan2RPM_Step4  },      // Level 3      
1348                  {4,     70,     61,     31,     &Fan2On_Step5,  &Fan2Off_Step5, &Fan2RPM_Step5  },      // Level 4      
1349                  {5, 74, 66,     36,     &Fan2On_Step6,  &Fan2Off_Step6, &Fan2RPM_Step6  },      // Level 5      
1350                  {6,128, 70,     42,     &Fan2On_Step7,  &Fan2Off_Step7, &Fan2RPM_Step7  },      // Level 6      
1351                  //{7,127, 55,   48,     &Fan2On_Step8,  &Fan2Off_Step8, &Fan2RPM_Step8  },      // Level 7      
1352          };
1353          //MARTINH079:add end
1354          
1355          //martin0616 add start
1356          const thermalstruct code ThermalTalbe2VGA[]= //MARTINH185 //MARTINH175 //MARTINH166 //MARTINH079:change co
             -ntent
1357          {
1358              {0, 45,     41,     0,      &Fan2OnVGA_Step1,       &Fan2OffVGA_Step1,      &Fan2RPMVGA_Step1       },      // Level 0      
1359              {1, 48,     41,     20,     &Fan2OnVGA_Step2,       &Fan2OffVGA_Step2,      &Fan2RPMVGA_Step2       },      // Level 1      
1360              {2, 52,     44,     23,     &Fan2OnVGA_Step3,       &Fan2OffVGA_Step3,      &Fan2RPMVGA_Step3       },      // Level 2      
1361              {3, 56,     48,     26,     &Fan2OnVGA_Step4,       &Fan2OffVGA_Step4,      &Fan2RPMVGA_Step4       },      // Level 3      
1362              {4, 60,     52,     31,     &Fan2OnVGA_Step5,       &Fan2OffVGA_Step5,      &Fan2RPMVGA_Step5       },      // Level 4      
1363              {5, 64,     56,     36,     &Fan2OnVGA_Step6,       &Fan2OffVGA_Step6,      &Fan2RPMVGA_Step6       },      // Level 5      
1364              {6,128,     60,     42,     &Fan2OnVGA_Step7,       &Fan2OffVGA_Step7,      &Fan2RPMVGA_Step7       },      // Level 6      
1365              //{7,127, 55, 48, &Fan2OnVGA_Step8, &Fan2OffVGA_Step8,      &Fan2RPMVGA_Step8       },      // Level 7              
1366          };
1367          //martin0616 add end
1368          //MARTINH146:Add start
1369          //-----------------------------------------------------------------------------
1370          // Check Fan RPM count used.
1371          //-----------------------------------------------------------------------------
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 24  

1372          void Check_FANRPM_Count(BYTE *BRPM_Cnt, BYTE TempType)
1373          {
1374   1                      if ( *BRPM_Cnt >= Fan_RPM_Cnt ) // Read 500ms*8 times: 4S
1375   1                      {
1376   2                       if ( TempType == TEMP_TYPE_FAN1RPM )
1377   2                                       { 
1378   3                                              Fan1RPM = Fan1RPMTemp; 
1379   3                                       }      
1380   2                                       else if( TempType == TEMP_TYPE_FAN2RPM ) 
1381   2                                       { 
1382   3                                           Fan2RPM = Fan2RPMTemp;
1383   3                                       }      
1384   2      
1385   2                                       *BRPM_Cnt = 0;
1386   2                      }
1387   1                      else
1388   1                      { (*BRPM_Cnt)++; }
1389   1      }
1390          //MARTINH146:Add end
1391          //-----------------------------------------------------------------------------
1392          // The function of check fan rpm 1  //martin0624A:change this function to meet 2 thermal table 1 fan.
1393          //----------------------------------------------------------------------------- 
1394          void CheckFanRPM1(void)
1395          {
1396   1              BYTE FanLevel_tcpu = FanLevelCPU;       
1397   1              BYTE FanLevel_tvga = FanLevelVGA;
1398   1              //BYTE Fan1RPM_t = Fan1RPM;
1399   1      
1400   1              if((Debugtemperature1==0x00)&&(Debugtemperature2==0x00))
1401   1              {
1402   2                      temperature1 = TEMP_Buff_3;
1403   2                      temperature2 = VGA_TBuff3;
1404   2              }
1405   1              else
1406   1              {
1407   2                      temperature1 = Debugtemperature1;
1408   2                      temperature2 = Debugtemperature2;
1409   2              }
1410   1      // check CPU fan table1:                
1411   1              if(FanLevel_tcpu <((sizeof(ThermalTalbe1CPU)/sizeof(thermalstruct))-1))
1412   1              {
1413   2                      if(temperature1>= *ThermalTalbe1CPU[FanLevel_tcpu].FanOn)          //COKEYXU031: Modify to >= as Thermal
             - request.
1414   2                      {
1415   3                              FanLevel_tcpu += 1;
1416   3                      }
1417   2              }
1418   1              
1419   1              if (FanLevel_tcpu>0)
1420   1              {
1421   2                      if (temperature1<= *ThermalTalbe1CPU[FanLevel_tcpu].FanOff)        //COKEYXU031: Modify to <= as Thermal
             - request.
1422   2                      {                       
1423   3                              FanLevel_tcpu-=1;
1424   3                      }
1425   2              }
1426   1      // check VGA fan table1:
1427   1              if(FanLevel_tvga <((sizeof(ThermalTalbe1VGA)/sizeof(thermalstruct))-1))
1428   1              {
1429   2                      if(temperature2>= *ThermalTalbe1VGA[FanLevel_tvga].FanOn)           //COKEYXU031: Modify to >= as Therma
             -l request.
1430   2                      {
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 25  

1431   3                              FanLevel_tvga += 1;
1432   3                      }
1433   2              }
1434   1              
1435   1              if (FanLevel_tvga>0)
1436   1              {
1437   2                      if (temperature2<= *ThermalTalbe1VGA[FanLevel_tvga].FanOff)          //COKEYXU031: Modify to <= as Therm
             -al request.
1438   2                      {                       
1439   3                              FanLevel_tvga-=1;
1440   3                      }
1441   2              }
1442   1              
1443   1              FanLevelCPU = FanLevel_tcpu;    
1444   1              FanLevelVGA = FanLevel_tvga;    
1445   1              if((*ThermalTalbe1CPU[FanLevel_tcpu].RPM)>(*ThermalTalbe1VGA[FanLevel_tvga].RPM))
1446   1                 Fan1RPMTemp =*ThermalTalbe1CPU[FanLevel_tcpu].RPM;  //MARTINH146:Change 'Fan1RPM' to 'Fan1RPMTemp'
1447   1              else
1448   1                 Fan1RPMTemp =*ThermalTalbe1VGA[FanLevel_tvga].RPM;  //MARTINH146:Change 'Fan1RPM' to 'Fan1RPMTemp'
1449   1                 
1450   1      //MARTINH146:Change:Add start
1451   1          //if(Fan1RPMTemp != Fan1RPM)  //MARTINH150:Remove
1452   1          if(Fan1RPMTemp == Fan1RPMBackUp)  //MARTINH150:Add
1453   1          {    
1454   2                  Check_FANRPM_Count(&Fan1RPMCount,TEMP_TYPE_FAN1RPM);
1455   2          }   
1456   1              else
1457   1              {
1458   2             Fan1RPMBackUp = Fan1RPMTemp;  //MARTINH150:Add
1459   2                 Fan1RPMCount = 0x00;
1460   2              }       
1461   1      //MARTINH146:Change:Add end     
1462   1      }
1463          //-----------------------------------------------------------------------------
1464          // The function of check fan rpm 2   //martin0624A:change this function to meet 2 thermal table 1 fan.
1465          //-----------------------------------------------------------------------------
1466          void CheckFanRPM2(void)
1467          {
1468   1              BYTE FanLevel_tcpu = FanLevel2CPU;
1469   1              BYTE FanLevel_tvga = FanLevel2VGA;
1470   1              //BYTE Fan1RPM_t = Fan2RPM;
1471   1      
1472   1              if((Debugtemperature1==0x00)&&(Debugtemperature2==0x00))
1473   1              {
1474   2                      temperature1 = TEMP_Buff_3;
1475   2                      temperature2 = VGA_TBuff3;
1476   2              }
1477   1              else
1478   1              {
1479   2                      temperature1 = Debugtemperature1;
1480   2                      temperature2 = Debugtemperature2;
1481   2              }
1482   1      
1483   1      // check CPU fan table2:                
1484   1              if(FanLevel_tcpu <((sizeof(ThermalTalbe2CPU)/sizeof(thermalstruct))-1))
1485   1              {
1486   2                      if(temperature1>= *ThermalTalbe2CPU[FanLevel_tcpu].FanOn)                  //COKEYXU031: Modify to >= as
             - Thermal request.
1487   2                      {
1488   3                              FanLevel_tcpu+= 1;
1489   3                      }
1490   2              }
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 26  

1491   1              
1492   1              if (FanLevel_tcpu>0)
1493   1              {
1494   2                      if (temperature1<= *ThermalTalbe2CPU[FanLevel_tcpu].FanOff)                 //COKEYXU031: Modify to <= a
             -s Thermal request.
1495   2                      {                       
1496   3                              FanLevel_tcpu-=1;
1497   3                      }
1498   2              }
1499   1      // check VGA fan table2:
1500   1              if(FanLevel_tvga <((sizeof(ThermalTalbe2VGA)/sizeof(thermalstruct))-1))
1501   1              {
1502   2                      if(temperature2>= *ThermalTalbe2VGA[FanLevel_tvga].FanOn)                  //COKEYXU031: Modify to >= as
             - Thermal request.
1503   2                      {
1504   3                              FanLevel_tvga+= 1;
1505   3                      }
1506   2              }
1507   1              
1508   1              if (FanLevel_tvga>0)
1509   1              {
1510   2                      if (temperature2<= *ThermalTalbe2VGA[FanLevel_tvga].FanOff)               //COKEYXU031: Modify to <= as 
             -Thermal request.
1511   2                      {                       
1512   3                              FanLevel_tvga-=1;
1513   3                      }
1514   2              }
1515   1      
1516   1      
1517   1              FanLevel2CPU = FanLevel_tcpu;   
1518   1              FanLevel2VGA= FanLevel_tvga;    
1519   1              if((*ThermalTalbe2CPU[FanLevel_tcpu].RPM)>(*ThermalTalbe2VGA[FanLevel_tvga].RPM))
1520   1                 Fan2RPMTemp =*ThermalTalbe2CPU[FanLevel_tcpu].RPM;    //MARTINH146:Change 'Fan2RPM' to 'Fan2RPMTemp'
1521   1              else
1522   1                 Fan2RPMTemp =*ThermalTalbe2VGA[FanLevel_tvga].RPM;    //MARTINH146:Change 'Fan2RPM' to 'Fan2RPMTemp'
1523   1      
1524   1      //MARTINH146:Change:Add start
1525   1          //if(Fan2RPMTemp != Fan2RPM)  //MARTINH150:Remove
1526   1          if(Fan2RPMTemp == Fan2RPMBackUp)  //MARTINH150:Add
1527   1          {
1528   2                  Check_FANRPM_Count(&Fan2RPMCount,TEMP_TYPE_FAN2RPM); 
1529   2          }
1530   1              else
1531   1              {
1532   2                 Fan2RPMBackUp = Fan2RPMTemp;  //MARTINH150:Add
1533   2                 Fan2RPMCount = 0x00;
1534   2              }
1535   1      //MARTINH146:Change:Add end
1536   1      
1537   1      }
1538          
1539          void Fan1MainControl(void)
1540          {
1541   1              //if(Fan1RPM>=Fan2RPM)  //martin0624A: remove
1542   1              //{     
1543   1                      if(((Fan1RPM*100)-100)>RPM1)
1544   1                      {
1545   2                              if(FAN_PWM<FAN_PWM_Max)
1546   2                              FAN_PWM++;      
1547   2                      }
1548   1                      else if(((Fan1RPM*100)+100)<RPM1)
1549   1                      {
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 27  

1550   2                              if(FAN_PWM>0x00)
1551   2                              FAN_PWM--;      
1552   2                      }
1553   1              //}
1554   1      //martin0624A remove start
1555   1      /*      else
1556   1              {
1557   1                      if(((Fan2RPM*100)-RPMACC)>RPM1)
1558   1                      {
1559   1                              if(FanValue<FAN_PWM_Max)
1560   1                              FanValue++;     
1561   1                      }
1562   1                      else if(((Fan2RPM*100)+RPMACC)<RPM1)
1563   1                      {
1564   1                              if(FanValue>0x00)
1565   1                              FanValue--;     
1566   1                      }               
1567   1              } */
1568   1      //martin0624A remove end        
1569   1      }
1570          void Fan2MainControl(void)
1571          {
1572   1              //if(Fan2RPM>=Fan1RPM)     //martin0624A: remove
1573   1              //{
1574   1                      if(((Fan2RPM*100)-100)>RPM2)
1575   1                      {
1576   2                              if(FAN2_PWM<FAN_PWM_Max)
1577   2                              FAN2_PWM++;     
1578   2                      }
1579   1                      else if(((Fan2RPM*100)+100)<RPM2)
1580   1                      {
1581   2                              if(FAN2_PWM>0x00)
1582   2                              FAN2_PWM--;     
1583   2                      }                       
1584   1              //}
1585   1      //martin0624A remove start      
1586   1      /*    else
1587   1              {       
1588   1                      if(((Fan1RPM*100)-RPMACC)>RPM1)
1589   1                      {
1590   1                              if(FanValue<FAN_PWM_Max)
1591   1                              FanValue++;     
1592   1                      }
1593   1                      else if(((Fan1RPM*100)+RPMACC)<RPM1)
1594   1                      {
1595   1                              if(FanValue>0x00)
1596   1                              FanValue--;     
1597   1                      }
1598   1              } */
1599   1      //martin0624A remove end        
1600   1      }
1601          
1602          //-----------------------------------------------------------------------------
1603          // The function of fan rpm control
1604          //-----------------------------------------------------------------------------
1605          void FanControl(void)
1606          {
1607   1              if(     RPM1==0x0000)
1608   1              {
1609   2                      FAN_PWM = FanInitValue;
1610   2              }
1611   1              Fan1MainControl(); //MARTINH031:add
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 28  

1612   1      //MARTINH031:remove     start
1613   1      /*      
1614   1          if(Fan1RPM!=0x00)
1615   1          {
1616   1              Fan1MainControl();
1617   1          }
1618   1          else
1619   1          {
1620   1              Fan2MainControl();
1621   1          }
1622   1      */  
1623   1      //MARTINH031:remove end
1624   1      }
1625          //MARTINH031:add start
1626          //-----------------------------------------------------------------------------
1627          // The function of fan rpm control
1628          //-----------------------------------------------------------------------------
1629          void Fan2Control(void)
1630          {
1631   1              if(     RPM2==0x0000)
1632   1              {
1633   2                      FAN2_PWM = FanInitValue;
1634   2              }
1635   1              Fan2MainControl(); 
1636   1      }
1637          //MARTINH031:add end
1638          //-----------------------------------------------------------------------------
1639          // Init. thermal table 1
1640          //-----------------------------------------------------------------------------
1641          void InitThermalTable1(void)
1642          {
1643   1              BYTE index;
1644   1              index=0x00;
1645   1      //MARTINH079:add start  
1646   1              if(IS_MASK_CLEAR(pProject0,b4VGAType)) 
1647   1              {
1648   2                   while(index<(sizeof(ThermalTalbe1CPU_DIS)/sizeof(thermalstruct)))
1649   2                  {
1650   3                      *ThermalTalbe1CPU[index].FanOn=ThermalTalbe1CPU_DIS[index].CFanOn;
1651   3                          *ThermalTalbe1CPU[index].FanOff=ThermalTalbe1CPU_DIS[index].CFanOff;
1652   3                          *ThermalTalbe1CPU[index].RPM=ThermalTalbe1CPU_DIS[index].CRPM;
1653   3                          index++;
1654   3                  }
1655   2              }
1656   1              else
1657   1      //MARTINH079: add end           
1658   1              {
1659   2                  while(index<(sizeof(ThermalTalbe1CPU)/sizeof(thermalstruct)))
1660   2                  {
1661   3                      *ThermalTalbe1CPU[index].FanOn=ThermalTalbe1CPU[index].CFanOn;
1662   3                          *ThermalTalbe1CPU[index].FanOff=ThermalTalbe1CPU[index].CFanOff;
1663   3                          *ThermalTalbe1CPU[index].RPM=ThermalTalbe1CPU[index].CRPM;
1664   3                          index++;
1665   3                  }
1666   2              }
1667   1      //MARTINH031: add start 
1668   1          index=0x00;
1669   1            while(index<(sizeof(ThermalTalbe1VGA)/sizeof(thermalstruct)))
1670   1            {
1671   2                   *ThermalTalbe1VGA[index].FanOn=ThermalTalbe1VGA[index].CFanOn;
1672   2                   *ThermalTalbe1VGA[index].FanOff=ThermalTalbe1VGA[index].CFanOff;
1673   2                   *ThermalTalbe1VGA[index].RPM=ThermalTalbe1VGA[index].CRPM;
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 29  

1674   2                   index++;
1675   2            } 
1676   1      //MARTINH031: add end 
1677   1      }
1678          
1679          //-----------------------------------------------------------------------------
1680          // Init. thermal table 2
1681          //-----------------------------------------------------------------------------
1682          void InitThermalTable2(void)
1683          {
1684   1              BYTE index;
1685   1              index=0x00;
1686   1      //MARTINH079:add start  
1687   1              if(IS_MASK_CLEAR(pProject0,b4VGAType)) 
1688   1              {
1689   2                  while(index<(sizeof(ThermalTalbe2CPU)/sizeof(thermalstruct)))
1690   2                  {
1691   3                      *ThermalTalbe2CPU[index].FanOn=ThermalTalbe2CPU_DIS[index].CFanOn;
1692   3                          *ThermalTalbe2CPU[index].FanOff=ThermalTalbe2CPU_DIS[index].CFanOff;
1693   3                          *ThermalTalbe2CPU[index].RPM=ThermalTalbe2CPU_DIS[index].CRPM;
1694   3                          index++;
1695   3                  }
1696   2              }
1697   1              else
1698   1      //MARTINH079: add end
1699   1              {
1700   2                  while(index<(sizeof(ThermalTalbe2CPU)/sizeof(thermalstruct)))
1701   2                  {
1702   3                      *ThermalTalbe2CPU[index].FanOn=ThermalTalbe2CPU[index].CFanOn;
1703   3                          *ThermalTalbe2CPU[index].FanOff=ThermalTalbe2CPU[index].CFanOff;
1704   3                          *ThermalTalbe2CPU[index].RPM=ThermalTalbe2CPU[index].CRPM;
1705   3                          index++;
1706   3                  }
1707   2              }       
1708   1      //MARTINH031: add start 
1709   1          index=0x00;
1710   1          while(index<(sizeof(ThermalTalbe2VGA)/sizeof(thermalstruct)))
1711   1         {
1712   2                 *ThermalTalbe2VGA[index].FanOn=ThermalTalbe2VGA[index].CFanOn;
1713   2                 *ThermalTalbe2VGA[index].FanOff=ThermalTalbe2VGA[index].CFanOff;
1714   2                 *ThermalTalbe2VGA[index].RPM=ThermalTalbe2VGA[index].CRPM;
1715   2                 index++;
1716   2         }
1717   1      //MARTINH031: add end   
1718   1      }
1719          
1720          //-----------------------------------------------------------------------------
1721          // Fan full off control
1722          //-----------------------------------------------------------------------------
1723          void FanFullOff(void)
1724          {
1725   1              FAN_PWM = 0x00;
1726   1              nAtmFanSpeed = 0;  //COKEYXU028: add for not show 0 fan rpm after fan stop
1727   1      }
1728          //MARTINH031: add start
1729          //-----------------------------------------------------------------------------
1730          // Fan full off control
1731          //-----------------------------------------------------------------------------
1732          void Fan2FullOff(void)
1733          {
1734   1              FAN2_PWM = 0x00;
1735   1              nAtmFan1Speed = 0;  //COKEYXU028: add for not show 0 fan rpm after fan stop
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 30  

1736   1      }
1737          //MARTINH031: add end
1738          //-----------------------------------------------------------------------------
1739          // The function of get fan RPM
1740          //-----------------------------------------------------------------------------
1741          void GetRPM1(void)
1742          {
1743   1      WORD Curr_Fan1Tachometer;
1744   1              if(SystemIsS0)
1745   1              {
1746   2                      if ( (F1TMRR == 0) && (F1TLRR == 0) )
1747   2                      {
1748   3                              nAtmFanSpeed = 0;
1749   3                      }
1750   2                      else
1751   2                      {
1752   3                              Curr_Fan1Tachometer = (36000/((WORD)(F1TMRR<<8) + F1TLRR))*60;
1753   3                              nAtmFanSpeed = ( Curr_Fan1Tachometer / 100 );
1754   3                  RPM1=Curr_Fan1Tachometer;  
1755   3                      }
1756   2                      
1757   2              }
1758   1              
1759   1      }
1760          //MARTINH031:add start
1761          //-----------------------------------------------------------------------------
1762          // The function of get fan2 RPM
1763          //-----------------------------------------------------------------------------
1764          void GetRPM2(void)
1765          {
1766   1        WORD Curr_Fan2Tachometer;
1767   1              if(SystemIsS0)
1768   1              {
1769   2                      if ( (F2TMRR == 0) && (F2TLRR == 0) )
1770   2                      {
1771   3                              nAtmFan1Speed = 0;
1772   3                      }
1773   2                      else
1774   2                      {
1775   3                              Curr_Fan2Tachometer = (36000/((WORD)(F2TMRR<<8) + F2TLRR))*60;
1776   3                              nAtmFan1Speed = ( Curr_Fan2Tachometer / 100 );
1777   3                  RPM2=Curr_Fan2Tachometer;  
1778   3                      }
1779   2                      
1780   2              }  
1781   1      }
1782          //-----------------------------------------------------------------------------
1783          // Fan Speed Control When Fan Table Not Ready
1784          //-----------------------------------------------------------------------------
1785          void FanSpeedConWhenFanTableNotReady(void)
1786          {
1787   1        if(ManualFanPRM!=0x00)        
1788   1        {         
1789   2                  FAN_PWM_ALT;
1790   2                              GetRPM1();
1791   2                              if( nAtmFanSpeed==0x0000)
1792   2                              {
1793   3                                      FAN_PWM = FanInitValue;
1794   3                              }
1795   2                              else
1796   2                              {
1797   3                                      if( nAtmFanSpeed > ManualFanPRM )
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 31  

1798   3                              {
1799   4                                      if( FAN_PWM > 0 )
1800   4                                      { FAN_PWM--; }
1801   4                              }
1802   3                              else
1803   3                              {
1804   4                                      if(FAN_PWM < FAN_PWM_Max)
1805   4                                      { FAN_PWM++; }
1806   4                                      else
1807   4                                      { FAN_PWM = FAN_PWM_Max; }
1808   4                              }
1809   3                              }
1810   2        }
1811   1      
1812   1       else
1813   1              {
1814   2              #if !FAN_TABLE_Already
                              FAN_PWM_OUT;                    // Set FAN_PWM OUTPUT.
                              EC_FAN_PWM_HI();
                              #endif  
1818   2              }
1819   1        
1820   1        if(ManualFan2PRM!=0x00)       
1821   1        {
1822   2                  FAN2_PWM_ALT;
1823   2                              GetRPM2();
1824   2                              if( nAtmFan1Speed==0x0000)
1825   2                              {
1826   3                                      FAN2_PWM = FanInitValue;
1827   3                              }
1828   2                              else
1829   2                              {
1830   3                                      if( nAtmFan1Speed > ManualFan2PRM )
1831   3                              {
1832   4                                      if( FAN2_PWM > 0 )
1833   4                                      { FAN2_PWM--; }
1834   4                              }
1835   3                              else
1836   3                              {
1837   4                                      if(FAN2_PWM < FAN_PWM_Max)
1838   4                                      { FAN2_PWM++; }
1839   4                                      else
1840   4                                      { FAN2_PWM = FAN_PWM_Max; }
1841   4                              }
1842   3                                      }
1843   2        }
1844   1        else
1845   1              {
1846   2              #if !FAN_TABLE_Already
                              FAN2_PWM_OUT;                   // Set FAN_PWM OUTPUT.
                              EC_FAN2_PWM_HI();
                              #endif  
1850   2              }
1851   1      }
1852          //MARTINH031:add end
1853          //-----------------------------------------------------------------------------
1854          // The function of smart fan  //martin0624A:change this function to meet 2 fan control.
1855          //-----------------------------------------------------------------------------
1856          void FanManager(void)
1857          {
1858   1      
1859   1                 // Check VGA and CPU Temperature error bit and full on bit.
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 32  

1860   1                  if ( (IS_MASK_SET(ERR_THMSTS, b1VGATempEr)) ||  //MARTINH116:remove "b3PECITempEr of ERR_THMSTS"
1861   1                                    (IS_MASK_SET(Thro_Status2, b4FAN1_FullOn)) )
1862   1                  {
1863   2                          FAN_PWM = FAN2_PWM = Target_Duty = FAN_PWM_Max;     // Fan turn on max.
1864   2                          return;
1865   2                  }
1866   1                      
1867   1                      if ( Fan_ON_Count != 0 )                                        // Turn on Fan x sec.
1868   1                      {
1869   2                              Fan_ON_Count--;
1870   2                              FAN_PWM = FAN2_PWM = Target_Duty = FAN_PWM_Min; // PWM min. 30%
1871   2                              return;
1872   2                      }
1873   1                      
1874   1                      if( SystemNotS0 )       // Not S0 status.
1875   1                      {
1876   2                              FAN_PWM = FAN2_PWM = Target_Duty = 0;   // Turn off FAN.
1877   2                              return;
1878   2                      }
1879   1      
1880   1                      if(FanFullOnCont!=0x00)
1881   1                      {
1882   2                              FanFullOnCont--;
1883   2                              GetRPM1();
1884   2                              GetRPM2();  //MARTINH031:add
1885   2                              return;
1886   2                      }
1887   1              
1888   1                      if(ManualFanPRM==0x00)                  // In normal control mode
1889   1                      {
1890   2                              //if((Fan1RPM!=0x00)||(Fan2RPM!=0x00))  //MARTINH031:remove
1891   2                              if(Fan1RPM!=0x00)  //MARTINH031:add
1892   2                              {
1893   3                                      GetRPM1();
1894   3                                      FanControl();
1895   3                              }
1896   2                              else
1897   2                              {
1898   3                                      if(FAN_PWM != 0x00)
1899   3                                      {
1900   4                                              RPM1=0x0000;
1901   4                                              FanFullOff();
1902   4                                      }
1903   3                              }
1904   2                      }
1905   1                      else                                                                                    // In RPM debug mode
1906   1                      {
1907   2                              GetRPM1();
1908   2                              if( RPM1==0x0000)
1909   2                              {
1910   3                                      FAN_PWM = FanInitValue;
1911   3                              }
1912   2                              else
1913   2                              {
1914   3                                      if(((ManualFanPRM*100)-100)>RPM1)
1915   3                                      {
1916   4                                              if(FAN_PWM<FAN_PWM_Max)
1917   4                                              FAN_PWM++; 
1918   4                                      }
1919   3                                      else if(((ManualFanPRM*100)+100)<RPM1)
1920   3                                      {
1921   4                                              if(FAN_PWM>0x00)
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 33  

1922   4                                              FAN_PWM--; 
1923   4                                      }
1924   3                              }
1925   2                      }
1926   1      //MARTINH031: add start
1927   1             if(ManualFan2PRM==0x00)                  // In normal control mode
1928   1                      {
1929   2                              if(Fan2RPM!=0x00)
1930   2                              {
1931   3                                      GetRPM2();
1932   3                                      Fan2Control();
1933   3                              }
1934   2                              else
1935   2                              {
1936   3                                      if(FAN2_PWM != 0x00)
1937   3                                      {
1938   4                                              RPM2=0x0000;
1939   4                                              Fan2FullOff();
1940   4                                      }
1941   3                                      
1942   3                              }
1943   2                      }
1944   1                      else                                                                                    // In RPM debug mode
1945   1                      {
1946   2                              GetRPM2();
1947   2                              if( RPM2==0x0000)
1948   2                              {
1949   3                                      FAN2_PWM = FanInitValue;
1950   3                              }
1951   2                              else
1952   2                              {
1953   3                                      if(((ManualFan2PRM*100)-100)>RPM2)
1954   3                                      {
1955   4                                              if(FAN2_PWM<FAN_PWM_Max)
1956   4                                              FAN2_PWM++; 
1957   4                                      }
1958   3                                      else if(((ManualFan2PRM*100)+100)<RPM2)
1959   3                                      {
1960   4                                              if(FAN2_PWM>0x00)
1961   4                                              FAN2_PWM--; 
1962   4                                      }
1963   3                              }
1964   2                      }
1965   1      
1966   1      //MARTINH031: add end
1967   1      }
1968          
1969          
1970          //martin0616 add end
1971          
1972          void Fan_Init(void)
1973          {
1974   1              nFanStatus1 = Fan_Num;
1975   1              nFanStatus1 = (nFanStatus1 << 4) | Fan_Step;
1976   1              nOSThrottlingTemp = 97;
1977   1              nOSShutdownTemp = 100;
1978   1              nShutDownTemp = 100;
1979   1      }
1980          
1981          //ANGELAS050:remove end
1982          /*****************************************************************************/
1983          // Procedure: ThrottlingControl                                                         TimeDiv: 100mSec
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 34  

1984          // Description: Chekc all throttling status.
1985          // GPIO:
1986          // Referrals:
1987          /*****************************************************************************/
1988          void ThrottlingControl(void)
1989          {
1990   1              if ( SystemIsS0 )
1991   1              {
1992   2                      //   Remove keep P1 states under battery mode.
1993   2                      /*
1994   2                    if ( IS_MASK_CLEAR(SYS_STATUS,AC_ADP)&&(0x00==cBATTThrottling) )
1995   2                   { cBATTThrottling = 0x01; }
1996   2                   */
1997   2                      //  Remove keep P1 states under battery mode.
1998   2                      cThrottlingSet.byte &= 0xF0;    // Clear Throttling status.
1999   2      
2000   2                      if( ( cThrottlingSet.byte & 0x0F ) < cADPThrottling )   // Compare current and ADP Throttling 
2001   2                      // if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < cADPThrottling )   //0ptimize CPU P_state (change 16 s
             -tep to 8 step).//:Change MAX P_state from 7 step to 11 step.
2002   2                      {
2003   3                              cThrottlingSet.byte |= cADPThrottling;
2004   3                      }
2005   2                      if( ( cThrottlingSet.byte & 0x0F ) < cTHERMThrottling ) // Compare current and Thermal throttling./
2006   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < cTHERMThrottling )//:0ptimize CPU P_state (change 16 st
             -ep to 8 step).//-
2007   2                      {
2008   3                              cThrottlingSet.byte &= 0xF0;
2009   3                              cThrottlingSet.byte |= cTHERMThrottling;
2010   3                      }
2011   2                      if( ( cThrottlingSet.byte & 0x0F ) < cBATTThrottling )  // Compare current and BAT throttling.
2012   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < cBATTThrottling )//:0ptimize CPU P_state (change 16 ste
             -p to 8 step).//-
2013   2                      {
2014   3                              cThrottlingSet.byte &= 0xF0;
2015   3                              cThrottlingSet.byte |= cBATTThrottling;
2016   3                      }
2017   2                      
2018   2                      //MEILING055:S+ add battery Low throttling level.
2019   2                      if( ( cThrottlingSet.byte & 0x0F ) < cBATTLowThrottling )       // Compare current and BAT throttling.
2020   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < cBATTThrottling )//:0ptimize CPU P_state (change 16 ste
             -p to 8 step).//-
2021   2                      {
2022   3                              cThrottlingSet.byte &= 0xF0;
2023   3                              cThrottlingSet.byte |= cBATTLowThrottling;
2024   3                      }
2025   2                      //MEILING055:E+
2026   2                      
2027   2                      if( ( cThrottlingSet.byte & 0x0F ) < nThrottlingAPSet ) // For AP or debug 
2028   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) < nThrottlingAPSet )//0ptimize CPU P_state (change 16 ste
             -p to 8 step).//-
2029   2                      {
2030   3                              cThrottlingSet.byte &= 0xF0;
2031   3                              cThrottlingSet.byte |= nThrottlingAPSet;
2032   3                      }
2033   2      
2034   2                      if( ( cThrottlingSet.byte & 0x0F ) != ( REAL_THROTTLING_INDEX & 0x0F ) )
2035   2                      //if( ( cThrottlingSet.byte & PSTATE_MAXStep ) != ( REAL_THROTTLING_INDEX & PSTATE_MAXStep ) )//:0ptimiz
             -e CPU P_state (change 16 step to 8 step).//-
2036   2                      {       // Cpu throttling for power status change
2037   3                              if( ( (nRealThermalPinGET) && (( cThrottlingSet.byte & 0x0F ) >= 0x01 ))|| (!nRealThermalPinGET) )
2038   3                              //if( ( (nRealThermalPinGET) && (( cThrottlingSet.byte & PSTATE_MAXStep ) >= 0x01 ))|| (!nRealThermalPi
             -nGET) )//:0ptimize CPU P_state (change 16 step to 8 step).
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 35  

2039   3                              {
2040   4                                      cThrottlingSet.fbit.cTHRM_SW = 1;
2041   4                      RamDebug(cADPThrottling);       
2042   4                      RamDebug(cTHERMThrottling);       
2043   4                      RamDebug(cBATTThrottling);        
2044   4                      RamDebug(REAL_THROTTLING_INDEX);        
2045   4                                      REAL_THROTTLING_INDEX = (REAL_THROTTLING_INDEX & 0xF0) | (cThrottlingSet.byte & 0x0F);
2046   4                      //REAL_THROTTLING_INDEX = (REAL_THROTTLING_INDEX & 0xF0) | (cThrottlingSet.byte & PSTATE_M
             -AXStep);//:0ptimize CPU P_state (change 16 step to 8 step).//-
2047   4                      RamDebug(REAL_THROTTLING_INDEX);      
2048   4                              }
2049   3                      }
2050   2                      if(CPUThrottlingDelayTime == 0) //MEILING052:send the 0x1D event after delay time.
2051   2                      {
2052   3                              if( cThrottlingSet.fbit.cTHRM_SW )
2053   3                              {
2054   4                                      cThrottlingSet.fbit.cTHRM_SW = 0;
2055   4                                      if ( IS_MASK_SET(SYS_MISC1, ACPI_OS) )  // Check OS mode.
2056   4                                      {
2057   5                                      RamDebug(0xEE);  RamDebug(CPU_SLOW_AD);        //T053+ 
2058   5                                              ECQEvent(CPU_SLOW_AD);  // 0x1D inform bios.
2059   5                                      }
2060   4                              }
2061   3                      }
2062   2              }
2063   1      }
2064          
2065          //MEILING033:add start GPU throttling control function.
2066          void GPUThrottlingControl(void)
2067          {
2068   1      
2069   1              if ( SystemIsS0 && (CPU_TYPE&0x80) ) //ANGELAG031: modify 0xc0 to 0x80 //ANGELAG022: modify 80 to C0 //AN
             -GELAG014: modify to only NV GPU //MEILING044:add.
2070   1              {
2071   2      
2072   2                      cGPUThrottlingSet.byte &= 0xF0; // Clear Throttling status.
2073   2      
2074   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUBattThrottling)     // Compare battery power Throttling 
2075   2                      {
2076   3                              cGPUThrottlingSet.byte |= cGPUBattThrottling;
2077   3                      }
2078   2      
2079   2                      //MEILING055:S+ add battery throttling level when PnP AC.
2080   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUACtoBattThrottling) // Compare PnP AC battery Throttling 
2081   2                      {
2082   3                              cGPUThrottlingSet.byte |= cGPUACtoBattThrottling;
2083   3                      }
2084   2                      //MEILING055:E+.
2085   2      
2086   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUBattOTPThrottling)  // Compare battery OTP Throttling 
2087   2                      {
2088   3                              cGPUThrottlingSet.byte &= 0xF0;
2089   3                              cGPUThrottlingSet.byte |= cGPUBattOTPThrottling;
2090   3                      }
2091   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUBattLowThrottling)  // Compare battery RSOC low Throttling 
2092   2                      {
2093   3                              cGPUThrottlingSet.byte &= 0xF0;
2094   3                              cGPUThrottlingSet.byte |= cGPUBattLowThrottling;
2095   3                      }
2096   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUThermalThrottling)  // Compare Thermal throttling
2097   2                      {
2098   3                              cGPUThrottlingSet.byte &= 0xF0;
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 36  

2099   3                              cGPUThrottlingSet.byte |= cGPUThermalThrottling;
2100   3                      }
2101   2                      //COKEYXU046: add start
2102   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUBattLTPThrottling)  // Compare battery OCP throttling
2103   2                      {
2104   3                              cGPUThrottlingSet.byte &= 0xF0;
2105   3                              cGPUThrottlingSet.byte |= cGPUBattLTPThrottling;
2106   3                      }
2107   2                      //COKEYXU046: add end
2108   2                      //ANGELAG019: add start
2109   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) < cGPUBattPsysThrottling) // Compare system power consumption thro
             -ttling
2110   2                      {
2111   3                              cGPUThrottlingSet.byte &= 0xF0;
2112   3                              cGPUThrottlingSet.byte |= cGPUBattPsysThrottling;
2113   3                      }
2114   2      
2115   2      
2116   2                      if( ( cGPUThrottlingSet.byte & 0x0F ) != ( GPU_REAL_THROTTLING_INDEX & 0x0F ) )
2117   2                      {       // send GPU throttling event.
2118   3                              GPU_REAL_THROTTLING_INDEX = (GPU_REAL_THROTTLING_INDEX & 0xF0) | (cGPUThrottlingSet.byte & 0x0F);
2119   3                              RamDebug(0xEE); 
2120   3                              RamDebug(GPU_SLOW);  
2121   3                              ECQEvent(GPU_SLOW);     // 0x1E inform bios.
2122   3                      }
2123   2              }
2124   1      
2125   1      }
2126          //MEILING033:add end.
2127          
2128          /*****************************************************************************/
2129          // Procedure: Chk_FAN_RPM_Control                                                       TimeDiv: 50mSec
2130          // Description: Check FAN is AP control.
2131          // GPIO:
2132          // Referrals:
2133          /*****************************************************************************/
2134          void Chk_FAN_RPM_Control(void)
2135          {
2136   1              BYTE BRPM_Manual;
2137   1              if (uReserve07.fbit.nFanManual == 1)
2138   1              {
2139   2                      FAN_PWM_ALT; //ANGELAS018:Open fan control function.
2140   2                      if ( (FAN_PWM != FAN_PWM_Max) && (nAtmFanSpeed != ManualFanPRM) )
2141   2                      {
2142   3                              if( nAtmFanSpeed > ManualFanPRM )
2143   3                              {
2144   4                                      if( FAN_PWM > 0 )
2145   4                                      { FAN_PWM--; }
2146   4                              }
2147   3                              else
2148   3                              {
2149   4                                      if(FAN_PWM < FAN_PWM_Max)
2150   4                                      { FAN_PWM++; }
2151   4                                      else
2152   4                                      { FAN_PWM = FAN_PWM_Max; }
2153   4                              }
2154   3                      }
2155   2                      //ANGELAS017:S+Open fan control function.
2156   2                      if ( (FAN_PWM == FAN_PWM_Max) && (nAtmFanSpeed > ManualFanPRM) )
2157   2                      {
2158   3                              if( FAN_PWM > 0 )
2159   3                              { FAN_PWM--; }
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 37  

2160   3                      }
2161   2                      //ANGELAS017:E+Open fan control function.
2162   2              }
2163   1              //ANGELAS018:S+Open fan control function.
2164   1              else
2165   1              {
2166   2                      #if !FAN_TABLE_Already
                              FAN_PWM_OUT;                    // Set FAN_PWM OUTPUT.
                              EC_FAN_PWM_HI();
                      FAN2_PWM_OUT;           //ELMERZH002:FAN 2 running at full speed.
                      EC_FAN2_PWM_HI();       //ELMERZH002:FAN 2 running at full speed.
                              #endif  // FAN_TABLE_Already
2172   2              }
2173   1              //ANGELAS018:E+Open fan control function.
2174   1      }
2175          
2176          
2177          
2178          
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 38  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com0154 (BEGIN)
0000         L?0341:
0000 F583              MOV     DPH,A
0002 E4                CLR     A
0003 93                MOVC    A,@A+DPTR
0004 FE                MOV     R6,A
0005 EF                MOV     A,R7
0006 75F00D            MOV     B,#0DH
0009 A4                MUL     AB
000A 2400        R     ADD     A,#LOW ThermalTalbe1CPU+04H
000C F582              MOV     DPL,A
000E E4                CLR     A
000F 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU+04H
0011         L?0342:
0011 F583              MOV     DPH,A
0013 120000      E     LCALL   ?C?PLDCODE
0016 EE                MOV     A,R6
0017 120000      E     LCALL   ?C?CSTPTR
001A EF                MOV     A,R7
001B 75F00D            MOV     B,#0DH
001E A4                MUL     AB
001F 22                RET     
0020         L?0343:
0020         L?0344:
0020 F583              MOV     DPH,A
0022 E4                CLR     A
0023 93                MOVC    A,@A+DPTR
0024 FE                MOV     R6,A
0025 EF                MOV     A,R7
0026 75F00D            MOV     B,#0DH
0029 A4                MUL     AB
002A 22                RET     
002B         L?0345:
002B 75F00D            MOV     B,#0DH
002E A4                MUL     AB
002F 2400        R     ADD     A,#LOW ThermalTalbe1VGA+0AH
0031 F582              MOV     DPL,A
0033 E4                CLR     A
0034 3400        R     ADDC    A,#HIGH ThermalTalbe1VGA+0AH
0036         L?0346:
0036 F583              MOV     DPH,A
0038 120000      E     LCALL   ?C?PLDCODE
003B 020000      E     LJMP    ?C?CLDPTR
003E         L?0347:
003E 540F              ANL     A,#0FH
0040 FF                MOV     R7,A
0041 E0                MOVX    A,@DPTR
0042 FE                MOV     R6,A
0043 EF                MOV     A,R7
0044 C3                CLR     C
0045 9E                SUBB    A,R6
0046 22                RET     
0047         L?0348:
0047 900000      E     MOV     DPTR,#VGA_TBuff2
004A E0                MOVX    A,@DPTR
004B 900000      E     MOV     DPTR,#VGA_TBuff3
004E F0                MOVX    @DPTR,A
004F 900000      E     MOV     DPTR,#VGA_TBuff1
0052 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 39  

0053 900000      E     MOV     DPTR,#VGA_TBuff2
0056 F0                MOVX    @DPTR,A
0057 900000      E     MOV     DPTR,#VGA_TEMP
005A E0                MOVX    A,@DPTR
005B 900000      E     MOV     DPTR,#VGA_TBuff1
005E F0                MOVX    @DPTR,A
005F 900000      E     MOV     DPTR,#VGA_TBuff2
0062 E0                MOVX    A,@DPTR
0063 FF                MOV     R7,A
0064 900000      E     MOV     DPTR,#VGA_TBuff1
0067 E0                MOVX    A,@DPTR
0068 2F                ADD     A,R7
0069 FF                MOV     R7,A
006A E4                CLR     A
006B 33                RLC     A
006C FE                MOV     R6,A
006D 900000      E     MOV     DPTR,#VGA_TBuff3
0070 E0                MOVX    A,@DPTR
0071 7C00              MOV     R4,#00H
0073 2F                ADD     A,R7
0074 FF                MOV     R7,A
0075 EC                MOV     A,R4
0076 3E                ADDC    A,R6
0077 FE                MOV     R6,A
0078 7D03              MOV     R5,#03H
007A 120000      E     LCALL   ?C?UIDIV
007D EF                MOV     A,R7
007E F0                MOVX    @DPTR,A
007F 22                RET     
0080         L?0349:
0080 E0                MOVX    A,@DPTR
0081 900000      E     MOV     DPTR,#RPM1+01H
0084         L?0350:
0084 75F064            MOV     B,#064H
0087 A4                MUL     AB
0088 249C              ADD     A,#09CH
008A FF                MOV     R7,A
008B E5F0              MOV     A,B
008D 34FF              ADDC    A,#0FFH
008F FE                MOV     R6,A
0090 C3                CLR     C
0091 E0                MOVX    A,@DPTR
0092 9F                SUBB    A,R7
0093 22                RET     
0094         L?0351:
0094 540F              ANL     A,#0FH
0096 FF                MOV     R7,A
0097 E0                MOVX    A,@DPTR
0098 FE                MOV     R6,A
0099 EF                MOV     A,R7
009A C3                CLR     C
009B 9E                SUBB    A,R6
009C 22                RET     
009D         L?0352:
009D 2400        R     ADD     A,#LOW ThermalTalbe1CPU+0AH
009F F582              MOV     DPL,A
00A1 E4                CLR     A
00A2 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU+0AH
00A4         L?0353:
00A4 F583              MOV     DPH,A
00A6 120000      E     LCALL   ?C?PLDCODE
00A9 EE                MOV     A,R6
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 40  

00AA 120000      E     LCALL   ?C?CSTPTR
00AD 0F                INC     R7
00AE 22                RET     
00AF         L?0354:
00AF E0                MOVX    A,@DPTR
00B0 900000      E     MOV     DPTR,#RPM2+01H
00B3         L?0355:
00B3 75F064            MOV     B,#064H
00B6 A4                MUL     AB
00B7 2464              ADD     A,#064H
00B9 FF                MOV     R7,A
00BA E4                CLR     A
00BB 35F0              ADDC    A,B
00BD FE                MOV     R6,A
00BE D3                SETB    C
00BF E0                MOVX    A,@DPTR
00C0 9F                SUBB    A,R7
00C1 22                RET     
00C2         L?0356:
00C2 FF                MOV     R7,A
00C3         L?0357:
00C3 E0                MOVX    A,@DPTR
00C4 FE                MOV     R6,A
00C5 EF                MOV     A,R7
00C6 4E                ORL     A,R6
00C7 900000      E     MOV     DPTR,#cGPUThrottlingSet
00CA F0                MOVX    @DPTR,A
00CB 22                RET     
00CC         L?0358:
00CC         L?0359:
00CC 900000      E     MOV     DPTR,#cGPUThrottlingSet
00CF         L?0360:
00CF E0                MOVX    A,@DPTR
00D0 54F0              ANL     A,#0F0H
00D2 F0                MOVX    @DPTR,A
00D3 E0                MOVX    A,@DPTR
00D4 FF                MOV     R7,A
00D5 22                RET     
00D6         L?0361:
00D6 540F              ANL     A,#0FH
00D8 FF                MOV     R7,A
00D9 E0                MOVX    A,@DPTR
00DA FE                MOV     R6,A
00DB EF                MOV     A,R7
00DC C3                CLR     C
00DD 9E                SUBB    A,R6
00DE 22                RET     
00DF         L?0364:
00DF         L?0365:
00DF 900000      E     MOV     DPTR,#CTR2
00E2 E0                MOVX    A,@DPTR
00E3 FF                MOV     R7,A
00E4 900000      E     MOV     DPTR,#DCR5
00E7 E0                MOVX    A,@DPTR
00E8 22                RET     
00E9         L?0366:
00E9 FE                MOV     R6,A
00EA E0                MOVX    A,@DPTR
00EB 7C00              MOV     R4,#00H
00ED 2400              ADD     A,#00H
00EF FF                MOV     R7,A
00F0 EC                MOV     A,R4
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 41  

00F1 3E                ADDC    A,R6
00F2 CB                XCH     A,R3
00F3 EF                MOV     A,R7
00F4 CB                XCH     A,R3
00F5 FA                MOV     R2,A
00F6 E4                CLR     A
00F7 F9                MOV     R1,A
00F8 F8                MOV     R0,A
00F9 7FA0              MOV     R7,#0A0H
00FB 7E8C              MOV     R6,#08CH
00FD FD                MOV     R5,A
00FE 120000      E     LCALL   ?C?SLDIV
0101 E4                CLR     A
0102 7B3C              MOV     R3,#03CH
0104 FA                MOV     R2,A
0105 F9                MOV     R1,A
0106 F8                MOV     R0,A
0107 020000      E     LJMP    ?C?LMUL
010A         L?0367:
010A F0                MOVX    @DPTR,A
010B EF                MOV     A,R7
010C         L?0368:
010C 75F005            MOV     B,#05H
010F A4                MUL     AB
0110 2400        R     ADD     A,#LOW CPUTHRTable+02H
0112 F582              MOV     DPL,A
0114 E4                CLR     A
0115 3400        R     ADDC    A,#HIGH CPUTHRTable+02H
0117 F583              MOV     DPH,A
0119 E4                CLR     A
011A 93                MOVC    A,@A+DPTR
011B 22                RET     
011C         L?0369:
011C F0                MOVX    @DPTR,A
011D EF                MOV     A,R7
011E         L?0370:
011E 75F005            MOV     B,#05H
0121 A4                MUL     AB
0122 2400        R     ADD     A,#LOW CPUTHRTable+03H
0124 F582              MOV     DPL,A
0126 E4                CLR     A
0127 3400        R     ADDC    A,#HIGH CPUTHRTable+03H
0129 F583              MOV     DPH,A
012B E4                CLR     A
012C 93                MOVC    A,@A+DPTR
012D 22                RET     
012E         L?0371:
012E 540F              ANL     A,#0FH
0130 FF                MOV     R7,A
0131 E0                MOVX    A,@DPTR
0132 FE                MOV     R6,A
0133 EF                MOV     A,R7
0134 C3                CLR     C
0135 9E                SUBB    A,R6
0136 22                RET     
0137         L?0372:
0137         L?0373:
0137 900000      E     MOV     DPTR,#CTR2
013A E0                MOVX    A,@DPTR
013B FD                MOV     R5,A
013C 7F1E              MOV     R7,#01EH
013E 22                RET     
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 42  

013F         L?0374:
013F         L?0375:
013F 900000      E     MOV     DPTR,#SysPowState
0142 E0                MOVX    A,@DPTR
0143 6411              XRL     A,#011H
0145 22                RET     
0146         L?0376:
0146         L?0377:
0146 E0                MOVX    A,@DPTR
0147 FE                MOV     R6,A
0148 EF                MOV     A,R7
0149 4E                ORL     A,R6
014A 900000      E     MOV     DPTR,#cThrottlingSet
014D F0                MOVX    @DPTR,A
014E 22                RET     
014F         L?0378:
014F 900000      E     MOV     DPTR,#VGA_TEMP
0152 F0                MOVX    @DPTR,A
0153 E4                CLR     A
0154 900000      E     MOV     DPTR,#VGAErrCnt
0157         L?0379:
0157 F0                MOVX    @DPTR,A
0158 900000      E     MOV     DPTR,#ERR_THMSTS
015B E0                MOVX    A,@DPTR
015C 54FD              ANL     A,#0FDH
015E F0                MOVX    @DPTR,A
015F 22                RET     
0160         L?0380:
0160         L?0381:
0160 900000      E     MOV     DPTR,#ManualFanPRM
0163 E0                MOVX    A,@DPTR
0164 FF                MOV     R7,A
0165 900000      E     MOV     DPTR,#nAtmFanSpeed
0168 E0                MOVX    A,@DPTR
0169 22                RET     
016A         L?0382:
016A 7D01              MOV     R5,#01H
016C 7BFF              MOV     R3,#0FFH
016E         L?0383:
016E 7E00              MOV     R6,#00H
0170 7F04              MOV     R7,#04H
0172 020000      E     LJMP    ?C?COPY
0175         L?0384:
0175         L?0385:
0175 900000      E     MOV     DPTR,#DCR5
0178 E0                MOVX    A,@DPTR
0179 D3                SETB    C
017A 9400              SUBB    A,#00H
017C 22                RET     
017D         L?0386:
017D         L?0387:
017D 900000      E     MOV     DPTR,#CTR2
0180 E0                MOVX    A,@DPTR
0181 FF                MOV     R7,A
0182 900000      E     MOV     DPTR,#DCR4
0185 E0                MOVX    A,@DPTR
0186 C3                CLR     C
0187 9F                SUBB    A,R7
0188 22                RET     
0189         L?0388:
0189 540F              ANL     A,#0FH
018B FF                MOV     R7,A
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 43  

018C E0                MOVX    A,@DPTR
018D FE                MOV     R6,A
018E EF                MOV     A,R7
018F C3                CLR     C
0190 9E                SUBB    A,R6
0191 22                RET     
0192         L?0389:
0192 F0                MOVX    @DPTR,A
0193 EF                MOV     A,R7
0194 75F005            MOV     B,#05H
0197 A4                MUL     AB
0198 2400        R     ADD     A,#LOW CPUTHRTable+01H
019A F582              MOV     DPL,A
019C E4                CLR     A
019D 3400        R     ADDC    A,#HIGH CPUTHRTable+01H
019F F583              MOV     DPH,A
01A1 E4                CLR     A
01A2 93                MOVC    A,@A+DPTR
01A3 22                RET     
01A4         L?0390:
01A4 F0                MOVX    @DPTR,A
01A5 EF                MOV     A,R7
01A6 75F005            MOV     B,#05H
01A9 A4                MUL     AB
01AA 2400        R     ADD     A,#LOW CPUTHRTable+04H
01AC F582              MOV     DPL,A
01AE E4                CLR     A
01AF 3400        R     ADDC    A,#HIGH CPUTHRTable+04H
01B1 F583              MOV     DPH,A
01B3 E4                CLR     A
01B4 93                MOVC    A,@A+DPTR
01B5 22                RET     
01B6         L?0391:
01B6 EF                MOV     A,R7
01B7 75F005            MOV     B,#05H
01BA A4                MUL     AB
01BB 2400        R     ADD     A,#LOW CPUTHRTable
01BD F582              MOV     DPL,A
01BF E4                CLR     A
01C0 3400        R     ADDC    A,#HIGH CPUTHRTable
01C2 F583              MOV     DPH,A
01C4 E4                CLR     A
01C5 93                MOVC    A,@A+DPTR
01C6 22                RET     
01C7         L?0392:
01C7         L?0393:
01C7 900000      E     MOV     DPTR,#VGAErrCnt
01CA E0                MOVX    A,@DPTR
01CB 04                INC     A
01CC F0                MOVX    @DPTR,A
01CD 22                RET     
01CE         L?0394:
01CE 75F00D            MOV     B,#0DH
01D1 A4                MUL     AB
01D2         L?0395:
01D2 2400        R     ADD     A,#LOW ThermalTalbe2VGA+0AH
01D4 F582              MOV     DPL,A
01D6 E4                CLR     A
01D7 3400        R     ADDC    A,#HIGH ThermalTalbe2VGA+0AH
01D9 22                RET     
01DA         L?0396:
01DA         L?0397:
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 44  

01DA E0                MOVX    A,@DPTR
01DB FF                MOV     R7,A
01DC 900000      E     MOV     DPTR,#EXT_VGA_Buff3
01DF E0                MOVX    A,@DPTR
01E0 C3                CLR     C
01E1 9F                SUBB    A,R7
01E2 22                RET     
01E3         L?0398:
01E3         L?0399:
01E3 E0                MOVX    A,@DPTR
01E4 FF                MOV     R7,A
01E5 900000      E     MOV     DPTR,#VGA_TBuff3
01E8 E0                MOVX    A,@DPTR
01E9 C3                CLR     C
01EA 9F                SUBB    A,R7
01EB 22                RET     
01EC         L?0400:
01EC         L?0401:
01EC E0                MOVX    A,@DPTR
01ED FF                MOV     R7,A
01EE 900000      E     MOV     DPTR,#TEMP_Buff_3
01F1 E0                MOVX    A,@DPTR
01F2 C3                CLR     C
01F3 9F                SUBB    A,R7
01F4 22                RET     
01F5         L?0402:
01F5 C3                CLR     C
01F6         L?0403:
01F6 FD                MOV     R5,A
01F7 900000      E     MOV     DPTR,#temperature1
01FA E0                MOVX    A,@DPTR
01FB 9D                SUBB    A,R5
01FC 22                RET     
01FD         L?0404:
01FD C3                CLR     C
01FE         L?0405:
01FE FD                MOV     R5,A
01FF 900000      E     MOV     DPTR,#temperature2
0202 E0                MOVX    A,@DPTR
0203 9D                SUBB    A,R5
0204 22                RET     
0205         L?0406:
0205 E0                MOVX    A,@DPTR
0206 FE                MOV     R6,A
0207 A3                INC     DPTR
0208 E0                MOVX    A,@DPTR
0209 FF                MOV     R7,A
020A 7C00              MOV     R4,#00H
020C 7D64              MOV     R5,#064H
020E 020000      E     LJMP    ?C?UIDIV
0211         L?0407:
0211         L?0408:
0211 900000      E     MOV     DPTR,#cThrottlingSet
0214 E0                MOVX    A,@DPTR
0215 540F              ANL     A,#0FH
0217 22                RET     
0218         L?0409:
0218 900000      E     MOV     DPTR,#TEMP_Buff_3
021B E0                MOVX    A,@DPTR
021C 900000      E     MOV     DPTR,#temperature1
021F F0                MOVX    @DPTR,A
0220 900000      E     MOV     DPTR,#VGA_TBuff3
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 45  

0223 22                RET     
0224         L?0410:
0224 900000      E     MOV     DPTR,#Debugtemperature1
0227 E0                MOVX    A,@DPTR
0228 900000      E     MOV     DPTR,#temperature1
022B F0                MOVX    @DPTR,A
022C 900000      E     MOV     DPTR,#Debugtemperature2
022F 22                RET     
0230         L?0411:
0230         L?0412:
0230 2400        R     ADD     A,#LOW ThermalTalbe1CPU+07H
0232 F582              MOV     DPL,A
0234 E4                CLR     A
0235 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU+07H
0237 22                RET     
0238         L?0413:
0238         L?0414:
0238 2400        R     ADD     A,#LOW ThermalTalbe2CPU+04H
023A F582              MOV     DPL,A
023C E4                CLR     A
023D 3400        R     ADDC    A,#HIGH ThermalTalbe2CPU+04H
023F 22                RET     
0240         L?0415:
0240         L?0416:
0240 2400        R     ADD     A,#LOW ThermalTalbe2CPU+07H
0242 F582              MOV     DPL,A
0244 E4                CLR     A
0245 3400        R     ADDC    A,#HIGH ThermalTalbe2CPU+07H
0247 22                RET     
0248         L?0417:
0248         L?0418:
0248 2400        R     ADD     A,#LOW ThermalTalbe2CPU+0AH
024A F582              MOV     DPL,A
024C E4                CLR     A
024D 3400        R     ADDC    A,#HIGH ThermalTalbe2CPU+0AH
024F 22                RET     
0250         L?0419:
0250         L?0420:
0250 900000      E     MOV     DPTR,#DCR4
0253 E0                MOVX    A,@DPTR
0254 D3                SETB    C
0255 9400              SUBB    A,#00H
0257 22                RET     
0258         L?0421:
0258         L?0422:
0258 900000      E     MOV     DPTR,#CPU_TYPE
025B E0                MOVX    A,@DPTR
025C 54C0              ANL     A,#0C0H
025E 22                RET     
025F         L?0423:
025F         L?0424:
025F 900000      E     MOV     DPTR,#cGPUThrottlingSet
0262 E0                MOVX    A,@DPTR
0263 540F              ANL     A,#0FH
0265 22                RET     
             ; FUNCTION Com0154 (END)

             ; FUNCTION PWM_TimeCount (BEGIN)
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 22
                                           ; SOURCE LINE # 23
0000 900000      E     MOV     DPTR,#uReserve07
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 46  

0003 E0                MOVX    A,@DPTR
0004 20E018            JB      ACC.0,?C0001
                                           ; SOURCE LINE # 24
                                           ; SOURCE LINE # 25
0007 900000      E     MOV     DPTR,#PWM_LEDBeep_CNT
000A E0                MOVX    A,@DPTR
000B 7002              JNZ     ?C0002
                                           ; SOURCE LINE # 26
                                           ; SOURCE LINE # 27
                                           ; SOURCE LINE # 28
000D 8015              SJMP    ?C0323
                                           ; SOURCE LINE # 30
000F         ?C0002:
                                           ; SOURCE LINE # 32
000F E4                CLR     A
0010 900000      E     MOV     DPTR,#GPCRA6
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 33
0014 900000      E     MOV     DPTR,#PWM_LEDBeep_CNT
0017 E0                MOVX    A,@DPTR
0018 14                DEC     A
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 35
001A E0                MOVX    A,@DPTR
001B 7012              JNZ     ?C0003
                                           ; SOURCE LINE # 36
                                           ; SOURCE LINE # 37
001D         ?C0322:
                                           ; SOURCE LINE # 38
                                           ; SOURCE LINE # 39
                                           ; SOURCE LINE # 40
001D 8005              SJMP    ?C0323
001F         ?C0001:
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 43
001F E4                CLR     A
0020 900000      E     MOV     DPTR,#PWM_LEDBeep_CNT
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 44
0024         ?C0323:
0024 900000      E     MOV     DPTR,#GPCRA6
0027 7482              MOV     A,#082H
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 45
002A E4                CLR     A
002B 900000      E     MOV     DPTR,#DCR6
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 46
                                           ; SOURCE LINE # 47
002F         ?C0003:
002F 22                RET     
             ; FUNCTION PWM_TimeCount (END)

             ; FUNCTION ThmIC_Temperature (BEGIN)
                                           ; SOURCE LINE # 56
                                           ; SOURCE LINE # 57
                                           ; SOURCE LINE # 60
0000 120000      R     LCALL   L?0374
0003 6003              JZ      $ + 5H
0005 020000      R     LJMP    ?C0008
0008 900000      E     MOV     DPTR,#PwrOnDly5Sec
000B E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 47  

000C 6003              JZ      $ + 5H
000E 020000      R     LJMP    ?C0008
                                           ; SOURCE LINE # 61
0011         ?C0006:
                                           ; SOURCE LINE # 66
0011 900000      E     MOV     DPTR,#TmlICStep
0014 E0                MOVX    A,@DPTR
0015 5403              ANL     A,#03H
0017 14                DEC     A
0018 600B              JZ      ?C0011
001A 04                INC     A
001B 700F              JNZ     ?C0012
                                           ; SOURCE LINE # 67
                                           ; SOURCE LINE # 68
001D         ?C0010:
                                           ; SOURCE LINE # 69
001D 900000      R     MOV     DPTR,#BTmlCmd
0020 7401              MOV     A,#01H
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 70
0023 800D              SJMP    ?C0009
                                           ; SOURCE LINE # 75
0025         ?C0011:
                                           ; SOURCE LINE # 76
0025 E4                CLR     A
0026 900000      R     MOV     DPTR,#BTmlCmd
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 77
002A 8006              SJMP    ?C0009
                                           ; SOURCE LINE # 82
002C         ?C0012:
                                           ; SOURCE LINE # 83
002C E4                CLR     A
002D 900000      E     MOV     DPTR,#TmlICStep
0030 F0                MOVX    @DPTR,A
0031 22                RET     
                                           ; SOURCE LINE # 85
0032         ?C0009:
                                           ; SOURCE LINE # 88
0032 900000      R     MOV     DPTR,#BTmlCmd
0035 E0                MOVX    A,@DPTR
0036 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0039 F0                MOVX    @DPTR,A
003A A3                INC     DPTR
003B 7400        R     MOV     A,#HIGH BsData
003D F0                MOVX    @DPTR,A
003E A3                INC     DPTR
003F 7400        R     MOV     A,#LOW BsData
0041 F0                MOVX    @DPTR,A
0042 E4                CLR     A
0043 A3                INC     DPTR
0044 F0                MOVX    @DPTR,A
0045 7B98              MOV     R3,#098H
0047 7D08              MOV     R5,#08H
0049 7F03              MOV     R7,#03H
004B 120000      E     LCALL   _bRWSMBus
004E EF                MOV     A,R7
004F 7037              JNZ     ?C0013
                                           ; SOURCE LINE # 90
                                           ; SOURCE LINE # 91
0051 900000      E     MOV     DPTR,#TMErrCnt
0054 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 48  

0055 04                INC     A
0056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 92
0057 900000      E     MOV     DPTR,#ERR_THMSTS
005A E0                MOVX    A,@DPTR
005B 20E012            JB      ACC.0,?C0014
                                           ; SOURCE LINE # 93
                                           ; SOURCE LINE # 94
005E 900000      E     MOV     DPTR,#TMErrCnt
0061 E0                MOVX    A,@DPTR
0062 D3                SETB    C
0063 9407              SUBB    A,#07H
0065 401C              JC      ?C0016
                                           ; SOURCE LINE # 95
                                           ; SOURCE LINE # 96
0067 900000      E     MOV     DPTR,#ERR_THMSTS
006A E0                MOVX    A,@DPTR
006B 4401              ORL     A,#01H
006D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 97
                                           ; SOURCE LINE # 98
006E 8013              SJMP    ?C0016
0070         ?C0014:
                                           ; SOURCE LINE # 100
                                           ; SOURCE LINE # 101
0070 900000      E     MOV     DPTR,#TMErrCnt
0073 E0                MOVX    A,@DPTR
0074 D3                SETB    C
0075 9444              SUBB    A,#044H
0077 400A              JC      ?C0016
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 103
0079 7F0B              MOV     R7,#0BH
007B 120000      E     LCALL   _ProcessSID
                                           ; SOURCE LINE # 104
007E E4                CLR     A
007F 900000      E     MOV     DPTR,#TMErrCnt
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 109
                                           ; SOURCE LINE # 110
0083         ?C0016:
                                           ; SOURCE LINE # 111
0083 7F03              MOV     R7,#03H
0085 020000      E     LJMP    _ResetSMBus
                                           ; SOURCE LINE # 112
0088         ?C0013:
                                           ; SOURCE LINE # 114
                                           ; SOURCE LINE # 145
0088 900000      E     MOV     DPTR,#TmlICStep
008B E0                MOVX    A,@DPTR
008C 5403              ANL     A,#03H
008E 14                DEC     A
008F 600C              JZ      ?C0021
0091 04                INC     A
0092 7023              JNZ     ?C0008
                                           ; SOURCE LINE # 146
                                           ; SOURCE LINE # 147
0094         ?C0020:
                                           ; SOURCE LINE # 148
0094 900000      R     MOV     DPTR,#BsData
0097 E0                MOVX    A,@DPTR
0098 900000      E     MOV     DPTR,#nVramTemp
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 49  

                                           ; SOURCE LINE # 149
                                           ; SOURCE LINE # 150
                                           ; SOURCE LINE # 151
                                           ; SOURCE LINE # 152
009B 8007              SJMP    ?C0324
                                           ; SOURCE LINE # 160
009D         ?C0021:
                                           ; SOURCE LINE # 161
009D 900000      R     MOV     DPTR,#BsData
00A0 E0                MOVX    A,@DPTR
00A1 900000      E     MOV     DPTR,#nRamTemp
00A4         ?C0324:
00A4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 162
00A5 E4                CLR     A
00A6 900000      E     MOV     DPTR,#TMErrCnt
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 163
00AA 900000      E     MOV     DPTR,#ERR_THMSTS
00AD E0                MOVX    A,@DPTR
00AE 54FE              ANL     A,#0FEH
00B0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 164
00B1 900000      E     MOV     DPTR,#TmlICStep
00B4 E0                MOVX    A,@DPTR
00B5 04                INC     A
00B6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 165
                                           ; SOURCE LINE # 166
                                           ; SOURCE LINE # 167
                                           ; SOURCE LINE # 168
                                           ; SOURCE LINE # 170
                                           ; SOURCE LINE # 172
00B7         ?C0008:
00B7 22                RET     
             ; FUNCTION ThmIC_Temperature (END)

             ; FUNCTION VGA_Temperature (BEGIN)
                                           ; SOURCE LINE # 299
                                           ; SOURCE LINE # 300
                                           ; SOURCE LINE # 305
0000 7800        R     MOV     R0,#LOW INIT_GPU_REG2
0002 7C00        R     MOV     R4,#HIGH INIT_GPU_REG2
0004 7A00        R     MOV     R2,#HIGH _?ix1000
0006 7900        R     MOV     R1,#LOW _?ix1000
0008 120000      R     LCALL   L?0382
                                           ; SOURCE LINE # 306
000B 7800        R     MOV     R0,#LOW INIT_GPU_REG1
000D 7C00        R     MOV     R4,#HIGH INIT_GPU_REG1
000F 7A00        R     MOV     R2,#HIGH _?ix1001
0011 7900        R     MOV     R1,#LOW _?ix1001
0013 120000      R     LCALL   L?0382
                                           ; SOURCE LINE # 307
0016 7800        R     MOV     R0,#LOW INIT_GPU_REG0
0018 7C00        R     MOV     R4,#HIGH INIT_GPU_REG0
001A 7D01              MOV     R5,#01H
001C 7BFF              MOV     R3,#0FFH
001E 7A00        R     MOV     R2,#HIGH _?ix1002
0020 7900        R     MOV     R1,#LOW _?ix1002
0022 120000      R     LCALL   L?0383
                                           ; SOURCE LINE # 309
0025 120000      R     LCALL   L?0421
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 50  

0028 900000      E     MOV     DPTR,#SWITCHABLE
002B 7006              JNZ     ?C0023
                                           ; SOURCE LINE # 310
002D E0                MOVX    A,@DPTR
002E 54FB              ANL     A,#0FBH
0030 F0                MOVX    @DPTR,A
0031 8004              SJMP    ?C0024
0033         ?C0023:
                                           ; SOURCE LINE # 312
0033 E0                MOVX    A,@DPTR
0034 4404              ORL     A,#04H
0036 F0                MOVX    @DPTR,A
0037         ?C0024:
                                           ; SOURCE LINE # 317
0037 900000      E     MOV     DPTR,#SysPowState
003A E0                MOVX    A,@DPTR
003B B41113            CJNE    A,#011H,?C0026
003E 900000      E     MOV     DPTR,#SWITCHABLE
0041 E0                MOVX    A,@DPTR
0042 30E203            JNB     ACC.2,?C0027
0045 D3                SETB    C
0046 8001              SJMP    ?C0028
0048         ?C0027:
0048 C3                CLR     C
0049         ?C0028:
0049 5006              JNC     ?C0026
004B 900000      E     MOV     DPTR,#PwrOnDly5Sec
004E E0                MOVX    A,@DPTR
004F 6018              JZ      ?C0025
0051         ?C0026:
                                           ; SOURCE LINE # 318
                                           ; SOURCE LINE # 319
0051 E4                CLR     A
0052 900000      E     MOV     DPTR,#VGAErrCnt
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 322
0056 900000      E     MOV     DPTR,#VGA_TBuff1
0059 F0                MOVX    @DPTR,A
005A 900000      E     MOV     DPTR,#VGA_TBuff2
005D F0                MOVX    @DPTR,A
005E 900000      E     MOV     DPTR,#VGA_TBuff3
0061 F0                MOVX    @DPTR,A
0062 900000      E     MOV     DPTR,#VGA_TEMP
                                           ; SOURCE LINE # 323
0065 120000      R     LCALL   L?0379
0068 22                RET     
                                           ; SOURCE LINE # 325
0069         ?C0025:
                                           ; SOURCE LINE # 327
0069 120000      R     LCALL   L?0421
006C 6440              XRL     A,#040H
006E 6003              JZ      $ + 5H
0070 020000      R     LJMP    ?C0030
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 330
0073 900000      E     MOV     DPTR,#?_bWSMBusBlock?BYTE+03H
0076 04                INC     A
0077 F0                MOVX    @DPTR,A
0078 A3                INC     DPTR
0079 7400        R     MOV     A,#HIGH INIT_GPU_REG1
007B F0                MOVX    @DPTR,A
007C 7400        R     MOV     A,#LOW INIT_GPU_REG1
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 51  

007E 120000      R     LCALL   L?0363
0081 7003              JNZ     ?C0031
                                           ; SOURCE LINE # 331
                                           ; SOURCE LINE # 332
0083 120000      R     LCALL   L?0392
                                           ; SOURCE LINE # 333
0086         ?C0031:
                                           ; SOURCE LINE # 334
0086 900000      E     MOV     DPTR,#?_bWSMBusBlock?BYTE+03H
0089 7402              MOV     A,#02H
008B F0                MOVX    @DPTR,A
008C A3                INC     DPTR
008D 7400        R     MOV     A,#HIGH INIT_GPU_REG0
008F F0                MOVX    @DPTR,A
0090 7400        R     MOV     A,#LOW INIT_GPU_REG0
0092 120000      R     LCALL   L?0363
0095 7003              JNZ     ?C0032
                                           ; SOURCE LINE # 335
                                           ; SOURCE LINE # 336
0097 120000      R     LCALL   L?0392
                                           ; SOURCE LINE # 337
009A         ?C0032:
                                           ; SOURCE LINE # 339
009A 900000      E     MOV     DPTR,#?_bWSMBusBlock?BYTE+03H
009D 7401              MOV     A,#01H
009F F0                MOVX    @DPTR,A
00A0 A3                INC     DPTR
00A1 7400        R     MOV     A,#HIGH INIT_GPU_REG2
00A3 F0                MOVX    @DPTR,A
00A4 A3                INC     DPTR
00A5 7400        R     MOV     A,#LOW INIT_GPU_REG2
00A7 F0                MOVX    @DPTR,A
00A8 A3                INC     DPTR
00A9 7404              MOV     A,#04H
00AB F0                MOVX    @DPTR,A
00AC E4                CLR     A
00AD A3                INC     DPTR
00AE F0                MOVX    @DPTR,A
00AF 7B82              MOV     R3,#082H
00B1 7D94              MOV     R5,#094H
00B3 7F03              MOV     R7,#03H
00B5 120000      E     LCALL   _bWSMBusBlock
00B8 EF                MOV     A,R7
00B9 7003              JNZ     ?C0033
                                           ; SOURCE LINE # 340
                                           ; SOURCE LINE # 341
00BB 120000      R     LCALL   L?0393
                                           ; SOURCE LINE # 342
00BE         ?C0033:
                                           ; SOURCE LINE # 353
00BE 900000      E     MOV     DPTR,#?_bRSMBusBlock?BYTE+03H
00C1 7403              MOV     A,#03H
00C3 F0                MOVX    @DPTR,A
00C4 7E00        E     MOV     R6,#HIGH sdAMDTH0
00C6 A3                INC     DPTR
00C7 7400        E     MOV     A,#HIGH sdAMDTH0
00C9 F0                MOVX    @DPTR,A
00CA A3                INC     DPTR
00CB 7400        E     MOV     A,#LOW sdAMDTH0
00CD F0                MOVX    @DPTR,A
00CE 7B82              MOV     R3,#082H
00D0 7D14              MOV     R5,#014H
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 52  

00D2 7F03              MOV     R7,#03H
00D4 120000      E     LCALL   _bRSMBusBlock
00D7 EF                MOV     A,R7
00D8 702F              JNZ     ?C0034
                                           ; SOURCE LINE # 354
                                           ; SOURCE LINE # 355
00DA 120000      R     LCALL   L?0393
                                           ; SOURCE LINE # 356
00DD 900000      E     MOV     DPTR,#ERR_THMSTS
00E0 E0                MOVX    A,@DPTR
00E1 20E112            JB      ACC.1,?C0035
                                           ; SOURCE LINE # 357
                                           ; SOURCE LINE # 358
00E4 900000      E     MOV     DPTR,#VGAErrCnt
00E7 E0                MOVX    A,@DPTR
00E8 D3                SETB    C
00E9 9423              SUBB    A,#023H
00EB 4015              JC      ?C0037
                                           ; SOURCE LINE # 359
                                           ; SOURCE LINE # 360
00ED 900000      E     MOV     DPTR,#ERR_THMSTS
00F0 E0                MOVX    A,@DPTR
00F1 4402              ORL     A,#02H
00F3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 361
                                           ; SOURCE LINE # 362
00F4 800C              SJMP    ?C0037
00F6         ?C0035:
                                           ; SOURCE LINE # 364
                                           ; SOURCE LINE # 365
00F6 900000      E     MOV     DPTR,#VGAErrCnt
00F9 E0                MOVX    A,@DPTR
00FA D3                SETB    C
00FB 94FE              SUBB    A,#0FEH
00FD 4003              JC      ?C0037
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 367
                                           ; SOURCE LINE # 368
                                           ; SOURCE LINE # 369
                                           ; SOURCE LINE # 370
                                           ; SOURCE LINE # 371
                                           ; SOURCE LINE # 372
00FF 120000      R     LCALL   L?0362
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 374
0102         ?C0037:
                                           ; SOURCE LINE # 375
0102 7F03              MOV     R7,#03H
0104 120000      E     LCALL   _ResetSMBus
                                           ; SOURCE LINE # 376
0107 8021              SJMP    ?C0030
0109         ?C0034:
                                           ; SOURCE LINE # 379
                                           ; SOURCE LINE # 381
0109 900000      E     MOV     DPTR,#sdAMDTH3
010C E0                MOVX    A,@DPTR
010D 900000      E     MOV     DPTR,#sdAMDTH2
0110 E0                MOVX    A,@DPTR
0111 FE                MOV     R6,A
0112 C3                CLR     C
0113 13                RRC     A
0114 2400              ADD     A,#00H
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 53  

                                           ; SOURCE LINE # 382
                                           ; SOURCE LINE # 383
0116 120000      R     LCALL   L?0378
                                           ; SOURCE LINE # 385
0119 900000      E     MOV     DPTR,#Fan_Debug_Temp
011C E0                MOVX    A,@DPTR
011D 20E10A            JB      ACC.1,?C0030
                                           ; SOURCE LINE # 386
                                           ; SOURCE LINE # 387
0120 900000      E     MOV     DPTR,#VGA_TEMP
0123 E0                MOVX    A,@DPTR
0124 20E76A            JB      ACC.7,?C0029
                                           ; SOURCE LINE # 388
                                           ; SOURCE LINE # 390
0127         ?C0041:
                                           ; SOURCE LINE # 392
                                           ; SOURCE LINE # 393
                                           ; SOURCE LINE # 394
                                           ; SOURCE LINE # 395
                                           ; SOURCE LINE # 396
0127 120000      R     LCALL   L?0348
                                           ; SOURCE LINE # 397
                                           ; SOURCE LINE # 398
                                           ; SOURCE LINE # 399
                                           ; SOURCE LINE # 400
012A         ?C0030:
                                           ; SOURCE LINE # 402
012A 120000      R     LCALL   L?0422
012D 6480              XRL     A,#080H
012F 7060              JNZ     ?C0029
                                           ; SOURCE LINE # 403
                                           ; SOURCE LINE # 404
0131 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0134 F0                MOVX    @DPTR,A
0135 A3                INC     DPTR
0136 7400        R     MOV     A,#HIGH BsData
0138 F0                MOVX    @DPTR,A
0139 A3                INC     DPTR
013A 7400        R     MOV     A,#LOW BsData
013C F0                MOVX    @DPTR,A
013D E4                CLR     A
013E A3                INC     DPTR
013F F0                MOVX    @DPTR,A
0140 7B9E              MOV     R3,#09EH
0142 7D08              MOV     R5,#08H
0144 7F03              MOV     R7,#03H
0146 120000      E     LCALL   _bRWSMBus
0149 EF                MOV     A,R7
014A 702D              JNZ     ?C0044
                                           ; SOURCE LINE # 407
                                           ; SOURCE LINE # 408
014C 120000      R     LCALL   L?0393
                                           ; SOURCE LINE # 409
014F 900000      E     MOV     DPTR,#ERR_THMSTS
0152 E0                MOVX    A,@DPTR
0153 20E112            JB      ACC.1,?C0045
                                           ; SOURCE LINE # 410
                                           ; SOURCE LINE # 411
0156 900000      E     MOV     DPTR,#VGAErrCnt
0159 E0                MOVX    A,@DPTR
015A D3                SETB    C
015B 9423              SUBB    A,#023H
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 54  

015D 4015              JC      ?C0047
                                           ; SOURCE LINE # 412
                                           ; SOURCE LINE # 413
015F 900000      E     MOV     DPTR,#ERR_THMSTS
0162 E0                MOVX    A,@DPTR
0163 4402              ORL     A,#02H
0165 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 414
                                           ; SOURCE LINE # 415
0166 800C              SJMP    ?C0047
0168         ?C0045:
                                           ; SOURCE LINE # 417
                                           ; SOURCE LINE # 418
0168 900000      E     MOV     DPTR,#VGAErrCnt
016B E0                MOVX    A,@DPTR
016C D3                SETB    C
016D 94FE              SUBB    A,#0FEH
016F 4003              JC      ?C0047
                                           ; SOURCE LINE # 419
                                           ; SOURCE LINE # 420
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
                                           ; SOURCE LINE # 423
                                           ; SOURCE LINE # 424
                                           ; SOURCE LINE # 425
0171 120000      R     LCALL   L?0362
                                           ; SOURCE LINE # 426
                                           ; SOURCE LINE # 427
0174         ?C0047:
                                           ; SOURCE LINE # 428
0174 7F03              MOV     R7,#03H
0176 020000      E     LJMP    _ResetSMBus
                                           ; SOURCE LINE # 429
0179         ?C0044:
                                           ; SOURCE LINE # 431
                                           ; SOURCE LINE # 462
0179 900000      R     MOV     DPTR,#BsData
017C E0                MOVX    A,@DPTR
                                           ; SOURCE LINE # 463
                                           ; SOURCE LINE # 464
017D 120000      R     LCALL   L?0378
                                           ; SOURCE LINE # 466
0180 900000      E     MOV     DPTR,#Fan_Debug_Temp
0183 E0                MOVX    A,@DPTR
0184 20E10A            JB      ACC.1,?C0029
                                           ; SOURCE LINE # 467
                                           ; SOURCE LINE # 468
0187 900000      E     MOV     DPTR,#VGA_TEMP
018A E0                MOVX    A,@DPTR
018B 20E703            JB      ACC.7,?C0029
                                           ; SOURCE LINE # 469
                                           ; SOURCE LINE # 471
018E         ?C0051:
                                           ; SOURCE LINE # 473
                                           ; SOURCE LINE # 474
                                           ; SOURCE LINE # 475
                                           ; SOURCE LINE # 476
                                           ; SOURCE LINE # 477
018E 120000      R     LCALL   L?0348
                                           ; SOURCE LINE # 478
                                           ; SOURCE LINE # 479
                                           ; SOURCE LINE # 481
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 55  

                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 484
0191         ?C0029:
0191 22                RET     
0192         L?0362:
0192 900000      E     MOV     DPTR,#SysStatus
0195 E0                MOVX    A,@DPTR
0196 4402              ORL     A,#02H
0198 F0                MOVX    @DPTR,A
0199 7F20              MOV     R7,#020H
019B 120000      E     LCALL   _ProcessSID
019E E4                CLR     A
019F 900000      E     MOV     DPTR,#VGAErrCnt
01A2 F0                MOVX    @DPTR,A
01A3 900000      E     MOV     DPTR,#GPDRH
01A6 E0                MOVX    A,@DPTR
01A7 54FE              ANL     A,#0FEH
01A9 F0                MOVX    @DPTR,A
01AA 7F01              MOV     R7,#01H
01AC 120000      E     LCALL   _Delay1MS
01AF 900000      E     MOV     DPTR,#GPDRH
01B2 E0                MOVX    A,@DPTR
01B3 4401              ORL     A,#01H
01B5 F0                MOVX    @DPTR,A
01B6 22                RET     
01B7         L?0363:
01B7 A3                INC     DPTR
01B8 F0                MOVX    @DPTR,A
01B9 A3                INC     DPTR
01BA 7404              MOV     A,#04H
01BC F0                MOVX    @DPTR,A
01BD E4                CLR     A
01BE A3                INC     DPTR
01BF F0                MOVX    @DPTR,A
01C0 7B82              MOV     R3,#082H
01C2 7D94              MOV     R5,#094H
01C4 7F03              MOV     R7,#03H
01C6 120000      E     LCALL   _bWSMBusBlock
01C9 EF                MOV     A,R7
01CA 22                RET     
             ; FUNCTION VGA_Temperature (END)

             ; FUNCTION Oem_Thermal_Control (BEGIN)
                                           ; SOURCE LINE # 494
                                           ; SOURCE LINE # 495
                                           ; SOURCE LINE # 498
0000 120000      R     LCALL   L?0374
0003 705E              JNZ     ?C0062
0005 900000      E     MOV     DPTR,#PwrOnDly5Sec
0008 E0                MOVX    A,@DPTR
0009 7058              JNZ     ?C0062
000B 900000      E     MOV     DPTR,#GPDRD
000E E0                MOVX    A,@DPTR
000F 30E051            JNB     ACC.0,?C0062
0012 E0                MOVX    A,@DPTR
0013 30E14D            JNB     ACC.1,?C0062
                                           ; SOURCE LINE # 499
                                           ; SOURCE LINE # 500
0016 900000      E     MOV     DPTR,#TJMAX
0019 E0                MOVX    A,@DPTR
001A 703A              JNZ     ?C0054
                                           ; SOURCE LINE # 501
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 56  

                                           ; SOURCE LINE # 502
001C 120000      E     LCALL   PECI_ReadCPUTJMAX
                                           ; SOURCE LINE # 503
001F 900000      E     MOV     DPTR,#CPU_TYPE
0022 E0                MOVX    A,@DPTR
0023 54FC              ANL     A,#0FCH
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 504
0026 900000      E     MOV     DPTR,#TJMAX
0029 E0                MOVX    A,@DPTR
002A B46909            CJNE    A,#069H,?C0055
                                           ; SOURCE LINE # 505
002D 900000      E     MOV     DPTR,#CPU_TYPE
0030 E0                MOVX    A,@DPTR
0031 4403              ORL     A,#03H
0033 F0                MOVX    @DPTR,A
0034 8023              SJMP    ?C0060
0036         ?C0055:
                                           ; SOURCE LINE # 506
0036 900000      E     MOV     DPTR,#TJMAX
0039 E0                MOVX    A,@DPTR
003A B46409            CJNE    A,#064H,?C0057
                                           ; SOURCE LINE # 507
003D 900000      E     MOV     DPTR,#CPU_TYPE
0040 E0                MOVX    A,@DPTR
0041 4402              ORL     A,#02H
0043 F0                MOVX    @DPTR,A
0044 8013              SJMP    ?C0060
0046         ?C0057:
                                           ; SOURCE LINE # 508
0046 900000      E     MOV     DPTR,#TJMAX
0049 E0                MOVX    A,@DPTR
004A B45A0C            CJNE    A,#05AH,?C0060
                                           ; SOURCE LINE # 509
004D 900000      E     MOV     DPTR,#CPU_TYPE
0050 E0                MOVX    A,@DPTR
0051 4401              ORL     A,#01H
0053 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 510
0054 8003              SJMP    ?C0060
0056         ?C0054:
                                           ; SOURCE LINE # 512
0056 120000      E     LCALL   PECI_ReadCPUTemp
0059         ?C0060:
                                           ; SOURCE LINE # 514
0059 900000      E     MOV     DPTR,#ERR_THMSTS
005C E0                MOVX    A,@DPTR
005D 30E303            JNB     ACC.3,?C0062
                                           ; SOURCE LINE # 515
                                           ; SOURCE LINE # 516
0060 120000      E     LCALL   DTS_ReadCPUTemp
                                           ; SOURCE LINE # 517
                                           ; SOURCE LINE # 519
                                           ; SOURCE LINE # 520
0063         ?C0062:
0063 22                RET     
             ; FUNCTION Oem_Thermal_Control (END)

             ; FUNCTION OEM_Throttling_Ctrl (BEGIN)
                                           ; SOURCE LINE # 585
                                           ; SOURCE LINE # 586
                                           ; SOURCE LINE # 589
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 57  

;---- Variable 'BTbStep' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
                                           ; SOURCE LINE # 591
0002 120000      R     LCALL   L?0375
0005 6008              JZ      ?C0063
                                           ; SOURCE LINE # 593
                                           ; SOURCE LINE # 594
0007 900000      E     MOV     DPTR,#GPDRJ
000A E0                MOVX    A,@DPTR
000B 54EF              ANL     A,#0EFH
000D F0                MOVX    @DPTR,A
000E 22                RET     
                                           ; SOURCE LINE # 596
000F         ?C0063:
                                           ; SOURCE LINE # 599
000F 900000      E     MOV     DPTR,#uMBID
0012 E0                MOVX    A,@DPTR
0013 B4140F            CJNE    A,#014H,?C0065
                                           ; SOURCE LINE # 600
                                           ; SOURCE LINE # 601
0016 900000      E     MOV     DPTR,#uMBGPU
0019 E0                MOVX    A,@DPTR
001A 30E104            JNB     ACC.1,?C0066
                                           ; SOURCE LINE # 602
                                           ; SOURCE LINE # 603
001D E4                CLR     A
001E FF                MOV     R7,A
                                           ; SOURCE LINE # 604
001F 802E              SJMP    ?C0068
0021         ?C0066:
                                           ; SOURCE LINE # 606
                                           ; SOURCE LINE # 607
0021 7F02              MOV     R7,#02H
                                           ; SOURCE LINE # 608
                                           ; SOURCE LINE # 609
0023 802A              SJMP    ?C0068
0025         ?C0065:
                                           ; SOURCE LINE # 610
0025 900000      E     MOV     DPTR,#uMBID
0028 E0                MOVX    A,@DPTR
0029 B4150F            CJNE    A,#015H,?C0069
                                           ; SOURCE LINE # 611
                                           ; SOURCE LINE # 612
002C 900000      E     MOV     DPTR,#uMBGPU
002F E0                MOVX    A,@DPTR
0030 30E104            JNB     ACC.1,?C0070
                                           ; SOURCE LINE # 613
                                           ; SOURCE LINE # 614
0033 7F04              MOV     R7,#04H
                                           ; SOURCE LINE # 615
0035 8018              SJMP    ?C0068
0037         ?C0070:
                                           ; SOURCE LINE # 617
                                           ; SOURCE LINE # 618
0037 7F06              MOV     R7,#06H
                                           ; SOURCE LINE # 619
                                           ; SOURCE LINE # 620
0039 8014              SJMP    ?C0068
003B         ?C0069:
                                           ; SOURCE LINE # 621
003B 900000      E     MOV     DPTR,#uMBID
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 58  

003E E0                MOVX    A,@DPTR
003F B4170D            CJNE    A,#017H,?C0068
                                           ; SOURCE LINE # 622
                                           ; SOURCE LINE # 623
0042 900000      E     MOV     DPTR,#uMBGPU
0045 E0                MOVX    A,@DPTR
0046 30E104            JNB     ACC.1,?C0074
                                           ; SOURCE LINE # 624
                                           ; SOURCE LINE # 625
0049 7F08              MOV     R7,#08H
                                           ; SOURCE LINE # 626
004B 8002              SJMP    ?C0068
004D         ?C0074:
                                           ; SOURCE LINE # 628
                                           ; SOURCE LINE # 629
004D 7F0A              MOV     R7,#0AH
                                           ; SOURCE LINE # 630
                                           ; SOURCE LINE # 631
004F         ?C0068:
                                           ; SOURCE LINE # 639
004F 120000      R     LCALL   _Thro_Std_Mode
                                           ; SOURCE LINE # 650
0052 900000      E     MOV     DPTR,#THR_PRO_ON
0055 E0                MOVX    A,@DPTR
0056 900000      E     MOV     DPTR,#nOSThrottlingTemp
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 651
005A 900000      E     MOV     DPTR,#THR_Tab_Shut
005D E0                MOVX    A,@DPTR
005E 900000      E     MOV     DPTR,#nOSShutdownTemp
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 652
0062 900000      E     MOV     DPTR,#THR_Tab_Shut
0065 E0                MOVX    A,@DPTR
0066 900000      E     MOV     DPTR,#nShutDownTemp
0069 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 654
006A         ?C0064:
006A 22                RET     
             ; FUNCTION OEM_Throttling_Ctrl (END)

             ; FUNCTION _Thro_Std_Mode (BEGIN)
                                           ; SOURCE LINE # 659
0000 900000      R     MOV     DPTR,#BMBStep
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 660
                                           ; SOURCE LINE # 694
0005 120000      R     LCALL   _THRTab_ToRAM
                                           ; SOURCE LINE # 695
0008 900000      R     MOV     DPTR,#BMBStep
000B E0                MOVX    A,@DPTR
000C 04                INC     A
000D FF                MOV     R7,A
000E 120000      R     LCALL   _VTHRTab_ToRAM
                                           ; SOURCE LINE # 697
0011 900000      R     MOV     DPTR,#BMBStep
0014 E0                MOVX    A,@DPTR
0015 FF                MOV     R7,A
0016 E4                CLR     A
0017 FD                MOV     R5,A
0018 120000      R     LCALL   _Thro_Shut_Status
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 59  

                                           ; SOURCE LINE # 698
001B 900000      R     MOV     DPTR,#BMBStep
001E E0                MOVX    A,@DPTR
001F FE                MOV     R6,A
0020 120000      R     LCALL   L?0368
0023 FF                MOV     R7,A
0024 EE                MOV     A,R6
0025 120000      R     LCALL   L?0370
0028 FD                MOV     R5,A
0029 E4                CLR     A
002A FB                MOV     R3,A
002B 120000      R     LCALL   _Thro_Turbo
                                           ; SOURCE LINE # 699
002E 7D04              MOV     R5,#04H
0030 E4                CLR     A
0031 FF                MOV     R7,A
0032 120000      R     LCALL   _Thro_Shut_Status
                                           ; SOURCE LINE # 701
0035 900000      E     MOV     DPTR,#uMBGPU
0038 E0                MOVX    A,@DPTR
0039 30E13D            JNB     ACC.1,?C0077
                                           ; SOURCE LINE # 702
                                           ; SOURCE LINE # 703
003C 900000      R     MOV     DPTR,#BMBStep
003F E0                MOVX    A,@DPTR
0040 04                INC     A
0041 FF                MOV     R7,A
0042 7D01              MOV     R5,#01H
0044 120000      R     LCALL   _Thro_Shut_Status
                                           ; SOURCE LINE # 704
0047 900000      R     MOV     DPTR,#BMBStep
004A E0                MOVX    A,@DPTR
004B FE                MOV     R6,A
004C 75F005            MOV     B,#05H
004F A4                MUL     AB
0050 2400        R     ADD     A,#LOW CPUTHRTable+07H
0052 F582              MOV     DPL,A
0054 E4                CLR     A
0055 3400        R     ADDC    A,#HIGH CPUTHRTable+07H
0057 F583              MOV     DPH,A
0059 E4                CLR     A
005A 93                MOVC    A,@A+DPTR
005B FF                MOV     R7,A
005C EE                MOV     A,R6
005D 75F005            MOV     B,#05H
0060 A4                MUL     AB
0061 2400        R     ADD     A,#LOW CPUTHRTable+08H
0063 F582              MOV     DPL,A
0065 E4                CLR     A
0066 3400        R     ADDC    A,#HIGH CPUTHRTable+08H
0068 F583              MOV     DPH,A
006A E4                CLR     A
006B 93                MOVC    A,@A+DPTR
006C FD                MOV     R5,A
006D 7B01              MOV     R3,#01H
006F 120000      R     LCALL   _Thro_Turbo
                                           ; SOURCE LINE # 705
0072 7D05              MOV     R5,#05H
0074 E4                CLR     A
0075 FF                MOV     R7,A
0076 120000      R     LCALL   _Thro_Shut_Status
                                           ; SOURCE LINE # 706
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 60  

                                           ; SOURCE LINE # 710
0079         ?C0077:
0079 22                RET     
             ; FUNCTION _Thro_Std_Mode (END)

             ; FUNCTION disCPUturbo90s (BEGIN)
                                           ; SOURCE LINE # 713
                                           ; SOURCE LINE # 714
                                           ; SOURCE LINE # 715
0000 D3                SETB    C
0001 900000      E     MOV     DPTR,#DisCPUTurboFor90s+01H
0004 E0                MOVX    A,@DPTR
0005 9400              SUBB    A,#00H
0007 900000      E     MOV     DPTR,#DisCPUTurboFor90s
000A E0                MOVX    A,@DPTR
000B 9400              SUBB    A,#00H
000D 4007              JC      ?C0079
                                           ; SOURCE LINE # 716
                                           ; SOURCE LINE # 717
000F 74FF              MOV     A,#0FFH
0011 F5F0              MOV     B,A
0013 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 718
                                           ; SOURCE LINE # 719
0016         ?C0079:
0016 22                RET     
             ; FUNCTION disCPUturbo90s (END)

             ; FUNCTION _Thro_Shut_Status (BEGIN)
                                           ; SOURCE LINE # 856
0000 900000      R     MOV     DPTR,#BStep
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 857
                                           ; SOURCE LINE # 860
0008 6402              XRL     A,#02H
000A 7037              JNZ     ?C0080
                                           ; SOURCE LINE # 861
                                           ; SOURCE LINE # 863
000C 900000      E     MOV     DPTR,#THR_PRO_OFF
000F 120000      R     LCALL   L?0396
0012 5009              JNC     ?C0081
                                           ; SOURCE LINE # 864
0014 900000      E     MOV     DPTR,#Thro_Status
0017 E0                MOVX    A,@DPTR
0018 54FB              ANL     A,#0FBH
001A F0                MOVX    @DPTR,A
001B 800F              SJMP    ?C0082
001D         ?C0081:
                                           ; SOURCE LINE # 866
001D 900000      E     MOV     DPTR,#THR_PRO_ON
0020 120000      R     LCALL   L?0396
0023 4007              JC      ?C0082
                                           ; SOURCE LINE # 867
0025 900000      E     MOV     DPTR,#Thro_Status
0028 E0                MOVX    A,@DPTR
0029 4404              ORL     A,#04H
002B F0                MOVX    @DPTR,A
002C         ?C0082:
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 61  

                                           ; SOURCE LINE # 870
002C 900000      E     MOV     DPTR,#THR_Tab_Shut
002F 120000      R     LCALL   L?0397
0032 4009              JC      ?C0084
                                           ; SOURCE LINE # 871
0034 7E00        E     MOV     R6,#HIGH EXTVGA_Shut_Cnt
0036 7F00        E     MOV     R7,#LOW EXTVGA_Shut_Cnt
0038 7D02              MOV     R5,#02H
003A 020000      R     LJMP    ?C0328
003D         ?C0084:
                                           ; SOURCE LINE # 873
003D E4                CLR     A
003E 900000      E     MOV     DPTR,#EXTVGA_Shut_Cnt
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 874
0042 22                RET     
0043         ?C0080:
                                           ; SOURCE LINE # 875
0043 900000      R     MOV     DPTR,#BTType
0046 E0                MOVX    A,@DPTR
0047 6401              XRL     A,#01H
0049 7037              JNZ     ?C0087
                                           ; SOURCE LINE # 876
                                           ; SOURCE LINE # 885
004B 900000      E     MOV     DPTR,#VTHR_PRO_OFF
004E 120000      R     LCALL   L?0398
0051 5009              JNC     ?C0088
                                           ; SOURCE LINE # 886
0053 900000      E     MOV     DPTR,#GPU_Prochot
0056 E0                MOVX    A,@DPTR
0057 54FE              ANL     A,#0FEH
0059 F0                MOVX    @DPTR,A
005A 800F              SJMP    ?C0089
005C         ?C0088:
                                           ; SOURCE LINE # 887
005C 900000      E     MOV     DPTR,#VTHR_PRO_ON
005F 120000      R     LCALL   L?0398
0062 4007              JC      ?C0089
                                           ; SOURCE LINE # 888
0064 900000      E     MOV     DPTR,#GPU_Prochot
0067 E0                MOVX    A,@DPTR
0068 4401              ORL     A,#01H
006A F0                MOVX    @DPTR,A
006B         ?C0089:
                                           ; SOURCE LINE # 892
006B 900000      E     MOV     DPTR,#VTHR_Tab_Shut
006E 120000      R     LCALL   L?0399
0071 4009              JC      ?C0091
                                           ; SOURCE LINE # 893
0073 7E00        E     MOV     R6,#HIGH VGA_Shut_Cnt
0075 7F00        E     MOV     R7,#LOW VGA_Shut_Cnt
0077 7D01              MOV     R5,#01H
0079         ?C0325:
0079 020000      R     LJMP    ?C0328
007C         ?C0091:
                                           ; SOURCE LINE # 895
007C E4                CLR     A
007D 900000      E     MOV     DPTR,#VGA_Shut_Cnt
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 896
0081 22                RET     
0082         ?C0087:
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 62  

                                           ; SOURCE LINE # 897
0082 900000      R     MOV     DPTR,#BTType
0085 E0                MOVX    A,@DPTR
0086 B40417            CJNE    A,#04H,?C0094
                                           ; SOURCE LINE # 898
                                           ; SOURCE LINE # 900
0089 900000      E     MOV     DPTR,#ThermistorCPU_TEMP
008C E0                MOVX    A,@DPTR
008D C3                CLR     C
008E 945F              SUBB    A,#05FH
0090 4008              JC      ?C0095
                                           ; SOURCE LINE # 901
0092 7E00        E     MOV     R6,#HIGH local_Shut_Cnt
0094 7F00        E     MOV     R7,#LOW local_Shut_Cnt
0096 7D04              MOV     R5,#04H
0098         ?C0326:
0098 8052              SJMP    ?C0328
009A         ?C0095:
                                           ; SOURCE LINE # 903
009A E4                CLR     A
009B 900000      E     MOV     DPTR,#local_Shut_Cnt
009E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 904
009F 22                RET     
00A0         ?C0094:
                                           ; SOURCE LINE # 905
00A0 900000      R     MOV     DPTR,#BTType
00A3 E0                MOVX    A,@DPTR
00A4 B40517            CJNE    A,#05H,?C0098
                                           ; SOURCE LINE # 906
                                           ; SOURCE LINE # 908
00A7 900000      E     MOV     DPTR,#EXTVGA_TEMP
00AA E0                MOVX    A,@DPTR
00AB C3                CLR     C
00AC 9463              SUBB    A,#063H
00AE 4008              JC      ?C0099
                                           ; SOURCE LINE # 909
00B0 7E00        E     MOV     R6,#HIGH remote_Shut_Cnt
00B2 7F00        E     MOV     R7,#LOW remote_Shut_Cnt
00B4 7D05              MOV     R5,#05H
00B6         ?C0327:
00B6 8034              SJMP    ?C0328
00B8         ?C0099:
                                           ; SOURCE LINE # 911
00B8 E4                CLR     A
00B9 900000      E     MOV     DPTR,#remote_Shut_Cnt
00BC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 912
00BD 22                RET     
00BE         ?C0098:
                                           ; SOURCE LINE # 914
                                           ; SOURCE LINE # 916
00BE 900000      E     MOV     DPTR,#THR_PRO_OFF
00C1 120000      R     LCALL   L?0400
00C4 5009              JNC     ?C0102
                                           ; SOURCE LINE # 917
00C6 900000      E     MOV     DPTR,#Thro_Status
00C9 E0                MOVX    A,@DPTR
00CA 54FE              ANL     A,#0FEH
00CC F0                MOVX    @DPTR,A
00CD 800F              SJMP    ?C0103
00CF         ?C0102:
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 63  

                                           ; SOURCE LINE # 919
00CF 900000      E     MOV     DPTR,#THR_PRO_ON
00D2 120000      R     LCALL   L?0400
00D5 4007              JC      ?C0103
                                           ; SOURCE LINE # 920
00D7 900000      E     MOV     DPTR,#Thro_Status
00DA E0                MOVX    A,@DPTR
00DB 4401              ORL     A,#01H
00DD F0                MOVX    @DPTR,A
00DE         ?C0103:
                                           ; SOURCE LINE # 923
00DE 900000      E     MOV     DPTR,#THR_Tab_Shut
00E1 120000      R     LCALL   L?0401
00E4 4009              JC      ?C0105
                                           ; SOURCE LINE # 924
00E6 7E00        E     MOV     R6,#HIGH CPU_Shut_Cnt
00E8 7F00        E     MOV     R7,#LOW CPU_Shut_Cnt
00EA E4                CLR     A
00EB FD                MOV     R5,A
00EC         ?C0328:
00EC 020000      R     LJMP    _Thro_Count_Shut
00EF         ?C0105:
                                           ; SOURCE LINE # 926
00EF E4                CLR     A
00F0 900000      E     MOV     DPTR,#CPU_Shut_Cnt
00F3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 927
                                           ; SOURCE LINE # 929
00F4         ?C0107:
00F4 22                RET     
             ; FUNCTION _Thro_Shut_Status (END)

             ; FUNCTION _Thro_Turbo (BEGIN)
                                           ; SOURCE LINE # 934
;---- Variable 'BTurboOff' assigned to Register 'R5' ----
;---- Variable 'BTurboRem' assigned to Register 'R7' ----
;---- Variable 'BTType' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 935
                                           ; SOURCE LINE # 938
0000 900000      E     MOV     DPTR,#SYS_MISC1
0003 E0                MOVX    A,@DPTR
0004 20E703            JB      ACC.7,$ + 6H
0007 020000      R     LJMP    ?C0109
000A         ?C0108:
                                           ; SOURCE LINE # 941
000A EB                MOV     A,R3
000B 6402              XRL     A,#02H
000D 7026              JNZ     ?C0110
                                           ; SOURCE LINE # 942
                                           ; SOURCE LINE # 943
000F 900000      E     MOV     DPTR,#EXT_VGA_Buff3
0012 E0                MOVX    A,@DPTR
0013 D3                SETB    C
0014 9F                SUBB    A,R7
0015 500A              JNC     ?C0111
                                           ; SOURCE LINE # 944
0017 900000      E     MOV     DPTR,#Thro_Status
001A E0                MOVX    A,@DPTR
001B 54DF              ANL     A,#0DFH
001D F0                MOVX    @DPTR,A
001E 020000      R     LJMP    ?C0114
0021         ?C0111:
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 64  

                                           ; SOURCE LINE # 945
0021 900000      E     MOV     DPTR,#EXT_VGA_Buff3
0024 E0                MOVX    A,@DPTR
0025 C3                CLR     C
0026 9D                SUBB    A,R5
0027 5003              JNC     $ + 5H
0029 020000      R     LJMP    ?C0114
                                           ; SOURCE LINE # 946
002C 900000      E     MOV     DPTR,#Thro_Status
002F E0                MOVX    A,@DPTR
0030 4420              ORL     A,#020H
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 947
0033 807B              SJMP    ?C0114
0035         ?C0110:
                                           ; SOURCE LINE # 948
0035 EB                MOV     A,R3
0036 6401              XRL     A,#01H
0038 7045              JNZ     ?C0115
                                           ; SOURCE LINE # 949
                                           ; SOURCE LINE # 952
003A 900000      E     MOV     DPTR,#GPDRB
003D E0                MOVX    A,@DPTR
003E 30E014            JNB     ACC.0,?C0116
                                           ; SOURCE LINE # 953
                                           ; SOURCE LINE # 955
0041 900000      E     MOV     DPTR,#VGA_TBuff3
0044 E0                MOVX    A,@DPTR
0045 D3                SETB    C
0046 9F                SUBB    A,R7
0047 5002              JNC     ?C0117
                                           ; SOURCE LINE # 956
0049 8016              SJMP    ?C0329
004B         ?C0117:
                                           ; SOURCE LINE # 958
004B 900000      E     MOV     DPTR,#VGA_TBuff3
004E E0                MOVX    A,@DPTR
004F C3                CLR     C
0050 9D                SUBB    A,R5
0051 405D              JC      ?C0114
                                           ; SOURCE LINE # 959
                                           ; SOURCE LINE # 961
0053 8021              SJMP    ?C0330
0055         ?C0116:
                                           ; SOURCE LINE # 963
                                           ; SOURCE LINE # 964
0055 EF                MOV     A,R7
0056 24FB              ADD     A,#0FBH
0058 FE                MOV     R6,A
0059 900000      E     MOV     DPTR,#VGA_TBuff3
005C E0                MOVX    A,@DPTR
005D D3                SETB    C
005E 9E                SUBB    A,R6
005F 5009              JNC     ?C0121
                                           ; SOURCE LINE # 965
0061         ?C0329:
0061 900000      E     MOV     DPTR,#Thro_Status
0064 E0                MOVX    A,@DPTR
0065 54EF              ANL     A,#0EFH
0067 F0                MOVX    @DPTR,A
0068 8046              SJMP    ?C0114
006A         ?C0121:
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 65  

                                           ; SOURCE LINE # 967
006A ED                MOV     A,R5
006B 24FB              ADD     A,#0FBH
006D FE                MOV     R6,A
006E 900000      E     MOV     DPTR,#VGA_TBuff3
0071 E0                MOVX    A,@DPTR
0072 C3                CLR     C
0073 9E                SUBB    A,R6
0074 403A              JC      ?C0114
                                           ; SOURCE LINE # 968
0076         ?C0330:
0076 900000      E     MOV     DPTR,#Thro_Status
0079 E0                MOVX    A,@DPTR
007A 4410              ORL     A,#010H
007C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 969
                                           ; SOURCE LINE # 971
007D 8031              SJMP    ?C0114
007F         ?C0115:
                                           ; SOURCE LINE # 973
                                           ; SOURCE LINE # 976
007F 900000      E     MOV     DPTR,#TEMP_Buff_3
0082 E0                MOVX    A,@DPTR
0083 D3                SETB    C
0084 9F                SUBB    A,R7
0085 5011              JNC     ?C0125
0087 900000      E     MOV     DPTR,#VGA_TBuff3
008A E0                MOVX    A,@DPTR
008B 943C              SUBB    A,#03CH
008D 5009              JNC     ?C0125
                                           ; SOURCE LINE # 977
008F 900000      E     MOV     DPTR,#Thro_Status
0092 E0                MOVX    A,@DPTR
0093 54F7              ANL     A,#0F7H
0095 F0                MOVX    @DPTR,A
0096 8018              SJMP    ?C0114
0098         ?C0125:
                                           ; SOURCE LINE # 979
                                           ; SOURCE LINE # 980
0098 900000      E     MOV     DPTR,#TEMP_Buff_3
009B E0                MOVX    A,@DPTR
009C C3                CLR     C
009D 9D                SUBB    A,R5
009E 5009              JNC     ?C0128
00A0 900000      E     MOV     DPTR,#VGA_TBuff3
00A3 E0                MOVX    A,@DPTR
00A4 C3                CLR     C
00A5 9441              SUBB    A,#041H
00A7 4007              JC      ?C0114
00A9         ?C0128:
                                           ; SOURCE LINE # 981
                                           ; SOURCE LINE # 982
00A9 900000      E     MOV     DPTR,#Thro_Status
00AC E0                MOVX    A,@DPTR
00AD 4408              ORL     A,#08H
00AF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 983
                                           ; SOURCE LINE # 984
                                           ; SOURCE LINE # 985
00B0         ?C0114:
                                           ; SOURCE LINE # 987
00B0 900000      E     MOV     DPTR,#Thro_Status
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 66  

00B3 E0                MOVX    A,@DPTR
00B4 20E32F            JB      ACC.3,?C0129
00B7 900000      E     MOV     DPTR,#DisCPUTurboFor90s
00BA E0                MOVX    A,@DPTR
00BB 7002              JNZ     ?C0317
00BD A3                INC     DPTR
00BE E0                MOVX    A,@DPTR
00BF         ?C0317:
00BF 7025              JNZ     ?C0129
00C1 900000      E     MOV     DPTR,#DisCPUTurboForLTP
00C4 E0                MOVX    A,@DPTR
00C5 701F              JNZ     ?C0129
00C7 900000      E     MOV     DPTR,#Adapter90WWA
00CA E0                MOVX    A,@DPTR
00CB 20E118            JB      ACC.1,?C0129
00CE 900000      E     MOV     DPTR,#nAtmFanSpeed
00D1 E0                MOVX    A,@DPTR
00D2 D3                SETB    C
00D3 9405              SUBB    A,#05H
00D5 400F              JC      ?C0129
                                           ; SOURCE LINE # 988
                                           ; SOURCE LINE # 989
00D7 900000      E     MOV     DPTR,#uVGATurboFun
00DA E0                MOVX    A,@DPTR
00DB 30E318            JNB     ACC.3,?C0109
                                           ; SOURCE LINE # 990
                                           ; SOURCE LINE # 991
00DE E0                MOVX    A,@DPTR
00DF 54F7              ANL     A,#0F7H
00E1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 992
00E2 7F67              MOV     R7,#067H
                                           ; SOURCE LINE # 993
                                           ; SOURCE LINE # 994
00E4 800D              SJMP    ?C0331
00E6         ?C0129:
                                           ; SOURCE LINE # 996
                                           ; SOURCE LINE # 997
00E6 900000      E     MOV     DPTR,#uVGATurboFun
00E9 E0                MOVX    A,@DPTR
00EA 20E309            JB      ACC.3,?C0109
                                           ; SOURCE LINE # 998
                                           ; SOURCE LINE # 999
00ED E0                MOVX    A,@DPTR
00EE 4408              ORL     A,#08H
00F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1000
00F1 7F66              MOV     R7,#066H
00F3         ?C0331:
00F3 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 1001
                                           ; SOURCE LINE # 1002
                                           ; SOURCE LINE # 1004
00F6         ?C0109:
00F6 22                RET     
             ; FUNCTION _Thro_Turbo (END)

             ; FUNCTION _Thro_Count_Shut (BEGIN)
                                           ; SOURCE LINE # 1074
0000 900000      R     MOV     DPTR,#TempType
0003 ED                MOV     A,R5
0004 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 67  

0005 900000      R     MOV     DPTR,#BShut_Cnt
0008 EE                MOV     A,R6
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B EF                MOV     A,R7
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1075
                                           ; SOURCE LINE # 1076
000D F582              MOV     DPL,A
000F 8E83              MOV     DPH,R6
0011 E0                MOVX    A,@DPTR
0012 C3                CLR     C
0013 9403              SUBB    A,#03H
0015 4046              JC      ?C0133
                                           ; SOURCE LINE # 1077
                                           ; SOURCE LINE # 1078
0017 900000      R     MOV     DPTR,#TempType
001A E0                MOVX    A,@DPTR
001B B40204            CJNE    A,#02H,?C0134
                                           ; SOURCE LINE # 1079
001E 7F1C              MOV     R7,#01CH
0020 8023              SJMP    ?C0335
0022         ?C0134:
                                           ; SOURCE LINE # 1080
0022 900000      R     MOV     DPTR,#TempType
0025 E0                MOVX    A,@DPTR
0026 B40104            CJNE    A,#01H,?C0136
                                           ; SOURCE LINE # 1081
0029 7F12              MOV     R7,#012H
002B         ?C0332:
002B 8018              SJMP    ?C0335
002D         ?C0136:
                                           ; SOURCE LINE # 1082
002D 900000      R     MOV     DPTR,#TempType
0030 E0                MOVX    A,@DPTR
0031 B40404            CJNE    A,#04H,?C0138
                                           ; SOURCE LINE # 1083
0034 7F33              MOV     R7,#033H
0036         ?C0333:
0036 800D              SJMP    ?C0335
0038         ?C0138:
                                           ; SOURCE LINE # 1084
0038 900000      R     MOV     DPTR,#TempType
003B E0                MOVX    A,@DPTR
003C B40504            CJNE    A,#05H,?C0140
                                           ; SOURCE LINE # 1085
003F 7F34              MOV     R7,#034H
0041         ?C0334:
0041 8002              SJMP    ?C0335
0043         ?C0140:
                                           ; SOURCE LINE # 1087
0043 7F11              MOV     R7,#011H
0045         ?C0335:
0045 120000      E     LCALL   _ProcessSID
0048         ?C0135:
                                           ; SOURCE LINE # 1089
0048 900000      E     MOV     DPTR,#SysStatus
004B E0                MOVX    A,@DPTR
004C 4402              ORL     A,#02H
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1090
004F 538E3F            ANL     CKCON,#03FH
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 68  

                                           ; SOURCE LINE # 1091
0052 438E10            ORL     CKCON,#010H
                                           ; SOURCE LINE # 1092
0055 43D801            ORL     WDTCON,#01H
                                           ; SOURCE LINE # 1093
0058 43D802            ORL     WDTCON,#02H
005B         ?C0142:
                                           ; SOURCE LINE # 1094
005B 80FE              SJMP    ?C0142
                                           ; SOURCE LINE # 1095
                                           ; SOURCE LINE # 1096
                                           ; SOURCE LINE # 1097
                                           ; SOURCE LINE # 1098
                                           ; SOURCE LINE # 1100
                                           ; SOURCE LINE # 1104
                                           ; SOURCE LINE # 1105
005D         ?C0133:
                                           ; SOURCE LINE # 1107
005D 900000      R     MOV     DPTR,#BShut_Cnt
0060 E0                MOVX    A,@DPTR
0061 FE                MOV     R6,A
0062 A3                INC     DPTR
0063 E0                MOVX    A,@DPTR
0064 F582              MOV     DPL,A
0066 8E83              MOV     DPH,R6
0068 E0                MOVX    A,@DPTR
0069 04                INC     A
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1108
006B         ?C0145:
006B 22                RET     
             ; FUNCTION _Thro_Count_Shut (END)

             ; FUNCTION _THRTab_ToRAM (BEGIN)
                                           ; SOURCE LINE # 1113
;---- Variable 'BStep' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1114
                                           ; SOURCE LINE # 1115
0000 900000      E     MOV     DPTR,#TEST_FLAG
0003 E0                MOVX    A,@DPTR
0004 20E71F            JB      ACC.7,?C0147
                                           ; SOURCE LINE # 1116
                                           ; SOURCE LINE # 1118
0007         ?C0146:
                                           ; SOURCE LINE # 1119
0007 120000      R     LCALL   L?0391
000A 900000      E     MOV     DPTR,#THR_PRO_OFF
                                           ; SOURCE LINE # 1120
000D 120000      R     LCALL   L?0389
0010 900000      E     MOV     DPTR,#THR_PRO_ON
                                           ; SOURCE LINE # 1121
0013 120000      R     LCALL   L?0367
0016 900000      E     MOV     DPTR,#THR_Turo_Rem
                                           ; SOURCE LINE # 1122
0019 120000      R     LCALL   L?0369
001C 900000      E     MOV     DPTR,#THR_Turo_OFF
                                           ; SOURCE LINE # 1123
001F 120000      R     LCALL   L?0390
0022 900000      E     MOV     DPTR,#THR_Tab_Shut
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1124
0026         ?C0147:
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 69  

0026 22                RET     
             ; FUNCTION _THRTab_ToRAM (END)

             ; FUNCTION _VTHRTab_ToRAM (BEGIN)
                                           ; SOURCE LINE # 1128
;---- Variable 'BStep' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1129
                                           ; SOURCE LINE # 1130
0000 900000      E     MOV     DPTR,#TEST_FLAG
0003 E0                MOVX    A,@DPTR
0004 20E71F            JB      ACC.7,?C0149
                                           ; SOURCE LINE # 1131
                                           ; SOURCE LINE # 1133
0007         ?C0148:
                                           ; SOURCE LINE # 1134
0007 120000      R     LCALL   L?0391
000A 900000      E     MOV     DPTR,#VTHR_PRO_OFF
                                           ; SOURCE LINE # 1135
000D 120000      R     LCALL   L?0389
0010 900000      E     MOV     DPTR,#VTHR_PRO_ON
                                           ; SOURCE LINE # 1136
0013 120000      R     LCALL   L?0367
0016 900000      E     MOV     DPTR,#VTHR_Turo_Rem
                                           ; SOURCE LINE # 1137
0019 120000      R     LCALL   L?0369
001C 900000      E     MOV     DPTR,#VTHR_Turo_OFF
                                           ; SOURCE LINE # 1138
001F 120000      R     LCALL   L?0390
0022 900000      E     MOV     DPTR,#VTHR_Tab_Shut
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1139
0026         ?C0149:
0026 22                RET     
             ; FUNCTION _VTHRTab_ToRAM (END)

             ; FUNCTION _Check_FANRPM_Count (BEGIN)
                                           ; SOURCE LINE # 1372
;---- Variable 'BRPM_Cnt' assigned to Register 'R1/R2/R3' ----
;---- Variable 'TempType' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 1373
                                           ; SOURCE LINE # 1374
0000 120000      E     LCALL   ?C?CLDPTR
0003 C3                CLR     C
0004 9464              SUBB    A,#064H
0006 401E              JC      ?C0150
                                           ; SOURCE LINE # 1375
                                           ; SOURCE LINE # 1376
0008 ED                MOV     A,R5
0009 B4010A            CJNE    A,#01H,?C0151
                                           ; SOURCE LINE # 1377
                                           ; SOURCE LINE # 1378
000C 900000      E     MOV     DPTR,#Fan1RPMTemp
000F E0                MOVX    A,@DPTR
0010 900000      E     MOV     DPTR,#Fan1RPM
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1379
0014 800C              SJMP    ?C0152
0016         ?C0151:
                                           ; SOURCE LINE # 1380
0016 ED                MOV     A,R5
0017 B40208            CJNE    A,#02H,?C0152
                                           ; SOURCE LINE # 1381
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 70  

                                           ; SOURCE LINE # 1382
001A 900000      E     MOV     DPTR,#Fan2RPMTemp
001D E0                MOVX    A,@DPTR
001E 900000      E     MOV     DPTR,#Fan2RPM
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1383
0022         ?C0152:
                                           ; SOURCE LINE # 1385
0022 E4                CLR     A
0023 020000      E     LJMP    ?C?CSTPTR
                                           ; SOURCE LINE # 1386
0026         ?C0150:
                                           ; SOURCE LINE # 1388
0026 7401              MOV     A,#01H
0028 120000      E     LCALL   ?C?CILDPTR
                                           ; SOURCE LINE # 1389
002B         ?C0155:
002B 22                RET     
             ; FUNCTION _Check_FANRPM_Count (END)

             ; FUNCTION CheckFanRPM1 (BEGIN)
                                           ; SOURCE LINE # 1394
                                           ; SOURCE LINE # 1395
                                           ; SOURCE LINE # 1396
0000 900000      E     MOV     DPTR,#FanLevelCPU
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
;---- Variable 'FanLevel_tcpu' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1397
0005 900000      E     MOV     DPTR,#FanLevelVGA
0008 E0                MOVX    A,@DPTR
0009 FE                MOV     R6,A
;---- Variable 'FanLevel_tvga' assigned to Register 'R6' ----
                                           ; SOURCE LINE # 1400
000A 900000      E     MOV     DPTR,#Debugtemperature1
000D E0                MOVX    A,@DPTR
000E 700B              JNZ     ?C0156
0010 900000      E     MOV     DPTR,#Debugtemperature2
0013 E0                MOVX    A,@DPTR
0014 7005              JNZ     ?C0156
                                           ; SOURCE LINE # 1401
                                           ; SOURCE LINE # 1402
                                           ; SOURCE LINE # 1403
0016 120000      R     LCALL   L?0409
                                           ; SOURCE LINE # 1404
0019 8003              SJMP    ?C0336
001B         ?C0156:
                                           ; SOURCE LINE # 1406
                                           ; SOURCE LINE # 1407
                                           ; SOURCE LINE # 1408
001B 120000      R     LCALL   L?0410
001E         ?C0336:
001E E0                MOVX    A,@DPTR
001F 900000      E     MOV     DPTR,#temperature2
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1409
0023         ?C0157:
                                           ; SOURCE LINE # 1411
0023 EF                MOV     A,R7
0024 C3                CLR     C
0025 9406              SUBB    A,#06H
0027 5015              JNC     ?C0158
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 71  

                                           ; SOURCE LINE # 1412
                                           ; SOURCE LINE # 1413
0029 EF                MOV     A,R7
002A 75F00D            MOV     B,#0DH
002D A4                MUL     AB
002E 2400        R     ADD     A,#LOW ThermalTalbe1CPU+04H
0030 F582              MOV     DPL,A
0032 E4                CLR     A
0033 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU+04H
0035 120000      R     LCALL   L?0346
0038 120000      R     LCALL   L?0402
003B 4001              JC      ?C0158
                                           ; SOURCE LINE # 1414
                                           ; SOURCE LINE # 1415
003D 0F                INC     R7
                                           ; SOURCE LINE # 1416
                                           ; SOURCE LINE # 1417
003E         ?C0158:
                                           ; SOURCE LINE # 1419
003E EF                MOV     A,R7
003F D3                SETB    C
0040 9400              SUBB    A,#00H
0042 4012              JC      ?C0160
                                           ; SOURCE LINE # 1420
                                           ; SOURCE LINE # 1421
0044 EF                MOV     A,R7
0045 75F00D            MOV     B,#0DH
0048 A4                MUL     AB
0049 120000      R     LCALL   L?0411
004C 120000      R     LCALL   L?0346
004F D3                SETB    C
0050 120000      R     LCALL   L?0403
0053 5001              JNC     ?C0160
                                           ; SOURCE LINE # 1422
                                           ; SOURCE LINE # 1423
0055 1F                DEC     R7
                                           ; SOURCE LINE # 1424
                                           ; SOURCE LINE # 1425
0056         ?C0160:
                                           ; SOURCE LINE # 1427
0056 EE                MOV     A,R6
0057 C3                CLR     C
0058 9406              SUBB    A,#06H
005A 5015              JNC     ?C0162
                                           ; SOURCE LINE # 1428
                                           ; SOURCE LINE # 1429
005C EE                MOV     A,R6
005D 75F00D            MOV     B,#0DH
0060 A4                MUL     AB
0061 2400        R     ADD     A,#LOW ThermalTalbe1VGA+04H
0063 F582              MOV     DPL,A
0065 E4                CLR     A
0066 3400        R     ADDC    A,#HIGH ThermalTalbe1VGA+04H
0068 120000      R     LCALL   L?0346
006B 120000      R     LCALL   L?0404
006E 4001              JC      ?C0162
                                           ; SOURCE LINE # 1430
                                           ; SOURCE LINE # 1431
0070 0E                INC     R6
                                           ; SOURCE LINE # 1432
                                           ; SOURCE LINE # 1433
0071         ?C0162:
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 72  

                                           ; SOURCE LINE # 1435
0071 EE                MOV     A,R6
0072 D3                SETB    C
0073 9400              SUBB    A,#00H
0075 4016              JC      ?C0164
                                           ; SOURCE LINE # 1436
                                           ; SOURCE LINE # 1437
0077 EE                MOV     A,R6
0078 75F00D            MOV     B,#0DH
007B A4                MUL     AB
007C 2400        R     ADD     A,#LOW ThermalTalbe1VGA+07H
007E F582              MOV     DPL,A
0080 E4                CLR     A
0081 3400        R     ADDC    A,#HIGH ThermalTalbe1VGA+07H
0083 120000      R     LCALL   L?0346
0086 D3                SETB    C
0087 120000      R     LCALL   L?0405
008A 5001              JNC     ?C0164
                                           ; SOURCE LINE # 1438
                                           ; SOURCE LINE # 1439
008C 1E                DEC     R6
                                           ; SOURCE LINE # 1440
                                           ; SOURCE LINE # 1441
008D         ?C0164:
                                           ; SOURCE LINE # 1443
008D 900000      E     MOV     DPTR,#FanLevelCPU
0090 EF                MOV     A,R7
0091 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1444
0092 900000      E     MOV     DPTR,#FanLevelVGA
0095 EE                MOV     A,R6
0096 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1445
0097 120000      R     LCALL   L?0345
009A FD                MOV     R5,A
009B EF                MOV     A,R7
009C 75F00D            MOV     B,#0DH
009F A4                MUL     AB
00A0 2400        R     ADD     A,#LOW ThermalTalbe1CPU+0AH
00A2 F582              MOV     DPL,A
00A4 E4                CLR     A
00A5 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU+0AH
00A7 120000      R     LCALL   L?0346
00AA FC                MOV     R4,A
00AB D3                SETB    C
00AC 9D                SUBB    A,R5
00AD 4007              JC      ?C0166
                                           ; SOURCE LINE # 1446
00AF 900000      E     MOV     DPTR,#Fan1RPMTemp
00B2 EC                MOV     A,R4
00B3 F0                MOVX    @DPTR,A
00B4 800B              SJMP    ?C0167
00B6         ?C0166:
                                           ; SOURCE LINE # 1448
00B6 CF                XCH     A,R7
00B7 EE                MOV     A,R6
00B8 CF                XCH     A,R7
00B9 EE                MOV     A,R6
00BA 120000      R     LCALL   L?0345
00BD 900000      E     MOV     DPTR,#Fan1RPMTemp
00C0 F0                MOVX    @DPTR,A
00C1         ?C0167:
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 73  

                                           ; SOURCE LINE # 1452
00C1 900000      E     MOV     DPTR,#Fan1RPMBackUp
00C4 E0                MOVX    A,@DPTR
00C5 FF                MOV     R7,A
00C6 900000      E     MOV     DPTR,#Fan1RPMTemp
00C9 E0                MOVX    A,@DPTR
00CA 6F                XRL     A,R7
00CB 700B              JNZ     ?C0168
                                           ; SOURCE LINE # 1453
                                           ; SOURCE LINE # 1454
00CD 7B01              MOV     R3,#01H
00CF 7A00        E     MOV     R2,#HIGH Fan1RPMCount
00D1 7900        E     MOV     R1,#LOW Fan1RPMCount
00D3 7D01              MOV     R5,#01H
00D5 020000      R     LJMP    _Check_FANRPM_Count
                                           ; SOURCE LINE # 1455
00D8         ?C0168:
                                           ; SOURCE LINE # 1457
                                           ; SOURCE LINE # 1458
00D8 900000      E     MOV     DPTR,#Fan1RPMTemp
00DB E0                MOVX    A,@DPTR
00DC 900000      E     MOV     DPTR,#Fan1RPMBackUp
00DF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1459
00E0 E4                CLR     A
00E1 900000      E     MOV     DPTR,#Fan1RPMCount
00E4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1460
                                           ; SOURCE LINE # 1462
00E5         ?C0170:
00E5 22                RET     
             ; FUNCTION CheckFanRPM1 (END)

             ; FUNCTION CheckFanRPM2 (BEGIN)
                                           ; SOURCE LINE # 1466
                                           ; SOURCE LINE # 1467
                                           ; SOURCE LINE # 1468
0000 900000      E     MOV     DPTR,#FanLevel2CPU
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
;---- Variable 'FanLevel_tcpu' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1469
0005 900000      E     MOV     DPTR,#FanLevel2VGA
0008 E0                MOVX    A,@DPTR
0009 FE                MOV     R6,A
;---- Variable 'FanLevel_tvga' assigned to Register 'R6' ----
                                           ; SOURCE LINE # 1472
000A 900000      E     MOV     DPTR,#Debugtemperature1
000D E0                MOVX    A,@DPTR
000E 700B              JNZ     ?C0171
0010 900000      E     MOV     DPTR,#Debugtemperature2
0013 E0                MOVX    A,@DPTR
0014 7005              JNZ     ?C0171
                                           ; SOURCE LINE # 1473
                                           ; SOURCE LINE # 1474
                                           ; SOURCE LINE # 1475
0016 120000      R     LCALL   L?0409
                                           ; SOURCE LINE # 1476
0019 8003              SJMP    ?C0337
001B         ?C0171:
                                           ; SOURCE LINE # 1478
                                           ; SOURCE LINE # 1479
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 74  

                                           ; SOURCE LINE # 1480
001B 120000      R     LCALL   L?0410
001E         ?C0337:
001E E0                MOVX    A,@DPTR
001F 900000      E     MOV     DPTR,#temperature2
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1481
0023         ?C0172:
                                           ; SOURCE LINE # 1484
0023 EF                MOV     A,R7
0024 C3                CLR     C
0025 9406              SUBB    A,#06H
0027 5011              JNC     ?C0173
                                           ; SOURCE LINE # 1485
                                           ; SOURCE LINE # 1486
0029 EF                MOV     A,R7
002A 75F00D            MOV     B,#0DH
002D A4                MUL     AB
002E 120000      R     LCALL   L?0413
0031 120000      R     LCALL   L?0346
0034 120000      R     LCALL   L?0402
0037 4001              JC      ?C0173
                                           ; SOURCE LINE # 1487
                                           ; SOURCE LINE # 1488
0039 0F                INC     R7
                                           ; SOURCE LINE # 1489
                                           ; SOURCE LINE # 1490
003A         ?C0173:
                                           ; SOURCE LINE # 1492
003A EF                MOV     A,R7
003B D3                SETB    C
003C 9400              SUBB    A,#00H
003E 4015              JC      ?C0175
                                           ; SOURCE LINE # 1493
                                           ; SOURCE LINE # 1494
0040 EF                MOV     A,R7
0041 75F00D            MOV     B,#0DH
0044 A4                MUL     AB
0045 120000      R     LCALL   L?0415
0048 120000      R     LCALL   L?0346
004B FD                MOV     R5,A
004C 900000      E     MOV     DPTR,#temperature1
004F E0                MOVX    A,@DPTR
0050 D3                SETB    C
0051 9D                SUBB    A,R5
0052 5001              JNC     ?C0175
                                           ; SOURCE LINE # 1495
                                           ; SOURCE LINE # 1496
0054 1F                DEC     R7
                                           ; SOURCE LINE # 1497
                                           ; SOURCE LINE # 1498
0055         ?C0175:
                                           ; SOURCE LINE # 1500
0055 EE                MOV     A,R6
0056 C3                CLR     C
0057 9406              SUBB    A,#06H
0059 5015              JNC     ?C0177
                                           ; SOURCE LINE # 1501
                                           ; SOURCE LINE # 1502
005B EE                MOV     A,R6
005C 75F00D            MOV     B,#0DH
005F A4                MUL     AB
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 75  

0060 2400        R     ADD     A,#LOW ThermalTalbe2VGA+04H
0062 F582              MOV     DPL,A
0064 E4                CLR     A
0065 3400        R     ADDC    A,#HIGH ThermalTalbe2VGA+04H
0067 120000      R     LCALL   L?0346
006A 120000      R     LCALL   L?0404
006D 4001              JC      ?C0177
                                           ; SOURCE LINE # 1503
                                           ; SOURCE LINE # 1504
006F 0E                INC     R6
                                           ; SOURCE LINE # 1505
                                           ; SOURCE LINE # 1506
0070         ?C0177:
                                           ; SOURCE LINE # 1508
0070 EE                MOV     A,R6
0071 D3                SETB    C
0072 9400              SUBB    A,#00H
0074 4019              JC      ?C0179
                                           ; SOURCE LINE # 1509
                                           ; SOURCE LINE # 1510
0076 EE                MOV     A,R6
0077 75F00D            MOV     B,#0DH
007A A4                MUL     AB
007B 2400        R     ADD     A,#LOW ThermalTalbe2VGA+07H
007D F582              MOV     DPL,A
007F E4                CLR     A
0080 3400        R     ADDC    A,#HIGH ThermalTalbe2VGA+07H
0082 120000      R     LCALL   L?0346
0085 FD                MOV     R5,A
0086 900000      E     MOV     DPTR,#temperature2
0089 E0                MOVX    A,@DPTR
008A D3                SETB    C
008B 9D                SUBB    A,R5
008C 5001              JNC     ?C0179
                                           ; SOURCE LINE # 1511
                                           ; SOURCE LINE # 1512
008E 1E                DEC     R6
                                           ; SOURCE LINE # 1513
                                           ; SOURCE LINE # 1514
008F         ?C0179:
                                           ; SOURCE LINE # 1517
008F 900000      E     MOV     DPTR,#FanLevel2CPU
0092 EF                MOV     A,R7
0093 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1518
0094 900000      E     MOV     DPTR,#FanLevel2VGA
0097 EE                MOV     A,R6
0098 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1519
0099 120000      R     LCALL   L?0394
009C 120000      R     LCALL   L?0346
009F FD                MOV     R5,A
00A0 EF                MOV     A,R7
00A1 75F00D            MOV     B,#0DH
00A4 A4                MUL     AB
00A5 120000      R     LCALL   L?0417
00A8 120000      R     LCALL   L?0346
00AB FC                MOV     R4,A
00AC D3                SETB    C
00AD 9D                SUBB    A,R5
00AE 4007              JC      ?C0181
                                           ; SOURCE LINE # 1520
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 76  

00B0 900000      E     MOV     DPTR,#Fan2RPMTemp
00B3 EC                MOV     A,R4
00B4 F0                MOVX    @DPTR,A
00B5 800E              SJMP    ?C0182
00B7         ?C0181:
                                           ; SOURCE LINE # 1522
00B7 CF                XCH     A,R7
00B8 EE                MOV     A,R6
00B9 CF                XCH     A,R7
00BA EE                MOV     A,R6
00BB 120000      R     LCALL   L?0394
00BE 120000      R     LCALL   L?0346
00C1 900000      E     MOV     DPTR,#Fan2RPMTemp
00C4 F0                MOVX    @DPTR,A
00C5         ?C0182:
                                           ; SOURCE LINE # 1526
00C5 900000      E     MOV     DPTR,#Fan2RPMBackUp
00C8 E0                MOVX    A,@DPTR
00C9 FF                MOV     R7,A
00CA 900000      E     MOV     DPTR,#Fan2RPMTemp
00CD E0                MOVX    A,@DPTR
00CE 6F                XRL     A,R7
00CF 700B              JNZ     ?C0183
                                           ; SOURCE LINE # 1527
                                           ; SOURCE LINE # 1528
00D1 7B01              MOV     R3,#01H
00D3 7A00        E     MOV     R2,#HIGH Fan2RPMCount
00D5 7900        E     MOV     R1,#LOW Fan2RPMCount
00D7 7D02              MOV     R5,#02H
00D9 020000      R     LJMP    _Check_FANRPM_Count
                                           ; SOURCE LINE # 1529
00DC         ?C0183:
                                           ; SOURCE LINE # 1531
                                           ; SOURCE LINE # 1532
00DC 900000      E     MOV     DPTR,#Fan2RPMTemp
00DF E0                MOVX    A,@DPTR
00E0 900000      E     MOV     DPTR,#Fan2RPMBackUp
00E3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1533
00E4 E4                CLR     A
00E5 900000      E     MOV     DPTR,#Fan2RPMCount
00E8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1534
                                           ; SOURCE LINE # 1537
00E9         ?C0185:
00E9 22                RET     
             ; FUNCTION CheckFanRPM2 (END)

             ; FUNCTION Fan1MainControl (BEGIN)
                                           ; SOURCE LINE # 1539
                                           ; SOURCE LINE # 1540
                                           ; SOURCE LINE # 1543
0000 900000      E     MOV     DPTR,#Fan1RPM
0003 120000      R     LCALL   L?0349
0006 900000      E     MOV     DPTR,#RPM1
0009 E0                MOVX    A,@DPTR
000A 9E                SUBB    A,R6
000B 500B              JNC     ?C0186
                                           ; SOURCE LINE # 1544
                                           ; SOURCE LINE # 1545
000D 120000      R     LCALL   L?0364
0010 C3                CLR     C
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 77  

0011 9F                SUBB    A,R7
0012 501D              JNC     ?C0191
                                           ; SOURCE LINE # 1546
0014 E0                MOVX    A,@DPTR
0015 04                INC     A
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1547
0017 22                RET     
0018         ?C0186:
                                           ; SOURCE LINE # 1548
0018 900000      E     MOV     DPTR,#Fan1RPM
001B E0                MOVX    A,@DPTR
001C 900000      E     MOV     DPTR,#RPM1+01H
001F 120000      R     LCALL   L?0355
0022 900000      E     MOV     DPTR,#RPM1
0025 E0                MOVX    A,@DPTR
0026 9E                SUBB    A,R6
0027 4008              JC      ?C0191
                                           ; SOURCE LINE # 1549
                                           ; SOURCE LINE # 1550
0029 120000      R     LCALL   L?0384
002C 4003              JC      ?C0191
                                           ; SOURCE LINE # 1551
002E E0                MOVX    A,@DPTR
002F 14                DEC     A
0030 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1552
                                           ; SOURCE LINE # 1569
0031         ?C0191:
0031 22                RET     
             ; FUNCTION Fan1MainControl (END)

             ; FUNCTION Fan2MainControl (BEGIN)
                                           ; SOURCE LINE # 1570
                                           ; SOURCE LINE # 1571
                                           ; SOURCE LINE # 1574
0000 900000      E     MOV     DPTR,#Fan2RPM
0003 E0                MOVX    A,@DPTR
0004 900000      E     MOV     DPTR,#RPM2+01H
0007 120000      R     LCALL   L?0350
000A 900000      E     MOV     DPTR,#RPM2
000D E0                MOVX    A,@DPTR
000E 9E                SUBB    A,R6
000F 5009              JNC     ?C0192
                                           ; SOURCE LINE # 1575
                                           ; SOURCE LINE # 1576
0011 120000      R     LCALL   L?0386
0014 5019              JNC     ?C0197
                                           ; SOURCE LINE # 1577
0016 E0                MOVX    A,@DPTR
0017 04                INC     A
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1578
0019 22                RET     
001A         ?C0192:
                                           ; SOURCE LINE # 1579
001A 900000      E     MOV     DPTR,#Fan2RPM
001D 120000      R     LCALL   L?0354
0020 900000      E     MOV     DPTR,#RPM2
0023 E0                MOVX    A,@DPTR
0024 9E                SUBB    A,R6
0025 4008              JC      ?C0197
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 78  

                                           ; SOURCE LINE # 1580
                                           ; SOURCE LINE # 1581
0027 120000      R     LCALL   L?0419
002A 4003              JC      ?C0197
                                           ; SOURCE LINE # 1582
002C E0                MOVX    A,@DPTR
002D 14                DEC     A
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1583
                                           ; SOURCE LINE # 1600
002F         ?C0197:
002F 22                RET     
             ; FUNCTION Fan2MainControl (END)

             ; FUNCTION FanControl (BEGIN)
                                           ; SOURCE LINE # 1605
                                           ; SOURCE LINE # 1606
                                           ; SOURCE LINE # 1607
0000 900000      E     MOV     DPTR,#RPM1
0003 E0                MOVX    A,@DPTR
0004 7002              JNZ     ?C0318
0006 A3                INC     DPTR
0007 E0                MOVX    A,@DPTR
0008         ?C0318:
0008 700B              JNZ     ?C0198
                                           ; SOURCE LINE # 1608
                                           ; SOURCE LINE # 1609
000A 120000      R     LCALL   L?0372
000D 120000      E     LCALL   _Cal_PWM_Duty
0010 900000      E     MOV     DPTR,#DCR5
0013 EF                MOV     A,R7
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1610
0015         ?C0198:
                                           ; SOURCE LINE # 1611
0015 020000      R     LJMP    Fan1MainControl
             ; FUNCTION FanControl (END)

             ; FUNCTION Fan2Control (BEGIN)
                                           ; SOURCE LINE # 1629
                                           ; SOURCE LINE # 1630
                                           ; SOURCE LINE # 1631
0000 900000      E     MOV     DPTR,#RPM2
0003 E0                MOVX    A,@DPTR
0004 7002              JNZ     ?C0319
0006 A3                INC     DPTR
0007 E0                MOVX    A,@DPTR
0008         ?C0319:
0008 700B              JNZ     ?C0200
                                           ; SOURCE LINE # 1632
                                           ; SOURCE LINE # 1633
000A 120000      R     LCALL   L?0372
000D 120000      E     LCALL   _Cal_PWM_Duty
0010 900000      E     MOV     DPTR,#DCR4
0013 EF                MOV     A,R7
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1634
0015         ?C0200:
                                           ; SOURCE LINE # 1635
0015 020000      R     LJMP    Fan2MainControl
             ; FUNCTION Fan2Control (END)

C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 79  

             ; FUNCTION InitThermalTable1 (BEGIN)
                                           ; SOURCE LINE # 1641
                                           ; SOURCE LINE # 1642
                                           ; SOURCE LINE # 1644
;---- Variable 'index' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
                                           ; SOURCE LINE # 1646
0002 900000      E     MOV     DPTR,#pProject0
0005 E0                MOVX    A,@DPTR
0006 20E432            JB      ACC.4,?C0206
                                           ; SOURCE LINE # 1647
0009         ?C0203:
                                           ; SOURCE LINE # 1648
                                           ; SOURCE LINE # 1649
                                           ; SOURCE LINE # 1650
0009 EF                MOV     A,R7
000A 75F00D            MOV     B,#0DH
000D A4                MUL     AB
000E 2400        R     ADD     A,#LOW ThermalTalbe1CPU_DIS+01H
0010 F582              MOV     DPL,A
0012 E4                CLR     A
0013 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU_DIS+01H
                                           ; SOURCE LINE # 1651
0015 120000      R     LCALL   L?0341
0018 2400        R     ADD     A,#LOW ThermalTalbe1CPU_DIS+02H
001A F582              MOV     DPL,A
001C E4                CLR     A
001D 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU_DIS+02H
001F 120000      R     LCALL   L?0343
0022 120000      R     LCALL   L?0411
                                           ; SOURCE LINE # 1652
0025 120000      R     LCALL   L?0342
0028 2400        R     ADD     A,#LOW ThermalTalbe1CPU_DIS+03H
002A F582              MOV     DPL,A
002C E4                CLR     A
002D 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU_DIS+03H
002F 120000      R     LCALL   L?0343
                                           ; SOURCE LINE # 1653
0032 120000      R     LCALL   L?0352
                                           ; SOURCE LINE # 1654
0035 EF                MOV     A,R7
0036 B407D0            CJNE    A,#07H,?C0203
0039 8034              SJMP    ?C0205
                                           ; SOURCE LINE # 1655
                                           ; SOURCE LINE # 1658
003B         ?C0206:
                                           ; SOURCE LINE # 1659
003B EF                MOV     A,R7
003C C3                CLR     C
003D 9407              SUBB    A,#07H
003F 502E              JNC     ?C0205
                                           ; SOURCE LINE # 1660
                                           ; SOURCE LINE # 1661
0041 EF                MOV     A,R7
0042 75F00D            MOV     B,#0DH
0045 A4                MUL     AB
0046 2400        R     ADD     A,#LOW ThermalTalbe1CPU+01H
0048 F582              MOV     DPL,A
004A E4                CLR     A
004B 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU+01H
                                           ; SOURCE LINE # 1662
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 80  

004D 120000      R     LCALL   L?0341
0050 2400        R     ADD     A,#LOW ThermalTalbe1CPU+02H
0052 F582              MOV     DPL,A
0054 E4                CLR     A
0055 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU+02H
0057 120000      R     LCALL   L?0344
005A 120000      R     LCALL   L?0412
                                           ; SOURCE LINE # 1663
005D 120000      R     LCALL   L?0342
0060 2400        R     ADD     A,#LOW ThermalTalbe1CPU+03H
0062 F582              MOV     DPL,A
0064 E4                CLR     A
0065 3400        R     ADDC    A,#HIGH ThermalTalbe1CPU+03H
0067 120000      R     LCALL   L?0344
                                           ; SOURCE LINE # 1664
006A 120000      R     LCALL   L?0352
                                           ; SOURCE LINE # 1665
006D 80CC              SJMP    ?C0206
                                           ; SOURCE LINE # 1666
006F         ?C0205:
                                           ; SOURCE LINE # 1668
006F E4                CLR     A
0070 FF                MOV     R7,A
0071         ?C0208:
                                           ; SOURCE LINE # 1669
                                           ; SOURCE LINE # 1670
                                           ; SOURCE LINE # 1671
0071 EF                MOV     A,R7
0072 75F00D            MOV     B,#0DH
0075 A4                MUL     AB
0076 2400        R     ADD     A,#LOW ThermalTalbe1VGA+01H
0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        R     ADDC    A,#HIGH ThermalTalbe1VGA+01H
007D 120000      R     LCALL   L?0344
0080 2400        R     ADD     A,#LOW ThermalTalbe1VGA+04H
0082 F582              MOV     DPL,A
0084 E4                CLR     A
0085 3400        R     ADDC    A,#HIGH ThermalTalbe1VGA+04H
                                           ; SOURCE LINE # 1672
0087 120000      R     LCALL   L?0342
008A 2400        R     ADD     A,#LOW ThermalTalbe1VGA+02H
008C F582              MOV     DPL,A
008E E4                CLR     A
008F 3400        R     ADDC    A,#HIGH ThermalTalbe1VGA+02H
0091 120000      R     LCALL   L?0344
0094 2400        R     ADD     A,#LOW ThermalTalbe1VGA+07H
0096 F582              MOV     DPL,A
0098 E4                CLR     A
0099 3400        R     ADDC    A,#HIGH ThermalTalbe1VGA+07H
                                           ; SOURCE LINE # 1673
009B 120000      R     LCALL   L?0342
009E 2400        R     ADD     A,#LOW ThermalTalbe1VGA+03H
00A0 F582              MOV     DPL,A
00A2 E4                CLR     A
00A3 3400        R     ADDC    A,#HIGH ThermalTalbe1VGA+03H
00A5 120000      R     LCALL   L?0344
00A8 2400        R     ADD     A,#LOW ThermalTalbe1VGA+0AH
00AA F582              MOV     DPL,A
00AC E4                CLR     A
00AD 3400        R     ADDC    A,#HIGH ThermalTalbe1VGA+0AH
                                           ; SOURCE LINE # 1674
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 81  

00AF 120000      R     LCALL   L?0353
                                           ; SOURCE LINE # 1675
00B2 EF                MOV     A,R7
00B3 B407BB            CJNE    A,#07H,?C0208
                                           ; SOURCE LINE # 1677
00B6         ?C0210:
00B6 22                RET     
             ; FUNCTION InitThermalTable1 (END)

             ; FUNCTION InitThermalTable2 (BEGIN)
                                           ; SOURCE LINE # 1682
                                           ; SOURCE LINE # 1683
                                           ; SOURCE LINE # 1685
;---- Variable 'index' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
                                           ; SOURCE LINE # 1687
0002 900000      E     MOV     DPTR,#pProject0
0005 E0                MOVX    A,@DPTR
0006 20E43B            JB      ACC.4,?C0215
                                           ; SOURCE LINE # 1688
0009         ?C0212:
                                           ; SOURCE LINE # 1689
                                           ; SOURCE LINE # 1690
                                           ; SOURCE LINE # 1691
0009 EF                MOV     A,R7
000A 75F00D            MOV     B,#0DH
000D A4                MUL     AB
000E 2400        R     ADD     A,#LOW ThermalTalbe2CPU_DIS+01H
0010 F582              MOV     DPL,A
0012 E4                CLR     A
0013 3400        R     ADDC    A,#HIGH ThermalTalbe2CPU_DIS+01H
0015 120000      R     LCALL   L?0344
0018 120000      R     LCALL   L?0413
                                           ; SOURCE LINE # 1692
001B 120000      R     LCALL   L?0342
001E 2400        R     ADD     A,#LOW ThermalTalbe2CPU_DIS+02H
0020 F582              MOV     DPL,A
0022 E4                CLR     A
0023 3400        R     ADDC    A,#HIGH ThermalTalbe2CPU_DIS+02H
0025 120000      R     LCALL   L?0344
0028 120000      R     LCALL   L?0415
                                           ; SOURCE LINE # 1693
002B 120000      R     LCALL   L?0342
002E 2400        R     ADD     A,#LOW ThermalTalbe2CPU_DIS+03H
0030 F582              MOV     DPL,A
0032 E4                CLR     A
0033 3400        R     ADDC    A,#HIGH ThermalTalbe2CPU_DIS+03H
0035 120000      R     LCALL   L?0344
0038 120000      R     LCALL   L?0417
                                           ; SOURCE LINE # 1694
003B 120000      R     LCALL   L?0353
                                           ; SOURCE LINE # 1695
003E EF                MOV     A,R7
003F B407C7            CJNE    A,#07H,?C0212
0042 803D              SJMP    ?C0214
                                           ; SOURCE LINE # 1696
                                           ; SOURCE LINE # 1699
0044         ?C0215:
                                           ; SOURCE LINE # 1700
0044 EF                MOV     A,R7
0045 C3                CLR     C
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 82  

0046 9407              SUBB    A,#07H
0048 5037              JNC     ?C0214
                                           ; SOURCE LINE # 1701
                                           ; SOURCE LINE # 1702
004A EF                MOV     A,R7
004B 75F00D            MOV     B,#0DH
004E A4                MUL     AB
004F 2400        R     ADD     A,#LOW ThermalTalbe2CPU+01H
0051 F582              MOV     DPL,A
0053 E4                CLR     A
0054 3400        R     ADDC    A,#HIGH ThermalTalbe2CPU+01H
0056 120000      R     LCALL   L?0344
0059 120000      R     LCALL   L?0414
                                           ; SOURCE LINE # 1703
005C 120000      R     LCALL   L?0342
005F 2400        R     ADD     A,#LOW ThermalTalbe2CPU+02H
0061 F582              MOV     DPL,A
0063 E4                CLR     A
0064 3400        R     ADDC    A,#HIGH ThermalTalbe2CPU+02H
0066 120000      R     LCALL   L?0344
0069 120000      R     LCALL   L?0416
                                           ; SOURCE LINE # 1704
006C 120000      R     LCALL   L?0342
006F 2400        R     ADD     A,#LOW ThermalTalbe2CPU+03H
0071 F582              MOV     DPL,A
0073 E4                CLR     A
0074 3400        R     ADDC    A,#HIGH ThermalTalbe2CPU+03H
0076 120000      R     LCALL   L?0344
0079 120000      R     LCALL   L?0418
                                           ; SOURCE LINE # 1705
007C 120000      R     LCALL   L?0353
                                           ; SOURCE LINE # 1706
007F 80C3              SJMP    ?C0215
                                           ; SOURCE LINE # 1707
0081         ?C0214:
                                           ; SOURCE LINE # 1709
0081 E4                CLR     A
0082 FF                MOV     R7,A
0083         ?C0217:
                                           ; SOURCE LINE # 1710
                                           ; SOURCE LINE # 1711
                                           ; SOURCE LINE # 1712
0083 EF                MOV     A,R7
0084 75F00D            MOV     B,#0DH
0087 A4                MUL     AB
0088 2400        R     ADD     A,#LOW ThermalTalbe2VGA+01H
008A F582              MOV     DPL,A
008C E4                CLR     A
008D 3400        R     ADDC    A,#HIGH ThermalTalbe2VGA+01H
008F 120000      R     LCALL   L?0344
0092 2400        R     ADD     A,#LOW ThermalTalbe2VGA+04H
0094 F582              MOV     DPL,A
0096 E4                CLR     A
0097 3400        R     ADDC    A,#HIGH ThermalTalbe2VGA+04H
                                           ; SOURCE LINE # 1713
0099 120000      R     LCALL   L?0342
009C 2400        R     ADD     A,#LOW ThermalTalbe2VGA+02H
009E F582              MOV     DPL,A
00A0 E4                CLR     A
00A1 3400        R     ADDC    A,#HIGH ThermalTalbe2VGA+02H
00A3 120000      R     LCALL   L?0344
00A6 2400        R     ADD     A,#LOW ThermalTalbe2VGA+07H
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 83  

00A8 F582              MOV     DPL,A
00AA E4                CLR     A
00AB 3400        R     ADDC    A,#HIGH ThermalTalbe2VGA+07H
                                           ; SOURCE LINE # 1714
00AD 120000      R     LCALL   L?0342
00B0 2400        R     ADD     A,#LOW ThermalTalbe2VGA+03H
00B2 F582              MOV     DPL,A
00B4 E4                CLR     A
00B5 3400        R     ADDC    A,#HIGH ThermalTalbe2VGA+03H
00B7 120000      R     LCALL   L?0344
00BA 120000      R     LCALL   L?0395
                                           ; SOURCE LINE # 1715
00BD 120000      R     LCALL   L?0353
                                           ; SOURCE LINE # 1716
00C0 EF                MOV     A,R7
00C1 B407BF            CJNE    A,#07H,?C0217
                                           ; SOURCE LINE # 1718
00C4         ?C0219:
00C4 22                RET     
             ; FUNCTION InitThermalTable2 (END)

             ; FUNCTION FanFullOff (BEGIN)
                                           ; SOURCE LINE # 1723
                                           ; SOURCE LINE # 1724
                                           ; SOURCE LINE # 1725
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#DCR5
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1726
0005 900000      E     MOV     DPTR,#nAtmFanSpeed
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1727
0009 22                RET     
             ; FUNCTION FanFullOff (END)

             ; FUNCTION Fan2FullOff (BEGIN)
                                           ; SOURCE LINE # 1732
                                           ; SOURCE LINE # 1733
                                           ; SOURCE LINE # 1734
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#DCR4
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1735
0005 900000      E     MOV     DPTR,#nAtmFan1Speed
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1736
0009 22                RET     
             ; FUNCTION Fan2FullOff (END)

             ; FUNCTION GetRPM1 (BEGIN)
                                           ; SOURCE LINE # 1741
                                           ; SOURCE LINE # 1742
                                           ; SOURCE LINE # 1744
0000 120000      R     LCALL   L?0375
0003 703D              JNZ     ?C0225
                                           ; SOURCE LINE # 1745
                                           ; SOURCE LINE # 1746
0005 900000      E     MOV     DPTR,#F1TMRR
0008 E0                MOVX    A,@DPTR
0009 700B              JNZ     ?C0223
000B 900000      E     MOV     DPTR,#F1TLRR
000E E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 84  

000F 7005              JNZ     ?C0223
                                           ; SOURCE LINE # 1747
                                           ; SOURCE LINE # 1748
0011 900000      E     MOV     DPTR,#nAtmFanSpeed
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1749
0015 22                RET     
0016         ?C0223:
                                           ; SOURCE LINE # 1751
                                           ; SOURCE LINE # 1752
0016 900000      E     MOV     DPTR,#F1TMRR
0019 E0                MOVX    A,@DPTR
001A 900000      E     MOV     DPTR,#F1TLRR
001D 120000      R     LCALL   L?0366
0020 900000      R     MOV     DPTR,#Curr_Fan1Tachometer
0023 EE                MOV     A,R6
0024 F0                MOVX    @DPTR,A
0025 A3                INC     DPTR
0026 EF                MOV     A,R7
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1753
0028 900000      R     MOV     DPTR,#Curr_Fan1Tachometer
002B 120000      R     LCALL   L?0406
002E 900000      E     MOV     DPTR,#nAtmFanSpeed
0031 EF                MOV     A,R7
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1754
0033 900000      R     MOV     DPTR,#Curr_Fan1Tachometer
0036 E0                MOVX    A,@DPTR
0037 FF                MOV     R7,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A 900000      E     MOV     DPTR,#RPM1
003D CF                XCH     A,R7
003E F0                MOVX    @DPTR,A
003F A3                INC     DPTR
0040 EF                MOV     A,R7
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1755
                                           ; SOURCE LINE # 1757
                                           ; SOURCE LINE # 1759
0042         ?C0225:
0042 22                RET     
             ; FUNCTION GetRPM1 (END)

             ; FUNCTION GetRPM2 (BEGIN)
                                           ; SOURCE LINE # 1764
                                           ; SOURCE LINE # 1765
                                           ; SOURCE LINE # 1767
0000 120000      R     LCALL   L?0375
0003 703D              JNZ     ?C0229
                                           ; SOURCE LINE # 1768
                                           ; SOURCE LINE # 1769
0005 900000      E     MOV     DPTR,#F2TMRR
0008 E0                MOVX    A,@DPTR
0009 700B              JNZ     ?C0227
000B 900000      E     MOV     DPTR,#F2TLRR
000E E0                MOVX    A,@DPTR
000F 7005              JNZ     ?C0227
                                           ; SOURCE LINE # 1770
                                           ; SOURCE LINE # 1771
0011 900000      E     MOV     DPTR,#nAtmFan1Speed
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 85  

0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1772
0015 22                RET     
0016         ?C0227:
                                           ; SOURCE LINE # 1774
                                           ; SOURCE LINE # 1775
0016 900000      E     MOV     DPTR,#F2TMRR
0019 E0                MOVX    A,@DPTR
001A 900000      E     MOV     DPTR,#F2TLRR
001D 120000      R     LCALL   L?0366
0020 900000      R     MOV     DPTR,#Curr_Fan2Tachometer
0023 EE                MOV     A,R6
0024 F0                MOVX    @DPTR,A
0025 A3                INC     DPTR
0026 EF                MOV     A,R7
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1776
0028 900000      R     MOV     DPTR,#Curr_Fan2Tachometer
002B 120000      R     LCALL   L?0406
002E 900000      E     MOV     DPTR,#nAtmFan1Speed
0031 EF                MOV     A,R7
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1777
0033 900000      R     MOV     DPTR,#Curr_Fan2Tachometer
0036 E0                MOVX    A,@DPTR
0037 FF                MOV     R7,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A 900000      E     MOV     DPTR,#RPM2
003D CF                XCH     A,R7
003E F0                MOVX    @DPTR,A
003F A3                INC     DPTR
0040 EF                MOV     A,R7
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1778
                                           ; SOURCE LINE # 1780
                                           ; SOURCE LINE # 1781
0042         ?C0229:
0042 22                RET     
             ; FUNCTION GetRPM2 (END)

             ; FUNCTION FanSpeedConWhenFanTableNotReady (BEGIN)
                                           ; SOURCE LINE # 1785
                                           ; SOURCE LINE # 1786
                                           ; SOURCE LINE # 1787
0000 900000      E     MOV     DPTR,#ManualFanPRM
0003 E0                MOVX    A,@DPTR
0004 6040              JZ      ?C0238
                                           ; SOURCE LINE # 1788
                                           ; SOURCE LINE # 1789
0006 E4                CLR     A
0007 900000      E     MOV     DPTR,#GPCRA5
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1790
000B 120000      R     LCALL   GetRPM1
                                           ; SOURCE LINE # 1791
000E 900000      E     MOV     DPTR,#nAtmFanSpeed
0011 E0                MOVX    A,@DPTR
0012 700D              JNZ     ?C0231
                                           ; SOURCE LINE # 1792
                                           ; SOURCE LINE # 1793
0014 120000      R     LCALL   L?0373
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 86  

0017 120000      E     LCALL   _Cal_PWM_Duty
001A 900000      E     MOV     DPTR,#DCR5
001D EF                MOV     A,R7
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1794
001F 8025              SJMP    ?C0238
0021         ?C0231:
                                           ; SOURCE LINE # 1796
                                           ; SOURCE LINE # 1797
0021 120000      R     LCALL   L?0380
0024 D3                SETB    C
0025 9F                SUBB    A,R7
0026 400A              JC      ?C0233
                                           ; SOURCE LINE # 1798
                                           ; SOURCE LINE # 1799
0028 120000      R     LCALL   L?0384
002B 4019              JC      ?C0238
                                           ; SOURCE LINE # 1800
002D E0                MOVX    A,@DPTR
002E 14                DEC     A
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1801
0030 8014              SJMP    ?C0238
0032         ?C0233:
                                           ; SOURCE LINE # 1803
                                           ; SOURCE LINE # 1804
0032 120000      R     LCALL   L?0364
0035 C3                CLR     C
0036 9F                SUBB    A,R7
0037 5005              JNC     ?C0236
                                           ; SOURCE LINE # 1805
0039 E0                MOVX    A,@DPTR
003A 04                INC     A
003B F0                MOVX    @DPTR,A
003C 8008              SJMP    ?C0238
003E         ?C0236:
                                           ; SOURCE LINE # 1807
003E 900000      E     MOV     DPTR,#CTR2
0041 E0                MOVX    A,@DPTR
0042 900000      E     MOV     DPTR,#DCR5
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1808
                                           ; SOURCE LINE # 1809
                                           ; SOURCE LINE # 1810
                                           ; SOURCE LINE # 1813
                                           ; SOURCE LINE # 1818
0046         ?C0238:
                                           ; SOURCE LINE # 1820
0046 900000      E     MOV     DPTR,#ManualFan2PRM
0049 E0                MOVX    A,@DPTR
004A 6041              JZ      ?C0248
                                           ; SOURCE LINE # 1821
                                           ; SOURCE LINE # 1822
004C E4                CLR     A
004D 900000      E     MOV     DPTR,#GPCRA4
0050 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1823
0051 120000      R     LCALL   GetRPM2
                                           ; SOURCE LINE # 1824
0054 900000      E     MOV     DPTR,#nAtmFan1Speed
0057 E0                MOVX    A,@DPTR
0058 700C              JNZ     ?C0240
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 87  

                                           ; SOURCE LINE # 1825
                                           ; SOURCE LINE # 1826
005A 120000      R     LCALL   L?0373
005D 120000      E     LCALL   _Cal_PWM_Duty
0060 900000      E     MOV     DPTR,#DCR4
0063 EF                MOV     A,R7
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1827
0065 22                RET     
0066         ?C0240:
                                           ; SOURCE LINE # 1829
                                           ; SOURCE LINE # 1830
0066 900000      E     MOV     DPTR,#ManualFan2PRM
0069 E0                MOVX    A,@DPTR
006A FF                MOV     R7,A
006B 900000      E     MOV     DPTR,#nAtmFan1Speed
006E E0                MOVX    A,@DPTR
006F D3                SETB    C
0070 9F                SUBB    A,R7
0071 4009              JC      ?C0242
                                           ; SOURCE LINE # 1831
                                           ; SOURCE LINE # 1832
0073 120000      R     LCALL   L?0419
0076 4015              JC      ?C0248
                                           ; SOURCE LINE # 1833
0078 E0                MOVX    A,@DPTR
0079 14                DEC     A
007A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1834
007B 22                RET     
007C         ?C0242:
                                           ; SOURCE LINE # 1836
                                           ; SOURCE LINE # 1837
007C 120000      R     LCALL   L?0386
007F 5004              JNC     ?C0245
                                           ; SOURCE LINE # 1838
0081 E0                MOVX    A,@DPTR
0082 04                INC     A
0083 F0                MOVX    @DPTR,A
0084 22                RET     
0085         ?C0245:
                                           ; SOURCE LINE # 1840
0085 900000      E     MOV     DPTR,#CTR2
0088 E0                MOVX    A,@DPTR
0089 900000      E     MOV     DPTR,#DCR4
008C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1841
                                           ; SOURCE LINE # 1842
                                           ; SOURCE LINE # 1843
                                           ; SOURCE LINE # 1845
                                           ; SOURCE LINE # 1850
                                           ; SOURCE LINE # 1851
008D         ?C0248:
008D 22                RET     
             ; FUNCTION FanSpeedConWhenFanTableNotReady (END)

             ; FUNCTION FanManager (BEGIN)
                                           ; SOURCE LINE # 1856
                                           ; SOURCE LINE # 1857
                                           ; SOURCE LINE # 1860
0000 900000      E     MOV     DPTR,#ERR_THMSTS
0003 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 88  

0004 20E107            JB      ACC.1,?C0250
0007 900000      E     MOV     DPTR,#Thro_Status2
000A E0                MOVX    A,@DPTR
000B 30E406            JNB     ACC.4,?C0249
000E         ?C0250:
                                           ; SOURCE LINE # 1862
                                           ; SOURCE LINE # 1863
000E 900000      E     MOV     DPTR,#CTR2
0011 E0                MOVX    A,@DPTR
0012 801B              SJMP    ?C0338
                                           ; SOURCE LINE # 1865
0014         ?C0249:
                                           ; SOURCE LINE # 1867
0014 900000      E     MOV     DPTR,#Fan_ON_Count
0017 E0                MOVX    A,@DPTR
0018 600F              JZ      ?C0252
                                           ; SOURCE LINE # 1868
                                           ; SOURCE LINE # 1869
001A E0                MOVX    A,@DPTR
001B 14                DEC     A
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1870
001D 120000      R     LCALL   L?0373
0020 120000      E     LCALL   _Cal_PWM_Duty
0023 900000      E     MOV     DPTR,#Target_Duty
0026 EF                MOV     A,R7
0027 8009              SJMP    ?C0339
                                           ; SOURCE LINE # 1872
0029         ?C0252:
                                           ; SOURCE LINE # 1874
0029 120000      R     LCALL   L?0375
002C 600E              JZ      ?C0253
                                           ; SOURCE LINE # 1875
                                           ; SOURCE LINE # 1876
002E E4                CLR     A
002F         ?C0338:
002F 900000      E     MOV     DPTR,#Target_Duty
0032         ?C0339:
0032 F0                MOVX    @DPTR,A
0033 900000      E     MOV     DPTR,#DCR4
0036 F0                MOVX    @DPTR,A
0037 900000      E     MOV     DPTR,#DCR5
003A F0                MOVX    @DPTR,A
003B 22                RET     
                                           ; SOURCE LINE # 1878
003C         ?C0253:
                                           ; SOURCE LINE # 1880
003C 900000      E     MOV     DPTR,#FanFullOnCont
003F E0                MOVX    A,@DPTR
0040 6009              JZ      ?C0254
                                           ; SOURCE LINE # 1881
                                           ; SOURCE LINE # 1882
0042 E0                MOVX    A,@DPTR
0043 14                DEC     A
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1883
0045 120000      R     LCALL   GetRPM1
                                           ; SOURCE LINE # 1884
0048 020000      R     LJMP    GetRPM2
                                           ; SOURCE LINE # 1886
004B         ?C0254:
                                           ; SOURCE LINE # 1888
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 89  

004B 900000      E     MOV     DPTR,#ManualFanPRM
004E E0                MOVX    A,@DPTR
004F 7021              JNZ     ?C0255
                                           ; SOURCE LINE # 1889
                                           ; SOURCE LINE # 1891
0051 900000      E     MOV     DPTR,#Fan1RPM
0054 E0                MOVX    A,@DPTR
0055 6009              JZ      ?C0256
                                           ; SOURCE LINE # 1892
                                           ; SOURCE LINE # 1893
0057 120000      R     LCALL   GetRPM1
                                           ; SOURCE LINE # 1894
005A 120000      R     LCALL   FanControl
                                           ; SOURCE LINE # 1895
005D 020000      R     LJMP    ?C0259
0060         ?C0256:
                                           ; SOURCE LINE # 1897
                                           ; SOURCE LINE # 1898
0060 900000      E     MOV     DPTR,#DCR5
0063 E0                MOVX    A,@DPTR
0064 6063              JZ      ?C0259
                                           ; SOURCE LINE # 1899
                                           ; SOURCE LINE # 1900
0066 E4                CLR     A
0067 900000      E     MOV     DPTR,#RPM1
006A F0                MOVX    @DPTR,A
006B A3                INC     DPTR
006C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1901
006D 120000      R     LCALL   FanFullOff
                                           ; SOURCE LINE # 1902
                                           ; SOURCE LINE # 1903
                                           ; SOURCE LINE # 1904
0070 8057              SJMP    ?C0259
0072         ?C0255:
                                           ; SOURCE LINE # 1906
                                           ; SOURCE LINE # 1907
0072 120000      R     LCALL   GetRPM1
                                           ; SOURCE LINE # 1908
0075 900000      E     MOV     DPTR,#RPM1
0078 E0                MOVX    A,@DPTR
0079 7002              JNZ     ?C0320
007B A3                INC     DPTR
007C E0                MOVX    A,@DPTR
007D         ?C0320:
007D 700D              JNZ     ?C0260
                                           ; SOURCE LINE # 1909
                                           ; SOURCE LINE # 1910
007F 120000      R     LCALL   L?0373
0082 120000      E     LCALL   _Cal_PWM_Duty
0085 900000      E     MOV     DPTR,#DCR5
0088 EF                MOV     A,R7
0089 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1911
008A 803D              SJMP    ?C0259
008C         ?C0260:
                                           ; SOURCE LINE # 1913
                                           ; SOURCE LINE # 1914
008C 900000      E     MOV     DPTR,#ManualFanPRM
008F 120000      R     LCALL   L?0349
0092 900000      E     MOV     DPTR,#RPM1
0095 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 90  

0096 9E                SUBB    A,R6
0097 500C              JNC     ?C0262
                                           ; SOURCE LINE # 1915
                                           ; SOURCE LINE # 1916
0099 120000      R     LCALL   L?0365
009C C3                CLR     C
009D 9F                SUBB    A,R7
009E 5029              JNC     ?C0259
                                           ; SOURCE LINE # 1917
00A0 E0                MOVX    A,@DPTR
00A1 04                INC     A
00A2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1918
00A3 8024              SJMP    ?C0259
00A5         ?C0262:
                                           ; SOURCE LINE # 1919
00A5 900000      E     MOV     DPTR,#ManualFanPRM
00A8 E0                MOVX    A,@DPTR
00A9 75F064            MOV     B,#064H
00AC A4                MUL     AB
00AD 2464              ADD     A,#064H
00AF FF                MOV     R7,A
00B0 E4                CLR     A
00B1 35F0              ADDC    A,B
00B3 FE                MOV     R6,A
00B4 D3                SETB    C
00B5 900000      E     MOV     DPTR,#RPM1+01H
00B8 E0                MOVX    A,@DPTR
00B9 9F                SUBB    A,R7
00BA 900000      E     MOV     DPTR,#RPM1
00BD E0                MOVX    A,@DPTR
00BE 9E                SUBB    A,R6
00BF 4008              JC      ?C0259
                                           ; SOURCE LINE # 1920
                                           ; SOURCE LINE # 1921
00C1 120000      R     LCALL   L?0385
00C4 4003              JC      ?C0259
                                           ; SOURCE LINE # 1922
00C6 E0                MOVX    A,@DPTR
00C7 14                DEC     A
00C8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1923
                                           ; SOURCE LINE # 1924
                                           ; SOURCE LINE # 1925
00C9         ?C0259:
                                           ; SOURCE LINE # 1927
00C9 900000      E     MOV     DPTR,#ManualFan2PRM
00CC E0                MOVX    A,@DPTR
00CD 701C              JNZ     ?C0267
                                           ; SOURCE LINE # 1928
                                           ; SOURCE LINE # 1929
00CF 900000      E     MOV     DPTR,#Fan2RPM
00D2 E0                MOVX    A,@DPTR
00D3 6006              JZ      ?C0268
                                           ; SOURCE LINE # 1930
                                           ; SOURCE LINE # 1931
00D5 120000      R     LCALL   GetRPM2
                                           ; SOURCE LINE # 1932
00D8 020000      R     LJMP    Fan2Control
                                           ; SOURCE LINE # 1933
00DB         ?C0268:
                                           ; SOURCE LINE # 1935
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 91  

                                           ; SOURCE LINE # 1936
00DB 900000      E     MOV     DPTR,#DCR4
00DE E0                MOVX    A,@DPTR
00DF 605E              JZ      ?C0251
                                           ; SOURCE LINE # 1937
                                           ; SOURCE LINE # 1938
00E1 E4                CLR     A
00E2 900000      E     MOV     DPTR,#RPM2
00E5 F0                MOVX    @DPTR,A
00E6 A3                INC     DPTR
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1939
00E8 020000      R     LJMP    Fan2FullOff
                                           ; SOURCE LINE # 1940
                                           ; SOURCE LINE # 1942
                                           ; SOURCE LINE # 1943
00EB         ?C0267:
                                           ; SOURCE LINE # 1945
                                           ; SOURCE LINE # 1946
00EB 120000      R     LCALL   GetRPM2
                                           ; SOURCE LINE # 1947
00EE 900000      E     MOV     DPTR,#RPM2
00F1 E0                MOVX    A,@DPTR
00F2 7002              JNZ     ?C0321
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6         ?C0321:
00F6 700C              JNZ     ?C0272
                                           ; SOURCE LINE # 1948
                                           ; SOURCE LINE # 1949
00F8 120000      R     LCALL   L?0373
00FB 120000      E     LCALL   _Cal_PWM_Duty
00FE 900000      E     MOV     DPTR,#DCR4
0101 EF                MOV     A,R7
0102 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1950
0103 22                RET     
0104         ?C0272:
                                           ; SOURCE LINE # 1952
                                           ; SOURCE LINE # 1953
0104 900000      E     MOV     DPTR,#ManualFan2PRM
0107 E0                MOVX    A,@DPTR
0108 75F064            MOV     B,#064H
010B A4                MUL     AB
010C 249C              ADD     A,#09CH
010E FF                MOV     R7,A
010F E5F0              MOV     A,B
0111 34FF              ADDC    A,#0FFH
0113 FE                MOV     R6,A
0114 C3                CLR     C
0115 900000      E     MOV     DPTR,#RPM2+01H
0118 E0                MOVX    A,@DPTR
0119 9F                SUBB    A,R7
011A 900000      E     MOV     DPTR,#RPM2
011D E0                MOVX    A,@DPTR
011E 9E                SUBB    A,R6
011F 5009              JNC     ?C0274
                                           ; SOURCE LINE # 1954
                                           ; SOURCE LINE # 1955
0121 120000      R     LCALL   L?0387
0124 5019              JNC     ?C0251
                                           ; SOURCE LINE # 1956
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 92  

0126 E0                MOVX    A,@DPTR
0127 04                INC     A
0128 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1957
0129 22                RET     
012A         ?C0274:
                                           ; SOURCE LINE # 1958
012A 900000      E     MOV     DPTR,#ManualFan2PRM
012D 120000      R     LCALL   L?0354
0130 900000      E     MOV     DPTR,#RPM2
0133 E0                MOVX    A,@DPTR
0134 9E                SUBB    A,R6
0135 4008              JC      ?C0251
                                           ; SOURCE LINE # 1959
                                           ; SOURCE LINE # 1960
0137 120000      R     LCALL   L?0420
013A 4003              JC      ?C0251
                                           ; SOURCE LINE # 1961
013C E0                MOVX    A,@DPTR
013D 14                DEC     A
013E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1962
                                           ; SOURCE LINE # 1963
                                           ; SOURCE LINE # 1964
                                           ; SOURCE LINE # 1967
013F         ?C0251:
013F 22                RET     
             ; FUNCTION FanManager (END)

             ; FUNCTION Fan_Init (BEGIN)
                                           ; SOURCE LINE # 1972
                                           ; SOURCE LINE # 1973
                                           ; SOURCE LINE # 1974
0000 900000      E     MOV     DPTR,#nFanStatus1
0003 7402              MOV     A,#02H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1975
0006 E0                MOVX    A,@DPTR
0007 C4                SWAP    A
0008 54F0              ANL     A,#0F0H
000A 4405              ORL     A,#05H
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1976
000D 900000      E     MOV     DPTR,#nOSThrottlingTemp
0010 7461              MOV     A,#061H
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1977
0013 900000      E     MOV     DPTR,#nOSShutdownTemp
0016 7464              MOV     A,#064H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1978
0019 900000      E     MOV     DPTR,#nShutDownTemp
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1979
001D 22                RET     
             ; FUNCTION Fan_Init (END)

             ; FUNCTION ThrottlingControl (BEGIN)
                                           ; SOURCE LINE # 1988
                                           ; SOURCE LINE # 1989
                                           ; SOURCE LINE # 1990
0000 120000      R     LCALL   L?0375
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 93  

0003 6003              JZ      $ + 5H
0005 020000      R     LJMP    ?C0295
                                           ; SOURCE LINE # 1991
                                           ; SOURCE LINE # 1998
0008 900000      E     MOV     DPTR,#cThrottlingSet
000B E0                MOVX    A,@DPTR
000C 54F0              ANL     A,#0F0H
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2000
000F E0                MOVX    A,@DPTR
0010 900000      E     MOV     DPTR,#cADPThrottling
0013 120000      R     LCALL   L?0347
0016 500B              JNC     ?C0281
                                           ; SOURCE LINE # 2002
                                           ; SOURCE LINE # 2003
0018 900000      E     MOV     DPTR,#cThrottlingSet
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D 900000      E     MOV     DPTR,#cADPThrottling
0020 120000      R     LCALL   L?0376
                                           ; SOURCE LINE # 2004
0023         ?C0281:
                                           ; SOURCE LINE # 2005
0023 900000      E     MOV     DPTR,#cThrottlingSet
0026 E0                MOVX    A,@DPTR
0027 900000      E     MOV     DPTR,#cTHERMThrottling
002A 120000      R     LCALL   L?0347
002D 500C              JNC     ?C0282
                                           ; SOURCE LINE # 2007
                                           ; SOURCE LINE # 2008
002F 900000      E     MOV     DPTR,#cThrottlingSet
                                           ; SOURCE LINE # 2009
0032 120000      R     LCALL   L?0360
0035 900000      E     MOV     DPTR,#cTHERMThrottling
0038 120000      R     LCALL   L?0376
                                           ; SOURCE LINE # 2010
003B         ?C0282:
                                           ; SOURCE LINE # 2011
003B 900000      E     MOV     DPTR,#cThrottlingSet
003E E0                MOVX    A,@DPTR
003F 900000      E     MOV     DPTR,#cBATTThrottling
0042 120000      R     LCALL   L?0351
0045 500C              JNC     ?C0283
                                           ; SOURCE LINE # 2013
                                           ; SOURCE LINE # 2014
0047 900000      E     MOV     DPTR,#cThrottlingSet
                                           ; SOURCE LINE # 2015
004A 120000      R     LCALL   L?0360
004D 900000      E     MOV     DPTR,#cBATTThrottling
0050 120000      R     LCALL   L?0377
                                           ; SOURCE LINE # 2016
0053         ?C0283:
                                           ; SOURCE LINE # 2019
0053 900000      E     MOV     DPTR,#cThrottlingSet
0056 E0                MOVX    A,@DPTR
0057 900000      E     MOV     DPTR,#cBATTLowThrottling
005A 120000      R     LCALL   L?0351
005D 500C              JNC     ?C0284
                                           ; SOURCE LINE # 2021
                                           ; SOURCE LINE # 2022
005F 900000      E     MOV     DPTR,#cThrottlingSet
                                           ; SOURCE LINE # 2023
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 94  

0062 120000      R     LCALL   L?0360
0065 900000      E     MOV     DPTR,#cBATTLowThrottling
0068 120000      R     LCALL   L?0377
                                           ; SOURCE LINE # 2024
006B         ?C0284:
                                           ; SOURCE LINE # 2027
006B 900000      E     MOV     DPTR,#cThrottlingSet
006E E0                MOVX    A,@DPTR
006F 900000      E     MOV     DPTR,#nThrottlingAPSet
0072 120000      R     LCALL   L?0361
0075 500C              JNC     ?C0285
                                           ; SOURCE LINE # 2029
                                           ; SOURCE LINE # 2030
0077 900000      E     MOV     DPTR,#cThrottlingSet
                                           ; SOURCE LINE # 2031
007A 120000      R     LCALL   L?0360
007D 900000      E     MOV     DPTR,#nThrottlingAPSet
0080 120000      R     LCALL   L?0377
                                           ; SOURCE LINE # 2032
0083         ?C0285:
                                           ; SOURCE LINE # 2034
0083 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
0086 E0                MOVX    A,@DPTR
0087 540F              ANL     A,#0FH
0089 FF                MOV     R7,A
008A 120000      R     LCALL   L?0407
008D 6F                XRL     A,R7
008E 6054              JZ      ?C0286
                                           ; SOURCE LINE # 2036
                                           ; SOURCE LINE # 2037
0090 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
0093 E0                MOVX    A,@DPTR
0094 30E708            JNB     ACC.7,?C0289
0097 120000      R     LCALL   L?0407
009A C3                CLR     C
009B 9401              SUBB    A,#01H
009D 500D              JNC     ?C0288
009F         ?C0289:
009F 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
00A2 E0                MOVX    A,@DPTR
00A3 30E703            JNB     ACC.7,?C0290
00A6 D3                SETB    C
00A7 8001              SJMP    ?C0291
00A9         ?C0290:
00A9 C3                CLR     C
00AA         ?C0291:
00AA 4038              JC      ?C0286
00AC         ?C0288:
                                           ; SOURCE LINE # 2039
                                           ; SOURCE LINE # 2040
00AC 900000      E     MOV     DPTR,#cThrottlingSet
00AF E0                MOVX    A,@DPTR
00B0 4440              ORL     A,#040H
00B2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2041
00B3 900000      E     MOV     DPTR,#cADPThrottling
00B6 E0                MOVX    A,@DPTR
00B7 FF                MOV     R7,A
00B8 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2042
00BB 900000      E     MOV     DPTR,#cTHERMThrottling
00BE E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 95  

00BF FF                MOV     R7,A
00C0 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2043
00C3 900000      E     MOV     DPTR,#cBATTThrottling
00C6 E0                MOVX    A,@DPTR
00C7 FF                MOV     R7,A
00C8 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2044
00CB 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
00CE E0                MOVX    A,@DPTR
00CF FF                MOV     R7,A
00D0 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2045
00D3 120000      R     LCALL   L?0408
00D6 FF                MOV     R7,A
00D7 900000      E     MOV     DPTR,#REAL_THROTTLING_INDEX
00DA E0                MOVX    A,@DPTR
00DB 54F0              ANL     A,#0F0H
00DD 4F                ORL     A,R7
00DE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2047
00DF E0                MOVX    A,@DPTR
00E0 FF                MOV     R7,A
00E1 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2048
                                           ; SOURCE LINE # 2049
00E4         ?C0286:
                                           ; SOURCE LINE # 2050
00E4 900000      E     MOV     DPTR,#CPUThrottlingDelayTime
00E7 E0                MOVX    A,@DPTR
00E8 7026              JNZ     ?C0295
                                           ; SOURCE LINE # 2051
                                           ; SOURCE LINE # 2052
00EA 900000      E     MOV     DPTR,#cThrottlingSet
00ED E0                MOVX    A,@DPTR
00EE C4                SWAP    A
00EF 13                RRC     A
00F0 13                RRC     A
00F1 5403              ANL     A,#03H
00F3 30E01A            JNB     ACC.0,?C0295
                                           ; SOURCE LINE # 2053
                                           ; SOURCE LINE # 2054
00F6 E0                MOVX    A,@DPTR
00F7 54BF              ANL     A,#0BFH
00F9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2055
00FA 900000      E     MOV     DPTR,#SYS_MISC1
00FD E0                MOVX    A,@DPTR
00FE 30E70F            JNB     ACC.7,?C0295
                                           ; SOURCE LINE # 2056
                                           ; SOURCE LINE # 2057
0101 7FEE              MOV     R7,#0EEH
0103 120000      E     LCALL   _RamDebug
0106 7F1D              MOV     R7,#01DH
0108 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2058
010B 7F1D              MOV     R7,#01DH
010D 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 2059
                                           ; SOURCE LINE # 2060
                                           ; SOURCE LINE # 2061
                                           ; SOURCE LINE # 2062
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 96  

                                           ; SOURCE LINE # 2063
0110         ?C0295:
0110 22                RET     
             ; FUNCTION ThrottlingControl (END)

             ; FUNCTION GPUThrottlingControl (BEGIN)
                                           ; SOURCE LINE # 2066
                                           ; SOURCE LINE # 2067
                                           ; SOURCE LINE # 2069
0000 120000      R     LCALL   L?0375
0003 6003              JZ      $ + 5H
0005 020000      R     LJMP    ?C0305
0008 900000      E     MOV     DPTR,#CPU_TYPE
000B E0                MOVX    A,@DPTR
000C 20E703            JB      ACC.7,$ + 6H
000F 020000      R     LJMP    ?C0305
                                           ; SOURCE LINE # 2070
                                           ; SOURCE LINE # 2072
0012 900000      E     MOV     DPTR,#cGPUThrottlingSet
0015 E0                MOVX    A,@DPTR
0016 54F0              ANL     A,#0F0H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2074
0019 E0                MOVX    A,@DPTR
001A 900000      E     MOV     DPTR,#cGPUBattThrottling
001D 120000      R     LCALL   L?0361
0020 500A              JNC     ?C0297
                                           ; SOURCE LINE # 2075
                                           ; SOURCE LINE # 2076
0022 900000      E     MOV     DPTR,#cGPUThrottlingSet
0025 E0                MOVX    A,@DPTR
0026 900000      E     MOV     DPTR,#cGPUBattThrottling
0029 120000      R     LCALL   L?0356
                                           ; SOURCE LINE # 2077
002C         ?C0297:
                                           ; SOURCE LINE # 2080
002C 900000      E     MOV     DPTR,#cGPUThrottlingSet
002F E0                MOVX    A,@DPTR
0030 900000      E     MOV     DPTR,#cGPUACtoBattThrottling
0033 120000      R     LCALL   L?0371
0036 500A              JNC     ?C0298
                                           ; SOURCE LINE # 2081
                                           ; SOURCE LINE # 2082
0038 900000      E     MOV     DPTR,#cGPUThrottlingSet
003B E0                MOVX    A,@DPTR
003C 900000      E     MOV     DPTR,#cGPUACtoBattThrottling
003F 120000      R     LCALL   L?0356
                                           ; SOURCE LINE # 2083
0042         ?C0298:
                                           ; SOURCE LINE # 2086
0042 900000      E     MOV     DPTR,#cGPUThrottlingSet
0045 E0                MOVX    A,@DPTR
0046 900000      E     MOV     DPTR,#cGPUBattOTPThrottling
0049 120000      R     LCALL   L?0371
004C 5009              JNC     ?C0299
                                           ; SOURCE LINE # 2087
                                           ; SOURCE LINE # 2088
                                           ; SOURCE LINE # 2089
004E 120000      R     LCALL   L?0358
0051 900000      E     MOV     DPTR,#cGPUBattOTPThrottling
0054 120000      R     LCALL   L?0357
                                           ; SOURCE LINE # 2090
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 97  

0057         ?C0299:
                                           ; SOURCE LINE # 2091
0057 900000      E     MOV     DPTR,#cGPUThrottlingSet
005A E0                MOVX    A,@DPTR
005B 900000      E     MOV     DPTR,#cGPUBattLowThrottling
005E 120000      R     LCALL   L?0388
0061 5009              JNC     ?C0300
                                           ; SOURCE LINE # 2092
                                           ; SOURCE LINE # 2093
                                           ; SOURCE LINE # 2094
0063 120000      R     LCALL   L?0358
0066 900000      E     MOV     DPTR,#cGPUBattLowThrottling
0069 120000      R     LCALL   L?0357
                                           ; SOURCE LINE # 2095
006C         ?C0300:
                                           ; SOURCE LINE # 2096
006C 900000      E     MOV     DPTR,#cGPUThrottlingSet
006F E0                MOVX    A,@DPTR
0070 900000      E     MOV     DPTR,#cGPUThermalThrottling
0073 120000      R     LCALL   L?0388
0076 5009              JNC     ?C0301
                                           ; SOURCE LINE # 2097
                                           ; SOURCE LINE # 2098
                                           ; SOURCE LINE # 2099
0078 120000      R     LCALL   L?0359
007B 900000      E     MOV     DPTR,#cGPUThermalThrottling
007E 120000      R     LCALL   L?0357
                                           ; SOURCE LINE # 2100
0081         ?C0301:
                                           ; SOURCE LINE # 2102
0081 120000      R     LCALL   L?0423
0084 FF                MOV     R7,A
0085 900000      E     MOV     DPTR,#cGPUBattLTPThrottling
0088 E0                MOVX    A,@DPTR
0089 FE                MOV     R6,A
008A EF                MOV     A,R7
008B C3                CLR     C
008C 9E                SUBB    A,R6
008D 5009              JNC     ?C0302
                                           ; SOURCE LINE # 2103
                                           ; SOURCE LINE # 2104
                                           ; SOURCE LINE # 2105
008F 120000      R     LCALL   L?0359
0092 900000      E     MOV     DPTR,#cGPUBattLTPThrottling
0095 120000      R     LCALL   L?0357
                                           ; SOURCE LINE # 2106
0098         ?C0302:
                                           ; SOURCE LINE # 2109
0098 120000      R     LCALL   L?0423
009B FF                MOV     R7,A
009C 900000      E     MOV     DPTR,#cGPUBattPsysThrottling
009F E0                MOVX    A,@DPTR
00A0 FE                MOV     R6,A
00A1 EF                MOV     A,R7
00A2 C3                CLR     C
00A3 9E                SUBB    A,R6
00A4 5009              JNC     ?C0303
                                           ; SOURCE LINE # 2110
                                           ; SOURCE LINE # 2111
                                           ; SOURCE LINE # 2112
00A6 120000      R     LCALL   L?0359
00A9 900000      E     MOV     DPTR,#cGPUBattPsysThrottling
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 98  

00AC 120000      R     LCALL   L?0357
                                           ; SOURCE LINE # 2113
00AF         ?C0303:
                                           ; SOURCE LINE # 2116
00AF 900000      E     MOV     DPTR,#GPU_REAL_THROTTLING_INDEX
00B2 E0                MOVX    A,@DPTR
00B3 540F              ANL     A,#0FH
00B5 FF                MOV     R7,A
00B6 120000      R     LCALL   L?0424
00B9 6F                XRL     A,R7
00BA 601B              JZ      ?C0305
                                           ; SOURCE LINE # 2117
                                           ; SOURCE LINE # 2118
00BC E0                MOVX    A,@DPTR
00BD 540F              ANL     A,#0FH
00BF FF                MOV     R7,A
00C0 900000      E     MOV     DPTR,#GPU_REAL_THROTTLING_INDEX
00C3 E0                MOVX    A,@DPTR
00C4 54F0              ANL     A,#0F0H
00C6 4F                ORL     A,R7
00C7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2119
00C8 7FEE              MOV     R7,#0EEH
00CA 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2120
00CD 7F1E              MOV     R7,#01EH
00CF 120000      E     LCALL   _RamDebug
                                           ; SOURCE LINE # 2121
00D2 7F1E              MOV     R7,#01EH
00D4 120000      E     LCALL   _ECQEvent
                                           ; SOURCE LINE # 2122
                                           ; SOURCE LINE # 2123
                                           ; SOURCE LINE # 2125
00D7         ?C0305:
00D7 22                RET     
             ; FUNCTION GPUThrottlingControl (END)

             ; FUNCTION Chk_FAN_RPM_Control (BEGIN)
                                           ; SOURCE LINE # 2134
                                           ; SOURCE LINE # 2135
                                           ; SOURCE LINE # 2137
0000 900000      E     MOV     DPTR,#uReserve07
0003 E0                MOVX    A,@DPTR
0004 C4                SWAP    A
0005 13                RRC     A
0006 13                RRC     A
0007 5403              ANL     A,#03H
0009 30E04B            JNB     ACC.0,?C0316
                                           ; SOURCE LINE # 2138
                                           ; SOURCE LINE # 2139
000C E4                CLR     A
000D 900000      E     MOV     DPTR,#GPCRA5
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2140
0011 120000      R     LCALL   L?0365
0014 6F                XRL     A,R7
0015 602B              JZ      ?C0307
0017 120000      R     LCALL   L?0380
001A 6F                XRL     A,R7
001B 6025              JZ      ?C0307
                                           ; SOURCE LINE # 2141
                                           ; SOURCE LINE # 2142
C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 99  

001D 120000      R     LCALL   L?0381
0020 D3                SETB    C
0021 9F                SUBB    A,R7
0022 400A              JC      ?C0308
                                           ; SOURCE LINE # 2143
                                           ; SOURCE LINE # 2144
0024 120000      R     LCALL   L?0385
0027 4019              JC      ?C0307
                                           ; SOURCE LINE # 2145
0029 E0                MOVX    A,@DPTR
002A 14                DEC     A
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2146
002C 8014              SJMP    ?C0307
002E         ?C0308:
                                           ; SOURCE LINE # 2148
                                           ; SOURCE LINE # 2149
002E 120000      R     LCALL   L?0365
0031 C3                CLR     C
0032 9F                SUBB    A,R7
0033 5005              JNC     ?C0311
                                           ; SOURCE LINE # 2150
0035 E0                MOVX    A,@DPTR
0036 04                INC     A
0037 F0                MOVX    @DPTR,A
0038 8008              SJMP    ?C0307
003A         ?C0311:
                                           ; SOURCE LINE # 2152
003A 900000      E     MOV     DPTR,#CTR2
003D E0                MOVX    A,@DPTR
003E 900000      E     MOV     DPTR,#DCR5
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2153
                                           ; SOURCE LINE # 2154
0042         ?C0307:
                                           ; SOURCE LINE # 2156
0042 120000      R     LCALL   L?0365
0045 6F                XRL     A,R7
0046 700F              JNZ     ?C0316
0048 120000      R     LCALL   L?0381
004B D3                SETB    C
004C 9F                SUBB    A,R7
004D 4008              JC      ?C0316
                                           ; SOURCE LINE # 2157
                                           ; SOURCE LINE # 2158
004F 120000      R     LCALL   L?0385
0052 4003              JC      ?C0316
                                           ; SOURCE LINE # 2159
0054 E0                MOVX    A,@DPTR
0055 14                DEC     A
0056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2160
                                           ; SOURCE LINE # 2162
                                           ; SOURCE LINE # 2165
                                           ; SOURCE LINE # 2172
                                           ; SOURCE LINE # 2174
0057         ?C0316:
0057 22                RET     
             ; FUNCTION Chk_FAN_RPM_Control (END)



C51 COMPILER V8.12   OEM_FAN                                                               07/28/2018 12:03:44 PAGE 100 

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4592    ----
   CONSTANT SIZE    =    618    ----
   XDATA SIZE       =   ----      29
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
