C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE OEM_LED
OBJECT MODULE PLACED IN Code\OEM\OEM_LED.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\OEM\OEM_LED.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\INC
                    -LUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_LED.C
   3           *
   4           * Copyright (c) 1983-2007, Insyde Software Corporation. All Rights Reserved.
   5           *
   6           * You may not reproduce, distribute, publish, display, perform, modify, adapt,
   7           * transmit, broadcast, present, recite, release, license or otherwise exploit
   8           * any part of this publication in any form, by any means, without the prior
   9           * written permission of Insyde Software Corporation.
  10           *---------------------------------------------------------------------------*/
  11          
  12          #include <CORE_INCLUDE.H>
  13          #include <OEM_INCLUDE.H>
  14          
  15          /* ----------------------------------------------------------------------------
  16           * FUNCTION:   OEM_Write_Leds
  17           *
  18           * Write to SCROLL LOCK, NUM LOCK, CAPS LOCK, and any custom LEDs (including
  19           * an "Fn" key LED).
  20           *
  21           * Input: data (LED_ON bit) = Data to write to the LEDs
  22           *         bit 0 - SCROLL, Scroll Lock
  23           *         bit 1 - NUM,    Num Lock
  24           *         bit 2 - CAPS,   Caps Lock
  25           *         bit 3 - OVL,    Fn LED
  26           *         bit 4 - LED4,   Undefined
  27           *         bit 5 - LED5,   Undefined
  28           *         bit 6 - LED6,   Undefined
  29           *         bit 7 - LED7,   Undefined
  30           *
  31           * Updates Led_Data variable and calls send_leds if appropriate.
  32           * ------------------------------------------------------------------------- */
  33          void OEM_Write_Leds(BYTE data_byte)
  34          {
  35   1          Led_Data = data_byte;
  36   1              //if ( uMBID & 0x40 )
  37   1          //if ( uMBID & 0x01 )       // Check 15"G52:modify board id for MFG  from 0x04 to 0x01 follow new ec common
             - spec
  38   1          //if( ( uMBID & 0x03 == 0x01 ) ||( uMBID & 0x03 == 0x02 ) ) //ANGELAS008: Modidy board ID for check 15
             -" and 17"
  39   1          if ( uMBID & 0x01 )         // Check 15"G52:modify board id for MFG  from 0x04 to 0x01 follow new ec common s
             -pec //ANGELAS009 remove ANGELAS008
  40   1          {
  41   2                  if ( data_byte & BIT1 )
  42   2                  {
  43   3                              Hook_NUMLED_ON();
  44   3                              SET_MASK(SYS_MISC1, b1Num_LED);
  45   3                  }
  46   2                  else
  47   2                  {
  48   3                              Hook_NUMLED_OFF();
  49   3                              CLR_MASK(SYS_MISC1, b1Num_LED);
  50   3                   }
  51   2          }
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 2   

  52   1      
  53   1          if ( data_byte & BIT2 )
  54   1          {
  55   2                      Hook_CAPLED_ON();
  56   2                      SET_MASK(SYS_MISC1, b2Cap_LED);
  57   2          }
  58   1              else
  59   1              {
  60   2                      Hook_CAPLED_OFF();
  61   2                      CLR_MASK(SYS_MISC1, b2Cap_LED);
  62   2              }
  63   1      }
  64          
  65          //MEILING030:S- remove old LED control function.
  66          /*void Lenovo_LED(void)
  67          {
  68                  if ( SystemIsS5 )
  69                  { PWR_LED_OFF(); }
  70                  else
  71                  {
  72                          LOWBATT_3TIMES =0;
  73                          if ( SystemIsS3 || (IS_MASK_SET(uISCT_2, b5ISCT_PwrLED)) )      // Check S3 and ISCT status.
  74                          {
  75                                  PowerLed_Count++;
  76                                  if ( PowerLed_Count < 20 )
  77                                  {
  78                                          PWR_LED_ON();
  79                                  }
  80                                  if( (PowerLed_Count > 20) && (PowerLed_Count <40) )
  81                                  {
  82                                          PWR_LED_OFF();
  83                                  }
  84                                  if ( PowerLed_Count > 40 )
  85                                  {
  86                                          PowerLed_Count = 0;
  87                                          PWR_LED_ON();
  88                                  }
  89                          }
  90                          else
  91                          {
  92                                  if ( SystemIsS0 || (SysPowState==SYSTEM_S5_S0)) // Check S0 and power on sequence status.
  93                                          PWR_LED_ON();
  94                          }
  95                  }
  96          
  97                  // Battery LED control
  98                  GPCRA1 = ALT;
  99                  GPCRA2 = ALT;
 100                  if ( IS_MASK_SET(SYS_MISC1,b5Crisis_LED) )
 101                  {
 102                          if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
 103                          {       // under 5%
 104                                  // 660mHz of Amber, 1000ms on/ 500ms off
 105                                  C4CPRS = 0xC0;  // set frequence
 106                                  C4MCPRS = 0x00;
 107                                  DCR2 = 0x55;    // On Amber
 108                                  DCR1 = 0xFF;    // Off Green
 109                          }
 110                          else
 111                          { DCR1 = DCR2 = 0xFF; } // Off Amber and Green.
 112                  }
 113                  else
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 3   

 114                  {
 115                          if( IS_MASK_SET(LV_Authen_Step_CNT,BIT(6)) )
 116                          {       // authentication Fail
 117                                  C4CPRS = 0xFF;  // set frequence
 118                                  C4MCPRS = 0x00;
 119          
 120                          if(SystemIsS0 || Read_AC_IN())
 121                          {
 122                              DCR2 = 0x7F;        // On Amber
 123                                  DCR1 = 0xFF;    // Off Green
 124                          }
 125                          else // not S0 & Battery Only
 126                          { DCR1 = DCR2 = 0xFF; } // Off Amber and Green.
 127                          }
 128                          else if( IS_MASK_SET(Bat1_FPChgFlag,BIT(0)) )
 129                          {       //  abnormal pre-charge
 130                                  // Amber and Green xchange at 250ms
 131                          C4CPRS = 0x3F;  // set frequence
 132                          C4MCPRS = 0x00;
 133          
 134                          if(SystemIsS0 || Read_AC_IN())
 135                          {
 136                              DCR2 = 0x7F;        // On Amber
 137                                  DCR1 = 0xFF;    // Off Green
 138                          }
 139                          else // not S0 & Battery Only
 140                          { DCR1 = DCR2 = 0xFF; } // Off Amber and Green.
 141                          }
 142                          else if( Read_AC_IN() )
 143                          {       // AC IN
 144                                  LOWBATT_3TIMES =0;
 145                                  PWMPOL = 0x00;                                          // sync. Green and Amber
 146                                                  
 147                                  if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
 148                                  {       // Battery IN, Charging mode
 149                                          if( BAT1PERCL >= 0x50 )
 150                                          {       // over 80%
 151                                                  // Green always on
 152                                                  DCR2 = 0xFF;    // Off Amber
 153                                                  DCR1 = 0x00;    // On Green
 154                                          }
 155                                          else if( BAT1PERCL >= 0x14 )
 156                                          {       // over 20%
 157                                                  // 196mHz of Green, 5000ms on/ 100ms off
 158                                                  C4CPRS = 0x90;  // set frequence
 159                                                  C4MCPRS = 0x02;
 160                                                  DCR2 = 0xFF;    // Off Amber
 161                                                  DCR1 = 0x05;    // On Green
 162                                          }
 163                                          else if( BAT1PERCL >= 0x05 )
 164                                          {       // over 5%
 165                                                  // 303mHz of Amber, 3200ms on/ 100ms off
 166                                                  C4CPRS = 0xA8;  // set frequence
 167                                                  C4MCPRS = 0x01;
 168                                                  DCR2 = 0x08;    // On Amber
 169                                                  DCR1 = 0xFF;    // Off Green
 170                                          }
 171                                          else
 172                                          {       // under 5%
 173                                                  // 660mHz of Amber, 1000ms on/ 500ms off
 174                                                  C4CPRS = 0xC0;  // set frequence
 175                                                  C4MCPRS = 0x00;
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 4   

 176                                                  DCR2 = 0x55;    // On Amber
 177                                                  DCR1 = 0xFF;    // Off Green
 178                                          }
 179                                  }
 180                                  else
 181                                  { DCR1 = DCR2 = 0xFF; } // Off Amber and Green.
 182                          }
 183                          else
 184                          {       // Dischage mode
 185                                  if ( SystemIsS5 )
 186                                  {
 187                                          DCR1 = 0xFF;            // Off Green
 188                                          if (LOWBATT_3TIMES ==0)
 189                                          {
 190                                                  DCR2 = 0xFF;    // Off Amber
 191                                          }
 192                                          else
 193                                          {
 194                                                  if (LOWBATT_3TIMES > 80)
 195                                                          DCR2 = 0x00;                                    // On Amber
 196                                                  else if (LOWBATT_3TIMES > 60)
 197                                                          DCR2 = 0xFF;                                    // Off Amber
 198                                                  else if (LOWBATT_3TIMES > 40)
 199                                                          DCR2 = 0x00;                                    // On Amber
 200                                                  else if (LOWBATT_3TIMES > 20)
 201                                                          DCR2 = 0xFF;                                    // Off Amber
 202                                                  else if (LOWBATT_3TIMES > 0)
 203                                                          DCR2 = 0x00;                                    // On Amber
 204          
 205                                                  LOWBATT_3TIMES--;
 206                                                  if (LOWBATT_3TIMES==0)
 207                                                          DCR2 = 0xFF;                                    // Off Amber
 208                                          }
 209                                  }
 210                                  else
 211                                  {
 212                                          PWMPOL = 0x00;          // sync. Green and Amber
 213                                          if( SystemIsS3 )
 214                                          {       // DC S3 mode
 215                                                  DCR2 = 0xFF;    // Off Amber
 216                                                  DCR1 = 0xFF;    // Off Green
 217                                          }
 218                                          else if( BAT1PERCL >= 0x14 )
 219                                          {
 220                                                  // Green always on
 221                                                  DCR2 = 0xFF;    // Off Amber
 222                                                  DCR1 = 0x00;    // On Green
 223                                          }
 224                                          else if( BAT1PERCL >= 0x05 )
 225                                          {       // over 5%
 226                                                  // Amber always on
 227                                                  DCR2 = 0x00;    // On Amber
 228                                                  DCR1 = 0xFF;    // Off Green
 229                                          }
 230                                          else
 231                                          {       // under 5%
 232                                                  // 660mHz of Amber, 1000ms on/ 500ms off
 233                                                  C4CPRS = 0xC0;  // set frequence
 234                                                  C4MCPRS = 0x00;
 235                                                  DCR2 = 0x55;    // On Amber
 236                                                  DCR1 = 0xFF;    // Off Green
 237                                          }
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 5   

 238                                  }
 239                          }
 240                  }
 241                  if( cCHIPType==0x01 )   // IT8586EX
 242                  {
 243                          DCR0 = DCR1;
 244                  }
 245          
 246          
 247                  #if Support_TPLED
 248                  if ( IS_MASK_SET(pDevStus, pENABLE_TP) )
 249                  {// TPLED_OFF(); }      // TouchPad ON.
 250                  else
 251                  { //TPLED_ON(); }               // TouchPad OFF.
 252                  #endif  // Support_TPLED
 253          }*/
 254          //MEILING030:E- remove old LED control function.
 255          
 256          
 257          //MEILING030:S+ add new LED control function.
 258          void Battery_Charge_Discharge_LED_CONTROL(WORD LED_ON,BYTE LED_OFF)   
 259          {
 260   1              if(!(BAT_LED_Cnt_OFF|BAT_LED_Cnt_ON))
 261   1              {
 262   2                      BAT_LED_Cnt_ON = LED_ON;
 263   2                      BAT_LED_Cnt_OFF = LED_OFF;
 264   2              }
 265   1              if(BAT_LED_Cnt_ON)
 266   1              {
 267   2                      BAT_LED_Cnt_ON = BAT_LED_Cnt_ON - 1;
 268   2                      if( (BAT1PERCL >= 0) && (BAT1PERCL < 20) )
 269   2                      {     
 270   3                              BAT_LOW_LED_ON();
 271   3                              BAT_CHG_LED_OFF();
 272   3                      }
 273   2                      else
 274   2                      {
 275   3                              BAT_CHG_LED_ON();         
 276   3                              BAT_LOW_LED_OFF();
 277   3                      }
 278   2                      
 279   2              }
 280   1              else if(BAT_LED_Cnt_OFF)
 281   1              {
 282   2                      BAT_LED_Cnt_OFF = BAT_LED_Cnt_OFF - 1;
 283   2                      BAT_CHG_LED_OFF();               //LED OFF
 284   2                      BAT_LOW_LED_OFF();      
 285   2              }
 286   1              
 287   1              
 288   1      }
 289          
 290          void Battery_LED_CONTROL(WORD LED_ON,BYTE LED_OFF)   
 291          {
 292   1              BAT_CHG_LED_OFF();
 293   1              if(!(BAT_LED_Cnt_OFF|BAT_LED_Cnt_ON))
 294   1              {
 295   2                      BAT_LED_Cnt_ON = LED_ON;
 296   2                      BAT_LED_Cnt_OFF = LED_OFF;
 297   2              }
 298   1              
 299   1              if(BAT_LED_Cnt_ON)
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 6   

 300   1              {
 301   2                      BAT_LED_Cnt_ON = BAT_LED_Cnt_ON - 1;
 302   2                      BAT_LOW_LED_ON();       
 303   2              }
 304   1              else if(BAT_LED_Cnt_OFF)
 305   1              {
 306   2                      BAT_LED_Cnt_OFF = BAT_LED_Cnt_OFF - 1;
 307   2                      BAT_LOW_LED_OFF();       
 308   2              }
 309   1              
 310   1              
 311   1      }
 312          
 313          void Battery_LED_Reset(void)
 314          {
 315   1              
 316   1              BAT_LED_Cnt_ON = 0;
 317   1              BAT_LED_Cnt_OFF = 0;
 318   1      
 319   1              BAT_LOW_LED_OFF();         //LED OFF
 320   1              BAT_CHG_LED_OFF();
 321   1      
 322   1                      
 323   1      }
 324          
 325          void Lenovo_LED(void)
 326          {
 327   1              if ( SystemIsS5||SystemIsDSX|| (SysPowState==SYSTEM_DSX_S5))
 328   1              { 
 329   2                      PWR_LED_OUTPUT;
 330   2                      CLR_MASK(PWM0LHE,DIMMING_ENABLE);
 331   2                      PWR_LED_OFF();
 332   2              }
 333   1              else
 334   1              {
 335   2                      LOWBATT_3TIMES =0;
 336   2                      if ( SystemIsS3 || (IS_MASK_SET(uISCT_2, b5ISCT_PwrLED)) )      // Check S3 and ISCT status.
 337   2                      {
 338   3                              PWR_LED_ALT;
 339   3                              SET_MASK(PWM0LHE,DIMMING_ENABLE);
 340   3                      }
 341   2                      else
 342   2                      {
 343   3                              if ( SystemIsS0 || (SysPowState==SYSTEM_S5_S0)) // Check S0 and power on sequence status.
 344   3                              {
 345   4                                      PWR_LED_OUTPUT;
 346   4                                      CLR_MASK(PWM0LHE,DIMMING_ENABLE);
 347   4                                      PWR_LED_ON();
 348   4                              }
 349   3                      }
 350   2              }
 351   1      
 352   1              if ( IS_MASK_SET(SYS_MISC1,b5Crisis_LED) )
 353   1              {
 354   2                      if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
 355   2                      {        
 356   3                              Battery_LED_CONTROL(20,10);//Amber, 1000ms on/ 500ms off
 357   3                      }
 358   2                      else
 359   2                      {  
 360   3                              Battery_LED_Reset();
 361   3                      }       
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 7   

 362   2              }
 363   1              else
 364   1              {
 365   2                      if( IS_MASK_SET(LV_Authen_Step_CNT,BIT(6)) )
 366   2                      {       // authentication Fail
 367   3                      if(SystemIsS0 || Read_AC_IN())
 368   3                      {
 369   4                                      Battery_LED_CONTROL(5,5);//Amber, 250ms on/ 250ms off
 370   4                      }
 371   3                      else // not S0 & Battery Only
 372   3                      { 
 373   4                              Battery_LED_Reset();
 374   4                              }       
 375   3                      }
 376   2                      else if( IS_MASK_SET(Bat1_FPChgFlag,BIT(0)) )
 377   2                      {       
 378   3                      if(SystemIsS0 || Read_AC_IN())
 379   3                      {
 380   4                                      Battery_LED_CONTROL(5,5);//Amber, 250ms on/ 250ms off
 381   4                      }
 382   3                      else // not S0 & Battery Only
 383   3                      { 
 384   4                                      Battery_LED_Reset();
 385   4                              }       
 386   3                      }
 387   2                      else if( Read_AC_IN() )
 388   2                      {       // AC IN
 389   3                              LOWBATT_3TIMES =0;
 390   3                              
 391   3                              if(IS_MASK_SET(SEL_STATE0,PRESENT_A))
 392   3                              {       // Battery IN, Charging mode
 393   4                                      if( BAT1PERCL >= 0x50 )
 394   4                                      {       // over 80%
 395   5                                              Battery_Charge_Discharge_LED_CONTROL(1,0);//White solid on
 396   5                                      }
 397   4                                      else if( BAT1PERCL >= 0x14 )
 398   4                                      {       // over 20%
 399   5                                              Battery_Charge_Discharge_LED_CONTROL(100,2);//White 0.1s off/5s on
 400   5                                      }
 401   4                                      else
 402   4                                      {       // under 20%  Amber 0.25s On/ 0.25s Off for total 1.25s, remain off for 3s
 403   5                                              BAT_LOW_LED_Cnt = BAT_LOW_LED_Cnt + 1;   
 404   5                                              
 405   5                                              if(BAT_LOW_LED_Cnt <= 25)
 406   5                                              {
 407   6                                                      Battery_Charge_Discharge_LED_CONTROL(5,5);
 408   6                                              }
 409   5                                              else 
 410   5                                              {
 411   6                                                      Battery_LED_Reset();
 412   6                                                      if(BAT_LOW_LED_Cnt==65) //ANGELAG003: Modify 85 to 65
 413   6                                                      {
 414   7                                                              BAT_LOW_LED_Cnt=0;
 415   7                                                      }
 416   6                                              }
 417   5                                      }
 418   4                              }
 419   3                              else
 420   3                              { 
 421   4                                      Battery_LED_Reset();
 422   4                              }       // Off Amber and Green.
 423   3                      }
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 8   

 424   2                      else
 425   2                      {       // Dischage mode
 426   3                              if ( SystemIsS5 ||SystemIsDSX ||(SysPowState==SYSTEM_DSX_S5))
 427   3                              {
 428   4                                      if (LOWBATT_3TIMES ==0)
 429   4                                      {
 430   5                                              Battery_LED_Reset();
 431   5                                      }
 432   4                                      else
 433   4                                      {       //low battery flash 3 times
 434   5                                              if (LOWBATT_3TIMES > 80)
 435   5                                              {
 436   6                                                      Battery_LED_CONTROL(1,0);// On Amber
 437   6                                              }
 438   5                                              else if (LOWBATT_3TIMES > 60)
 439   5                                              {
 440   6                                                      Battery_LED_CONTROL(0,1);// Off Amber
 441   6                                              }
 442   5                                              else if (LOWBATT_3TIMES > 40)
 443   5                                              {
 444   6                                                      Battery_LED_CONTROL(1,0);// On Amber
 445   6                                              }
 446   5                                              else if (LOWBATT_3TIMES > 20)
 447   5                                              {
 448   6                                                      Battery_LED_CONTROL(0,1);//// Off Amber
 449   6                                              }
 450   5                                              else if (LOWBATT_3TIMES > 0)
 451   5                                              {
 452   6                                                  Battery_LED_CONTROL(1,0);// On Amber
 453   6                          }
 454   5                                              LOWBATT_3TIMES--;
 455   5                                              if (LOWBATT_3TIMES==0)
 456   5                                              {
 457   6                                                
 458   6                                                      Battery_LED_Reset(); // Off Amber
 459   6                                              }
 460   5                                      }
 461   4                              }
 462   3                              else
 463   3                              {
 464   4                                      if( SystemIsS3 )
 465   4                                      {       // DC S3 mode
 466   5                                              Battery_LED_Reset();
 467   5                                      }
 468   4                                      else if( BAT1PERCL >= 0x14 )
 469   4                                      {       //over 20%
 470   5                                              Battery_LED_Reset();//off
 471   5                                      }
 472   4                                      else if( BAT1PERCL >= 0x05 )
 473   4                                      {       //over 5%
 474   5                                          Battery_Charge_Discharge_LED_CONTROL(1,0);//Amber solid on
 475   5                                      }
 476   4                                      else
 477   4                                      {       // under 5%
 478   5                                              Battery_Charge_Discharge_LED_CONTROL(5,5);//Amber 0.25s on/0.25s off
 479   5                                      }
 480   4                              }
 481   3                      }
 482   2              }
 483   1              /*
 484   1              if ( SystemIsS0 )
 485   1              {
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 9   

 486   1                      if ( (DEVICEMODULE & 0x43) != 0 )
 487   1                      { RF_LED_LOW(); }       // RF LED ON.
 488   1                      else
 489   1                      { RF_LED_HI(); }        // RF LED OFF.
 490   1              }
 491   1              else
 492   1              { RF_LED_HI(); }                // RF LED OFF.
 493   1              */
 494   1      
 495   1              #if Support_TPLED
                      if ( IS_MASK_SET(pDevStus, pENABLE_TP) )
                      {
                              //TPLED_OFF();
                      }       // TouchPad ON.
                      else
                      { 
                              //TPLED_ON();
                      }       // TouchPad OFF.
                      #endif  // Support_TPLED
 505   1      }
 506          
 507          //MEILING030:E+ add new LED control function.
 508          
 509          void MFG_LED(void)
 510          {
 511   1              if(cOsLedCtrl.fbit.cOL_PwrLed == 1)
 512   1                      PWR_LED_ON();
 513   1              else
 514   1                      PWR_LED_OFF();
 515   1      
 516   1              if(cOsLedCtrl.fbit.cOL_ChgLed == 1)
 517   1                      //DCR1=0;  //MEILING030:remove.
 518   1                      BAT_CHG_LED_ON(); //MEILING030:add.
 519   1              else
 520   1                      //DCR1=0xFF;  //MEILING030:remove.
 521   1                      BAT_CHG_LED_OFF(); //MEILING030:add.
 522   1      
 523   1              if(cOsLedCtrl.fbit.cOL_DisChgLed == 1)
 524   1                      //DCR2=0;  //MEILING030:remove.
 525   1                      BAT_LOW_LED_ON(); //MEILING030:add.
 526   1              else
 527   1                      //DCR2=0xFF;  //MEILING030:remove.
 528   1                      BAT_LOW_LED_OFF(); //MEILING030:add.  //MEILING056:modify led on to off.
 529   1      
 530   1              /*
 531   1              if(cOsLedCtrl.fbit.cOL_WLANLed == 1)
 532   1                      RF_LED_LOW();
 533   1              else
 534   1                      RF_LED_HI();
 535   1              */
 536   1      
 537   1          if( uMBID & 0x01 ) // Check 15"G52:modify board id for MFG  from 0x04 to 0x01 follow new ec common spe
             -c
 538   1              {
 539   2                      if( cOsLedCtrl.fbit.cOL_NumlockLed == 1 )
 540   2                              NUMLED_ON();
 541   2                      else
 542   2                              NUMLED_OFF();
 543   2              }
 544   1      
 545   1              if( cOsLed1Ctrl.fbit.cOL1_CapslockLed == 1 )
 546   1                      CAPLED_ON();
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 10  

 547   1              else
 548   1                      CAPLED_OFF();
 549   1      
 550   1              if( cOsLed1Ctrl.fbit.cOL1_KBBacklight == 1 )
 551   1                      DCR3 = 0xFF; //ELMERZH001:add PWM control Keyboard backlight
 552   1                      //EC_BKL_EN_HI(); //ELMERZH001:add PWM control Keyboard backlight
 553   1              else
 554   1                      DCR3 = 0; //ELMERZH001:add PWM control Keyboard backlight
 555   1                      //EC_BKL_EN_LOW(); //ELMERZH001:add PWM control Keyboard backlight
 556   1      
 557   1              #if Support_TPLED
                      if( cOsLedCtrl.fbit.cOL_TPActLed == 1 )
                              //TPLED_ON();
                      else
                              //TPLED_OFF();
                      #endif  // Support_TPLED
 563   1      }
 564          
 565          //ELMERZH001:S+ add PWM control Keyboard backlight ,transplant code from 720s.  
 566          void SetKeyboardLED(void)
 567          {
 568   1          BYTE BKBMax, BKBHalf;
 569   1      
 570   1          if ( (SystemNotS0) || (cOsLedCtrl.fbit.cOL_CtrlRight == 1) || (!Read_LID_SW_IN()) )
 571   1          {
 572   2              EC_BKL_PWM = 0;  //ELMERZH001:add
 573   2              //EC_BKL_EN_LOW(); //ELMERZH001:remove
 574   2              return;
 575   2          }
 576   1      
 577   1          //if ( uMBID & 0x40 )
 578   1          //{ // QIQY6.
 579   1          //  BKBMax = 0x4B;
 580   1          //  BKBHalf = 0x33;
 581   1          //}
 582   1          //else
 583   1          //{ // QIQY5.
 584   1          BKBMax = 0xF0;//ELMERZH001:modify
 585   1          BKBHalf = 0x28;//ELMERZH001:modify
 586   1          //}
 587   1          if(UpdateLEDBL_delay != 0)
 588   1          {
 589   2              UpdateLEDBL_delay--;
 590   2              return;
 591   2          }
 592   1      
 593   1      
 594   1          if(uReserve07.fbit.nVPCDriverIn == 1)
 595   1          {
 596   2              if ( IS_MASK_SET(EMStatusBit, b0SetKBLEDON) )
 597   2              {
 598   3                  if ( IS_MASK_SET(EMStatusBit, b2KBLEDChk) )
 599   3                  {
 600   4                      LED_KB_PWM_Step = 2;   //COKEYXU010:Modify KB BKL to just on/off
 601   4                  }
 602   3              }
 603   2              else
 604   2              {
 605   3                  LED_KB_PWM_Step = 0;
 606   3              }
 607   2          }
 608   1      
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 11  

 609   1      
 610   1          if ( (LED_KB_PWM_Count & 0x7F) != 0 )
 611   1          {
 612   2              if ( 0 == EC_BKL_PWM )  //MEILING001:remove.
 613   2                  //if(!Read_EC_BKL_EN()) //MEILING001:add.
 614   2              {
 615   3                  EC_BKL_PWM = BKBMax; //MEILING001:remove.
 616   3                  //EC_BKL_EN_HI(); //MEILING001:add.
 617   3                  LED_KB_PWM_Count |= 0x80;
 618   3              }
 619   2              LED_KB_PWM_Count--;
 620   2          }
 621   1          else
 622   1          {
 623   2              if ( IS_MASK_SET(LED_KB_PWM_Count, BIT7) ) //REJERRY007:modify backlight control.
 624   2              {
 625   3                  EC_BKL_PWM = 0;
 626   3                  LED_KB_PWM_Count = 0;
 627   3              }
 628   2              else
 629   2              {
 630   3                  switch(LED_KB_PWM_Step)
 631   3                  {
 632   4                  case 0:
 633   4                      EC_BKL_PWM = 0;
 634   4                      SET_MASK(EMStatusBit, b2KBLEDChk);//72JERRY036: Modify KB backlight control for lenovo app
             - setting.
 635   4                      break;
 636   4                  case 1:
 637   4                                      //COKEYXU010:Modify KB BKL to just on/off 
 638   4                      //EC_BKL_PWM = BKBHalf;
 639   4                      //CLEAR_MASK(EMStatusBit, b2KBLEDChk);//72JERRY036: Modify KB backlight control for lenovo
             - app setting.
 640   4                      break;
 641   4      
 642   4                  case 2:
 643   4                      EC_BKL_PWM = BKBMax;
 644   4                      CLEAR_MASK(EMStatusBit, b2KBLEDChk);//72JERRY036: Modify KB backlight control for lenovo a
             -pp setting.
 645   4                      break;
 646   4      
 647   4                  default:
 648   4                      EC_BKL_PWM = 0;
 649   4                      SET_MASK(EMStatusBit, b2KBLEDChk);//72JERRY036: Modify KB backlight control for lenovo app
             - setting.
 650   4                      break;
 651   4      
 652   4                  }
 653   3      
 654   3              }
 655   2          }
 656   1      
 657   1      }
 658          
 659          //ELMERZH001:E+ add PWM control Keyboard backlight,transplant code from 720s.  
 660          
 661          
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 12  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com0082 (BEGIN)
0000         L?0131:
0000 900000      E     MOV     DPTR,#GPCRA0
0003 7440              MOV     A,#040H
0005 F0                MOVX    @DPTR,A
0006 900000      E     MOV     DPTR,#PWM0LHE
0009 E0                MOVX    A,@DPTR
000A 54FE              ANL     A,#0FEH
000C F0                MOVX    @DPTR,A
000D 900000      E     MOV     DPTR,#GPDRA
0010 22                RET     
0011         L?0132:
0011 E0                MOVX    A,@DPTR
0012 A3                INC     DPTR
0013 E0                MOVX    A,@DPTR
0014 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
0017 F0                MOVX    @DPTR,A
0018 CF                XCH     A,R7
0019 ED                MOV     A,R5
001A CF                XCH     A,R7
001B 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
001E ED                MOV     A,R5
001F F0                MOVX    @DPTR,A
0020 22                RET     
0021         L?0133:
0021         L?0134:
0021 900000      E     MOV     DPTR,#SysPowState
0024 E0                MOVX    A,@DPTR
0025 6411              XRL     A,#011H
0027 22                RET     
0028         L?0135:
0028         L?0136:
0028 E0                MOVX    A,@DPTR
0029 14                DEC     A
002A F0                MOVX    @DPTR,A
002B 900000      E     MOV     DPTR,#GPDRA
002E E0                MOVX    A,@DPTR
002F 22                RET     
0030         L?0137:
0030 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
0033 E0                MOVX    A,@DPTR
0034 FF                MOV     R7,A
0035 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
0038 E0                MOVX    A,@DPTR
0039 4F                ORL     A,R7
003A 22                RET     
             ; FUNCTION Com0082 (END)

             ; FUNCTION _OEM_Write_Leds (BEGIN)
                                           ; SOURCE LINE # 33
0000 900000      R     MOV     DPTR,#data_byte
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 34
                                           ; SOURCE LINE # 35
0005 F500        E     MOV     Led_Data,A
                                           ; SOURCE LINE # 39
0007 900000      E     MOV     DPTR,#uMBID
000A E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 13  

000B 30E01D            JNB     ACC.0,?C0001
                                           ; SOURCE LINE # 40
                                           ; SOURCE LINE # 41
000E 900000      R     MOV     DPTR,#data_byte
0011 E0                MOVX    A,@DPTR
0012 30E10C            JNB     ACC.1,?C0002
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 43
0015 120000      E     LCALL   Hook_NUMLED_ON
                                           ; SOURCE LINE # 44
0018 900000      E     MOV     DPTR,#SYS_MISC1
001B E0                MOVX    A,@DPTR
001C 4402              ORL     A,#02H
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 45
001F 800A              SJMP    ?C0001
0021         ?C0002:
                                           ; SOURCE LINE # 47
                                           ; SOURCE LINE # 48
0021 120000      E     LCALL   Hook_NUMLED_OFF
                                           ; SOURCE LINE # 49
0024 900000      E     MOV     DPTR,#SYS_MISC1
0027 E0                MOVX    A,@DPTR
0028 54FD              ANL     A,#0FDH
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 50
                                           ; SOURCE LINE # 51
002B         ?C0001:
                                           ; SOURCE LINE # 53
002B 900000      R     MOV     DPTR,#data_byte
002E E0                MOVX    A,@DPTR
002F 30E20B            JNB     ACC.2,?C0004
                                           ; SOURCE LINE # 54
                                           ; SOURCE LINE # 55
0032 120000      E     LCALL   Hook_CAPLED_ON
                                           ; SOURCE LINE # 56
0035 900000      E     MOV     DPTR,#SYS_MISC1
0038 E0                MOVX    A,@DPTR
0039 4404              ORL     A,#04H
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 57
003C 22                RET     
003D         ?C0004:
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 60
003D 120000      E     LCALL   Hook_CAPLED_OFF
                                           ; SOURCE LINE # 61
0040 900000      E     MOV     DPTR,#SYS_MISC1
0043 E0                MOVX    A,@DPTR
0044 54FB              ANL     A,#0FBH
0046 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 62
                                           ; SOURCE LINE # 63
0047         ?C0006:
0047 22                RET     
             ; FUNCTION _OEM_Write_Leds (END)

             ; FUNCTION _Battery_Charge_Discharge_LED_CONTROL (BEGIN)
                                           ; SOURCE LINE # 258
0000 900000      R     MOV     DPTR,#bit6
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 14  

0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
;---- Variable 'LED_OFF' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 259
                                           ; SOURCE LINE # 260
0008 120000      R     LCALL   L?0137
000B 7006              JNZ     ?C0007
                                           ; SOURCE LINE # 261
                                           ; SOURCE LINE # 262
000D 900000      R     MOV     DPTR,#bit6
                                           ; SOURCE LINE # 263
0010 120000      R     LCALL   L?0132
                                           ; SOURCE LINE # 264
0013         ?C0007:
                                           ; SOURCE LINE # 265
0013 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
0016 E0                MOVX    A,@DPTR
0017 6025              JZ      ?C0008
                                           ; SOURCE LINE # 266
                                           ; SOURCE LINE # 267
0019 E0                MOVX    A,@DPTR
001A 14                DEC     A
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 268
001C 900000      E     MOV     DPTR,#BAT1PERCL
001F E0                MOVX    A,@DPTR
0020 C3                CLR     C
0021 9400              SUBB    A,#00H
0023 4011              JC      ?C0009
0025 E0                MOVX    A,@DPTR
0026 9414              SUBB    A,#014H
0028 500C              JNC     ?C0009
                                           ; SOURCE LINE # 269
                                           ; SOURCE LINE # 270
002A 900000      E     MOV     DPTR,#GPDRA
002D E0                MOVX    A,@DPTR
002E 54FB              ANL     A,#0FBH
0030 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 271
0031 E0                MOVX    A,@DPTR
0032 4402              ORL     A,#02H
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 272
0035 22                RET     
0036         ?C0009:
                                           ; SOURCE LINE # 274
                                           ; SOURCE LINE # 275
0036 900000      E     MOV     DPTR,#GPDRA
0039 E0                MOVX    A,@DPTR
003A 54FD              ANL     A,#0FDH
                                           ; SOURCE LINE # 276
                                           ; SOURCE LINE # 277
                                           ; SOURCE LINE # 279
003C 800B              SJMP    ?C0109
003E         ?C0008:
                                           ; SOURCE LINE # 280
003E 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
0041 E0                MOVX    A,@DPTR
0042 600A              JZ      ?C0013
                                           ; SOURCE LINE # 281
                                           ; SOURCE LINE # 282
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 15  

                                           ; SOURCE LINE # 283
0044 120000      R     LCALL   L?0135
0047 4402              ORL     A,#02H
0049         ?C0109:
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 284
004A E0                MOVX    A,@DPTR
004B 4404              ORL     A,#04H
004D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 285
                                           ; SOURCE LINE # 288
004E         ?C0013:
004E 22                RET     
             ; FUNCTION _Battery_Charge_Discharge_LED_CONTROL (END)

             ; FUNCTION _Battery_LED_CONTROL (BEGIN)
                                           ; SOURCE LINE # 290
0000 900000      R     MOV     DPTR,#bit6
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
;---- Variable 'LED_OFF' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 291
                                           ; SOURCE LINE # 292
0008 900000      E     MOV     DPTR,#GPDRA
000B E0                MOVX    A,@DPTR
000C 4402              ORL     A,#02H
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 293
000F 120000      R     LCALL   L?0137
0012 7006              JNZ     ?C0014
                                           ; SOURCE LINE # 294
                                           ; SOURCE LINE # 295
0014 900000      R     MOV     DPTR,#bit6
                                           ; SOURCE LINE # 296
0017 120000      R     LCALL   L?0132
                                           ; SOURCE LINE # 297
001A         ?C0014:
                                           ; SOURCE LINE # 299
001A 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
001D E0                MOVX    A,@DPTR
001E 6007              JZ      ?C0015
                                           ; SOURCE LINE # 300
                                           ; SOURCE LINE # 301
                                           ; SOURCE LINE # 302
0020 120000      R     LCALL   L?0135
0023 54FB              ANL     A,#0FBH
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 303
0026 22                RET     
0027         ?C0015:
                                           ; SOURCE LINE # 304
0027 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
002A E0                MOVX    A,@DPTR
002B 6006              JZ      ?C0018
                                           ; SOURCE LINE # 305
                                           ; SOURCE LINE # 306
                                           ; SOURCE LINE # 307
002D 120000      R     LCALL   L?0136
0030 4404              ORL     A,#04H
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 16  

0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 308
                                           ; SOURCE LINE # 311
0033         ?C0018:
0033 22                RET     
             ; FUNCTION _Battery_LED_CONTROL (END)

             ; FUNCTION Battery_LED_Reset (BEGIN)
                                           ; SOURCE LINE # 313
                                           ; SOURCE LINE # 314
                                           ; SOURCE LINE # 316
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#BAT_LED_Cnt_ON
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 317
0005 900000      E     MOV     DPTR,#BAT_LED_Cnt_OFF
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 319
0009 900000      E     MOV     DPTR,#GPDRA
000C E0                MOVX    A,@DPTR
000D 4404              ORL     A,#04H
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 320
0010 E0                MOVX    A,@DPTR
0011 4402              ORL     A,#02H
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 323
0014 22                RET     
             ; FUNCTION Battery_LED_Reset (END)

             ; FUNCTION Lenovo_LED (BEGIN)
                                           ; SOURCE LINE # 325
                                           ; SOURCE LINE # 326
                                           ; SOURCE LINE # 327
0000 900000      E     MOV     DPTR,#SysPowState
0003 E0                MOVX    A,@DPTR
0004 6455              XRL     A,#055H
0006 6009              JZ      ?C0021
0008 E0                MOVX    A,@DPTR
0009 6466              XRL     A,#066H
000B 6004              JZ      ?C0021
000D E0                MOVX    A,@DPTR
000E B46005            CJNE    A,#060H,?C0020
0011         ?C0021:
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 329
                                           ; SOURCE LINE # 330
                                           ; SOURCE LINE # 331
0011 120000      R     LCALL   L?0131
                                           ; SOURCE LINE # 332
0014 801C              SJMP    ?C0110
0016         ?C0020:
                                           ; SOURCE LINE # 334
                                           ; SOURCE LINE # 335
0016 E4                CLR     A
0017 900000      E     MOV     DPTR,#LOWBATT_3TIMES
001A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 336
001B 900000      E     MOV     DPTR,#SysPowState
001E E0                MOVX    A,@DPTR
001F 6433              XRL     A,#033H
0021 6007              JZ      ?C0024
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 17  

0023 900000      E     MOV     DPTR,#uISCT_2
0026 E0                MOVX    A,@DPTR
0027 30E50E            JNB     ACC.5,?C0023
002A         ?C0024:
                                           ; SOURCE LINE # 337
                                           ; SOURCE LINE # 338
002A E4                CLR     A
002B 900000      E     MOV     DPTR,#GPCRA0
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 339
002F 900000      E     MOV     DPTR,#PWM0LHE
0032         ?C0110:
0032 E0                MOVX    A,@DPTR
0033 4401              ORL     A,#01H
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 340
0036 8010              SJMP    ?C0022
0038         ?C0023:
                                           ; SOURCE LINE # 342
                                           ; SOURCE LINE # 343
0038 120000      R     LCALL   L?0133
003B 6004              JZ      ?C0027
003D E0                MOVX    A,@DPTR
003E B45007            CJNE    A,#050H,?C0022
0041         ?C0027:
                                           ; SOURCE LINE # 344
                                           ; SOURCE LINE # 345
                                           ; SOURCE LINE # 346
                                           ; SOURCE LINE # 347
0041 120000      R     LCALL   L?0131
0044 E0                MOVX    A,@DPTR
0045 54FE              ANL     A,#0FEH
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 348
                                           ; SOURCE LINE # 349
                                           ; SOURCE LINE # 350
0048         ?C0022:
                                           ; SOURCE LINE # 352
0048 900000      E     MOV     DPTR,#SYS_MISC1
004B E0                MOVX    A,@DPTR
004C 30E50D            JNB     ACC.5,?C0028
                                           ; SOURCE LINE # 353
                                           ; SOURCE LINE # 354
004F 900000      E     MOV     DPTR,#SEL_STATE0
0052 E0                MOVX    A,@DPTR
0053 30E01F            JNB     ACC.0,?C0112
                                           ; SOURCE LINE # 355
                                           ; SOURCE LINE # 356
0056 7D0A              MOV     R5,#0AH
0058 7F14              MOV     R7,#014H
                                           ; SOURCE LINE # 357
005A 8033              SJMP    ?C0113
005C         ?C0028:
                                           ; SOURCE LINE # 364
                                           ; SOURCE LINE # 365
005C 900000      E     MOV     DPTR,#LV_Authen_Step_CNT
005F E0                MOVX    A,@DPTR
0060 30E615            JNB     ACC.6,?C0032
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 367
0063 120000      R     LCALL   L?0133
0066 6007              JZ      ?C0034
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 18  

0068 900000      E     MOV     DPTR,#GPDRB
006B E0                MOVX    A,@DPTR
006C 30E006            JNB     ACC.0,?C0033
006F         ?C0034:
                                           ; SOURCE LINE # 368
                                           ; SOURCE LINE # 369
006F 7D05              MOV     R5,#05H
0071 7F05              MOV     R7,#05H
0073         ?C0111:
                                           ; SOURCE LINE # 370
0073 801A              SJMP    ?C0113
0075         ?C0033:
                                           ; SOURCE LINE # 372
                                           ; SOURCE LINE # 373
0075         ?C0112:
                                           ; SOURCE LINE # 374
                                           ; SOURCE LINE # 375
0075 020000      R     LJMP    ?C0126
0078         ?C0032:
                                           ; SOURCE LINE # 376
0078 900000      E     MOV     DPTR,#Bat1_FPChgFlag
007B E0                MOVX    A,@DPTR
007C 30E018            JNB     ACC.0,?C0037
                                           ; SOURCE LINE # 377
                                           ; SOURCE LINE # 378
007F 120000      R     LCALL   L?0134
0082 6007              JZ      ?C0039
0084 900000      E     MOV     DPTR,#GPDRB
0087 E0                MOVX    A,@DPTR
0088 30E009            JNB     ACC.0,?C0038
008B         ?C0039:
                                           ; SOURCE LINE # 379
                                           ; SOURCE LINE # 380
008B 7D05              MOV     R5,#05H
008D 7F05              MOV     R7,#05H
008F         ?C0113:
008F 7E00              MOV     R6,#00H
0091 020000      R     LJMP    _Battery_LED_CONTROL
                                           ; SOURCE LINE # 381
0094         ?C0038:
                                           ; SOURCE LINE # 383
                                           ; SOURCE LINE # 384
0094         ?C0114:
                                           ; SOURCE LINE # 385
                                           ; SOURCE LINE # 386
0094 020000      R     LJMP    ?C0126
0097         ?C0037:
                                           ; SOURCE LINE # 387
0097 900000      E     MOV     DPTR,#GPDRB
009A E0                MOVX    A,@DPTR
009B 30E04D            JNB     ACC.0,?C0042
                                           ; SOURCE LINE # 388
                                           ; SOURCE LINE # 389
009E E4                CLR     A
009F 900000      E     MOV     DPTR,#LOWBATT_3TIMES
00A2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 391
00A3 900000      E     MOV     DPTR,#SEL_STATE0
00A6 E0                MOVX    A,@DPTR
00A7 30E03F            JNB     ACC.0,?C0043
                                           ; SOURCE LINE # 392
                                           ; SOURCE LINE # 393
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 19  

00AA 900000      E     MOV     DPTR,#BAT1PERCL
00AD E0                MOVX    A,@DPTR
00AE C3                CLR     C
00AF 9450              SUBB    A,#050H
00B1 4003              JC      ?C0044
                                           ; SOURCE LINE # 394
                                           ; SOURCE LINE # 395
                                           ; SOURCE LINE # 396
00B3 020000      R     LJMP    ?C0116
00B6         ?C0044:
                                           ; SOURCE LINE # 397
00B6 900000      E     MOV     DPTR,#BAT1PERCL
00B9 E0                MOVX    A,@DPTR
00BA C3                CLR     C
00BB 9414              SUBB    A,#014H
00BD 4007              JC      ?C0046
                                           ; SOURCE LINE # 398
                                           ; SOURCE LINE # 399
00BF 7D02              MOV     R5,#02H
00C1 7F64              MOV     R7,#064H
                                           ; SOURCE LINE # 400
00C3 020000      R     LJMP    ?C0118
00C6         ?C0046:
                                           ; SOURCE LINE # 402
                                           ; SOURCE LINE # 403
00C6 900000      E     MOV     DPTR,#BAT_LOW_LED_Cnt
00C9 E0                MOVX    A,@DPTR
00CA 04                INC     A
00CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 405
00CC E0                MOVX    A,@DPTR
00CD D3                SETB    C
00CE 9419              SUBB    A,#019H
00D0 5007              JNC     ?C0048
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 407
00D2 7D05              MOV     R5,#05H
00D4 7F05              MOV     R7,#05H
00D6         ?C0117:
                                           ; SOURCE LINE # 408
00D6 020000      R     LJMP    ?C0118
00D9         ?C0048:
                                           ; SOURCE LINE # 410
                                           ; SOURCE LINE # 411
00D9 120000      R     LCALL   Battery_LED_Reset
                                           ; SOURCE LINE # 412
00DC 900000      E     MOV     DPTR,#BAT_LOW_LED_Cnt
00DF E0                MOVX    A,@DPTR
00E0 6441              XRL     A,#041H
00E2 6003              JZ      $ + 5H
00E4 020000      R     LJMP    ?C0074
                                           ; SOURCE LINE # 413
                                           ; SOURCE LINE # 414
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 415
                                           ; SOURCE LINE # 416
                                           ; SOURCE LINE # 417
                                           ; SOURCE LINE # 418
00E8 22                RET     
00E9         ?C0043:
                                           ; SOURCE LINE # 420
                                           ; SOURCE LINE # 421
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 20  

00E9         ?C0115:
                                           ; SOURCE LINE # 422
                                           ; SOURCE LINE # 423
00E9 8078              SJMP    ?C0126
00EB         ?C0042:
                                           ; SOURCE LINE # 425
                                           ; SOURCE LINE # 426
00EB 900000      E     MOV     DPTR,#SysPowState
00EE E0                MOVX    A,@DPTR
00EF 6455              XRL     A,#055H
00F1 600A              JZ      ?C0054
00F3 E0                MOVX    A,@DPTR
00F4 6466              XRL     A,#066H
00F6 6005              JZ      ?C0054
00F8 E0                MOVX    A,@DPTR
00F9 6460              XRL     A,#060H
00FB 7054              JNZ     ?C0053
00FD         ?C0054:
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 428
00FD 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0100 E0                MOVX    A,@DPTR
0101 7002              JNZ     ?C0055
                                           ; SOURCE LINE # 429
                                           ; SOURCE LINE # 430
0103         ?C0119:
                                           ; SOURCE LINE # 431
0103 805E              SJMP    ?C0126
0105         ?C0055:
                                           ; SOURCE LINE # 433
                                           ; SOURCE LINE # 434
0105 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0108 E0                MOVX    A,@DPTR
0109 D3                SETB    C
010A 9450              SUBB    A,#050H
010C 4002              JC      ?C0057
                                           ; SOURCE LINE # 435
                                           ; SOURCE LINE # 436
                                           ; SOURCE LINE # 437
010E 802E              SJMP    ?C0123
0110         ?C0057:
                                           ; SOURCE LINE # 438
0110 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0113 E0                MOVX    A,@DPTR
0114 D3                SETB    C
0115 943C              SUBB    A,#03CH
0117 4002              JC      ?C0059
                                           ; SOURCE LINE # 439
                                           ; SOURCE LINE # 440
                                           ; SOURCE LINE # 441
0119 8014              SJMP    ?C0122
011B         ?C0059:
                                           ; SOURCE LINE # 442
011B 900000      E     MOV     DPTR,#LOWBATT_3TIMES
011E E0                MOVX    A,@DPTR
011F D3                SETB    C
0120 9428              SUBB    A,#028H
0122 4002              JC      ?C0061
                                           ; SOURCE LINE # 443
                                           ; SOURCE LINE # 444
0124         ?C0121:
                                           ; SOURCE LINE # 445
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 21  

0124 8018              SJMP    ?C0123
0126         ?C0061:
                                           ; SOURCE LINE # 446
0126 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0129 E0                MOVX    A,@DPTR
012A D3                SETB    C
012B 9414              SUBB    A,#014H
012D 4006              JC      ?C0063
                                           ; SOURCE LINE # 447
                                           ; SOURCE LINE # 448
012F         ?C0122:
012F 7D01              MOV     R5,#01H
0131 E4                CLR     A
0132 FF                MOV     R7,A
                                           ; SOURCE LINE # 449
0133 800D              SJMP    ?C0124
0135         ?C0063:
                                           ; SOURCE LINE # 450
0135 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0138 E0                MOVX    A,@DPTR
0139 D3                SETB    C
013A 9400              SUBB    A,#00H
013C 4008              JC      ?C0058
                                           ; SOURCE LINE # 451
                                           ; SOURCE LINE # 452
013E         ?C0123:
013E E4                CLR     A
013F FD                MOV     R5,A
0140 7F01              MOV     R7,#01H
0142         ?C0124:
0142 FE                MOV     R6,A
0143 120000      R     LCALL   _Battery_LED_CONTROL
                                           ; SOURCE LINE # 453
0146         ?C0058:
                                           ; SOURCE LINE # 454
0146 900000      E     MOV     DPTR,#LOWBATT_3TIMES
0149 E0                MOVX    A,@DPTR
014A 14                DEC     A
014B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 455
014C E0                MOVX    A,@DPTR
014D 7030              JNZ     ?C0074
                                           ; SOURCE LINE # 456
                                           ; SOURCE LINE # 458
014F         ?C0120:
                                           ; SOURCE LINE # 459
                                           ; SOURCE LINE # 460
                                           ; SOURCE LINE # 461
014F 8012              SJMP    ?C0126
0151         ?C0053:
                                           ; SOURCE LINE # 463
                                           ; SOURCE LINE # 464
0151 900000      E     MOV     DPTR,#SysPowState
0154 E0                MOVX    A,@DPTR
0155 B43302            CJNE    A,#033H,?C0068
                                           ; SOURCE LINE # 465
                                           ; SOURCE LINE # 466
0158         ?C0125:
                                           ; SOURCE LINE # 467
0158 8009              SJMP    ?C0126
015A         ?C0068:
                                           ; SOURCE LINE # 468
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 22  

015A 900000      E     MOV     DPTR,#BAT1PERCL
015D E0                MOVX    A,@DPTR
015E C3                CLR     C
015F 9414              SUBB    A,#014H
0161 4003              JC      ?C0070
                                           ; SOURCE LINE # 469
                                           ; SOURCE LINE # 470
0163         ?C0126:
0163 020000      R     LJMP    Battery_LED_Reset
                                           ; SOURCE LINE # 471
0166         ?C0070:
                                           ; SOURCE LINE # 472
0166 900000      E     MOV     DPTR,#BAT1PERCL
0169 E0                MOVX    A,@DPTR
016A C3                CLR     C
016B 9405              SUBB    A,#05H
016D 4007              JC      ?C0072
                                           ; SOURCE LINE # 473
                                           ; SOURCE LINE # 474
016F         ?C0116:
016F E4                CLR     A
0170 FD                MOV     R5,A
0171 7F01              MOV     R7,#01H
0173 FE                MOV     R6,A
                                           ; SOURCE LINE # 475
0174 8006              SJMP    ?C0127
0176         ?C0072:
                                           ; SOURCE LINE # 477
                                           ; SOURCE LINE # 478
0176 7D05              MOV     R5,#05H
0178 7F05              MOV     R7,#05H
017A         ?C0118:
017A 7E00              MOV     R6,#00H
017C         ?C0127:
017C 120000      R     LCALL   _Battery_Charge_Discharge_LED_CONTROL
                                           ; SOURCE LINE # 479
                                           ; SOURCE LINE # 480
                                           ; SOURCE LINE # 481
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 505
017F         ?C0074:
017F 22                RET     
             ; FUNCTION Lenovo_LED (END)

             ; FUNCTION MFG_LED (BEGIN)
                                           ; SOURCE LINE # 509
                                           ; SOURCE LINE # 510
                                           ; SOURCE LINE # 511
0000 900000      E     MOV     DPTR,#cOsLedCtrl
0003 E0                MOVX    A,@DPTR
0004 C3                CLR     C
0005 13                RRC     A
0006 900000      E     MOV     DPTR,#GPDRA
0009 30E006            JNB     ACC.0,?C0075
                                           ; SOURCE LINE # 512
000C E0                MOVX    A,@DPTR
000D 54FE              ANL     A,#0FEH
000F F0                MOVX    @DPTR,A
0010 8004              SJMP    ?C0076
0012         ?C0075:
                                           ; SOURCE LINE # 514
0012 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 23  

0013 4401              ORL     A,#01H
0015 F0                MOVX    @DPTR,A
0016         ?C0076:
                                           ; SOURCE LINE # 516
0016 900000      E     MOV     DPTR,#cOsLedCtrl
0019 E0                MOVX    A,@DPTR
001A 13                RRC     A
001B 13                RRC     A
001C 543F              ANL     A,#03FH
001E 900000      E     MOV     DPTR,#GPDRA
0021 30E006            JNB     ACC.0,?C0077
                                           ; SOURCE LINE # 518
0024 E0                MOVX    A,@DPTR
0025 54FD              ANL     A,#0FDH
0027 F0                MOVX    @DPTR,A
0028 8004              SJMP    ?C0078
002A         ?C0077:
                                           ; SOURCE LINE # 521
002A E0                MOVX    A,@DPTR
002B 4402              ORL     A,#02H
002D F0                MOVX    @DPTR,A
002E         ?C0078:
                                           ; SOURCE LINE # 523
002E 900000      E     MOV     DPTR,#cOsLedCtrl
0031 E0                MOVX    A,@DPTR
0032 13                RRC     A
0033 13                RRC     A
0034 13                RRC     A
0035 541F              ANL     A,#01FH
0037 900000      E     MOV     DPTR,#GPDRA
003A 30E006            JNB     ACC.0,?C0079
                                           ; SOURCE LINE # 525
003D E0                MOVX    A,@DPTR
003E 54FB              ANL     A,#0FBH
0040 F0                MOVX    @DPTR,A
0041 8004              SJMP    ?C0080
0043         ?C0079:
                                           ; SOURCE LINE # 528
0043 E0                MOVX    A,@DPTR
0044 4404              ORL     A,#04H
0046 F0                MOVX    @DPTR,A
0047         ?C0080:
                                           ; SOURCE LINE # 537
0047 900000      E     MOV     DPTR,#uMBID
004A E0                MOVX    A,@DPTR
004B 30E019            JNB     ACC.0,?C0081
                                           ; SOURCE LINE # 538
                                           ; SOURCE LINE # 539
004E 900000      E     MOV     DPTR,#cOsLedCtrl+01H
0051 E0                MOVX    A,@DPTR
0052 C4                SWAP    A
0053 13                RRC     A
0054 13                RRC     A
0055 5403              ANL     A,#03H
0057 900000      E     MOV     DPTR,#GPDRE
005A 30E006            JNB     ACC.0,?C0082
                                           ; SOURCE LINE # 540
005D E0                MOVX    A,@DPTR
005E 547F              ANL     A,#07FH
0060 F0                MOVX    @DPTR,A
0061 8004              SJMP    ?C0081
0063         ?C0082:
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 24  

                                           ; SOURCE LINE # 542
0063 E0                MOVX    A,@DPTR
0064 4480              ORL     A,#080H
0066 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 543
0067         ?C0081:
                                           ; SOURCE LINE # 545
0067 900000      E     MOV     DPTR,#cOsLed1Ctrl
006A E0                MOVX    A,@DPTR
006B 900000      E     MOV     DPTR,#GPDRH
006E 30E006            JNB     ACC.0,?C0084
                                           ; SOURCE LINE # 546
0071 E0                MOVX    A,@DPTR
0072 54F7              ANL     A,#0F7H
0074 F0                MOVX    @DPTR,A
0075 8004              SJMP    ?C0085
0077         ?C0084:
                                           ; SOURCE LINE # 548
0077 E0                MOVX    A,@DPTR
0078 4408              ORL     A,#08H
007A F0                MOVX    @DPTR,A
007B         ?C0085:
                                           ; SOURCE LINE # 550
007B 900000      E     MOV     DPTR,#cOsLed1Ctrl
007E E0                MOVX    A,@DPTR
007F 13                RRC     A
0080 13                RRC     A
0081 13                RRC     A
0082 541F              ANL     A,#01FH
0084 30E007            JNB     ACC.0,?C0086
                                           ; SOURCE LINE # 551
0087 900000      E     MOV     DPTR,#DCR3
008A 74FF              MOV     A,#0FFH
008C F0                MOVX    @DPTR,A
008D 22                RET     
008E         ?C0086:
                                           ; SOURCE LINE # 554
008E E4                CLR     A
008F 900000      E     MOV     DPTR,#DCR3
0092 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 563
0093         ?C0088:
0093 22                RET     
             ; FUNCTION MFG_LED (END)

             ; FUNCTION SetKeyboardLED (BEGIN)
                                           ; SOURCE LINE # 566
                                           ; SOURCE LINE # 567
                                           ; SOURCE LINE # 570
0000 120000      R     LCALL   L?0134
0003 701A              JNZ     ?C0090
0005 900000      E     MOV     DPTR,#cOsLedCtrl
0008 E0                MOVX    A,@DPTR
0009 C4                SWAP    A
000A 13                RRC     A
000B 13                RRC     A
000C 13                RRC     A
000D 5401              ANL     A,#01H
000F 20E00D            JB      ACC.0,?C0090
0012 900000      E     MOV     DPTR,#GPDRB
0015 E0                MOVX    A,@DPTR
0016 30E103            JNB     ACC.1,?C0091
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 25  

0019 D3                SETB    C
001A 8001              SJMP    ?C0092
001C         ?C0091:
001C C3                CLR     C
001D         ?C0092:
001D 4006              JC      ?C0089
001F         ?C0090:
                                           ; SOURCE LINE # 571
                                           ; SOURCE LINE # 572
001F E4                CLR     A
0020 900000      E     MOV     DPTR,#DCR3
0023 F0                MOVX    @DPTR,A
0024 22                RET     
                                           ; SOURCE LINE # 575
0025         ?C0089:
                                           ; SOURCE LINE # 584
;---- Variable 'BKBMax' assigned to Register 'R5' ----
0025 7DF0              MOV     R5,#0F0H
                                           ; SOURCE LINE # 585
0027 900000      R     MOV     DPTR,#BKBHalf
002A 7428              MOV     A,#028H
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 587
002D 900000      E     MOV     DPTR,#UpdateLEDBL_delay
0030 E0                MOVX    A,@DPTR
0031 6002              JZ      ?C0094
                                           ; SOURCE LINE # 588
                                           ; SOURCE LINE # 589
0033 803D              SJMP    ?C0128
                                           ; SOURCE LINE # 591
0035         ?C0094:
                                           ; SOURCE LINE # 594
0035 900000      E     MOV     DPTR,#uReserve07
0038 E0                MOVX    A,@DPTR
0039 C4                SWAP    A
003A 13                RRC     A
003B 5407              ANL     A,#07H
003D 30E018            JNB     ACC.0,?C0095
                                           ; SOURCE LINE # 595
                                           ; SOURCE LINE # 596
0040 900000      E     MOV     DPTR,#EMStatusBit
0043 E0                MOVX    A,@DPTR
0044 30E00C            JNB     ACC.0,?C0096
                                           ; SOURCE LINE # 597
                                           ; SOURCE LINE # 598
0047 E0                MOVX    A,@DPTR
0048 30E20D            JNB     ACC.2,?C0095
                                           ; SOURCE LINE # 599
                                           ; SOURCE LINE # 600
004B 900000      E     MOV     DPTR,#LED_KB_PWM_Step
004E 7402              MOV     A,#02H
0050 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 601
                                           ; SOURCE LINE # 602
0051 8005              SJMP    ?C0095
0053         ?C0096:
                                           ; SOURCE LINE # 604
                                           ; SOURCE LINE # 605
0053 E4                CLR     A
0054 900000      E     MOV     DPTR,#LED_KB_PWM_Step
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 606
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 26  

                                           ; SOURCE LINE # 607
0058         ?C0095:
                                           ; SOURCE LINE # 610
0058 900000      E     MOV     DPTR,#LED_KB_PWM_Count
005B E0                MOVX    A,@DPTR
005C 547F              ANL     A,#07FH
005E 6016              JZ      ?C0099
                                           ; SOURCE LINE # 611
                                           ; SOURCE LINE # 612
0060 900000      E     MOV     DPTR,#DCR3
0063 E0                MOVX    A,@DPTR
0064 7009              JNZ     ?C0100
                                           ; SOURCE LINE # 614
                                           ; SOURCE LINE # 615
0066 ED                MOV     A,R5
0067 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 617
0068 900000      E     MOV     DPTR,#LED_KB_PWM_Count
006B E0                MOVX    A,@DPTR
006C 4480              ORL     A,#080H
006E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 618
006F         ?C0100:
                                           ; SOURCE LINE # 619
006F 900000      E     MOV     DPTR,#LED_KB_PWM_Count
0072         ?C0128:
0072 E0                MOVX    A,@DPTR
0073 14                DEC     A
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 620
0075 22                RET     
0076         ?C0099:
                                           ; SOURCE LINE # 622
                                           ; SOURCE LINE # 623
0076 900000      E     MOV     DPTR,#LED_KB_PWM_Count
0079 E0                MOVX    A,@DPTR
007A 30E70A            JNB     ACC.7,?C0102
                                           ; SOURCE LINE # 624
                                           ; SOURCE LINE # 625
007D E4                CLR     A
007E 900000      E     MOV     DPTR,#DCR3
0081 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 626
0082 900000      E     MOV     DPTR,#LED_KB_PWM_Count
0085 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 627
0086 22                RET     
0087         ?C0102:
                                           ; SOURCE LINE # 629
                                           ; SOURCE LINE # 630
0087 900000      E     MOV     DPTR,#LED_KB_PWM_Step
008A E0                MOVX    A,@DPTR
008B 14                DEC     A
008C 6020              JZ      ?C0093
008E 14                DEC     A
008F 6004              JZ      ?C0107
0091 2402              ADD     A,#02H
                                           ; SOURCE LINE # 631
                                           ; SOURCE LINE # 632
0093         ?C0105:
                                           ; SOURCE LINE # 633
                                           ; SOURCE LINE # 634
C51 COMPILER V8.12   OEM_LED                                                               07/28/2018 12:03:42 PAGE 27  

                                           ; SOURCE LINE # 635
0093 800D              SJMP    ?C0129
                                           ; SOURCE LINE # 636
                                           ; SOURCE LINE # 640
                                           ; SOURCE LINE # 642
0095         ?C0107:
                                           ; SOURCE LINE # 643
0095 900000      E     MOV     DPTR,#DCR3
0098 ED                MOV     A,R5
0099 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 644
009A 900000      E     MOV     DPTR,#EMStatusBit
009D E0                MOVX    A,@DPTR
009E 54FB              ANL     A,#0FBH
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 645
00A1 22                RET     
                                           ; SOURCE LINE # 647
00A2         ?C0129:
00A2 E4                CLR     A
00A3 900000      E     MOV     DPTR,#DCR3
00A6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 649
00A7 900000      E     MOV     DPTR,#EMStatusBit
00AA E0                MOVX    A,@DPTR
00AB 4404              ORL     A,#04H
00AD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 650
                                           ; SOURCE LINE # 652
                                           ; SOURCE LINE # 654
                                           ; SOURCE LINE # 655
                                           ; SOURCE LINE # 657
00AE         ?C0093:
00AE 22                RET     
             ; FUNCTION SetKeyboardLED (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    990    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
