C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE CORE_PORT6064
OBJECT MODULE PLACED IN Code\CORE\CORE_PORT6064.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\CORE\CORE_PORT6064.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\C
                    -ORE\INCLUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: CORE_PORT6064.C - Standard 8042 Keyboard Controller Commands
   3           *
   4           * Copyright (c) 1983-2007, Insyde Software Corporation. All Rights Reserved.
   5           *
   6           * You may not reproduce, distribute, publish, display, perform, modify, adapt,
   7           * transmit, broadcast, present, recite, release, license or otherwise exploit
   8           * any part of this publication in any form, by any means, without the prior
   9           * written permission of Insyde Software Corporation.
  10           *---------------------------------------------------------------------------*/
  11          
  12          #include <CORE_INCLUDE.H>
  13          #include <OEM_INCLUDE.H>
  14          
  15          //-----------------------------------------------------------------------
  16          // Process Command/Data received from System via the KBC interface
  17          //-----------------------------------------------------------------------
  18          void service_pci1(void)
  19          {
  20   1          if ( IS_MASK_CLEAR(KBHISR,IBF) )
  21   1          {
  22   2                      return;
  23   2          }
  24   1      
  25   1          if ( KBHISR & C_D )                         // command
  26   1          {
  27   2              KBHIStep = 0;                           // command start
  28   2              KbdNeedResponseFlag = 0;
  29   2                      KBHICmd  = KBHIDIR;
  30   2      
  31   2                      //ANGELAG057: add start
  32   2                 #if KBDEBUG    
                      RamDebug(0x6D); 
                      RamDebug(KBHICmd); 
                     #endif 
  36   2                      //ANGELAG057: add end
  37   2              Core_64Port(KBHICmd);
  38   2              Hook_64Port(KBHICmd);
  39   2              
  40   2               if ( KbdNeedResponseFlag )
  41   2               {
  42   3                  KbdNeedResponseFlag = 0;
  43   3                  KBC_DataToHost(KBHIReponse);
  44   3              }
  45   2          }
  46   1          else                                                // data
  47   1          {
  48   2              KBHIData2 = KBHIData1;
  49   2              KBHIData1 = KBHIData;
  50   2              KBHIData  = KBHIDIR;
  51   2                      //ANGELAG057: add start
  52   2                      #if KBDEBUG  
                       RamDebug(0x6E); 
                      RamDebug(KBHIData); 
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 2   

                      #endif   
  56   2                      //ANGELAG057: add end
  57   2      
  58   2               if(FastA20)
  59   2               {
  60   3                  if((KBHIData&0x02)!= 0x00)
  61   3                  {
  62   4                      Hook_A20ON();
  63   4                  }
  64   3                  else
  65   3                  {
  66   4                  Hook_A20OFF();
  67   4                  }
  68   3                  FastA20=0;
  69   3                  KBHIStep = 0;
  70   3               }
  71   2              else
  72   2              {
  73   3                  if (KBHIStep!=0x00 )        // if need data
  74   3                   {
  75   4                      Core_60Port(KBHICmd);
  76   4                      Hook_60Port(KBHICmd);
  77   4                                      KBHIStep --;
  78   4                              if (KbdNeedResponseFlag)
  79   4                                      {
  80   5                                      KbdNeedResponseFlag = 0;
  81   5                                      KBC_DataToHost(KBHIReponse);
  82   5                              }
  83   4                  }
  84   3                      else
  85   3                  {
  86   4                      Cmd_AE();                               // Enable auxiliary keyboard.
  87   4      
  88   4                      #if PS2_KBCMD
                                  #ifdef UART_Debug
                                      printf("\nKB CMD : 0X%bX\n",KBHIData);
                                  #endif
                              #endif
  93   4      
  94   4                      KeyboardCmd(KBHIData);          // Keyboard command
  95   4                  }
  96   3                }
  97   2          }
  98   1      
  99   1          EnableKBCIBFInt();          // enable interrupt again
 100   1      }
 101          
 102          //-----------------------------------------------------------------------
 103          // Handle 64 port command 2x.
 104          //-----------------------------------------------------------------------
 105          //-----------------------------------------------------------------------
 106          // Handle command 20 - Read command byte
 107          //-----------------------------------------------------------------------
 108          void Cmd_20(void)
 109          
 110          {
 111   1              ResponseKBData(Ccb42);
 112   1      }
 113          
 114          //-----------------------------------------------------------------------
 115          // Handle 64 port command 3x.
 116          //-----------------------------------------------------------------------
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 3   

 117          //-----------------------------------------------------------------------
 118          // Handle command 33 - Send Security Code On byte to host
 119          //-----------------------------------------------------------------------
 120          void Cmd_33(void)
 121          
 122          {
 123   1              ResponseKBData(Pass_On);
 124   1      }
 125          
 126          //-----------------------------------------------------------------------
 127          // Handle command 34 - Send Security Code Off byte to host
 128          //-----------------------------------------------------------------------
 129          void Cmd_34(void)
 130          
 131          {
 132   1              ResponseKBData(Pass_Off);
 133   1      }
 134          
 135          //-----------------------------------------------------------------------
 136          // Handle command 36 - Send Reject make code 1 to host
 137          //-----------------------------------------------------------------------
 138          void Cmd_36(void)
 139          
 140          {
 141   1              ResponseKBData(Pass_Make1);
 142   1      }
 143          
 144          //-----------------------------------------------------------------------
 145          // Handle command 37 - Send Reject make code 2 to host
 146          //-----------------------------------------------------------------------
 147          void Cmd_37(void)
 148          
 149          {
 150   1              ResponseKBData(Pass_Make2);
 151   1      }
 152          
 153          //-----------------------------------------------------------------------
 154          // Handle 64 port command 6x.
 155          //-----------------------------------------------------------------------
 156          //-----------------------------------------------------------------------
 157          // Handle command 60 - Write command byte to KBC
 158          //-----------------------------------------------------------------------
 159          void Cmd_60(void)
 160          
 161          {
 162   1              SetHandleCmdData(1);
 163   1      }
 164          
 165          //-----------------------------------------------------------------------
 166          // Handle 64 port command 7x.
 167          //-----------------------------------------------------------------------
 168          //-----------------------------------------------------------------------
 169          // Handle command 73 - Write security Code On byte.
 170          //-----------------------------------------------------------------------
 171          void Cmd_73(void)
 172          
 173          {
 174   1              SetHandleCmdData(1);
 175   1      }
 176          
 177          //-----------------------------------------------------------------------
 178          // Handle command 74 - Write security Code Off byte.
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 4   

 179          //-----------------------------------------------------------------------
 180          void Cmd_74(void)
 181          
 182          {
 183   1              SetHandleCmdData(1);
 184   1      }
 185          
 186          //-----------------------------------------------------------------------
 187          // Handle command 76 - Write Password Code Discard 1
 188          //-----------------------------------------------------------------------
 189          void Cmd_76(void)
 190          
 191          {
 192   1              SetHandleCmdData(1);
 193   1      }
 194          
 195          //-----------------------------------------------------------------------
 196          // Handle command 77 - Write Password Code Discard 2
 197          //-----------------------------------------------------------------------
 198          void Cmd_77(void)
 199          
 200          {
 201   1              SetHandleCmdData(1);
 202   1      }
 203          
 204          //-----------------------------------------------------------------------
 205          // Handle 64 port command 9x.
 206          //-----------------------------------------------------------------------
 207          //-----------------------------------------------------------------------
 208          // Handle command 90 -
 209          //-----------------------------------------------------------------------
 210          void Cmd_90(void)
 211          
 212          {
 213   1              SetHandleCmdData(1);
 214   1      }
 215          
 216          //-----------------------------------------------------------------------
 217          // Handle command 91 -
 218          //-----------------------------------------------------------------------
 219          void Cmd_91(void)
 220          
 221          {
 222   1              SetHandleCmdData(1);
 223   1      }
 224          
 225          //-----------------------------------------------------------------------
 226          // Handle command 92 -
 227          //-----------------------------------------------------------------------
 228          void Cmd_92(void)
 229          
 230          {
 231   1              SetHandleCmdData(1);
 232   1      }
 233          
 234          //-----------------------------------------------------------------------
 235          // Handle command 93 -
 236          //-----------------------------------------------------------------------
 237          void Cmd_93(void)
 238          
 239          {
 240   1              SetHandleCmdData(1);
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 5   

 241   1      }
 242          
 243          //-----------------------------------------------------------------------
 244          // Handle 64 port command Ax.
 245          //-----------------------------------------------------------------------
 246          //-----------------------------------------------------------------------
 247          // Handle command A4 - Test Password Installed
 248          // Return: data to send to HOST (FA or F1)
 249          //-----------------------------------------------------------------------
 250          void Cmd_A4(void)
 251          
 252          {
 253   1          if (Flag.PASS_READY)
 254   1              {
 255   2              ResponseKBData(0xFA);   // Return FA if password is loaded
 256   2          }
 257   1          else
 258   1              {
 259   2              ResponseKBData(0xF1);   // Return F1 if password not loaded
 260   2          }
 261   1      }
 262          
 263          //-----------------------------------------------------------------------
 264          // Handle command A5 - Load Password
 265          //-----------------------------------------------------------------------
 266          void Cmd_A5(void)
 267          
 268          {
 269   1              Tmp_Load = 0x00;
 270   1              SetHandleCmdData(8);
 271   1      }
 272          
 273          //-----------------------------------------------------------------------
 274          // Handle command A6 - Enable Password
 275          //-----------------------------------------------------------------------
 276          void Cmd_A6(void)
 277          
 278          {
 279   1          if (Flag.PASS_READY)                        // At this point, a password is loaded.
 280   1          {                                                           // Enable inhibit switch
 281   2              Gen_Info_PASS_ENABLE = 1;       // Enable password
 282   2              Pass_Buff_Idx = 0;              // Clear password buffer index
 283   2              Flag.SCAN_INH = 0;              // Clear internal keyboard inhibit
 284   2                      ResponseKBData(Pass_On);
 285   2          }
 286   1          else
 287   1          {                                                           // At this point, a password is not loaded.
 288   2              ResponseKBData(0x00);
 289   2          }
 290   1      }
 291          
 292          //-----------------------------------------------------------------------
 293          // Handle command A7 - Disable Aux Device Interface
 294          //-----------------------------------------------------------------------
 295          void Cmd_A7(void)
 296          
 297          {
 298   1              Ccb42_DISAB_AUX = 1;   // Disable auxiliary device (mouse)
 299   1      }
 300          
 301          //-----------------------------------------------------------------------
 302          // Handle command A8 - Enable Auxiliary Device Interface
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 6   

 303          //-----------------------------------------------------------------------
 304          void Cmd_A8(void)
 305          
 306          {
 307   1              Ccb42_DISAB_AUX = 0;    // Enable aux device (mouse)
 308   1      }
 309          
 310          //-----------------------------------------------------------------------
 311          // Handle command A9 - Test Aux Device Interface
 312          // Returns: test error code:
 313          //             0 = no error
 314          //             1 = Clock line stuck low
 315          //             2 = Clock line stuck high
 316          //             3 = Data line stuck low
 317          //             4 = Data line stuck high
 318          //-----------------------------------------------------------------------
 319          void Cmd_A9(void)
 320          
 321          {
 322   1          MULPX_Multiplex = 0;
 323   1              ResponseKBData(0x00);
 324   1      }
 325          
 326          //-----------------------------------------------------------------------
 327          // Handle command AA - Self Test
 328          // Returns: 0x55 to signify that the test passed
 329          //-----------------------------------------------------------------------
 330          void Cmd_AA(void)
 331          
 332          {
 333   1          #if TouchPad_only
 334   1          ScanAUXDevice(ScanMouseChannel);    // Scan Mouse channel
 335   1          #else
                  ScanAUXDevice(ScanAllPS2Channel);   // Scan all PS2 channels
                  #endif
 338   1      
 339   1          MULPX_Multiplex = 0;                // Dino MUX ps2
 340   1      
 341   1          Data_To_Host(0x55 );
 342   1          //KBC_DataToHost(0x55);
 343   1      }
 344          
 345          //-----------------------------------------------------------------------
 346          // Handle command AB - Test Keyboard Interface
 347          // Returns: test error code:
 348          //             0 = no error
 349          //             1 = Clock line stuck low
 350          //             2 = Clock line stuck high
 351          //             3 = Data line stuck low
 352          //             4 = Data line stuck high
 353          //-----------------------------------------------------------------------
 354          void Cmd_AB(void)
 355          
 356          {
 357   1              ResponseKBData(0x00);
 358   1      }
 359          
 360          //-----------------------------------------------------------------------
 361          // Handle command AC - Diagnostic Dump
 362          //-----------------------------------------------------------------------
 363          void Cmd_AC(void)
 364          
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 7   

 365          {
 366   1              //Kbd_Response = respCMD_AC;// Send multibyte sequence.
 367   1              //Tmp_Byte[0] = 0;                      // Tmp_Byte[0] will be used as the index for data.
 368   1      }
 369          
 370          //-----------------------------------------------------------------------
 371          // Handle command AD - Disable Keyboard Interface
 372          //-----------------------------------------------------------------------
 373          void Cmd_AD(void)
 374          
 375          {
 376   1          Ccb42_DISAB_KEY = 1;                // Disable auxiliary keyboard.
 377   1          Flag.SCAN_INH = 1;          // Inhibit scanner (internal keyboard).
 378   1          Lock_Scan();                // Lock scanner.
 379   1          //Load_Timer_B();                   // Start inhibit delay timer.
 380   1      }
 381          
 382          //-----------------------------------------------------------------------
 383          // Handle command AE - Enable Keyboard Interface
 384          //-----------------------------------------------------------------------
 385          void Cmd_AE(void)
 386          
 387          {
 388   1              Ccb42_DISAB_KEY = 0;            // Enable auxiliary keyboard.
 389   1              Flag.SCAN_INH = 0;              // Enable scanner (internal keyboard).
 390   1      }
 391          
 392          //-----------------------------------------------------------------------
 393          // Handle command AF -
 394          //-----------------------------------------------------------------------
 395          void Cmd_AF(void)
 396          
 397          {
 398   1      
 399   1      }
 400          
 401          //-----------------------------------------------------------------------
 402          // Handle 64 port command Cx.
 403          // Return: Byte from input port.
 404          //     Bit 7 = Keyboard not inhibited via switch.
 405          //     Bit 6 = Monochrome adapter (0 = Color/Graphics adapter).
 406          //     Bit 5 = Manufacturing jumper not installed.
 407          //     Bit 4 = Enable 2nd 256K of system board RAM.
 408          //     Bit 3 =
 409          //     Bit 2 =
 410          //     Bit 1 = Auxiliary data in line (PS/2 only).
 411          //     Bit 0 = Keyboard data in line (PS/2 only).
 412          //-----------------------------------------------------------------------
 413          //-----------------------------------------------------------------------
 414          // Handle command C0 - Emulate reading the 8042 Input port and send data
 415          //                                              to the system
 416          //-----------------------------------------------------------------------
 417          void Cmd_C0(void)
 418          
 419          {
 420   1              ResponseKBData(0xBF);   //  Just return the compatibility value for now. //return (PCIN | 0x1F);
 421   1      }
 422          
 423          //-----------------------------------------------------------------------
 424          // Handle 64 port command Dx.
 425          //-----------------------------------------------------------------------
 426          //-----------------------------------------------------------------------
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 8   

 427          // Handle command D0 - Send 8042 Output port value to the system
 428          //                                              (emulates data since there¡¯s no real Output port)
 429          //-----------------------------------------------------------------------
 430          void Cmd_D0(void)
 431          
 432          {
 433   1              ResponseKBData(Read_Output_Port_2());
 434   1      }
 435          
 436          //-----------------------------------------------------------------------
 437          // Handle command D1 - Only set/reset GateA20 line based on the System Data bit1.
 438          //-----------------------------------------------------------------------
 439          void Cmd_D1(void)
 440          
 441          {
 442   1              FastA20=1;
 443   1              //SetHandleCmdData(1);
 444   1      }
 445          
 446          //-----------------------------------------------------------------------
 447          // Handle command D2 - Send data to the system as if it came from the keyboard.
 448          //-----------------------------------------------------------------------
 449          void Cmd_D2(void)
 450          
 451          {
 452   1          TR1 = 0;                    // Disable timer1
 453   1          ET1 = 0;                    // Disable timer1 interrupt
 454   1          _nop_();
 455   1          _nop_();
 456   1          _nop_();
 457   1          _nop_();
 458   1          TH1 = Timer_20ms>>8;        // Set timer1 counter 20ms
 459   1          TL1 = Timer_20ms;           // Set timer1 counter 20ms
 460   1          TF1 = 0;                    // Clear overflow flag
 461   1          TR1 = 1;                    // Enable timer1
 462   1      
 463   1              while (!TF1)
 464   1              {
 465   2                  if(IS_MASK_SET(KBHISR,IBF))
 466   2                      {
 467   3                  if(IS_MASK_CLEAR(KBHISR,C_D))   // Data Port
 468   3                  {
 469   4                      KBHIData = KBHIDIR;
 470   4                      Data_To_Host(KBHIData);
 471   4                  }
 472   3                  TR1 = 0;            // Disable timer 1
 473   3                  TF1 = 0;                // clear overflow flag
 474   3                  ET1 = 1;                // Enable timer1 interrupt
 475   3                  return;
 476   3                      }
 477   2          }
 478   1      
 479   1          TR1 = 0;                    // Disable timer 1
 480   1          TF1 = 0;                            // clear overflow flag
 481   1          ET1 = 1;                            // Enable timer1 interrupt
 482   1          SetHandleCmdData(1);
 483   1      }
 484          
 485          //-----------------------------------------------------------------------
 486          // Handle command D3 - Send data to the system as if it came from the auxiliary device.
 487          //-----------------------------------------------------------------------
 488          void Cmd_D3(void)
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 9   

 489          
 490          {
 491   1          TR1 = 0;                    // Disable timer1
 492   1          ET1 = 0;                    // Disable timer1 interrupt
 493   1          _nop_();
 494   1          _nop_();
 495   1          _nop_();
 496   1          _nop_();
 497   1          TH1 = Timer_20ms>>8;        // Set timer1 counter 20ms
 498   1          TL1 = Timer_20ms;           // Set timer1 counter 20ms
 499   1          TF1 = 0;                    // Clear overflow flag
 500   1          TR1 = 1;                    // Enable timer1
 501   1      
 502   1              while (!TF1)
 503   1              {
 504   2                  if(IS_MASK_SET(KBHISR,IBF))
 505   2                      {
 506   3                  if(IS_MASK_CLEAR(KBHISR,C_D))   // Data Port
 507   3                  {
 508   4                      KBHIData = KBHIDIR;
 509   4                      #if MultiplexedModes
                                      Aux_Data_To_Host(CheckAuxMux());
                              #else
 512   4                          Aux_Data_To_Host(KBHIData);
 513   4                      #endif
 514   4                  }
 515   3                  TR1 = 0;            // Disable timer 1
 516   3                  TF1 = 0;                // clear overflow flag
 517   3                  ET1 = 1;                // Enable timer1 interrupt
 518   3                  return;
 519   3                      }
 520   2          }
 521   1      
 522   1          TR1 = 0;                    // Disable timer 1
 523   1          TF1 = 0;                            // clear overflow flag
 524   1          ET1 = 1;                            // Enable timer1 interrupt
 525   1          SetHandleCmdData(1);
 526   1      }
 527          
 528          //-----------------------------------------------------------------------
 529          // Handle command D4 - Output next received byte of data from system to auxiliary device.
 530          //-----------------------------------------------------------------------
 531          void Cmd_D4(void)
 532          
 533          {
 534   1              SetHandleCmdData(1);
 535   1              MULPX_Multiplex = 0;            // Dino MUX ps2
 536   1      }
 537          
 538          //-----------------------------------------------------------------------
 539          // Handle 64 port command Ex.
 540          //-----------------------------------------------------------------------
 541          //-----------------------------------------------------------------------
 542          // Handle command E0 - Reports the state of the test inputs
 543          //-----------------------------------------------------------------------
 544          void Cmd_E0(void)
 545          
 546          {
 547   1              ResponseKBData(0x00);
 548   1      }
 549          
 550          //-----------------------------------------------------------------------
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 10  

 551          // Handle 64 port command Fx.
 552          //-----------------------------------------------------------------------
 553          void Cmd_FX(void)
 554          {
 555   1              if ((KBHICmd % 2)==0x00)    // Even command
 556   1          {
 557   2              //CLEAR_MASK(KBHISR,SYSF);
 558   2                      Hook_A20ON();
 559   2                      Hook_KBRSTON();
 560   2                      //Microsecond_Delay(64);  // Delay.
 561   2                  WNCKR = 0x00;           // Delay 15.26 us
 562   2              WNCKR = 0x00;           // Delay 15.26 us
 563   2              WNCKR = 0x00;           // Delay 15.26 us
 564   2              WNCKR = 0x00;           // Delay 15.26 us
 565   2              WNCKR = 0x00;           // Delay 15.26 us
 566   2                      Hook_KBRSTOFF();
 567   2              }                                                       // Odd command do no thing
 568   1      }
 569          
 570          //-----------------------------------------------------------------------
 571          // Handle 60 port data 6x.
 572          //-----------------------------------------------------------------------
 573          //-----------------------------------------------------------------------
 574          // Process command data 60 - Write command byte
 575          //-----------------------------------------------------------------------
 576          void Cmd_60Data(void)
 577          {
 578   1              Ccb42 = KBHIData;   // Write the data.
 579   1              //RamDebug(0x60); //ANGELAG031: remove //ANGELAG025: add
 580   1              //RamDebug(KBHIData); //ANGELAG031: remove //ANGELAG025: add
 581   1              //if (Ext_Cb0_PS2_AT)   // Reconfigure variables/registers that are dependent on Command Byte value.
 582   1              //{
 583   1              //      if (Ccb42_DISAB_AUX)    // For PS/2 style 8042 interface.
 584   1              //      {
 585   1          //          Cmd_A7();       // Disable aux device interface.
 586   1          //  }
 587   1         //   else
 588   1              //      {
 589   1          //                  Cmd_A8();       // Enable Auxiliary Device Interface.
 590   1          //  }
 591   1              //}
 592   1      
 593   1              if (Ccb42_DISAB_KEY)
 594   1              {
 595   2              Cmd_AD();               // Disable keyboard interface.
 596   2              }
 597   1              else
 598   1              {
 599   2              Cmd_AE();               // Enable keyboard interface.
 600   2              }
 601   1      
 602   1      
 603   1              if (Ccb42_SYS_FLAG)     // Put system flag bit in Status Reg.
 604   1                      SET_MASK(KBHISR,SYSF);
 605   1              else
 606   1                      CLEAR_MASK(KBHISR,SYSF);
 607   1      }
 608          
 609          //-----------------------------------------------------------------------
 610          // Handle 60 port data 7x.
 611          //-----------------------------------------------------------------------
 612          //-----------------------------------------------------------------------
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 11  

 613          // Process command data 71 - Write Security Code On byte
 614          //-----------------------------------------------------------------------
 615          void Cmd_73Data(void)
 616          {
 617   1              Pass_On = KBHIData;     // Write the data.
 618   1      }
 619          
 620          //-----------------------------------------------------------------------
 621          // Process command data 74 - Write Security Code Off byte
 622          //-----------------------------------------------------------------------
 623          void Cmd_74Data(void)
 624          {
 625   1              Pass_Off = KBHIData;    // Write the data.
 626   1      }
 627          
 628          //-----------------------------------------------------------------------
 629          // Process command data 76 - Reject make code 1
 630          //-----------------------------------------------------------------------
 631          void Cmd_76Data(void)
 632          {
 633   1              Pass_Make1 = KBHIData;  // Write the data.
 634   1      }
 635          
 636          //-----------------------------------------------------------------------
 637          // Process command data 77 - Reject make code 2
 638          //-----------------------------------------------------------------------
 639          void Cmd_77Data(void)
 640          {
 641   1              Pass_Make2 = KBHIData;  // Write the data.
 642   1      }
 643          
 644          // Dino MUX ps2 -->
 645          //-----------------------------------------------------------------------
 646          // Handle 60 port data 9x.
 647          //-----------------------------------------------------------------------
 648          //-----------------------------------------------------------------------
 649          // Process command data 90 - MUX AUX port #0
 650          //-----------------------------------------------------------------------
 651          void Cmd_90Data(void)                   // always send timeout error to system
 652          {
 653   1          if(PS2_MSCMD)
 654   1          {
 655   2              #ifdef UART_Debug
 656   2                  printf("\nMS 90Port CMD : 0X%bX\n",KBHIData);
 657   2              #endif
 658   2          }
 659   1      
 660   1          #if !TouchPad_only
                      if(ECSendtoAUXFlag)
                      {
                          if(WaitECSend2PortACK(AUX_SCAN_INDEX)==0x01)
                          {
                              AUXDevicePlugOutClearVariables();
                          }
                      }
              
                      SetPS2SkipScanTime(100);    // 1Sec
                  #endif
 671   1      
 672   1          if(KBHIData==0xFF)
 673   1          {
 674   2              ScanAUXDevice(ScanAllPS2Channel);
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 12  

 675   2          }
 676   1      
 677   1          KBHISR = 0x24;                                  // set error bit and AUX bit, source bits is 00
 678   1          KBHICR &= 0xFC;
 679   1          if ( Ccb42_INTR_AUX )                   // If AUX IRQ bit of command is present
 680   1          {
 681   2              SET_MASK(KBHICR,OBFMIE);    // Enable IRQ
 682   2          }
 683   1      
 684   1          DelayXms(5);                                    // Emulate transmission delay times
 685   1          KBHIMDOR = 0xFC;                        // timeout error
 686   1      
 687   1          Hook_Mouse_90Cmd(KBHIData);
 688   1      }
 689          
 690          //-----------------------------------------------------------------------
 691          // Process command data 91 - MUX AUX port #1 internal mouse
 692          //-----------------------------------------------------------------------
 693          void Cmd_91Data(void)
 694          {
 695   1          if(PS2_MSCMD)
 696   1          {
 697   2              #ifdef UART_Debug
 698   2                  printf("\nMS 91Port CMD : 0X%bX\n",KBHIData);
 699   2              #endif
 700   2          }
 701   1      
 702   1          if(IS_MASK_SET(AuxFlags[0], DEVICE_IS_MOUSE))
 703   1          {
 704   2              SendCmdtoMUX(0);                    // Send command to channel 0 mouse
 705   2          }
 706   1          else
 707   1          {
 708   2                  KBHISR = 0x40;
 709   2                  DelayXms(5);                                // Emulate transmission delay times
 710   2                  KBHIMDOR = 0xFC;                    // timeout error
 711   2          }
 712   1      
 713   1          Hook_Mouse_91Cmd(KBHIData);
 714   1      }
 715          
 716          //-----------------------------------------------------------------------
 717          // Process command data 92 - MUX AUX port #2
 718          //-----------------------------------------------------------------------
 719          void Cmd_92Data(void)
 720          {
 721   1          if(PS2_MSCMD)
 722   1          {
 723   2              #ifdef UART_Debug
 724   2                  printf("\nMS 92Port CMD : 0X%bX\n",KBHIData);
 725   2              #endif
 726   2          }
 727   1      
 728   1          if(IS_MASK_SET(AuxFlags[1], DEVICE_IS_MOUSE))
 729   1          {
 730   2                  SendCmdtoMUX(1);                // Send command to channel 0 mouse
 731   2          }
 732   1          else
 733   1          {
 734   2              KBHISR = 0x80;
 735   2                  DelayXms(5);                                // Emulate transmission delay times
 736   2              KBHIMDOR = 0xFC;                        // timeout error
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 13  

 737   2          }
 738   1      
 739   1          Hook_Mouse_92Cmd(KBHIData);
 740   1      }
 741          
 742          //-----------------------------------------------------------------------
 743          // Process command data 93 - MUX AUX port #3 external mouse
 744          //-----------------------------------------------------------------------
 745          void Cmd_93Data(void)
 746          {
 747   1          if(PS2_MSCMD)
 748   1          {
 749   2              #ifdef UART_Debug
 750   2                  printf("\nMS 93Port CMD : 0X%bX\n",KBHIData);
 751   2              #endif
 752   2          }
 753   1      
 754   1          if(IS_MASK_SET(AuxFlags[2], DEVICE_IS_MOUSE))
 755   1          {
 756   2                  SendCmdtoMUX(2);            // Send command to channel 2 mouse
 757   2          }
 758   1          else
 759   1          {
 760   2                  KBHISR = 0xC0;                              // source bits is 11
 761   2                  DelayXms(5);                                // Emulate transmission delay times
 762   2                  KBHIMDOR = 0xFC;
 763   2          }
 764   1      
 765   1          Hook_Mouse_93Cmd(KBHIData);
 766   1      }
 767          // Dino MUX ps2 <--
 768          
 769          //-----------------------------------------------------------------------
 770          // Handle 60 port data Ax.
 771          //-----------------------------------------------------------------------
 772          
 773          //-----------------------------------------------------------------------
 774          // Process command data A5 - Load Password
 775          //-----------------------------------------------------------------------
 776          void Cmd_A5Data(void)
 777          {
 778   1              if ((Tmp_Load == 0) && (KBHIData == 0)) // The first byte is NULL
 779   1              {
 780   2                      Flag.PASS_READY = 0;    // clear password ready flag and exit
 781   2                                                      // Cmd_Byte has already been set to 0.  So the code will
 782   2                                                      // NOT wait for next byte
 783   2              }
 784   1              else
 785   1              {
 786   2              if (Tmp_Load < 8)               // PASS_SIZE = 8
 787   2              {                                       // If there is room in the buffer
 788   3                      Pass_Buff[Tmp_Load] = KBHIData;   // Store scan code
 789   3                      Tmp_Load++;             // Increment password buffer index
 790   3              }
 791   2              //Cmd_Byte = 0xA5;      // Set to keep waiting for next byte
 792   2                      if (KBHIData == 0)              // The last byte (null terminated string) has been stored
 793   2              {
 794   3                      //Cmd_Byte = 0;     // Clear out the command byte.
 795   3                      Flag.PASS_READY = 1; // Set password ready bit.
 796   3              }
 797   2              }
 798   1      }
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 14  

 799          
 800          //-----------------------------------------------------------------------
 801          // Handle 60 port data Dx.
 802          //-----------------------------------------------------------------------
 803          //-----------------------------------------------------------------------
 804          // Process command data D1 - set/reset GateA20 line based on the System Data bit1.
 805          //-----------------------------------------------------------------------
 806          void Cmd_D1Data(void)
 807          {
 808   1              if ( (KBHIData & 0x02) != 0x00)
 809   1              {
 810   2              Hook_A20ON();
 811   2              }
 812   1              else
 813   1              {
 814   2              Hook_A20OFF();
 815   2              }
 816   1      }
 817          
 818          //-----------------------------------------------------------------------
 819          // Process command data D2 - Send data back to the system as if it came from the keyboard.
 820          //-----------------------------------------------------------------------
 821          void Cmd_D2Data(void)
 822          {
 823   1          Data_To_Host(KBHIData);
 824   1      }
 825          
 826          //-----------------------------------------------------------------------
 827          // Process command data D3 - Send data back to the system as if it came from the auxiliary device.
 828          //-----------------------------------------------------------------------
 829          void Cmd_D3Data(void)                           // Dino MUX ps2
 830          {
 831   1          #if MultiplexedModes
                          Aux_Data_To_Host(CheckAuxMux());
                  #else
 834   1              Aux_Data_To_Host(KBHIData);
 835   1          #endif
 836   1      }
 837          
 838          //-----------------------------------------------------------------------
 839          // Process command data D4 - Output next received byte of data from system to auxiliary device.
 840          //-----------------------------------------------------------------------
 841          void Cmd_D4Data(void)
 842          {
 843   1          if(PS2_MSCMD)
 844   1          {
 845   2              #ifdef UART_Debug
 846   2              printf("\nMS CMD : 0X%bX\n",KBHIData);
 847   2              #endif
 848   2          }
 849   1          if(KBHIData==0xFF)                      // if is reset command
 850   1          {
 851   2              ScanAUXDevice(ScanMouseChannel);    // Scan mouse channel
 852   2          }
 853   1      
 854   1          if(Main_MOUSE_CHN!=0x00)                // mouse device is attached
 855   1          {
 856   2              CLEAR_MASK(AuxFlags[(Main_MOUSE_CHN-1)], DEVICE_NEED_INIT);
 857   2              CLEAR_MASK(AuxFlags[(Main_MOUSE_CHN-1)], DEVICE_NEED_CONFIG);
 858   2                  SendCmdtoMouse((Main_MOUSE_CHN-1));
 859   2          }
 860   1          else
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 15  

 861   1          {
 862   2                  DelayXms(20);                                   // Emulate transmission delay times
 863   2                  #ifdef Hook_ECACKMouseDriver
                      Hook_ECRespondtoMouseDriver(KBHIData);
                      #else
 866   2                  SendFromAux(0xFC);
 867   2              #endif
 868   2          }
 869   1      
 870   1          Hook_Mouse_D4Cmd(KBHIData);
 871   1      }
 872          
 873          //-----------------------------------------------------------------------
 874          // Handle 60 port data Fx.
 875          //-----------------------------------------------------------------------
 876          void ResponseKBData(BYTE RData)
 877          {
 878   1              KBHIReponse = RData;
 879   1              KbdNeedResponseFlag = 1;
 880   1      }
 881          
 882          //-----------------------------------------------------------------------
 883          // Handle 60 port data Fx.
 884          //-----------------------------------------------------------------------
 885          void SetHandleCmdData(BYTE step)
 886          {
 887   1          KBHIStep = step;
 888   1      }
 889          
 890          /* ----------------------------------------------------------------------------
 891           * FUNCTION: vKeyboardCmd
 892           *
 893           * Passes data sent from the Host (port 60 write) to the keyboard.
 894           *
 895           * Input: data = data byte to send
 896           * ------------------------------------------------------------------------- */
 897          static void KeyboardCmd(BYTE nKB60DAT)
 898          {
 899   1          BYTE ack,ack1,ack2,index,cmdbk;
 900   1          BYTE cnt1=0; //BROOKE0000: add
 901   1          BYTE cnt1flag=0; //BROOKE0000: add
 902   1          KBCmdAckByteCunt(0x00);         // New keyboard command, clear ack counter
 903   1          ack = 0x00;
 904   1          ack1 = 0x00;
 905   1          ack2 = 0x00;
 906   1          //  BROOKE0000: Start for clear output buffer before 0xFA ack to make sure kb function ok.
 907   1          //  and make sure command/data integrated. for example. cmd 0xF3, Ack 0xFA. 
 908   1          while(IS_MASK_SET(KBHISR,OBF))
 909   1          {
 910   2              cnt1++;
 911   2             if(cnt1>0xFE)
 912   2             {
 913   3               cnt1=0x00;
 914   3               break;
 915   3             }
 916   2      
 917   2              if ((IS_MASK_SET(KBHICR,OBFKIE))&&(IS_MASK_SET(KBIRQR,IRQ1B)))
 918   2              {
 919   3                    KBHICR &= 0xFC;
 920   3                    KBIRQR &= 0xFE;
 921   3                   _nop_();
 922   3                   _nop_();
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 16  

 923   3                  _nop_();
 924   3              } 
 925   2              else if ((IS_MASK_CLEAR(KBHICR,OBFKIE))&&(IS_MASK_CLEAR(KBIRQR,IRQ1B)))
 926   2              {
 927   3               KBHICR |= 0x01;
 928   3               
 929   3               _nop_();
 930   3               _nop_();
 931   3               _nop_();
 932   3              }
 933   2              if (IS_MASK_CLEAR(KBHISR,OBF))
 934   2              {
 935   3                  Cmd_AD();
 936   3                              cnt1flag=1;
 937   3                  Clear_Key();
 938   3                  cnt1=0x00;
 939   3                  break;
 940   3              }
 941   2          }
 942   1              //BROOKE0000: End
 943   1          //-------------------------------------------------------------------------
 944   1          //Keyboard Command Received Data Process
 945   1          //-------------------------------------------------------------------------
 946   1          if ( KB_Command )
 947   1          {
 948   2              cmdbk = KB_Command;
 949   2      
 950   2              switch(KB_Command)
 951   2              {
 952   3                  case 0xED:  /* Update LEDs command. */
 953   3                              Led_Data = nKB60DAT;
 954   3                              ack = 0xFA;
 955   3                              KB_Command = 0x00;
 956   3                              OEM_Write_Leds(Led_Data);   //Hook Oem On-board LED control
 957   3      
 958   3                              /* Update scanner numlock state. */
 959   3                              Scanner_State_NUM_LOCK = Led_Data_NUM;
 960   3                              break;
 961   3                  case 0xF0:  /* Set alternate scan codes. */
 962   3                              KB_CodeSet = nKB60DAT;
 963   3                              ack = 0xFA;
 964   3                              KB_Command = 0x00;
 965   3                              break;
 966   3                  case 0xF3:  /* Set typematic rate/delay. */
 967   3                              PS2KB_Typematic = nKB60DAT;
 968   3                              Set_Typematic(PS2KB_Typematic);
 969   3                              ack = 0xFA;
 970   3                              KB_Command = 0x00;
 971   3                              break;
 972   3                  default:    //Unknown command request system resend
 973   3                              ack = 0xFE;         //Resend
 974   3                              //KBCUnProcessCnt++;
 975   3                              break;
 976   3              }
 977   2      
 978   2              if((cmdbk==0xF3)||(cmdbk==0xED))
 979   2              {
 980   3                  KeyboardDriverIn = 1;
 981   3              }
 982   2      
 983   2              if( Main_KB_CHN ==0x00)             // no any external keyboard
 984   2              {
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 17  

 985   3                  if(ack != 0x00)                 // if need send ack to host
 986   3                  {
 987   4                      KBC_DataToHost(ack);        // send to host
 988   4                      #if PS2_KBCMD
                                  #ifdef UART_Debug
                                  printf("EC KB ACK : 0X%bX\n",ack);
                                  #endif
                              #endif
 993   4                  }
 994   3              }
 995   2              else                                // Send command to external keyboard
 996   2              {
 997   3      
 998   3                  CLEAR_MASK(AuxFlags[(Main_KB_CHN-1)], DEVICE_NEED_INIT);
 999   3                  CLEAR_MASK(AuxFlags[(Main_KB_CHN-1)], DEVICE_NEED_CONFIG);
1000   3      
1001   3                  KBCmdAckByteCunt(0x01);         // set ec need send one byte to host
1002   3      
1003   3                  if(cmdbk==0xED)
1004   3                  {
1005   4                          Send2Port((Main_KB_CHN-1), (nKB60DAT&0x07), SendCmdToKB);
1006   4                  }
1007   3                  else
1008   3                  {
1009   4                          Send2Port((Main_KB_CHN-1), nKB60DAT, SendCmdToKB);
1010   4                  }
1011   3      
1012   3                  if((cmdbk==0xF3)||(cmdbk==0xED))
1013   3                  {
1014   4                      SetOtherKBNeedUpdataFlag(cmdbk);
1015   4                  }
1016   3              }
1017   2                      //BROOKE0000: add start
1018   2                      if(cnt1flag == 1)
1019   2                      {
1020   3                              cnt1flag = 0;
1021   3                      Cmd_AE();
1022   3                      }
1023   2                      //BROOKE0000: add end
1024   2              Hook_Keyboard_Cmd_Parameter(nKB60DAT);
1025   2              return;
1026   2          }
1027   1      
1028   1          //-------------------------------------------------------------------------
1029   1          //Keyboard Command Process
1030   1          //-------------------------------------------------------------------------
1031   1          switch(nKB60DAT)
1032   1          {
1033   2          //  BROOKE0000: Start for clear output buffer before 0xFA ack to make sure kb function ok.
1034   2          //  and make sure command/data integrated. for example. cmd 0xF3, Ack 0xFA. 
1035   2               while(IS_MASK_SET(KBHISR,OBF))
1036   2              {
1037   3                  cnt1++;
1038   3                  if(cnt1>0xFE)
1039   3                  {
1040   4                      cnt1=0x00;
1041   4                      break;
1042   4                  }
1043   3                  if ((IS_MASK_SET(KBHICR,OBFKIE))&&(IS_MASK_SET(KBIRQR,IRQ1B)))
1044   3                  {
1045   4                      KBHICR &= 0xFC;
1046   4                      KBIRQR &= 0xFE;
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 18  

1047   4                      _nop_();
1048   4                      _nop_();
1049   4                      _nop_();
1050   4                  } 
1051   3                  else if ((IS_MASK_CLEAR(KBHICR,OBFKIE))&&(IS_MASK_CLEAR(KBIRQR,IRQ1B)))
1052   3                  {
1053   4                      KBHICR |= 0x01; 
1054   4                      _nop_();
1055   4                      _nop_();
1056   4                      _nop_();
1057   4                  }
1058   3                  if (IS_MASK_CLEAR(KBHISR,OBF))
1059   3                  {
1060   4                      Cmd_AD();
1061   4                                      cnt1flag = 1;
1062   4                      Clear_Key();
1063   4                      cnt1=0x00;
1064   4                      break;
1065   4                  }
1066   3              }
1067   2              //BROOKE0000:End
1068   2              KB_Command = 0x00;
1069   2              case 0xED:  /* Update LEDs command. */
1070   2                          ack = 0xFA;
1071   2                          KB_Command = 0xED;
1072   2                          break;
1073   2              case 0xEC:
1074   2                          ack = 0xFA;
1075   2                          break;
1076   2      
1077   2              case 0xEE:  /* ECHO command. */
1078   2                          ack = 0xEE;
1079   2                          break;
1080   2      
1081   2              case 0xF0:  /* Set alternate scan codes. */
1082   2                          ack = 0xFA;
1083   2                          KB_Command = 0xF0;
1084   2                          break;
1085   2      
1086   2              case 0xF2:  /* Read manufacturers ID */
1087   2                          ack = 0xFA;
1088   2                          ack1 = 0xAB;
1089   2                          if( Ccb42_XLATE_PC )
1090   2                          {
1091   3                              ack2 = 0x83;
1092   3                          }
1093   2                          else
1094   2                          {
1095   3                              ack2 = 0x41;
1096   3                          }
1097   2                          break;
1098   2      
1099   2              case 0xF3:  /* Set typematic rate/delay. */
1100   2                          ack = 0xFA;
1101   2                          KB_Command = 0xF3;
1102   2                          break;
1103   2      
1104   2              case 0xF4:  /* Enable scanning. */
1105   2                          KeyboardDriverIn = 1;
1106   2                          Clear_Key();
1107   2                          ack = 0xFA;
1108   2                          break;
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 19  

1109   2      
1110   2              case 0xF5:  /* Default disable. */
1111   2                          KeyboardDriverIn = 0;
1112   2                          Clear_Key();
1113   2                          Clear_Typematic();
1114   2                          ack = 0xFA;
1115   2                          break;
1116   2      
1117   2              case 0xF6:  /* Set defaults. */
1118   2                          Clear_Key();
1119   2                          Clear_Typematic();
1120   2                          ack = 0xFA;
1121   2                          break;
1122   2              case 0xF7:
1123   2              case 0xF8:
1124   2              case 0xF9:
1125   2              case 0xFA:
1126   2              case 0xFB:
1127   2                          ack = 0xFA;
1128   2                          break;
1129   2      
1130   2              case 0xFF:  /* Reset keyboard. */
1131   2                          KeyboardDriverIn = 0;
1132   2                          ScanAUXDevice(ScanKeyboardChannel); // Scan keyboard channel
1133   2                          Clear_Key();
1134   2                          Clear_Typematic();
1135   2                          Scanner_State = 0;
1136   2                          Clear_Fn_Keys();
1137   2                          ack = 0xFA;
1138   2                          ack1 = 0xAA;
1139   2      
1140   2                          for(index=0x00; index<3; index++)
1141   2                          {
1142   3                              if((Main_KB_CHN-1)!=index)
1143   3                              {
1144   4                                  if(IS_MASK_SET(AuxFlags[index], DEVICE_IS_KEYBOARD))
1145   4                                  {
1146   5                                      AuxFlags[index] = 0x00;
1147   5                                  }
1148   4                              }
1149   3                          }
1150   2      
1151   2                          #if KB_FnStickKey
                                  FnStickKey = 0;
                                  #endif
1154   2      
1155   2                          break;
1156   2      
1157   2              default:    //Unknown command request system resend
1158   2                          ack = 0xFE;
1159   2                          //KBCUnProcessCnt++;
1160   2                          //KBCUnProcessRec = nKB60DAT;
1161   2                          break;
1162   2      
1163   2          }
1164   1      
1165   1          if( Main_KB_CHN ==0x00)             // no any external keyboard
1166   1          {
1167   2              KBCmdAckByteCunt(0x00);
1168   2      
1169   2              if(ack != 0x00)
1170   2              {
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 20  

1171   3                  KBC_DataToHost(ack);
1172   3      
1173   3                  #if PS2_KBCMD
                              #ifdef UART_Debug
                              printf("EC KB ACK : 0X%bX\n",ack);
                              #endif
                          #endif
1178   3      
1179   3                  if(ack1 != 0x00)
1180   3                  {
1181   4                      KBC_DataPending(ack1);
1182   4      
1183   4                      #if PS2_KBCMD
                                  #ifdef UART_Debug
                                  printf("EC KB ACK : 0X%bX\n",ack1);
                                  #endif
                              #endif
1188   4      
1189   4                      if(ack2 != 0x00)
1190   4                      {
1191   5                          KBC_DataPending(ack2);
1192   5      
1193   5                          #if PS2_KBCMD
                                      #ifdef UART_Debug
                                      printf("EC KB ACK : 0X%bX\n",ack2);
                                      #endif
                                  #endif
1198   5                      }
1199   4                  }
1200   3              }
1201   2          }
1202   1          else                                    // Send command to external keyboard
1203   1          {
1204   2              CLEAR_MASK(AuxFlags[(Main_KB_CHN-1)], DEVICE_NEED_INIT);
1205   2              CLEAR_MASK(AuxFlags[(Main_KB_CHN-1)], DEVICE_NEED_CONFIG);
1206   2      
1207   2              if(nKB60DAT==0xFF)                  // reset command
1208   2              {
1209   3                  KBCmdAckByteCunt(0x02);
1210   3              }
1211   2              else
1212   2              {
1213   3                  if(nKB60DAT==0xF2)              // read keyboard ID command
1214   3                  {
1215   4                      KBCmdAckByteCunt(0x03);
1216   4                  }
1217   3                  else if((nKB60DAT==0xF3)||(nKB60DAT==0xED))
1218   3                  {
1219   4                      KBCmdAckByteCunt(0x02);
1220   4                  }
1221   3                  else                            // other
1222   3                  {
1223   4                      KBCmdAckByteCunt(0x01);
1224   4                  }
1225   3              }
1226   2      
1227   2                  Send2Port((Main_KB_CHN-1), nKB60DAT, SendCmdToKB);
1228   2      
1229   2              if((nKB60DAT==0xF4)||(nKB60DAT==0xF5))
1230   2              {
1231   3                  SetOtherKBNeedUpdataFlag(nKB60DAT);
1232   3              }
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 21  

1233   2          }
1234   1              //BROOKE0000: add start
1235   1              if(cnt1flag == 1)
1236   1              {
1237   2                      cnt1flag = 0;
1238   2              Cmd_AE();
1239   2              }
1240   1              //BROOKE0000: add end
1241   1          Hook_Keyboard_Cmd(nKB60DAT);
1242   1      }
1243          
1244          
1245          /* ----------------------------------------------------------------------------
1246           * FUNCTION: Set_Overlay_Mask
1247           *
1248           * Set the overlay state in the scanner_state variable and
1249           * set the led numlock and/or overlay bits for the LED data.
1250           *
1251           * Input: data = current LED data
1252           *        bit_state = 1 to set overlay/numlock bits
1253           *                  = 0 to clear overlay/numlock bits
1254           *
1255           * Return: updated LED data (num lock and overlay state updated)
1256           * ------------------------------------------------------------------------- */
1257          BBYTE Set_Overlay_Mask(BBYTE data_byte, FLAG bit_state)
1258          {
1259   1          BITS_8 temp;
1260   1          temp.byte = data_byte;
1261   1      
1262   1          if (Led_Ctrl_NUM) {
1263   2              temp.fbit.NUM = bit_state;
1264   2          }
1265   1      
1266   1          if (Led_Ctrl_OVL) {
1267   2              temp.fbit.OVL = bit_state;
1268   2          }
1269   1      
1270   1          data_byte = temp.byte;
1271   1          Scanner_State_NUM_LOCK = bit_state;
1272   1          //Ext_Cb3_OVL_STATE = bit_state;
1273   1      
1274   1          return(data_byte);
1275   1      }
1276          
1277          /* ----------------------------------------------------------------------------
1278           * FUNCTION: Read_Input_Port_1
1279           *
1280           * Read 8042 Input Port 1 and return its contents.
1281           *
1282           * Return: Byte from input port.
1283           *     Bit 7 = Keyboard not inhibited via switch.
1284           *     Bit 6 = Monochrome adapter (0 = Color/Graphics adapter).
1285           *     Bit 5 = Manufacturing jumper not installed.
1286           *     Bit 4 = Enable 2nd 256K of system board RAM.
1287           *     Bit 3 =
1288           *     Bit 2 =
1289           *     Bit 1 = Auxiliary data in line (PS/2 only).
1290           *     Bit 0 = Keyboard data in line (PS/2 only).
1291           * ------------------------------------------------------------------------- */
1292          //BYTE Read_Input_Port_1(void)
1293          //{
1294          //   return(0xBF);   //  Just return the compatibility value for now. //return (PCIN | 0x1F);
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 22  

1295          //}
1296          
1297          
1298          /* ----------------------------------------------------------------------------
1299           * FUNCTION: Read_Output_Port_2
1300           *
1301           * Read 8042 output port 2.
1302           *
1303           * Return: Byte from output port.
1304           *     Bit 7 = Keyboard data output line (inverted on PS/2).
1305           *     Bit 6 = Keyboard clock output line.
1306           *     Bit 5 = Input buffer empty (auxiliary interrupt IRQ12 on PS/2).
1307           *     Bit 4 = Output buffer full (Generates IRQ1).
1308           *     Bit 3 = Reserved (inverted auxiliary clock output line on PS/2).
1309           *     Bit 2 = Reserved (inverted auxiliary data output line on PS/2).
1310           *     Bit 1 = Gate A20.
1311           *     Bit 0 = System reset.
1312           * ------------------------------------------------------------------------- */
1313          BYTE Read_Output_Port_2(void)
1314          {
1315   1      #if 1
1316   1          BYTE p2byte;
1317   1      
1318   1          /* "data" will hold bits read from different inputs.
1319   1              Start with bit 0 set and set bits 2 and 3 for AT mode.
1320   1              If PS2 mode is being used, bits 2 and 3 will be changed. */
1321   1          p2byte = (1 << 3) | (1 << 2) | (1 << 0);
1322   1      
1323   1          //if (Ext_Cb0_PS2_AT)
1324   1          //{   /* If PS2 mode is enabled */
1325   1              /* Invert auxiliary keyboard data line (bit 7) and clear bits 2 and 3.
1326   1                 (Since bits 2 and 3 were set before, they can be cleared by inverting.) */
1327   1          //    p2byte^= 0x8C;
1328   1          //}
1329   1      
1330   1          return (p2byte);
1331   1      #else
              
                  BYTE data_byte;
              
                  /* "data" will hold bits read from different inputs.
                     Start with bit 0 set and set bits 2 and 3 for AT mode.
                     If PS2 mode is being used, bits 2 and 3 will be changed. */
                  data_byte = (1 << 3) | (1 << 2) | (1 << 0);
              
                  /* Put Gate A20 bit value into bit 1. */
              
                  if (Ext_Cb0_PS2_AT)
                  {   /* PS/2 mode is enabled 8/
                      /* Invert aux keyboard data line (bit 7) and clear bit[3:2]. (Since
                         bits 2 and 3 were set before, they can be cleared by inverting.) */
                      data_byte ^= 0x8C;
              
                      /* Put inverted auxiliary device (mouse) clock line in bit 3. */
              
                      /* Put inverted auxiliary device (mouse) data line in bit 2. */
                  } /* if (Ext_Cb0_PS2_AT) */
              
                  return (data_byte);
              #endif
1355   1      }
1356          
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 23  

1357          //----------------------------------------------------------------------------
1358          // The function of processing 60 port
1359          //----------------------------------------------------------------------------
1360          void Core_60Port(BYTE KBHIData)
1361          {
1362   1          switch(KBHIData)
1363   1          {
1364   2              case 0x60:
1365   2              Cmd_60Data();
1366   2              break;
1367   2      
1368   2              case 0x73:
1369   2              Cmd_73Data();
1370   2              break;
1371   2      
1372   2              case 0x74:
1373   2              Cmd_74Data();
1374   2              break;
1375   2      
1376   2              case 0x76:
1377   2              Cmd_76Data();
1378   2              break;
1379   2      
1380   2              case 0x77:
1381   2              Cmd_77Data();
1382   2              break;
1383   2      
1384   2              case 0x90:
1385   2              Cmd_90Data();
1386   2              break;
1387   2      
1388   2              case 0x91:
1389   2              Cmd_91Data();
1390   2              break;
1391   2      
1392   2              case 0x92:
1393   2              Cmd_92Data();
1394   2              break;
1395   2      
1396   2              case 0x93:
1397   2              Cmd_93Data();
1398   2              break;
1399   2      
1400   2              case 0xA5:
1401   2              Cmd_A5Data();
1402   2              break;
1403   2      
1404   2              case 0xD1:
1405   2              Cmd_D1Data();
1406   2              break;
1407   2      
1408   2              case 0xD2:
1409   2              Cmd_D2Data();
1410   2              break;
1411   2      
1412   2              case 0xD3:
1413   2              Cmd_D3Data();
1414   2              break;
1415   2      
1416   2              case 0xD4:
1417   2              Cmd_D4Data();
1418   2              break;
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 24  

1419   2      
1420   2              default:
1421   2              break;
1422   2          }
1423   1      }
1424          
1425          //----------------------------------------------------------------------------
1426          // The function of processing 64 port
1427          //----------------------------------------------------------------------------
1428          void Core_64Port(BYTE KBHICmd)
1429          {
1430   1          switch(KBHICmd)
1431   1          {
1432   2              case 0x20:
1433   2              Cmd_20();
1434   2              break;
1435   2      
1436   2              case 0x33:
1437   2              Cmd_33();
1438   2              break;
1439   2      
1440   2              case 0x34:
1441   2              Cmd_34();
1442   2              break;
1443   2      
1444   2              case 0x36:
1445   2              Cmd_36();
1446   2              break;
1447   2      
1448   2              case 0x37:
1449   2              Cmd_37();
1450   2              break;
1451   2      
1452   2              case 0x60:
1453   2              Cmd_60();
1454   2              break;
1455   2      
1456   2              case 0x73:
1457   2              Cmd_73();
1458   2              break;
1459   2      
1460   2              case 0x74:
1461   2              Cmd_74();
1462   2              break;
1463   2      
1464   2              case 0x76:
1465   2              Cmd_76();
1466   2              break;
1467   2      
1468   2              case 0x77:
1469   2              Cmd_77();
1470   2              break;
1471   2      
1472   2              case 0x90:
1473   2              Cmd_90();
1474   2              break;
1475   2      
1476   2              case 0x91:
1477   2              Cmd_91();
1478   2              break;
1479   2      
1480   2              case 0x92:
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 25  

1481   2              Cmd_92();
1482   2              break;
1483   2      
1484   2              case 0x93:
1485   2              Cmd_93();
1486   2              break;
1487   2      
1488   2              case 0xA4:
1489   2              Cmd_A4();
1490   2              break;
1491   2      
1492   2              case 0xA5:
1493   2              Cmd_A5();
1494   2              break;
1495   2      
1496   2              case 0xA6:
1497   2              Cmd_A6();
1498   2              break;
1499   2      
1500   2              case 0xA7:
1501   2              Cmd_A7();
1502   2              break;
1503   2      
1504   2              case 0xA8:
1505   2              Cmd_A8();
1506   2              break;
1507   2      
1508   2              case 0xA9:
1509   2              Cmd_A9();
1510   2              break;
1511   2      
1512   2              case 0xAA:
1513   2              Cmd_AA();
1514   2              break;
1515   2      
1516   2              case 0xAB:
1517   2              Cmd_AB();
1518   2              break;
1519   2      
1520   2              case 0xAC:
1521   2              Cmd_AC();
1522   2              break;
1523   2      
1524   2              case 0xAD:
1525   2              Cmd_AD();
1526   2              break;
1527   2      
1528   2              case 0xAE:
1529   2              Cmd_AE();
1530   2              break;
1531   2      
1532   2              case 0xAF:
1533   2              Cmd_AF();
1534   2              break;
1535   2      
1536   2              case 0xC0:
1537   2              Cmd_C0();
1538   2              break;
1539   2      
1540   2              case 0xD0:
1541   2              Cmd_D0();
1542   2              break;
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 26  

1543   2      
1544   2              case 0xD1:
1545   2              Cmd_D1();
1546   2              break;
1547   2      
1548   2              case 0xD2:
1549   2              Cmd_D2();
1550   2              break;
1551   2      
1552   2              case 0xD3:
1553   2              Cmd_D3();
1554   2              break;
1555   2      
1556   2              case 0xD4:
1557   2              Cmd_D4();
1558   2              break;
1559   2      
1560   2              case 0xE0:
1561   2              Cmd_E0();
1562   2              break;
1563   2      
1564   2              case 0xF0:
1565   2              case 0xF1:
1566   2              case 0xF2:
1567   2              case 0xF3:
1568   2              case 0xF4:
1569   2              case 0xF5:
1570   2              case 0xF6:
1571   2              case 0xF7:
1572   2              case 0xF8:
1573   2              case 0xF9:
1574   2              case 0xFA:
1575   2              case 0xFB:
1576   2              case 0xFC:
1577   2              case 0xFD:
1578   2              case 0xFE:
1579   2              case 0xFF:
1580   2              Cmd_FX();
1581   2              break;
1582   2      
1583   2              default:
1584   2              break;
1585   2          }
1586   1      }
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 27  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com0103 (BEGIN)
0000         L?0260:
0000 7800        E     MOV     R0,#LOW Main_KB_CHN
0002 E6                MOV     A,@R0
0003 2400        E     ADD     A,#LOW AuxFlags+0FFFFH
0005 F8                MOV     R0,A
0006 74FD              MOV     A,#0FDH
0008 56                ANL     A,@R0
0009 F6                MOV     @R0,A
000A 7800        E     MOV     R0,#LOW Main_KB_CHN
000C         L?0261:
000C E6                MOV     A,@R0
000D 2400        E     ADD     A,#LOW AuxFlags+0FFFFH
000F F8                MOV     R0,A
0010 74F7              MOV     A,#0F7H
0012 56                ANL     A,@R0
0013 F6                MOV     @R0,A
0014 22                RET     
0015         L?0262:
0015         L?0263:
0015 900000      R     MOV     DPTR,#ack
0018 74FA              MOV     A,#0FAH
001A F0                MOVX    @DPTR,A
001B 22                RET     
001C         L?0264:
001C         L?0265:
001C C28E              CLR     TR1
001E C28F              CLR     TF1
0020 D2AB              SETB    ET1
0022 22                RET     
0023         L?0266:
0023         L?0267:
0023 900000      E     MOV     DPTR,#KBHIMDOR
0026 74FC              MOV     A,#0FCH
0028 F0                MOVX    @DPTR,A
0029 22                RET     
002A         L?0268:
002A         L?0269:
002A E6                MOV     A,@R0
002B 14                DEC     A
002C FF                MOV     R7,A
002D 900000      R     MOV     DPTR,#nKB60DAT
0030 E0                MOVX    A,@DPTR
0031 22                RET     
0032         L?0270:
0032 758DC4            MOV     TH1,#0C4H
0035 758B1B            MOV     TL1,#01BH
0038 C28F              CLR     TF1
003A D28E              SETB    TR1
003C 22                RET     
003D         L?0271:
003D         L?0272:
003D 900000      E     MOV     DPTR,#KBHIDIR
0040 E0                MOVX    A,@DPTR
0041 F500        E     MOV     KBHIData,A
0043 22                RET     
0044         L?0273:
0044 900000      E     MOV     DPTR,#KBHISR
0047 F0                MOVX    @DPTR,A
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 28  

0048 7F05              MOV     R7,#05H
004A 22                RET     
             ; FUNCTION Com0103 (END)

             ; FUNCTION service_pci1 (BEGIN)
                                           ; SOURCE LINE # 18
                                           ; SOURCE LINE # 19
                                           ; SOURCE LINE # 20
0000 900000      E     MOV     DPTR,#KBHISR
0003 E0                MOVX    A,@DPTR
0004 30E16A            JNB     ACC.1,?C0002
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 23
0007         ?C0001:
                                           ; SOURCE LINE # 25
0007 900000      E     MOV     DPTR,#KBHISR
000A E0                MOVX    A,@DPTR
000B 30E31A            JNB     ACC.3,?C0003
                                           ; SOURCE LINE # 26
                                           ; SOURCE LINE # 27
000E E4                CLR     A
000F F500        E     MOV     KBHIStep,A
                                           ; SOURCE LINE # 28
0011 C200        E     CLR     KbdNeedResponseFlag
                                           ; SOURCE LINE # 29
0013 900000      E     MOV     DPTR,#KBHIDIR
0016 E0                MOVX    A,@DPTR
0017 F500        E     MOV     KBHICmd,A
                                           ; SOURCE LINE # 37
0019 AF00        E     MOV     R7,KBHICmd
001B 120000      R     LCALL   _Core_64Port
                                           ; SOURCE LINE # 38
001E AF00        E     MOV     R7,KBHICmd
0020 120000      E     LCALL   _Hook_64Port
                                           ; SOURCE LINE # 40
0023 300048      E     JNB     KbdNeedResponseFlag,?C0005
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 43
                                           ; SOURCE LINE # 44
                                           ; SOURCE LINE # 45
0026 8033              SJMP    ?C0245
0028         ?C0003:
                                           ; SOURCE LINE # 47
                                           ; SOURCE LINE # 48
0028 850000      E     MOV     KBHIData2,KBHIData1
                                           ; SOURCE LINE # 49
002B 850000      E     MOV     KBHIData1,KBHIData
                                           ; SOURCE LINE # 50
002E 120000      R     LCALL   L?0271
                                           ; SOURCE LINE # 58
0031 300014      E     JNB     FastA20,?C0006
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 60
0034 E500        E     MOV     A,KBHIData
0036 30E105            JNB     ACC.1,?C0007
                                           ; SOURCE LINE # 61
                                           ; SOURCE LINE # 62
0039 120000      E     LCALL   Hook_A20ON
                                           ; SOURCE LINE # 63
003C 8003              SJMP    ?C0008
003E         ?C0007:
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 29  

                                           ; SOURCE LINE # 65
                                           ; SOURCE LINE # 66
003E 120000      E     LCALL   Hook_A20OFF
                                           ; SOURCE LINE # 67
0041         ?C0008:
                                           ; SOURCE LINE # 68
0041 C200        E     CLR     FastA20
                                           ; SOURCE LINE # 69
0043 E4                CLR     A
0044 F500        E     MOV     KBHIStep,A
                                           ; SOURCE LINE # 70
0046 8026              SJMP    ?C0005
0048         ?C0006:
                                           ; SOURCE LINE # 72
                                           ; SOURCE LINE # 73
0048 E500        E     MOV     A,KBHIStep
004A 601A              JZ      ?C0010
                                           ; SOURCE LINE # 74
                                           ; SOURCE LINE # 75
004C AF00        E     MOV     R7,KBHICmd
004E 120000      R     LCALL   _Core_60Port
                                           ; SOURCE LINE # 76
0051 AF00        E     MOV     R7,KBHICmd
0053 120000      E     LCALL   _Hook_60Port
                                           ; SOURCE LINE # 77
0056 1500        E     DEC     KBHIStep
                                           ; SOURCE LINE # 78
0058 300013      E     JNB     KbdNeedResponseFlag,?C0005
                                           ; SOURCE LINE # 79
                                           ; SOURCE LINE # 80
005B         ?C0245:
005B C200        E     CLR     KbdNeedResponseFlag
                                           ; SOURCE LINE # 81
005D 7800        E     MOV     R0,#LOW KBHIReponse
005F E6                MOV     A,@R0
0060 FF                MOV     R7,A
0061 120000      E     LCALL   _KBC_DataToHost
                                           ; SOURCE LINE # 82
                                           ; SOURCE LINE # 83
0064 8008              SJMP    ?C0005
0066         ?C0010:
                                           ; SOURCE LINE # 85
                                           ; SOURCE LINE # 86
0066 120000      R     LCALL   Cmd_AE
                                           ; SOURCE LINE # 94
0069 AF00        E     MOV     R7,KBHIData
006B 120000      R     LCALL   _KeyboardCmd
                                           ; SOURCE LINE # 95
                                           ; SOURCE LINE # 96
                                           ; SOURCE LINE # 97
006E         ?C0005:
                                           ; SOURCE LINE # 99
006E 120000      E     LCALL   EnableKBCIBFInt
                                           ; SOURCE LINE # 100
0071         ?C0002:
0071 22                RET     
             ; FUNCTION service_pci1 (END)

             ; FUNCTION Cmd_20 (BEGIN)
                                           ; SOURCE LINE # 108
                                           ; SOURCE LINE # 110
                                           ; SOURCE LINE # 111
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 30  

0000 AF00        E     MOV     R7,Ccb42
0002 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_20 (END)

             ; FUNCTION Cmd_33 (BEGIN)
                                           ; SOURCE LINE # 120
                                           ; SOURCE LINE # 122
                                           ; SOURCE LINE # 123
0000 900000      E     MOV     DPTR,#Pass_On
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_33 (END)

             ; FUNCTION Cmd_34 (BEGIN)
                                           ; SOURCE LINE # 129
                                           ; SOURCE LINE # 131
                                           ; SOURCE LINE # 132
0000 900000      E     MOV     DPTR,#Pass_Off
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_34 (END)

             ; FUNCTION Cmd_36 (BEGIN)
                                           ; SOURCE LINE # 138
                                           ; SOURCE LINE # 140
                                           ; SOURCE LINE # 141
0000 900000      E     MOV     DPTR,#Pass_Make1
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_36 (END)

             ; FUNCTION Cmd_37 (BEGIN)
                                           ; SOURCE LINE # 147
                                           ; SOURCE LINE # 149
                                           ; SOURCE LINE # 150
0000 900000      E     MOV     DPTR,#Pass_Make2
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_37 (END)

             ; FUNCTION Cmd_60 (BEGIN)
                                           ; SOURCE LINE # 159
                                           ; SOURCE LINE # 161
                                           ; SOURCE LINE # 162
0000 7F01              MOV     R7,#01H
0002 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_60 (END)

             ; FUNCTION Cmd_73 (BEGIN)
                                           ; SOURCE LINE # 171
                                           ; SOURCE LINE # 173
                                           ; SOURCE LINE # 174
0000 7F01              MOV     R7,#01H
0002 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_73 (END)

             ; FUNCTION Cmd_74 (BEGIN)
                                           ; SOURCE LINE # 180
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 31  

                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 183
0000 7F01              MOV     R7,#01H
0002 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_74 (END)

             ; FUNCTION Cmd_76 (BEGIN)
                                           ; SOURCE LINE # 189
                                           ; SOURCE LINE # 191
                                           ; SOURCE LINE # 192
0000 7F01              MOV     R7,#01H
0002 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_76 (END)

             ; FUNCTION Cmd_77 (BEGIN)
                                           ; SOURCE LINE # 198
                                           ; SOURCE LINE # 200
                                           ; SOURCE LINE # 201
0000 7F01              MOV     R7,#01H
0002 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_77 (END)

             ; FUNCTION Cmd_90 (BEGIN)
                                           ; SOURCE LINE # 210
                                           ; SOURCE LINE # 212
                                           ; SOURCE LINE # 213
0000 7F01              MOV     R7,#01H
0002 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_90 (END)

             ; FUNCTION Cmd_91 (BEGIN)
                                           ; SOURCE LINE # 219
                                           ; SOURCE LINE # 221
                                           ; SOURCE LINE # 222
0000 7F01              MOV     R7,#01H
0002 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_91 (END)

             ; FUNCTION Cmd_92 (BEGIN)
                                           ; SOURCE LINE # 228
                                           ; SOURCE LINE # 230
                                           ; SOURCE LINE # 231
0000 7F01              MOV     R7,#01H
0002 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_92 (END)

             ; FUNCTION Cmd_93 (BEGIN)
                                           ; SOURCE LINE # 237
                                           ; SOURCE LINE # 239
                                           ; SOURCE LINE # 240
0000 7F01              MOV     R7,#01H
0002 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_93 (END)

             ; FUNCTION Cmd_A4 (BEGIN)
                                           ; SOURCE LINE # 250
                                           ; SOURCE LINE # 252
                                           ; SOURCE LINE # 253
0000 7800        E     MOV     R0,#LOW Flag
0002 E6                MOV     A,@R0
0003 13                RRC     A
0004 13                RRC     A
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 32  

0005 543F              ANL     A,#03FH
0007 30E004            JNB     ACC.0,?C0027
                                           ; SOURCE LINE # 254
                                           ; SOURCE LINE # 255
000A 7FFA              MOV     R7,#0FAH
                                           ; SOURCE LINE # 256
000C 8002              SJMP    ?C0246
000E         ?C0027:
                                           ; SOURCE LINE # 258
                                           ; SOURCE LINE # 259
000E 7FF1              MOV     R7,#0F1H
0010         ?C0246:
0010 120000      R     LCALL   _ResponseKBData
                                           ; SOURCE LINE # 260
                                           ; SOURCE LINE # 261
0013         ?C0029:
0013 22                RET     
             ; FUNCTION Cmd_A4 (END)

             ; FUNCTION Cmd_A5 (BEGIN)
                                           ; SOURCE LINE # 266
                                           ; SOURCE LINE # 268
                                           ; SOURCE LINE # 269
0000 E4                CLR     A
0001 F500        E     MOV     Tmp_Load,A
                                           ; SOURCE LINE # 270
0003 7F08              MOV     R7,#08H
0005 020000      R     LJMP    _SetHandleCmdData
             ; FUNCTION Cmd_A5 (END)

             ; FUNCTION Cmd_A6 (BEGIN)
                                           ; SOURCE LINE # 276
                                           ; SOURCE LINE # 278
                                           ; SOURCE LINE # 279
0000 7800        E     MOV     R0,#LOW Flag
0002 E6                MOV     A,@R0
0003 13                RRC     A
0004 13                RRC     A
0005 543F              ANL     A,#03FH
0007 30E012            JNB     ACC.0,?C0031
                                           ; SOURCE LINE # 280
                                           ; SOURCE LINE # 281
000A D200        E     SETB    Gen_Info_PASS_ENABLE
                                           ; SOURCE LINE # 282
000C E4                CLR     A
000D 900000      E     MOV     DPTR,#Pass_Buff_Idx
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 283
0011 E6                MOV     A,@R0
0012 54FE              ANL     A,#0FEH
0014 F6                MOV     @R0,A
                                           ; SOURCE LINE # 284
0015 900000      E     MOV     DPTR,#Pass_On
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
                                           ; SOURCE LINE # 285
001A 8002              SJMP    ?C0247
001C         ?C0031:
                                           ; SOURCE LINE # 287
                                           ; SOURCE LINE # 288
001C E4                CLR     A
001D FF                MOV     R7,A
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 33  

001E         ?C0247:
001E 120000      R     LCALL   _ResponseKBData
                                           ; SOURCE LINE # 289
                                           ; SOURCE LINE # 290
0021         ?C0033:
0021 22                RET     
             ; FUNCTION Cmd_A6 (END)

             ; FUNCTION Cmd_A7 (BEGIN)
                                           ; SOURCE LINE # 295
                                           ; SOURCE LINE # 297
                                           ; SOURCE LINE # 298
0000 D200        E     SETB    Ccb42_DISAB_AUX
                                           ; SOURCE LINE # 299
0002 22                RET     
             ; FUNCTION Cmd_A7 (END)

             ; FUNCTION Cmd_A8 (BEGIN)
                                           ; SOURCE LINE # 304
                                           ; SOURCE LINE # 306
                                           ; SOURCE LINE # 307
0000 C200        E     CLR     Ccb42_DISAB_AUX
                                           ; SOURCE LINE # 308
0002 22                RET     
             ; FUNCTION Cmd_A8 (END)

             ; FUNCTION Cmd_A9 (BEGIN)
                                           ; SOURCE LINE # 319
                                           ; SOURCE LINE # 321
                                           ; SOURCE LINE # 322
0000 C200        E     CLR     MULPX_Multiplex
                                           ; SOURCE LINE # 323
0002 E4                CLR     A
0003 FF                MOV     R7,A
0004 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_A9 (END)

             ; FUNCTION Cmd_AA (BEGIN)
                                           ; SOURCE LINE # 330
                                           ; SOURCE LINE # 332
                                           ; SOURCE LINE # 334
0000 7F01              MOV     R7,#01H
0002 120000      E     LCALL   _ScanAUXDevice
                                           ; SOURCE LINE # 339
0005 C200        E     CLR     MULPX_Multiplex
                                           ; SOURCE LINE # 341
0007 7F55              MOV     R7,#055H
0009 020000      E     LJMP    _Data_To_Host
             ; FUNCTION Cmd_AA (END)

             ; FUNCTION Cmd_AB (BEGIN)
                                           ; SOURCE LINE # 354
                                           ; SOURCE LINE # 356
                                           ; SOURCE LINE # 357
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_AB (END)

             ; FUNCTION Cmd_AC (BEGIN)
                                           ; SOURCE LINE # 363
                                           ; SOURCE LINE # 365
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 34  

                                           ; SOURCE LINE # 368
0000 22                RET     
             ; FUNCTION Cmd_AC (END)

             ; FUNCTION Cmd_AD (BEGIN)
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 375
                                           ; SOURCE LINE # 376
0000 D200        E     SETB    Ccb42_DISAB_KEY
                                           ; SOURCE LINE # 377
0002 7800        E     MOV     R0,#LOW Flag
0004 E6                MOV     A,@R0
0005 4401              ORL     A,#01H
0007 F6                MOV     @R0,A
                                           ; SOURCE LINE # 378
0008 020000      E     LJMP    Lock_Scan
             ; FUNCTION Cmd_AD (END)

             ; FUNCTION Cmd_AE (BEGIN)
                                           ; SOURCE LINE # 385
                                           ; SOURCE LINE # 387
                                           ; SOURCE LINE # 388
0000 C200        E     CLR     Ccb42_DISAB_KEY
                                           ; SOURCE LINE # 389
0002 7800        E     MOV     R0,#LOW Flag
0004 E6                MOV     A,@R0
0005 54FE              ANL     A,#0FEH
0007 F6                MOV     @R0,A
                                           ; SOURCE LINE # 390
0008 22                RET     
             ; FUNCTION Cmd_AE (END)

             ; FUNCTION Cmd_AF (BEGIN)
                                           ; SOURCE LINE # 395
                                           ; SOURCE LINE # 397
                                           ; SOURCE LINE # 399
0000 22                RET     
             ; FUNCTION Cmd_AF (END)

             ; FUNCTION Cmd_C0 (BEGIN)
                                           ; SOURCE LINE # 417
                                           ; SOURCE LINE # 419
                                           ; SOURCE LINE # 420
0000 7FBF              MOV     R7,#0BFH
0002 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_C0 (END)

             ; FUNCTION Cmd_D0 (BEGIN)
                                           ; SOURCE LINE # 430
                                           ; SOURCE LINE # 432
                                           ; SOURCE LINE # 433
0000 120000      R     LCALL   Read_Output_Port_2
0003 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_D0 (END)

             ; FUNCTION Cmd_D1 (BEGIN)
                                           ; SOURCE LINE # 439
                                           ; SOURCE LINE # 441
                                           ; SOURCE LINE # 442
0000 D200        E     SETB    FastA20
                                           ; SOURCE LINE # 444
0002 22                RET     
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 35  

             ; FUNCTION Cmd_D1 (END)

             ; FUNCTION Cmd_D2 (BEGIN)
                                           ; SOURCE LINE # 449
                                           ; SOURCE LINE # 451
                                           ; SOURCE LINE # 452
0000 C28E              CLR     TR1
                                           ; SOURCE LINE # 453
0002 C2AB              CLR     ET1
                                           ; SOURCE LINE # 454
0004 00                NOP     
                                           ; SOURCE LINE # 455
0005 00                NOP     
                                           ; SOURCE LINE # 456
0006 00                NOP     
                                           ; SOURCE LINE # 457
0007 00                NOP     
                                           ; SOURCE LINE # 458
                                           ; SOURCE LINE # 459
                                           ; SOURCE LINE # 460
                                           ; SOURCE LINE # 461
0008 120000      R     LCALL   L?0270
000B         ?C0046:
                                           ; SOURCE LINE # 463
000B 208F17            JB      TF1,?C0047
                                           ; SOURCE LINE # 464
                                           ; SOURCE LINE # 465
000E 900000      E     MOV     DPTR,#KBHISR
0011 E0                MOVX    A,@DPTR
0012 30E1F6            JNB     ACC.1,?C0046
                                           ; SOURCE LINE # 466
                                           ; SOURCE LINE # 467
0015 E0                MOVX    A,@DPTR
0016 20E308            JB      ACC.3,?C0049
                                           ; SOURCE LINE # 468
                                           ; SOURCE LINE # 469
0019 120000      R     LCALL   L?0271
                                           ; SOURCE LINE # 470
001C AF00        E     MOV     R7,KBHIData
001E 120000      E     LCALL   _Data_To_Host
                                           ; SOURCE LINE # 471
0021         ?C0049:
                                           ; SOURCE LINE # 472
                                           ; SOURCE LINE # 473
                                           ; SOURCE LINE # 474
0021 120000      R     LCALL   L?0264
0024 22                RET     
                                           ; SOURCE LINE # 476
                                           ; SOURCE LINE # 477
0025         ?C0047:
                                           ; SOURCE LINE # 479
                                           ; SOURCE LINE # 480
                                           ; SOURCE LINE # 481
0025 120000      R     LCALL   L?0264
                                           ; SOURCE LINE # 482
0028 7F01              MOV     R7,#01H
002A 120000      R     LCALL   _SetHandleCmdData
                                           ; SOURCE LINE # 483
002D         ?C0050:
002D 22                RET     
             ; FUNCTION Cmd_D2 (END)

C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 36  

             ; FUNCTION Cmd_D3 (BEGIN)
                                           ; SOURCE LINE # 488
                                           ; SOURCE LINE # 490
                                           ; SOURCE LINE # 491
0000 C28E              CLR     TR1
                                           ; SOURCE LINE # 492
0002 C2AB              CLR     ET1
                                           ; SOURCE LINE # 493
0004 00                NOP     
                                           ; SOURCE LINE # 494
0005 00                NOP     
                                           ; SOURCE LINE # 495
0006 00                NOP     
                                           ; SOURCE LINE # 496
0007 00                NOP     
                                           ; SOURCE LINE # 497
                                           ; SOURCE LINE # 498
                                           ; SOURCE LINE # 499
                                           ; SOURCE LINE # 500
0008 120000      R     LCALL   L?0270
000B         ?C0051:
                                           ; SOURCE LINE # 502
000B 208F17            JB      TF1,?C0052
                                           ; SOURCE LINE # 503
                                           ; SOURCE LINE # 504
000E 900000      E     MOV     DPTR,#KBHISR
0011 E0                MOVX    A,@DPTR
0012 30E1F6            JNB     ACC.1,?C0051
                                           ; SOURCE LINE # 505
                                           ; SOURCE LINE # 506
0015 E0                MOVX    A,@DPTR
0016 20E308            JB      ACC.3,?C0054
                                           ; SOURCE LINE # 507
                                           ; SOURCE LINE # 508
0019 120000      R     LCALL   L?0272
                                           ; SOURCE LINE # 512
001C AF00        E     MOV     R7,KBHIData
001E 120000      E     LCALL   _Aux_Data_To_Host
                                           ; SOURCE LINE # 514
0021         ?C0054:
                                           ; SOURCE LINE # 515
                                           ; SOURCE LINE # 516
                                           ; SOURCE LINE # 517
0021 120000      R     LCALL   L?0265
0024 22                RET     
                                           ; SOURCE LINE # 519
                                           ; SOURCE LINE # 520
0025         ?C0052:
                                           ; SOURCE LINE # 522
                                           ; SOURCE LINE # 523
                                           ; SOURCE LINE # 524
0025 120000      R     LCALL   L?0265
                                           ; SOURCE LINE # 525
0028 7F01              MOV     R7,#01H
002A 120000      R     LCALL   _SetHandleCmdData
                                           ; SOURCE LINE # 526
002D         ?C0055:
002D 22                RET     
             ; FUNCTION Cmd_D3 (END)

             ; FUNCTION Cmd_D4 (BEGIN)
                                           ; SOURCE LINE # 531
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 37  

                                           ; SOURCE LINE # 533
                                           ; SOURCE LINE # 534
0000 7F01              MOV     R7,#01H
0002 120000      R     LCALL   _SetHandleCmdData
                                           ; SOURCE LINE # 535
0005 C200        E     CLR     MULPX_Multiplex
                                           ; SOURCE LINE # 536
0007 22                RET     
             ; FUNCTION Cmd_D4 (END)

             ; FUNCTION Cmd_E0 (BEGIN)
                                           ; SOURCE LINE # 544
                                           ; SOURCE LINE # 546
                                           ; SOURCE LINE # 547
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002 020000      R     LJMP    _ResponseKBData
             ; FUNCTION Cmd_E0 (END)

             ; FUNCTION Cmd_FX (BEGIN)
                                           ; SOURCE LINE # 553
                                           ; SOURCE LINE # 554
                                           ; SOURCE LINE # 555
0000 E500        E     MOV     A,KBHICmd
0002 20E012            JB      ACC.0,?C0059
                                           ; SOURCE LINE # 556
                                           ; SOURCE LINE # 558
0005 120000      E     LCALL   Hook_A20ON
                                           ; SOURCE LINE # 559
0008 120000      E     LCALL   Hook_KBRSTON
                                           ; SOURCE LINE # 561
000B E4                CLR     A
000C 900000      E     MOV     DPTR,#WNCKR
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 562
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 563
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 564
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 565
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 566
0014 120000      E     LCALL   Hook_KBRSTOFF
                                           ; SOURCE LINE # 567
                                           ; SOURCE LINE # 568
0017         ?C0059:
0017 22                RET     
             ; FUNCTION Cmd_FX (END)

             ; FUNCTION Cmd_60Data (BEGIN)
                                           ; SOURCE LINE # 576
                                           ; SOURCE LINE # 577
                                           ; SOURCE LINE # 578
0000 850000      E     MOV     Ccb42,KBHIData
                                           ; SOURCE LINE # 593
0003 300005      E     JNB     Ccb42_DISAB_KEY,?C0060
                                           ; SOURCE LINE # 594
                                           ; SOURCE LINE # 595
0006 120000      R     LCALL   Cmd_AD
                                           ; SOURCE LINE # 596
0009 8003              SJMP    ?C0061
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 38  

000B         ?C0060:
                                           ; SOURCE LINE # 598
                                           ; SOURCE LINE # 599
000B 120000      R     LCALL   Cmd_AE
                                           ; SOURCE LINE # 600
000E         ?C0061:
                                           ; SOURCE LINE # 603
000E 900000      E     MOV     DPTR,#KBHISR
0011 E0                MOVX    A,@DPTR
0012 300004      E     JNB     Ccb42_SYS_FLAG,?C0062
                                           ; SOURCE LINE # 604
0015 4404              ORL     A,#04H
0017 F0                MOVX    @DPTR,A
0018 22                RET     
0019         ?C0062:
                                           ; SOURCE LINE # 606
0019 54FB              ANL     A,#0FBH
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 607
001C         ?C0064:
001C 22                RET     
             ; FUNCTION Cmd_60Data (END)

             ; FUNCTION Cmd_73Data (BEGIN)
                                           ; SOURCE LINE # 615
                                           ; SOURCE LINE # 616
                                           ; SOURCE LINE # 617
0000 900000      E     MOV     DPTR,#Pass_On
0003 E500        E     MOV     A,KBHIData
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 618
0006 22                RET     
             ; FUNCTION Cmd_73Data (END)

             ; FUNCTION Cmd_74Data (BEGIN)
                                           ; SOURCE LINE # 623
                                           ; SOURCE LINE # 624
                                           ; SOURCE LINE # 625
0000 900000      E     MOV     DPTR,#Pass_Off
0003 E500        E     MOV     A,KBHIData
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 626
0006 22                RET     
             ; FUNCTION Cmd_74Data (END)

             ; FUNCTION Cmd_76Data (BEGIN)
                                           ; SOURCE LINE # 631
                                           ; SOURCE LINE # 632
                                           ; SOURCE LINE # 633
0000 900000      E     MOV     DPTR,#Pass_Make1
0003 E500        E     MOV     A,KBHIData
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 634
0006 22                RET     
             ; FUNCTION Cmd_76Data (END)

             ; FUNCTION Cmd_77Data (BEGIN)
                                           ; SOURCE LINE # 639
                                           ; SOURCE LINE # 640
                                           ; SOURCE LINE # 641
0000 900000      E     MOV     DPTR,#Pass_Make2
0003 E500        E     MOV     A,KBHIData
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 39  

0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 642
0006 22                RET     
             ; FUNCTION Cmd_77Data (END)

             ; FUNCTION Cmd_90Data (BEGIN)
                                           ; SOURCE LINE # 651
                                           ; SOURCE LINE # 652
                                           ; SOURCE LINE # 653
                                           ; SOURCE LINE # 654
                                           ; SOURCE LINE # 656
                                           ; SOURCE LINE # 658
0000         ?C0069:
                                           ; SOURCE LINE # 672
0000 E500        E     MOV     A,KBHIData
0002 B4FF05            CJNE    A,#0FFH,?C0070
                                           ; SOURCE LINE # 673
                                           ; SOURCE LINE # 674
0005 E4                CLR     A
0006 FF                MOV     R7,A
0007 120000      E     LCALL   _ScanAUXDevice
                                           ; SOURCE LINE # 675
000A         ?C0070:
                                           ; SOURCE LINE # 677
000A 900000      E     MOV     DPTR,#KBHISR
000D 7424              MOV     A,#024H
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 678
0010 900000      E     MOV     DPTR,#KBHICR
0013 E0                MOVX    A,@DPTR
0014 54FC              ANL     A,#0FCH
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 679
0017 300004      E     JNB     Ccb42_INTR_AUX,?C0071
                                           ; SOURCE LINE # 680
                                           ; SOURCE LINE # 681
001A E0                MOVX    A,@DPTR
001B 4402              ORL     A,#02H
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 682
001E         ?C0071:
                                           ; SOURCE LINE # 684
001E 7F05              MOV     R7,#05H
0020 120000      E     LCALL   _DelayXms
                                           ; SOURCE LINE # 685
0023 120000      R     LCALL   L?0266
                                           ; SOURCE LINE # 687
0026 AF00        E     MOV     R7,KBHIData
0028 020000      E     LJMP    _Hook_Mouse_90Cmd
             ; FUNCTION Cmd_90Data (END)

             ; FUNCTION Cmd_91Data (BEGIN)
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 694
                                           ; SOURCE LINE # 695
                                           ; SOURCE LINE # 696
                                           ; SOURCE LINE # 698
                                           ; SOURCE LINE # 700
0000         ?C0073:
                                           ; SOURCE LINE # 702
0000 7800        E     MOV     R0,#LOW AuxFlags
0002 E6                MOV     A,@R0
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 40  

0003 30E707            JNB     ACC.7,?C0074
                                           ; SOURCE LINE # 703
                                           ; SOURCE LINE # 704
0006 E4                CLR     A
0007 FF                MOV     R7,A
0008 120000      E     LCALL   _SendCmdtoMUX
                                           ; SOURCE LINE # 705
000B 800B              SJMP    ?C0075
000D         ?C0074:
                                           ; SOURCE LINE # 707
                                           ; SOURCE LINE # 708
000D 7440              MOV     A,#040H
                                           ; SOURCE LINE # 709
000F 120000      R     LCALL   L?0273
0012 120000      E     LCALL   _DelayXms
                                           ; SOURCE LINE # 710
0015 120000      R     LCALL   L?0266
                                           ; SOURCE LINE # 711
0018         ?C0075:
                                           ; SOURCE LINE # 713
0018 AF00        E     MOV     R7,KBHIData
001A 020000      E     LJMP    _Hook_Mouse_91Cmd
             ; FUNCTION Cmd_91Data (END)

             ; FUNCTION Cmd_92Data (BEGIN)
                                           ; SOURCE LINE # 719
                                           ; SOURCE LINE # 720
                                           ; SOURCE LINE # 721
                                           ; SOURCE LINE # 722
                                           ; SOURCE LINE # 724
                                           ; SOURCE LINE # 726
0000         ?C0077:
                                           ; SOURCE LINE # 728
0000 7800        E     MOV     R0,#LOW AuxFlags+01H
0002 E6                MOV     A,@R0
0003 30E707            JNB     ACC.7,?C0078
                                           ; SOURCE LINE # 729
                                           ; SOURCE LINE # 730
0006 7F01              MOV     R7,#01H
0008 120000      E     LCALL   _SendCmdtoMUX
                                           ; SOURCE LINE # 731
000B 800B              SJMP    ?C0079
000D         ?C0078:
                                           ; SOURCE LINE # 733
                                           ; SOURCE LINE # 734
000D 7480              MOV     A,#080H
                                           ; SOURCE LINE # 735
000F 120000      R     LCALL   L?0273
0012 120000      E     LCALL   _DelayXms
                                           ; SOURCE LINE # 736
0015 120000      R     LCALL   L?0267
                                           ; SOURCE LINE # 737
0018         ?C0079:
                                           ; SOURCE LINE # 739
0018 AF00        E     MOV     R7,KBHIData
001A 020000      E     LJMP    _Hook_Mouse_92Cmd
             ; FUNCTION Cmd_92Data (END)

             ; FUNCTION Cmd_93Data (BEGIN)
                                           ; SOURCE LINE # 745
                                           ; SOURCE LINE # 746
                                           ; SOURCE LINE # 747
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 41  

                                           ; SOURCE LINE # 748
                                           ; SOURCE LINE # 750
                                           ; SOURCE LINE # 752
0000         ?C0081:
                                           ; SOURCE LINE # 754
0000 7800        E     MOV     R0,#LOW AuxFlags+02H
0002 E6                MOV     A,@R0
0003 30E707            JNB     ACC.7,?C0082
                                           ; SOURCE LINE # 755
                                           ; SOURCE LINE # 756
0006 7F02              MOV     R7,#02H
0008 120000      E     LCALL   _SendCmdtoMUX
                                           ; SOURCE LINE # 757
000B 800E              SJMP    ?C0083
000D         ?C0082:
                                           ; SOURCE LINE # 759
                                           ; SOURCE LINE # 760
000D 900000      E     MOV     DPTR,#KBHISR
0010 74C0              MOV     A,#0C0H
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 761
0013 7F05              MOV     R7,#05H
0015 120000      E     LCALL   _DelayXms
                                           ; SOURCE LINE # 762
0018 120000      R     LCALL   L?0267
                                           ; SOURCE LINE # 763
001B         ?C0083:
                                           ; SOURCE LINE # 765
001B AF00        E     MOV     R7,KBHIData
001D 020000      E     LJMP    _Hook_Mouse_93Cmd
             ; FUNCTION Cmd_93Data (END)

             ; FUNCTION Cmd_A5Data (BEGIN)
                                           ; SOURCE LINE # 776
                                           ; SOURCE LINE # 777
                                           ; SOURCE LINE # 778
0000 E500        E     MOV     A,Tmp_Load
0002 700B              JNZ     ?C0085
0004 E500        E     MOV     A,KBHIData
0006 7007              JNZ     ?C0085
                                           ; SOURCE LINE # 779
                                           ; SOURCE LINE # 780
0008 7800        E     MOV     R0,#LOW Flag
000A E6                MOV     A,@R0
000B 54FB              ANL     A,#0FBH
000D F6                MOV     @R0,A
                                           ; SOURCE LINE # 783
000E 22                RET     
000F         ?C0085:
                                           ; SOURCE LINE # 785
                                           ; SOURCE LINE # 786
000F E500        E     MOV     A,Tmp_Load
0011 C3                CLR     C
0012 9408              SUBB    A,#08H
0014 5011              JNC     ?C0087
                                           ; SOURCE LINE # 787
                                           ; SOURCE LINE # 788
0016 AF00        E     MOV     R7,Tmp_Load
0018 7400        E     MOV     A,#LOW Pass_Buff
001A 2F                ADD     A,R7
001B F582              MOV     DPL,A
001D E4                CLR     A
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 42  

001E 3400        E     ADDC    A,#HIGH Pass_Buff
0020 F583              MOV     DPH,A
0022 E500        E     MOV     A,KBHIData
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 789
0025 0500        E     INC     Tmp_Load
                                           ; SOURCE LINE # 790
0027         ?C0087:
                                           ; SOURCE LINE # 792
0027 E500        E     MOV     A,KBHIData
0029 7006              JNZ     ?C0089
                                           ; SOURCE LINE # 793
                                           ; SOURCE LINE # 795
002B 7800        E     MOV     R0,#LOW Flag
002D E6                MOV     A,@R0
002E 4404              ORL     A,#04H
0030 F6                MOV     @R0,A
                                           ; SOURCE LINE # 796
                                           ; SOURCE LINE # 797
                                           ; SOURCE LINE # 798
0031         ?C0089:
0031 22                RET     
             ; FUNCTION Cmd_A5Data (END)

             ; FUNCTION Cmd_D1Data (BEGIN)
                                           ; SOURCE LINE # 806
                                           ; SOURCE LINE # 807
                                           ; SOURCE LINE # 808
0000 E500        E     MOV     A,KBHIData
0002 30E103            JNB     ACC.1,?C0090
                                           ; SOURCE LINE # 809
                                           ; SOURCE LINE # 810
0005 020000      E     LJMP    Hook_A20ON
                                           ; SOURCE LINE # 811
0008         ?C0090:
                                           ; SOURCE LINE # 813
                                           ; SOURCE LINE # 814
0008 120000      E     LCALL   Hook_A20OFF
                                           ; SOURCE LINE # 815
                                           ; SOURCE LINE # 816
000B         ?C0092:
000B 22                RET     
             ; FUNCTION Cmd_D1Data (END)

             ; FUNCTION Cmd_D2Data (BEGIN)
                                           ; SOURCE LINE # 821
                                           ; SOURCE LINE # 822
                                           ; SOURCE LINE # 823
0000 AF00        E     MOV     R7,KBHIData
0002 020000      E     LJMP    _Data_To_Host
             ; FUNCTION Cmd_D2Data (END)

             ; FUNCTION Cmd_D3Data (BEGIN)
                                           ; SOURCE LINE # 829
                                           ; SOURCE LINE # 830
                                           ; SOURCE LINE # 834
0000 AF00        E     MOV     R7,KBHIData
0002 020000      E     LJMP    _Aux_Data_To_Host
             ; FUNCTION Cmd_D3Data (END)

             ; FUNCTION Cmd_D4Data (BEGIN)
                                           ; SOURCE LINE # 841
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 43  

                                           ; SOURCE LINE # 842
                                           ; SOURCE LINE # 843
                                           ; SOURCE LINE # 844
                                           ; SOURCE LINE # 846
                                           ; SOURCE LINE # 848
0000         ?C0095:
                                           ; SOURCE LINE # 849
0000 E500        E     MOV     A,KBHIData
0002 B4FF05            CJNE    A,#0FFH,?C0096
                                           ; SOURCE LINE # 850
                                           ; SOURCE LINE # 851
0005 7F01              MOV     R7,#01H
0007 120000      E     LCALL   _ScanAUXDevice
                                           ; SOURCE LINE # 852
000A         ?C0096:
                                           ; SOURCE LINE # 854
000A 7800        E     MOV     R0,#LOW Main_MOUSE_CHN
000C E6                MOV     A,@R0
000D 6017              JZ      ?C0097
                                           ; SOURCE LINE # 855
                                           ; SOURCE LINE # 856
000F E6                MOV     A,@R0
0010 2400        E     ADD     A,#LOW AuxFlags+0FFFFH
0012 F8                MOV     R0,A
0013 74FD              MOV     A,#0FDH
0015 56                ANL     A,@R0
0016 F6                MOV     @R0,A
                                           ; SOURCE LINE # 857
0017 7800        E     MOV     R0,#LOW Main_MOUSE_CHN
0019 120000      R     LCALL   L?0261
                                           ; SOURCE LINE # 858
001C 7800        E     MOV     R0,#LOW Main_MOUSE_CHN
001E E6                MOV     A,@R0
001F 14                DEC     A
0020 FF                MOV     R7,A
0021 120000      E     LCALL   _SendCmdtoMouse
                                           ; SOURCE LINE # 859
0024 800A              SJMP    ?C0098
0026         ?C0097:
                                           ; SOURCE LINE # 861
                                           ; SOURCE LINE # 862
0026 7F14              MOV     R7,#014H
0028 120000      E     LCALL   _DelayXms
                                           ; SOURCE LINE # 866
002B 7FFC              MOV     R7,#0FCH
002D 120000      E     LCALL   _SendFromAux
                                           ; SOURCE LINE # 868
0030         ?C0098:
                                           ; SOURCE LINE # 870
0030 AF00        E     MOV     R7,KBHIData
0032 020000      E     LJMP    _Hook_Mouse_D4Cmd
             ; FUNCTION Cmd_D4Data (END)

             ; FUNCTION _ResponseKBData (BEGIN)
                                           ; SOURCE LINE # 876
;---- Variable 'RData' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 877
                                           ; SOURCE LINE # 878
0000 7800        E     MOV     R0,#LOW KBHIReponse
0002 EF                MOV     A,R7
0003 F6                MOV     @R0,A
                                           ; SOURCE LINE # 879
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 44  

0004 D200        E     SETB    KbdNeedResponseFlag
                                           ; SOURCE LINE # 880
0006 22                RET     
             ; FUNCTION _ResponseKBData (END)

             ; FUNCTION _SetHandleCmdData (BEGIN)
                                           ; SOURCE LINE # 885
;---- Variable 'step' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 886
                                           ; SOURCE LINE # 887
0000 8F00        E     MOV     KBHIStep,R7
                                           ; SOURCE LINE # 888
0002 22                RET     
             ; FUNCTION _SetHandleCmdData (END)

             ; FUNCTION _KeyboardCmd (BEGIN)
                                           ; SOURCE LINE # 897
0000 900000      R     MOV     DPTR,#nKB60DAT
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 898
                                           ; SOURCE LINE # 900
0005 E4                CLR     A
0006 900000      R     MOV     DPTR,#cnt1
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 901
000A A3                INC     DPTR
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 902
000C FF                MOV     R7,A
000D 120000      E     LCALL   _KBCmdAckByteCunt
                                           ; SOURCE LINE # 903
0010 E4                CLR     A
0011 900000      R     MOV     DPTR,#ack
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 904
0015 A3                INC     DPTR
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 905
0017 A3                INC     DPTR
0018 F0                MOVX    @DPTR,A
0019         ?C0102:
                                           ; SOURCE LINE # 908
0019 900000      E     MOV     DPTR,#KBHISR
001C E0                MOVX    A,@DPTR
001D 30E05D            JNB     ACC.0,?C0103
                                           ; SOURCE LINE # 909
                                           ; SOURCE LINE # 910
0020 900000      R     MOV     DPTR,#cnt1
0023 E0                MOVX    A,@DPTR
0024 04                INC     A
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 911
0026 E0                MOVX    A,@DPTR
0027 D3                SETB    C
0028 94FE              SUBB    A,#0FEH
002A 4004              JC      ?C0104
                                           ; SOURCE LINE # 912
                                           ; SOURCE LINE # 913
002C E4                CLR     A
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 914
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 45  

002E 804D              SJMP    ?C0103
                                           ; SOURCE LINE # 915
0030         ?C0104:
                                           ; SOURCE LINE # 917
0030 900000      E     MOV     DPTR,#KBHICR
0033 E0                MOVX    A,@DPTR
0034 30E016            JNB     ACC.0,?C0105
0037 900000      E     MOV     DPTR,#KBIRQR
003A E0                MOVX    A,@DPTR
003B 30E00F            JNB     ACC.0,?C0105
                                           ; SOURCE LINE # 918
                                           ; SOURCE LINE # 919
003E 900000      E     MOV     DPTR,#KBHICR
0041 E0                MOVX    A,@DPTR
0042 54FC              ANL     A,#0FCH
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 920
0045 900000      E     MOV     DPTR,#KBIRQR
0048 E0                MOVX    A,@DPTR
0049 54FE              ANL     A,#0FEH
                                           ; SOURCE LINE # 921
                                           ; SOURCE LINE # 922
                                           ; SOURCE LINE # 923
                                           ; SOURCE LINE # 924
004B 8014              SJMP    ?C0249
004D         ?C0105:
                                           ; SOURCE LINE # 925
004D 900000      E     MOV     DPTR,#KBHICR
0050 E0                MOVX    A,@DPTR
0051 20E011            JB      ACC.0,?C0106
0054 900000      E     MOV     DPTR,#KBIRQR
0057 E0                MOVX    A,@DPTR
0058 20E00A            JB      ACC.0,?C0106
                                           ; SOURCE LINE # 926
                                           ; SOURCE LINE # 927
005B 900000      E     MOV     DPTR,#KBHICR
005E E0                MOVX    A,@DPTR
005F 4401              ORL     A,#01H
0061         ?C0249:
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 929
0062 00                NOP     
                                           ; SOURCE LINE # 930
0063 00                NOP     
                                           ; SOURCE LINE # 931
0064 00                NOP     
                                           ; SOURCE LINE # 932
0065         ?C0106:
                                           ; SOURCE LINE # 933
0065 900000      E     MOV     DPTR,#KBHISR
0068 E0                MOVX    A,@DPTR
0069 20E0AD            JB      ACC.0,?C0102
                                           ; SOURCE LINE # 934
                                           ; SOURCE LINE # 935
006C 120000      R     LCALL   Cmd_AD
                                           ; SOURCE LINE # 936
006F 900000      R     MOV     DPTR,#cnt1flag
0072 7401              MOV     A,#01H
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 937
0075 120000      E     LCALL   Clear_Key
                                           ; SOURCE LINE # 938
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 46  

0078 E4                CLR     A
0079 900000      R     MOV     DPTR,#cnt1
007C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 939
                                           ; SOURCE LINE # 940
                                           ; SOURCE LINE # 941
007D         ?C0103:
                                           ; SOURCE LINE # 946
007D 7800        E     MOV     R0,#LOW KB_Command
007F E6                MOV     A,@R0
0080 7003              JNZ     $ + 5H
0082 020000      R     LJMP    ?C0109
                                           ; SOURCE LINE # 947
                                           ; SOURCE LINE # 948
0085 E6                MOV     A,@R0
0086 900000      R     MOV     DPTR,#cmdbk
0089 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 950
008A E6                MOV     A,@R0
008B 2410              ADD     A,#010H
008D 6021              JZ      ?C0112
008F 24FD              ADD     A,#0FDH
0091 6027              JZ      ?C0113
0093 2406              ADD     A,#06H
0095 703D              JNZ     ?C0114
                                           ; SOURCE LINE # 951
                                           ; SOURCE LINE # 952
0097         ?C0111:
                                           ; SOURCE LINE # 953
0097 900000      R     MOV     DPTR,#nKB60DAT
009A E0                MOVX    A,@DPTR
009B F500        E     MOV     Led_Data,A
                                           ; SOURCE LINE # 954
009D A3                INC     DPTR
009E 74FA              MOV     A,#0FAH
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 955
00A1 E4                CLR     A
00A2 7800        E     MOV     R0,#LOW KB_Command
00A4 F6                MOV     @R0,A
                                           ; SOURCE LINE # 956
00A5 AF00        E     MOV     R7,Led_Data
00A7 120000      E     LCALL   _OEM_Write_Leds
                                           ; SOURCE LINE # 959
00AA A200        E     MOV     C,Led_Data_NUM
00AC 9200        E     MOV     Scanner_State_NUM_LOCK,C
                                           ; SOURCE LINE # 960
00AE 802A              SJMP    ?C0110
                                           ; SOURCE LINE # 961
00B0         ?C0112:
                                           ; SOURCE LINE # 962
00B0 900000      R     MOV     DPTR,#nKB60DAT
00B3 E0                MOVX    A,@DPTR
00B4 7800        E     MOV     R0,#LOW KB_CodeSet
00B6 F6                MOV     @R0,A
                                           ; SOURCE LINE # 963
00B7 A3                INC     DPTR
                                           ; SOURCE LINE # 964
                                           ; SOURCE LINE # 965
00B8 8011              SJMP    ?C0250
                                           ; SOURCE LINE # 966
00BA         ?C0113:
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 47  

                                           ; SOURCE LINE # 967
00BA 900000      R     MOV     DPTR,#nKB60DAT
00BD E0                MOVX    A,@DPTR
00BE 7800        E     MOV     R0,#LOW PS2KB_Typematic
00C0 F6                MOV     @R0,A
                                           ; SOURCE LINE # 968
00C1 E6                MOV     A,@R0
00C2 FF                MOV     R7,A
00C3 7E00              MOV     R6,#00H
00C5 120000      E     LCALL   _Set_Typematic
                                           ; SOURCE LINE # 969
00C8 900000      R     MOV     DPTR,#ack
00CB         ?C0250:
00CB 74FA              MOV     A,#0FAH
00CD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 970
00CE E4                CLR     A
00CF 7800        E     MOV     R0,#LOW KB_Command
00D1 F6                MOV     @R0,A
                                           ; SOURCE LINE # 971
00D2 8006              SJMP    ?C0110
                                           ; SOURCE LINE # 972
00D4         ?C0114:
                                           ; SOURCE LINE # 973
00D4 900000      R     MOV     DPTR,#ack
00D7 74FE              MOV     A,#0FEH
00D9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 975
                                           ; SOURCE LINE # 976
00DA         ?C0110:
                                           ; SOURCE LINE # 978
00DA 900000      R     MOV     DPTR,#cmdbk
00DD E0                MOVX    A,@DPTR
00DE FF                MOV     R7,A
00DF 64F3              XRL     A,#0F3H
00E1 6004              JZ      ?C0116
00E3 EF                MOV     A,R7
00E4 B4ED02            CJNE    A,#0EDH,?C0115
00E7         ?C0116:
                                           ; SOURCE LINE # 979
                                           ; SOURCE LINE # 980
00E7 D200        E     SETB    KeyboardDriverIn
                                           ; SOURCE LINE # 981
00E9         ?C0115:
                                           ; SOURCE LINE # 983
00E9 7800        E     MOV     R0,#LOW Main_KB_CHN
00EB E6                MOV     A,@R0
00EC 700C              JNZ     ?C0117
                                           ; SOURCE LINE # 984
                                           ; SOURCE LINE # 985
00EE 900000      R     MOV     DPTR,#ack
00F1 E0                MOVX    A,@DPTR
00F2 FF                MOV     R7,A
00F3 6036              JZ      ?C0119
                                           ; SOURCE LINE # 986
                                           ; SOURCE LINE # 987
00F5 120000      E     LCALL   _KBC_DataToHost
                                           ; SOURCE LINE # 993
                                           ; SOURCE LINE # 994
00F8 8031              SJMP    ?C0119
00FA         ?C0117:
                                           ; SOURCE LINE # 996
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 48  

                                           ; SOURCE LINE # 998
                                           ; SOURCE LINE # 999
00FA 120000      R     LCALL   L?0260
                                           ; SOURCE LINE # 1001
00FD 7F01              MOV     R7,#01H
00FF 120000      E     LCALL   _KBCmdAckByteCunt
                                           ; SOURCE LINE # 1003
0102 900000      R     MOV     DPTR,#cmdbk
0105 E0                MOVX    A,@DPTR
0106 7800        E     MOV     R0,#LOW Main_KB_CHN
0108 B4ED07            CJNE    A,#0EDH,?C0120
                                           ; SOURCE LINE # 1004
                                           ; SOURCE LINE # 1005
010B 120000      R     LCALL   L?0268
010E 5407              ANL     A,#07H
                                           ; SOURCE LINE # 1006
0110 8003              SJMP    ?C0248
0112         ?C0120:
                                           ; SOURCE LINE # 1008
                                           ; SOURCE LINE # 1009
0112 120000      R     LCALL   L?0268
0115         ?C0248:
0115 FD                MOV     R5,A
0116 7B01              MOV     R3,#01H
0118 120000      E     LCALL   _Send2Port
                                           ; SOURCE LINE # 1010
011B         ?C0121:
                                           ; SOURCE LINE # 1012
011B 900000      R     MOV     DPTR,#cmdbk
011E E0                MOVX    A,@DPTR
011F FF                MOV     R7,A
0120 64F3              XRL     A,#0F3H
0122 6004              JZ      ?C0123
0124 EF                MOV     A,R7
0125 B4ED03            CJNE    A,#0EDH,?C0119
0128         ?C0123:
                                           ; SOURCE LINE # 1013
                                           ; SOURCE LINE # 1014
0128 120000      E     LCALL   _SetOtherKBNeedUpdataFlag
                                           ; SOURCE LINE # 1015
                                           ; SOURCE LINE # 1016
012B         ?C0119:
                                           ; SOURCE LINE # 1018
012B 900000      R     MOV     DPTR,#cnt1flag
012E E0                MOVX    A,@DPTR
012F B40105            CJNE    A,#01H,?C0124
                                           ; SOURCE LINE # 1019
                                           ; SOURCE LINE # 1020
0132 E4                CLR     A
0133 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1021
0134 120000      R     LCALL   Cmd_AE
                                           ; SOURCE LINE # 1022
0137         ?C0124:
                                           ; SOURCE LINE # 1024
0137 900000      R     MOV     DPTR,#nKB60DAT
013A E0                MOVX    A,@DPTR
013B FF                MOV     R7,A
013C 020000      E     LJMP    _Hook_Keyboard_Cmd_Parameter
                                           ; SOURCE LINE # 1026
013F         ?C0109:
                                           ; SOURCE LINE # 1031
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 49  

013F 900000      R     MOV     DPTR,#nKB60DAT
0142 E0                MOVX    A,@DPTR
0143 120000      E     LCALL   ?C?CCASE
0146 0000        R     DW      ?C0135
0148 EC                DB      0ECH
0149 0000        R     DW      ?C0134
014B ED                DB      0EDH
014C 0000        R     DW      ?C0136
014E EE                DB      0EEH
014F 0000        R     DW      ?C0137
0151 F0                DB      0F0H
0152 0000        R     DW      ?C0138
0154 F2                DB      0F2H
0155 0000        R     DW      ?C0141
0157 F3                DB      0F3H
0158 0000        R     DW      ?C0142
015A F4                DB      0F4H
015B 0000        R     DW      ?C0143
015D F5                DB      0F5H
015E 0000        R     DW      ?C0144
0160 F6                DB      0F6H
0161 0000        R     DW      ?C0135
0163 F7                DB      0F7H
0164 0000        R     DW      ?C0135
0166 F8                DB      0F8H
0167 0000        R     DW      ?C0135
0169 F9                DB      0F9H
016A 0000        R     DW      ?C0135
016C FA                DB      0FAH
016D 0000        R     DW      ?C0135
016F FB                DB      0FBH
0170 0000        R     DW      ?C0150
0172 FF                DB      0FFH
0173 0000              DW      00H
0175 0000        R     DW      ?C0156
                                           ; SOURCE LINE # 1032
                                           ; SOURCE LINE # 1036
                                           ; SOURCE LINE # 1037
                                           ; SOURCE LINE # 1039
                                           ; SOURCE LINE # 1040
                                           ; SOURCE LINE # 1042
                                           ; SOURCE LINE # 1044
                                           ; SOURCE LINE # 1045
                                           ; SOURCE LINE # 1052
                                           ; SOURCE LINE # 1053
                                           ; SOURCE LINE # 1059
                                           ; SOURCE LINE # 1060
0177         ?C0134:
                                           ; SOURCE LINE # 1070
0177 120000      R     LCALL   L?0262
                                           ; SOURCE LINE # 1071
017A 7800        E     MOV     R0,#LOW KB_Command
017C 76ED              MOV     @R0,#0EDH
                                           ; SOURCE LINE # 1072
017E 020000      R     LJMP    ?C0126
                                           ; SOURCE LINE # 1073
0181         ?C0135:
                                           ; SOURCE LINE # 1074
                                           ; SOURCE LINE # 1075
0181 8047              SJMP    ?C0252
                                           ; SOURCE LINE # 1077
0183         ?C0136:
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 50  

                                           ; SOURCE LINE # 1078
0183 900000      R     MOV     DPTR,#ack
0186 74EE              MOV     A,#0EEH
0188 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1079
0189 020000      R     LJMP    ?C0126
                                           ; SOURCE LINE # 1081
018C         ?C0137:
                                           ; SOURCE LINE # 1082
018C 120000      R     LCALL   L?0262
                                           ; SOURCE LINE # 1083
018F 7800        E     MOV     R0,#LOW KB_Command
0191 76F0              MOV     @R0,#0F0H
                                           ; SOURCE LINE # 1084
0193 020000      R     LJMP    ?C0126
                                           ; SOURCE LINE # 1086
0196         ?C0138:
                                           ; SOURCE LINE # 1087
0196 120000      R     LCALL   L?0263
                                           ; SOURCE LINE # 1088
0199 A3                INC     DPTR
019A 74AB              MOV     A,#0ABH
019C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1089
019D 300006      E     JNB     Ccb42_XLATE_PC,?C0139
                                           ; SOURCE LINE # 1090
                                           ; SOURCE LINE # 1091
01A0 A3                INC     DPTR
01A1 7483              MOV     A,#083H
01A3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1092
01A4 8067              SJMP    ?C0126
01A6         ?C0139:
                                           ; SOURCE LINE # 1094
                                           ; SOURCE LINE # 1095
01A6 900000      R     MOV     DPTR,#ack2
01A9 7441              MOV     A,#041H
01AB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1096
                                           ; SOURCE LINE # 1097
01AC 805F              SJMP    ?C0126
                                           ; SOURCE LINE # 1099
01AE         ?C0141:
                                           ; SOURCE LINE # 1100
01AE 120000      R     LCALL   L?0263
                                           ; SOURCE LINE # 1101
01B1 7800        E     MOV     R0,#LOW KB_Command
01B3 76F3              MOV     @R0,#0F3H
                                           ; SOURCE LINE # 1102
01B5 8056              SJMP    ?C0126
                                           ; SOURCE LINE # 1104
01B7         ?C0142:
                                           ; SOURCE LINE # 1105
01B7 D200        E     SETB    KeyboardDriverIn
                                           ; SOURCE LINE # 1106
01B9 120000      E     LCALL   Clear_Key
                                           ; SOURCE LINE # 1107
                                           ; SOURCE LINE # 1108
01BC 800C              SJMP    ?C0254
                                           ; SOURCE LINE # 1110
01BE         ?C0143:
                                           ; SOURCE LINE # 1111
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 51  

01BE C200        E     CLR     KeyboardDriverIn
                                           ; SOURCE LINE # 1112
                                           ; SOURCE LINE # 1113
01C0 120000      R     LCALL   L?0274
                                           ; SOURCE LINE # 1114
01C3         ?C0253:
                                           ; SOURCE LINE # 1115
01C3 8005              SJMP    ?C0254
                                           ; SOURCE LINE # 1117
01C5         ?C0144:
                                           ; SOURCE LINE # 1118
                                           ; SOURCE LINE # 1119
01C5 120000      R     LCALL   L?0274
                                           ; SOURCE LINE # 1120
                                           ; SOURCE LINE # 1121
01C8 8000              SJMP    ?C0255
                                           ; SOURCE LINE # 1122
                                           ; SOURCE LINE # 1123
                                           ; SOURCE LINE # 1124
                                           ; SOURCE LINE # 1125
                                           ; SOURCE LINE # 1126
01CA         ?C0252:
01CA         ?C0254:
01CA         ?C0255:
01CA 120000      R     LCALL   L?0263
                                           ; SOURCE LINE # 1128
01CD 803E              SJMP    ?C0126
                                           ; SOURCE LINE # 1130
01CF         ?C0150:
                                           ; SOURCE LINE # 1131
01CF C200        E     CLR     KeyboardDriverIn
                                           ; SOURCE LINE # 1132
01D1 7F02              MOV     R7,#02H
01D3 120000      E     LCALL   _ScanAUXDevice
                                           ; SOURCE LINE # 1133
01D6 120000      E     LCALL   Clear_Key
                                           ; SOURCE LINE # 1134
01D9 120000      E     LCALL   Clear_Typematic
                                           ; SOURCE LINE # 1135
01DC E4                CLR     A
01DD F500        E     MOV     Scanner_State,A
                                           ; SOURCE LINE # 1136
01DF 120000      E     LCALL   Clear_Fn_Keys
                                           ; SOURCE LINE # 1137
01E2 120000      R     LCALL   L?0263
                                           ; SOURCE LINE # 1138
01E5 A3                INC     DPTR
01E6 74AA              MOV     A,#0AAH
01E8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1140
;---- Variable 'index' assigned to Register 'R7' ----
01E9 E4                CLR     A
01EA FF                MOV     R7,A
01EB         ?C0151:
                                           ; SOURCE LINE # 1141
                                           ; SOURCE LINE # 1142
01EB 7800        E     MOV     R0,#LOW Main_KB_CHN
01ED E6                MOV     A,@R0
01EE 14                DEC     A
01EF 6F                XRL     A,R7
01F0 600E              JZ      ?C0153
                                           ; SOURCE LINE # 1143
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 52  

                                           ; SOURCE LINE # 1144
01F2 7400        E     MOV     A,#LOW AuxFlags
01F4 2F                ADD     A,R7
01F5 F8                MOV     R0,A
01F6 E6                MOV     A,@R0
01F7 30E606            JNB     ACC.6,?C0153
                                           ; SOURCE LINE # 1145
                                           ; SOURCE LINE # 1146
01FA 7400        E     MOV     A,#LOW AuxFlags
01FC 2F                ADD     A,R7
01FD F8                MOV     R0,A
01FE E4                CLR     A
01FF F6                MOV     @R0,A
                                           ; SOURCE LINE # 1147
                                           ; SOURCE LINE # 1148
                                           ; SOURCE LINE # 1149
0200         ?C0153:
0200 0F                INC     R7
0201 EF                MOV     A,R7
0202 B403E6            CJNE    A,#03H,?C0151
0205 8006              SJMP    ?C0126
                                           ; SOURCE LINE # 1155
                                           ; SOURCE LINE # 1157
0207         ?C0156:
                                           ; SOURCE LINE # 1158
0207 900000      R     MOV     DPTR,#ack
020A 74FE              MOV     A,#0FEH
020C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1161
                                           ; SOURCE LINE # 1163
020D         ?C0126:
                                           ; SOURCE LINE # 1165
020D 7800        E     MOV     R0,#LOW Main_KB_CHN
020F E6                MOV     A,@R0
0210 7024              JNZ     ?C0157
                                           ; SOURCE LINE # 1166
                                           ; SOURCE LINE # 1167
0212 FF                MOV     R7,A
0213 120000      E     LCALL   _KBCmdAckByteCunt
                                           ; SOURCE LINE # 1169
0216 900000      R     MOV     DPTR,#ack
0219 E0                MOVX    A,@DPTR
021A FF                MOV     R7,A
021B 6061              JZ      ?C0161
                                           ; SOURCE LINE # 1170
                                           ; SOURCE LINE # 1171
021D 120000      E     LCALL   _KBC_DataToHost
                                           ; SOURCE LINE # 1179
0220 900000      R     MOV     DPTR,#ack1
0223 E0                MOVX    A,@DPTR
0224 FF                MOV     R7,A
0225 6057              JZ      ?C0161
                                           ; SOURCE LINE # 1180
                                           ; SOURCE LINE # 1181
0227 120000      E     LCALL   _KBC_DataPending
                                           ; SOURCE LINE # 1189
022A 900000      R     MOV     DPTR,#ack2
022D E0                MOVX    A,@DPTR
022E FF                MOV     R7,A
022F 604D              JZ      ?C0161
                                           ; SOURCE LINE # 1190
                                           ; SOURCE LINE # 1191
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 53  

0231 120000      E     LCALL   _KBC_DataPending
                                           ; SOURCE LINE # 1198
                                           ; SOURCE LINE # 1199
                                           ; SOURCE LINE # 1200
                                           ; SOURCE LINE # 1201
0234 8048              SJMP    ?C0161
0236         ?C0157:
                                           ; SOURCE LINE # 1203
                                           ; SOURCE LINE # 1204
                                           ; SOURCE LINE # 1205
0236 120000      R     LCALL   L?0260
                                           ; SOURCE LINE # 1207
0239 900000      R     MOV     DPTR,#nKB60DAT
023C E0                MOVX    A,@DPTR
023D B4FF02            CJNE    A,#0FFH,?C0162
                                           ; SOURCE LINE # 1208
                                           ; SOURCE LINE # 1209
                                           ; SOURCE LINE # 1210
0240 8018              SJMP    ?C0256
0242         ?C0162:
                                           ; SOURCE LINE # 1212
                                           ; SOURCE LINE # 1213
0242 900000      R     MOV     DPTR,#nKB60DAT
0245 E0                MOVX    A,@DPTR
0246 B4F204            CJNE    A,#0F2H,?C0164
                                           ; SOURCE LINE # 1214
                                           ; SOURCE LINE # 1215
0249 7F03              MOV     R7,#03H
                                           ; SOURCE LINE # 1216
024B 8013              SJMP    ?C0258
024D         ?C0164:
                                           ; SOURCE LINE # 1217
024D 900000      R     MOV     DPTR,#nKB60DAT
0250 E0                MOVX    A,@DPTR
0251 FF                MOV     R7,A
0252 64F3              XRL     A,#0F3H
0254 6004              JZ      ?C0167
0256 EF                MOV     A,R7
0257 B4ED04            CJNE    A,#0EDH,?C0166
025A         ?C0167:
                                           ; SOURCE LINE # 1218
                                           ; SOURCE LINE # 1219
025A         ?C0256:
025A 7F02              MOV     R7,#02H
025C         ?C0257:
                                           ; SOURCE LINE # 1220
025C 8002              SJMP    ?C0258
025E         ?C0166:
                                           ; SOURCE LINE # 1222
                                           ; SOURCE LINE # 1223
025E 7F01              MOV     R7,#01H
0260         ?C0258:
0260 120000      E     LCALL   _KBCmdAckByteCunt
                                           ; SOURCE LINE # 1224
                                           ; SOURCE LINE # 1225
0263         ?C0163:
                                           ; SOURCE LINE # 1227
0263 7800        E     MOV     R0,#LOW Main_KB_CHN
0265 120000      R     LCALL   L?0269
0268 FD                MOV     R5,A
0269 7B01              MOV     R3,#01H
026B 120000      E     LCALL   _Send2Port
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 54  

                                           ; SOURCE LINE # 1229
026E 900000      R     MOV     DPTR,#nKB60DAT
0271 E0                MOVX    A,@DPTR
0272 FF                MOV     R7,A
0273 64F4              XRL     A,#0F4H
0275 6004              JZ      ?C0170
0277 EF                MOV     A,R7
0278 B4F503            CJNE    A,#0F5H,?C0161
027B         ?C0170:
                                           ; SOURCE LINE # 1230
                                           ; SOURCE LINE # 1231
027B 120000      E     LCALL   _SetOtherKBNeedUpdataFlag
                                           ; SOURCE LINE # 1232
                                           ; SOURCE LINE # 1233
027E         ?C0161:
                                           ; SOURCE LINE # 1235
027E 900000      R     MOV     DPTR,#cnt1flag
0281 E0                MOVX    A,@DPTR
0282 B40105            CJNE    A,#01H,?C0171
                                           ; SOURCE LINE # 1236
                                           ; SOURCE LINE # 1237
0285 E4                CLR     A
0286 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1238
0287 120000      R     LCALL   Cmd_AE
                                           ; SOURCE LINE # 1239
028A         ?C0171:
                                           ; SOURCE LINE # 1241
028A 900000      R     MOV     DPTR,#nKB60DAT
028D E0                MOVX    A,@DPTR
028E FF                MOV     R7,A
028F 120000      E     LCALL   _Hook_Keyboard_Cmd
                                           ; SOURCE LINE # 1242
0292         ?C0125:
0292 22                RET     
0293         L?0274:
0293 120000      E     LCALL   Clear_Key
0296 120000      E     LCALL   Clear_Typematic
0299 22                RET     
             ; FUNCTION _KeyboardCmd (END)

             ; FUNCTION _Set_Overlay_Mask (BEGIN)
                                           ; SOURCE LINE # 1257
0000 900000      R     MOV     DPTR,#data_byte
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1258
                                           ; SOURCE LINE # 1260
0008 900000      R     MOV     DPTR,#data_byte
000B E0                MOVX    A,@DPTR
000C 7800        R     MOV     R0,#LOW temp
000E F6                MOV     @R0,A
                                           ; SOURCE LINE # 1262
000F 30000C      E     JNB     Led_Ctrl_NUM,?C0172
                                           ; SOURCE LINE # 1263
0012 A3                INC     DPTR
0013 E0                MOVX    A,@DPTR
0014 5401              ANL     A,#01H
0016 25E0              ADD     A,ACC
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 55  

0018 FF                MOV     R7,A
0019 E6                MOV     A,@R0
001A 54FD              ANL     A,#0FDH
001C 4F                ORL     A,R7
001D F6                MOV     @R0,A
                                           ; SOURCE LINE # 1264
001E         ?C0172:
                                           ; SOURCE LINE # 1266
001E 300013      E     JNB     Led_Ctrl_OVL,?C0173
                                           ; SOURCE LINE # 1267
0021 900000      R     MOV     DPTR,#bit_state
0024 E0                MOVX    A,@DPTR
0025 5401              ANL     A,#01H
0027 33                RLC     A
0028 33                RLC     A
0029 33                RLC     A
002A 54F8              ANL     A,#0F8H
002C FF                MOV     R7,A
002D 7800        R     MOV     R0,#LOW temp
002F E6                MOV     A,@R0
0030 54F7              ANL     A,#0F7H
0032 4F                ORL     A,R7
0033 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1268
0034         ?C0173:
                                           ; SOURCE LINE # 1270
0034 7800        R     MOV     R0,#LOW temp
0036 E6                MOV     A,@R0
0037 900000      R     MOV     DPTR,#data_byte
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1271
003B A3                INC     DPTR
003C E0                MOVX    A,@DPTR
003D 24FF              ADD     A,#0FFH
003F 9200        E     MOV     Scanner_State_NUM_LOCK,C
                                           ; SOURCE LINE # 1274
0041 900000      R     MOV     DPTR,#data_byte
0044 E0                MOVX    A,@DPTR
0045 FF                MOV     R7,A
                                           ; SOURCE LINE # 1275
0046         ?C0174:
0046 22                RET     
             ; FUNCTION _Set_Overlay_Mask (END)

             ; FUNCTION Read_Output_Port_2 (BEGIN)
                                           ; SOURCE LINE # 1313
                                           ; SOURCE LINE # 1314
                                           ; SOURCE LINE # 1321
;---- Variable 'p2byte' assigned to Register 'R7' ----
0000 7F0D              MOV     R7,#0DH
                                           ; SOURCE LINE # 1330
                                           ; SOURCE LINE # 1355
0002         ?C0175:
0002 22                RET     
             ; FUNCTION Read_Output_Port_2 (END)

             ; FUNCTION _Core_60Port (BEGIN)
                                           ; SOURCE LINE # 1360
;---- Variable 'KBHIData' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1361
                                           ; SOURCE LINE # 1362
0000 EF                MOV     A,R7
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 56  

0001 120000      E     LCALL   ?C?CCASE
0004 0000        R     DW      ?C0177
0006 60                DB      060H
0007 0000        R     DW      ?C0178
0009 73                DB      073H
000A 0000        R     DW      ?C0179
000C 74                DB      074H
000D 0000        R     DW      ?C0180
000F 76                DB      076H
0010 0000        R     DW      ?C0181
0012 77                DB      077H
0013 0000        R     DW      ?C0182
0015 90                DB      090H
0016 0000        R     DW      ?C0183
0018 91                DB      091H
0019 0000        R     DW      ?C0184
001B 92                DB      092H
001C 0000        R     DW      ?C0185
001E 93                DB      093H
001F 0000        R     DW      ?C0186
0021 A5                DB      0A5H
0022 0000        R     DW      ?C0187
0024 D1                DB      0D1H
0025 0000        R     DW      ?C0188
0027 D2                DB      0D2H
0028 0000        R     DW      ?C0189
002A D3                DB      0D3H
002B 0000        R     DW      ?C0190
002D D4                DB      0D4H
002E 0000              DW      00H
0030 0000        R     DW      ?C0192
                                           ; SOURCE LINE # 1363
                                           ; SOURCE LINE # 1364
0032         ?C0177:
                                           ; SOURCE LINE # 1365
0032 020000      R     LJMP    Cmd_60Data
                                           ; SOURCE LINE # 1366
                                           ; SOURCE LINE # 1368
0035         ?C0178:
                                           ; SOURCE LINE # 1369
0035 020000      R     LJMP    Cmd_73Data
                                           ; SOURCE LINE # 1370
                                           ; SOURCE LINE # 1372
0038         ?C0179:
                                           ; SOURCE LINE # 1373
0038 020000      R     LJMP    Cmd_74Data
                                           ; SOURCE LINE # 1374
                                           ; SOURCE LINE # 1376
003B         ?C0180:
                                           ; SOURCE LINE # 1377
003B 020000      R     LJMP    Cmd_76Data
                                           ; SOURCE LINE # 1378
                                           ; SOURCE LINE # 1380
003E         ?C0181:
                                           ; SOURCE LINE # 1381
003E 020000      R     LJMP    Cmd_77Data
                                           ; SOURCE LINE # 1382
                                           ; SOURCE LINE # 1384
0041         ?C0182:
                                           ; SOURCE LINE # 1385
0041 020000      R     LJMP    Cmd_90Data
                                           ; SOURCE LINE # 1386
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 57  

                                           ; SOURCE LINE # 1388
0044         ?C0183:
                                           ; SOURCE LINE # 1389
0044 020000      R     LJMP    Cmd_91Data
                                           ; SOURCE LINE # 1390
                                           ; SOURCE LINE # 1392
0047         ?C0184:
                                           ; SOURCE LINE # 1393
0047 020000      R     LJMP    Cmd_92Data
                                           ; SOURCE LINE # 1394
                                           ; SOURCE LINE # 1396
004A         ?C0185:
                                           ; SOURCE LINE # 1397
004A 020000      R     LJMP    Cmd_93Data
                                           ; SOURCE LINE # 1398
                                           ; SOURCE LINE # 1400
004D         ?C0186:
                                           ; SOURCE LINE # 1401
004D 020000      R     LJMP    Cmd_A5Data
                                           ; SOURCE LINE # 1402
                                           ; SOURCE LINE # 1404
0050         ?C0187:
                                           ; SOURCE LINE # 1405
0050 020000      R     LJMP    Cmd_D1Data
                                           ; SOURCE LINE # 1406
                                           ; SOURCE LINE # 1408
0053         ?C0188:
                                           ; SOURCE LINE # 1409
0053 020000      R     LJMP    Cmd_D2Data
                                           ; SOURCE LINE # 1410
                                           ; SOURCE LINE # 1412
0056         ?C0189:
                                           ; SOURCE LINE # 1413
0056 020000      R     LJMP    Cmd_D3Data
                                           ; SOURCE LINE # 1414
                                           ; SOURCE LINE # 1416
0059         ?C0190:
                                           ; SOURCE LINE # 1417
0059 120000      R     LCALL   Cmd_D4Data
                                           ; SOURCE LINE # 1418
                                           ; SOURCE LINE # 1420
                                           ; SOURCE LINE # 1421
                                           ; SOURCE LINE # 1422
                                           ; SOURCE LINE # 1423
005C         ?C0192:
005C 22                RET     
             ; FUNCTION _Core_60Port (END)

             ; FUNCTION _Core_64Port (BEGIN)
                                           ; SOURCE LINE # 1428
;---- Variable 'KBHICmd' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1429
                                           ; SOURCE LINE # 1430
0000 EF                MOV     A,R7
0001 120000      E     LCALL   ?C?CCASE
0004 0000        R     DW      ?C0194
0006 20                DB      020H
0007 0000        R     DW      ?C0195
0009 33                DB      033H
000A 0000        R     DW      ?C0196
000C 34                DB      034H
000D 0000        R     DW      ?C0197
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 58  

000F 36                DB      036H
0010 0000        R     DW      ?C0198
0012 37                DB      037H
0013 0000        R     DW      ?C0199
0015 60                DB      060H
0016 0000        R     DW      ?C0200
0018 73                DB      073H
0019 0000        R     DW      ?C0201
001B 74                DB      074H
001C 0000        R     DW      ?C0202
001E 76                DB      076H
001F 0000        R     DW      ?C0203
0021 77                DB      077H
0022 0000        R     DW      ?C0204
0024 90                DB      090H
0025 0000        R     DW      ?C0205
0027 91                DB      091H
0028 0000        R     DW      ?C0206
002A 92                DB      092H
002B 0000        R     DW      ?C0207
002D 93                DB      093H
002E 0000        R     DW      ?C0208
0030 A4                DB      0A4H
0031 0000        R     DW      ?C0209
0033 A5                DB      0A5H
0034 0000        R     DW      ?C0210
0036 A6                DB      0A6H
0037 0000        R     DW      ?C0211
0039 A7                DB      0A7H
003A 0000        R     DW      ?C0212
003C A8                DB      0A8H
003D 0000        R     DW      ?C0213
003F A9                DB      0A9H
0040 0000        R     DW      ?C0214
0042 AA                DB      0AAH
0043 0000        R     DW      ?C0215
0045 AB                DB      0ABH
0046 0000        R     DW      ?C0216
0048 AC                DB      0ACH
0049 0000        R     DW      ?C0217
004B AD                DB      0ADH
004C 0000        R     DW      ?C0218
004E AE                DB      0AEH
004F 0000        R     DW      ?C0219
0051 AF                DB      0AFH
0052 0000        R     DW      ?C0220
0054 C0                DB      0C0H
0055 0000        R     DW      ?C0221
0057 D0                DB      0D0H
0058 0000        R     DW      ?C0222
005A D1                DB      0D1H
005B 0000        R     DW      ?C0223
005D D2                DB      0D2H
005E 0000        R     DW      ?C0224
0060 D3                DB      0D3H
0061 0000        R     DW      ?C0225
0063 D4                DB      0D4H
0064 0000        R     DW      ?C0226
0066 E0                DB      0E0H
0067 0000        R     DW      ?C0242
0069 F0                DB      0F0H
006A 0000        R     DW      ?C0242
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 59  

006C F1                DB      0F1H
006D 0000        R     DW      ?C0242
006F F2                DB      0F2H
0070 0000        R     DW      ?C0242
0072 F3                DB      0F3H
0073 0000        R     DW      ?C0242
0075 F4                DB      0F4H
0076 0000        R     DW      ?C0242
0078 F5                DB      0F5H
0079 0000        R     DW      ?C0242
007B F6                DB      0F6H
007C 0000        R     DW      ?C0242
007E F7                DB      0F7H
007F 0000        R     DW      ?C0242
0081 F8                DB      0F8H
0082 0000        R     DW      ?C0242
0084 F9                DB      0F9H
0085 0000        R     DW      ?C0242
0087 FA                DB      0FAH
0088 0000        R     DW      ?C0242
008A FB                DB      0FBH
008B 0000        R     DW      ?C0242
008D FC                DB      0FCH
008E 0000        R     DW      ?C0242
0090 FD                DB      0FDH
0091 0000        R     DW      ?C0242
0093 FE                DB      0FEH
0094 0000        R     DW      ?C0242
0096 FF                DB      0FFH
0097 0000              DW      00H
0099 0000        R     DW      ?C0244
                                           ; SOURCE LINE # 1431
                                           ; SOURCE LINE # 1432
009B         ?C0194:
                                           ; SOURCE LINE # 1433
009B 020000      R     LJMP    Cmd_20
                                           ; SOURCE LINE # 1434
                                           ; SOURCE LINE # 1436
009E         ?C0195:
                                           ; SOURCE LINE # 1437
009E 020000      R     LJMP    Cmd_33
                                           ; SOURCE LINE # 1438
                                           ; SOURCE LINE # 1440
00A1         ?C0196:
                                           ; SOURCE LINE # 1441
00A1 020000      R     LJMP    Cmd_34
                                           ; SOURCE LINE # 1442
                                           ; SOURCE LINE # 1444
00A4         ?C0197:
                                           ; SOURCE LINE # 1445
00A4 020000      R     LJMP    Cmd_36
                                           ; SOURCE LINE # 1446
                                           ; SOURCE LINE # 1448
00A7         ?C0198:
                                           ; SOURCE LINE # 1449
00A7 020000      R     LJMP    Cmd_37
                                           ; SOURCE LINE # 1450
                                           ; SOURCE LINE # 1452
00AA         ?C0199:
                                           ; SOURCE LINE # 1453
00AA 020000      R     LJMP    Cmd_60
                                           ; SOURCE LINE # 1454
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 60  

                                           ; SOURCE LINE # 1456
00AD         ?C0200:
                                           ; SOURCE LINE # 1457
00AD 020000      R     LJMP    Cmd_73
                                           ; SOURCE LINE # 1458
                                           ; SOURCE LINE # 1460
00B0         ?C0201:
                                           ; SOURCE LINE # 1461
00B0 020000      R     LJMP    Cmd_74
                                           ; SOURCE LINE # 1462
                                           ; SOURCE LINE # 1464
00B3         ?C0202:
                                           ; SOURCE LINE # 1465
00B3 020000      R     LJMP    Cmd_76
                                           ; SOURCE LINE # 1466
                                           ; SOURCE LINE # 1468
00B6         ?C0203:
                                           ; SOURCE LINE # 1469
00B6 020000      R     LJMP    Cmd_77
                                           ; SOURCE LINE # 1470
                                           ; SOURCE LINE # 1472
00B9         ?C0204:
                                           ; SOURCE LINE # 1473
00B9 020000      R     LJMP    Cmd_90
                                           ; SOURCE LINE # 1474
                                           ; SOURCE LINE # 1476
00BC         ?C0205:
                                           ; SOURCE LINE # 1477
00BC 020000      R     LJMP    Cmd_91
                                           ; SOURCE LINE # 1478
                                           ; SOURCE LINE # 1480
00BF         ?C0206:
                                           ; SOURCE LINE # 1481
00BF 020000      R     LJMP    Cmd_92
                                           ; SOURCE LINE # 1482
                                           ; SOURCE LINE # 1484
00C2         ?C0207:
                                           ; SOURCE LINE # 1485
00C2 020000      R     LJMP    Cmd_93
                                           ; SOURCE LINE # 1486
                                           ; SOURCE LINE # 1488
00C5         ?C0208:
                                           ; SOURCE LINE # 1489
00C5 020000      R     LJMP    Cmd_A4
                                           ; SOURCE LINE # 1490
                                           ; SOURCE LINE # 1492
00C8         ?C0209:
                                           ; SOURCE LINE # 1493
00C8 020000      R     LJMP    Cmd_A5
                                           ; SOURCE LINE # 1494
                                           ; SOURCE LINE # 1496
00CB         ?C0210:
                                           ; SOURCE LINE # 1497
00CB 020000      R     LJMP    Cmd_A6
                                           ; SOURCE LINE # 1498
                                           ; SOURCE LINE # 1500
00CE         ?C0211:
                                           ; SOURCE LINE # 1501
00CE 020000      R     LJMP    Cmd_A7
                                           ; SOURCE LINE # 1502
                                           ; SOURCE LINE # 1504
00D1         ?C0212:
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 61  

                                           ; SOURCE LINE # 1505
00D1 020000      R     LJMP    Cmd_A8
                                           ; SOURCE LINE # 1506
                                           ; SOURCE LINE # 1508
00D4         ?C0213:
                                           ; SOURCE LINE # 1509
00D4 020000      R     LJMP    Cmd_A9
                                           ; SOURCE LINE # 1510
                                           ; SOURCE LINE # 1512
00D7         ?C0214:
                                           ; SOURCE LINE # 1513
00D7 020000      R     LJMP    Cmd_AA
                                           ; SOURCE LINE # 1514
                                           ; SOURCE LINE # 1516
00DA         ?C0215:
                                           ; SOURCE LINE # 1517
00DA 020000      R     LJMP    Cmd_AB
                                           ; SOURCE LINE # 1518
                                           ; SOURCE LINE # 1520
00DD         ?C0216:
                                           ; SOURCE LINE # 1521
00DD 020000      R     LJMP    Cmd_AC
                                           ; SOURCE LINE # 1522
                                           ; SOURCE LINE # 1524
00E0         ?C0217:
                                           ; SOURCE LINE # 1525
00E0 020000      R     LJMP    Cmd_AD
                                           ; SOURCE LINE # 1526
                                           ; SOURCE LINE # 1528
00E3         ?C0218:
                                           ; SOURCE LINE # 1529
00E3 020000      R     LJMP    Cmd_AE
                                           ; SOURCE LINE # 1530
                                           ; SOURCE LINE # 1532
00E6         ?C0219:
                                           ; SOURCE LINE # 1533
00E6 020000      R     LJMP    Cmd_AF
                                           ; SOURCE LINE # 1534
                                           ; SOURCE LINE # 1536
00E9         ?C0220:
                                           ; SOURCE LINE # 1537
00E9 020000      R     LJMP    Cmd_C0
                                           ; SOURCE LINE # 1538
                                           ; SOURCE LINE # 1540
00EC         ?C0221:
                                           ; SOURCE LINE # 1541
00EC 020000      R     LJMP    Cmd_D0
                                           ; SOURCE LINE # 1542
                                           ; SOURCE LINE # 1544
00EF         ?C0222:
                                           ; SOURCE LINE # 1545
00EF 020000      R     LJMP    Cmd_D1
                                           ; SOURCE LINE # 1546
                                           ; SOURCE LINE # 1548
00F2         ?C0223:
                                           ; SOURCE LINE # 1549
00F2 020000      R     LJMP    Cmd_D2
                                           ; SOURCE LINE # 1550
                                           ; SOURCE LINE # 1552
00F5         ?C0224:
                                           ; SOURCE LINE # 1553
00F5 020000      R     LJMP    Cmd_D3
C51 COMPILER V8.12   CORE_PORT6064                                                         07/28/2018 12:03:34 PAGE 62  

                                           ; SOURCE LINE # 1554
                                           ; SOURCE LINE # 1556
00F8         ?C0225:
                                           ; SOURCE LINE # 1557
00F8 020000      R     LJMP    Cmd_D4
                                           ; SOURCE LINE # 1558
                                           ; SOURCE LINE # 1560
00FB         ?C0226:
                                           ; SOURCE LINE # 1561
00FB 020000      R     LJMP    Cmd_E0
                                           ; SOURCE LINE # 1562
                                           ; SOURCE LINE # 1564
                                           ; SOURCE LINE # 1565
                                           ; SOURCE LINE # 1566
                                           ; SOURCE LINE # 1567
                                           ; SOURCE LINE # 1568
                                           ; SOURCE LINE # 1569
                                           ; SOURCE LINE # 1570
                                           ; SOURCE LINE # 1571
                                           ; SOURCE LINE # 1572
                                           ; SOURCE LINE # 1573
                                           ; SOURCE LINE # 1574
                                           ; SOURCE LINE # 1575
                                           ; SOURCE LINE # 1576
                                           ; SOURCE LINE # 1577
                                           ; SOURCE LINE # 1578
                                           ; SOURCE LINE # 1579
00FE         ?C0242:
                                           ; SOURCE LINE # 1580
00FE 120000      R     LCALL   Cmd_FX
                                           ; SOURCE LINE # 1581
                                           ; SOURCE LINE # 1583
                                           ; SOURCE LINE # 1584
                                           ; SOURCE LINE # 1585
                                           ; SOURCE LINE # 1586
0101         ?C0244:
0101 22                RET     
             ; FUNCTION _Core_64Port (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1944    ----
   CONSTANT SIZE    =    113    ----
   XDATA SIZE       =   ----       9
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----       1
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
