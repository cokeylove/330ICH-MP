C51 COMPILER V8.12   OEM_GPIO                                                              07/28/2018 12:03:41 PAGE 1   


C51 COMPILER V8.12, COMPILATION OF MODULE OEM_GPIO
OBJECT MODULE PLACED IN Code\OEM\OEM_GPIO.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Code\OEM\OEM_GPIO.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\IN
                    -CLUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_GPIO.C
   3           *
   4           * Author : Dino
   5           *
   6           * Note : These functions are reference only.
   7           *        Please follow your project software specification to do some modification.
   8           *---------------------------------------------------------------------------*/
   9          
  10          #include <CORE_INCLUDE.H>
  11          #include <OEM_INCLUDE.H>
  12          
  13          //-----------------------------------------------------------------
  14          // External ram GPIO Registers
  15          //-----------------------------------------------------------------
  16          const sInitGPIOReg code asInitGPIOReg[] =
  17          {
  18                  { &GCR,         GCR_Init                },      //
  19                  { &GCR2,        GCR2_Init               },      //
  20                  { &GCR10,       GCR10_Init              },
  21                  
  22                  { &GPOTD,       GPOTD_Init              }, //BROOKEW005: start configure GPIO 1.8V and Open drain
  23                  { &GPOTH,       GPOTH_Init              }, //
  24                  
  25                  
  26                  //{ &GPOTA,     0x06                    },      // msmart  /AC  //cwy
  27                  { &GPOTA,       GPOTA_Init                      },      //ANGELAS011 :Set  EC_VCCST_PWRGD pin is OD.
  28                  { &GPOTE,       GPOTE_Init                      },      //MEILING039 :Set  GPU_PROCHOT_ON# pin is OD.
  29                  
  30          
  31                  { &GPDRA,       PortA_Init              },      // Port A Data port Init
  32                  { &GPDRB,       PortB_Init              },      // Port B Data port Init
  33                  { &GPDRC,       PortC_Init              },      // Port C Data port Init
  34                  { &GPDRD,       PortD_Init              },      // Port D Data port Init
  35                  { &GPDRE,       PortE_Init              },      // Port E Data port Init
  36                  { &GPDRF,       PortF_Init              },      // Port F Data port Init
  37                  { &GPDRG,       PortG_Init              },      // Port G Data port Init
  38                  { &GPDRH,       PortH_Init              },      // Port H Data port Init
  39                  { &GPDRI,       PortI_Init              },      // Port I Data port Init
  40                  { &GPDRJ,       PortJ_Init              },      // Port J Data port Init
  41          
  42                  { &GPCRA0,      PortA0_Ctrl             },
  43                  { &GPCRA1,      PortA1_Ctrl             },
  44                  { &GPCRA2,      PortA2_Ctrl             },
  45                  { &GPCRA3,      PortA3_Ctrl             },
  46                  { &GPCRA4,      PortA4_Ctrl             },
  47                  { &GPCRA5,      PortA5_Ctrl             },
  48                  { &GPCRA6,      PortA6_Ctrl             },
  49                  { &GPCRA7,      PortA7_Ctrl             },
  50          
  51                  { &GPCRB0,      PortB0_Ctrl             },
  52                  { &GPCRB1,      PortB1_Ctrl             },
  53                  { &GPCRB2,      PortB2_Ctrl             },
  54                  { &GPCRB3,      PortB3_Ctrl             },
C51 COMPILER V8.12   OEM_GPIO                                                              07/28/2018 12:03:41 PAGE 2   

  55                  { &GPCRB4,      PortB4_Ctrl             },
  56                  { &GPCRB5,      PortB5_Ctrl             },
  57                  { &GPCRB6,      PortB6_Ctrl             },
  58                  { &GPCRB7,      PortB7_Ctrl             },
  59          
  60                  { &GPCRC0,      PortC0_Ctrl             },
  61                  { &GPCRC1,      PortC1_Ctrl             },
  62                  { &GPCRC2,      PortC2_Ctrl             },
  63                  { &GPCRC3,      PortC3_Ctrl             },
  64                  { &GPCRC4,      PortC4_Ctrl             },
  65                  { &GPCRC5,      PortC5_Ctrl             },
  66                  { &GPCRC6,      PortC6_Ctrl             },
  67                  { &GPCRC7,      PortC7_Ctrl             },
  68          
  69                  { &GPCRD0,      PortD0_Ctrl             },
  70                  { &GPCRD1,      PortD1_Ctrl             },
  71                  { &GPCRD2,      PortD2_Ctrl             },
  72                  { &GPCRD3,      PortD3_Ctrl             },
  73                  { &GPCRD4,      PortD4_Ctrl             },
  74                  { &GPCRD5,      PortD5_Ctrl             },
  75                  { &GPCRD6,      PortD6_Ctrl             },
  76                  { &GPCRD7,      PortD7_Ctrl             },
  77          
  78                  { &GPCRE0,      PortE0_Ctrl             },
  79                  { &GPCRE1,      PortE1_Ctrl             },
  80                  { &GPCRE2,      PortE2_Ctrl             },
  81                  { &GPCRE3,      PortE3_Ctrl             },
  82                  { &GPCRE4,      PortE4_Ctrl     },
  83                  { &GPCRE5,      PortE5_Ctrl             },
  84                  { &GPCRE6,      PortE6_Ctrl             },
  85                  { &GPCRE7,      PortE7_Ctrl             },
  86          
  87                  { &GPCRF0,      PortF0_Ctrl             },
  88                  { &GPCRF1,      PortF1_Ctrl             },
  89                  { &GPCRF2,      PortF2_Ctrl             },
  90                  { &GPCRF3,      PortF3_Ctrl             },
  91                  { &GPCRF4,      PortF4_Ctrl             },
  92                  { &GPCRF5,      PortF5_Ctrl             },
  93                  { &GPCRF6,      PortF6_Ctrl             },
  94                  { &GPCRF7,      PortF7_Ctrl             },
  95          
  96                  { &GPCRG0,      PortG0_Ctrl             },
  97                  { &GPCRG1,      PortG1_Ctrl             },
  98                  { &GPCRG2,      PortG2_Ctrl             },
  99                  { &GPCRG3,      PortG3_Ctrl             },
 100                  { &GPCRG4,      PortG4_Ctrl             },
 101                  { &GPCRG5,      PortG5_Ctrl             },
 102                  { &GPCRG6,      PortG6_Ctrl             },
 103                  { &GPCRG7,      PortG7_Ctrl             },
 104          
 105                  { &GPCRH0,      PortH0_Ctrl             },
 106                  { &GPCRH1,      PortH1_Ctrl             },
 107                  { &GPCRH2,      PortH2_Ctrl             },
 108                  { &GPCRH3,      PortH3_Ctrl             },
 109                  { &GPCRH4,      PortH4_Ctrl             },
 110                  { &GPCRH5,      PortH5_Ctrl             },
 111                  { &GPCRH6,      PortH6_Ctrl             },
 112          
 113                  { &GPCRI0,      PortI0_Ctrl             },
 114                  { &GPCRI1,      PortI1_Ctrl             },
 115                  { &GPCRI2,      PortI2_Ctrl             },
 116                  { &GPCRI3,      PortI3_Ctrl             },
C51 COMPILER V8.12   OEM_GPIO                                                              07/28/2018 12:03:41 PAGE 3   

 117                  { &GPCRI4,      PortI4_Ctrl             },
 118                  { &GPCRI5,      PortI5_Ctrl             },
 119                  { &GPCRI6,      PortI6_Ctrl             },
 120                  { &GPCRI7,      PortI7_Ctrl             },
 121          
 122                  { &GPCRJ0,      PortJ0_Ctrl             },
 123                  { &GPCRJ1,      PortJ1_Ctrl             },
 124                  { &GPCRJ2,      PortJ2_Ctrl             },
 125                  { &GPCRJ3,      PortJ3_Ctrl             },
 126                  { &GPCRJ4,      PortJ4_Ctrl             },
 127                  { &GPCRJ5,      PortJ5_Ctrl             },
 128                  { &GPCRJ6,      PortJ6_Ctrl             },
 129                  { &GPCRJ7,      PortJ7_Ctrl             }
 130          
 131          };
 132          
 133          //-----------------------------------------------------------------------------
 134          // The function of GPIO register init.
 135          //-----------------------------------------------------------------------------
 136          void Init_GPIO(void)
 137          {
 138   1              BYTE index;
 139   1              index=0x00;
 140   1              //GPCRE5= OUTPUT;//JERRYSK002:Change GPIO ctrl.
 141   1          //DPWROK_EC_HI();
 142   1          //Delay1MS(1);
 143   1          //RamDebug(0x44);
 144   1          //GPCRH0=OUTPUT; //ANGELAS015:Change GPIO ctrl.
 145   1          // RSMRST_HI();//JERRYSK001:modify RSMRST signal to low when GPIO init.
 146   1              while(index<(sizeof(asInitGPIOReg)/sizeof(sInitGPIOReg)))
 147   1              {
 148   2                      /*ANGELAS038:remove start
 149   2                      //ANGELAS023:s+Modify UMA LED function.
 150   2                      if((NTC_FLAG==1) && (index==6))
 151   2                      {
 152   2                              *asInitGPIOReg[index].reg=0x07;
 153   2                              index++;
 154   2                              break;
 155   2                      }
 156   2                      //ANGELAS023:e+Modify UMA LED function.
 157   2                      *///ANGELAS038:remove end
 158   2                      *asInitGPIOReg[index].reg=asInitGPIOReg[index].value;
 159   2                      index++;
 160   2              }
 161   1      }
 162          
 163          //----------------------------------------------------------------------------
 164          // Hook function of SCI high
 165          //----------------------------------------------------------------------------
 166          void Hook_SCION(void)
 167          {
 168   1              SCI_ON();
 169   1      }
 170          
 171          //----------------------------------------------------------------------------
 172          // Hook function of SCI low
 173          //----------------------------------------------------------------------------
 174          void Hook_SCIOFF(void)
 175          {
 176   1              SCI_OFF();
 177   1      }
 178          
C51 COMPILER V8.12   OEM_GPIO                                                              07/28/2018 12:03:41 PAGE 4   

 179          //----------------------------------------------------------------------------
 180          // Hook function of SMI high
 181          //----------------------------------------------------------------------------
 182          void Hook_SMION(void)
 183          {
 184   1              SMI_ON();//JERRYCH003:Enable SMI for hang debug.
 185   1      }
 186          
 187          //----------------------------------------------------------------------------
 188          // Hook function of SMI low
 189          //----------------------------------------------------------------------------
 190          void Hook_SMIOFF(void)
 191          {
 192   1              SMI_OFF();//JERRYCH003:Enable SMI for hang debug.
 193   1      }
 194          
 195          //----------------------------------------------------------------------------
 196          // Hook function of A20 high
 197          //----------------------------------------------------------------------------
 198          void Hook_A20ON(void)
 199          {
 200   1              //GATEA20_ON();
 201   1      }
 202          
 203          //----------------------------------------------------------------------------
 204          // Hook function of A20 low
 205          //----------------------------------------------------------------------------
 206          void Hook_A20OFF(void)
 207          {
 208   1              //GATEA20_OFF();
 209   1      }
 210          
 211          //----------------------------------------------------------------------------
 212          // Hook function of keyboard reset low
 213          //----------------------------------------------------------------------------
 214          void Hook_KBRSTON(void)
 215          {
 216   1              KBRST_ON();
 217   1      }
 218          
 219          //----------------------------------------------------------------------------
 220          // Hook function of keyboard reset high
 221          //----------------------------------------------------------------------------
 222          void Hook_KBRSTOFF(void)
 223          {
 224   1              KBRST_OFF();
 225   1      }
 226          
 227          //----------------------------------------------------------------------------
 228          // Hook function of NUM LED ON
 229          //----------------------------------------------------------------------------
 230          void Hook_NUMLED_ON(void)
 231          {
 232   1              if (cOsLedCtrl.fbit.cOL_CtrlRight ==0 )
 233   1                      NUMLED_ON();
 234   1      }
 235          
 236          //----------------------------------------------------------------------------
 237          // Hook function of NUM LED OFF
 238          //----------------------------------------------------------------------------
 239          void Hook_NUMLED_OFF(void)
 240          {
C51 COMPILER V8.12   OEM_GPIO                                                              07/28/2018 12:03:41 PAGE 5   

 241   1              if (cOsLedCtrl.fbit.cOL_CtrlRight ==0 )
 242   1                      NUMLED_OFF();
 243   1      }
 244          
 245          //----------------------------------------------------------------------------
 246          // Hook function of CAP LED ON
 247          //----------------------------------------------------------------------------
 248          void Hook_CAPLED_ON(void)
 249          {
 250   1              if (cOsLedCtrl.fbit.cOL_CtrlRight ==0 )
 251   1                      CAPLED_ON();
 252   1      }
 253          
 254          //----------------------------------------------------------------------------
 255          // Hook function of CAP LED OFF
 256          //----------------------------------------------------------------------------
 257          void Hook_CAPLED_OFF(void)
 258          {
 259   1              if (cOsLedCtrl.fbit.cOL_CtrlRight ==0 )
 260   1                      CAPLED_OFF();
 261   1      }
C51 COMPILER V8.12   OEM_GPIO                                                              07/28/2018 12:03:41 PAGE 6   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com0014 (BEGIN)
0000         L?0021:
0000         L?0022:
0000 900000      E     MOV     DPTR,#cOsLedCtrl
0003 E0                MOVX    A,@DPTR
0004 C4                SWAP    A
0005 13                RRC     A
0006 13                RRC     A
0007 13                RRC     A
0008 5401              ANL     A,#01H
000A 22                RET     
000B         L?0023:
000B 75F003            MOV     B,#03H
000E EF                MOV     A,R7
000F 120000      E     LCALL   ?C?OFFXADD
0012 E4                CLR     A
0013 93                MOVC    A,@A+DPTR
0014 22                RET     
             ; FUNCTION Com0014 (END)

             ; FUNCTION Init_GPIO (BEGIN)
                                           ; SOURCE LINE # 136
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 139
;---- Variable 'index' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002         ?C0001:
                                           ; SOURCE LINE # 146
                                           ; SOURCE LINE # 147
                                           ; SOURCE LINE # 158
0002 900000      R     MOV     DPTR,#asInitGPIOReg+02H
0005 120000      R     LCALL   L?0023
0008 FE                MOV     R6,A
0009 900000      R     MOV     DPTR,#asInitGPIOReg
000C 120000      R     LCALL   L?0023
000F FC                MOV     R4,A
0010 7401              MOV     A,#01H
0012 93                MOVC    A,@A+DPTR
0013 F582              MOV     DPL,A
0015 8C83              MOV     DPH,R4
0017 EE                MOV     A,R6
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 159
0019 0F                INC     R7
                                           ; SOURCE LINE # 160
001A EF                MOV     A,R7
001B B460E4            CJNE    A,#060H,?C0001
                                           ; SOURCE LINE # 161
001E         ?C0003:
001E 22                RET     
             ; FUNCTION Init_GPIO (END)

             ; FUNCTION Hook_SCION (BEGIN)
                                           ; SOURCE LINE # 166
                                           ; SOURCE LINE # 167
                                           ; SOURCE LINE # 168
0000 900000      E     MOV     DPTR,#GPDRD
0003 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_GPIO                                                              07/28/2018 12:03:41 PAGE 7   

0004 54F7              ANL     A,#0F7H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 169
0007 22                RET     
             ; FUNCTION Hook_SCION (END)

             ; FUNCTION Hook_SCIOFF (BEGIN)
                                           ; SOURCE LINE # 174
                                           ; SOURCE LINE # 175
                                           ; SOURCE LINE # 176
0000 900000      E     MOV     DPTR,#GPDRD
0003 E0                MOVX    A,@DPTR
0004 4408              ORL     A,#08H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 177
0007 22                RET     
             ; FUNCTION Hook_SCIOFF (END)

             ; FUNCTION Hook_SMION (BEGIN)
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 183
                                           ; SOURCE LINE # 184
0000 900000      E     MOV     DPTR,#GPDRD
0003 E0                MOVX    A,@DPTR
0004 54EF              ANL     A,#0EFH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 185
0007 22                RET     
             ; FUNCTION Hook_SMION (END)

             ; FUNCTION Hook_SMIOFF (BEGIN)
                                           ; SOURCE LINE # 190
                                           ; SOURCE LINE # 191
                                           ; SOURCE LINE # 192
0000 900000      E     MOV     DPTR,#GPDRD
0003 E0                MOVX    A,@DPTR
0004 4410              ORL     A,#010H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 193
0007 22                RET     
             ; FUNCTION Hook_SMIOFF (END)

             ; FUNCTION Hook_A20ON (BEGIN)
                                           ; SOURCE LINE # 198
                                           ; SOURCE LINE # 199
                                           ; SOURCE LINE # 201
0000 22                RET     
             ; FUNCTION Hook_A20ON (END)

             ; FUNCTION Hook_A20OFF (BEGIN)
                                           ; SOURCE LINE # 206
                                           ; SOURCE LINE # 207
                                           ; SOURCE LINE # 209
0000 22                RET     
             ; FUNCTION Hook_A20OFF (END)

             ; FUNCTION Hook_KBRSTON (BEGIN)
                                           ; SOURCE LINE # 214
                                           ; SOURCE LINE # 215
                                           ; SOURCE LINE # 216
0000 900000      E     MOV     DPTR,#GPDRB
0003 E0                MOVX    A,@DPTR
C51 COMPILER V8.12   OEM_GPIO                                                              07/28/2018 12:03:41 PAGE 8   

0004 54BF              ANL     A,#0BFH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 217
0007 22                RET     
             ; FUNCTION Hook_KBRSTON (END)

             ; FUNCTION Hook_KBRSTOFF (BEGIN)
                                           ; SOURCE LINE # 222
                                           ; SOURCE LINE # 223
                                           ; SOURCE LINE # 224
0000 900000      E     MOV     DPTR,#GPDRB
0003 E0                MOVX    A,@DPTR
0004 4440              ORL     A,#040H
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 225
0007 22                RET     
             ; FUNCTION Hook_KBRSTOFF (END)

             ; FUNCTION Hook_NUMLED_ON (BEGIN)
                                           ; SOURCE LINE # 230
                                           ; SOURCE LINE # 231
                                           ; SOURCE LINE # 232
0000 120000      R     LCALL   L?0021
0003 20E007            JB      ACC.0,?C0013
                                           ; SOURCE LINE # 233
0006 900000      E     MOV     DPTR,#GPDRE
0009 E0                MOVX    A,@DPTR
000A 547F              ANL     A,#07FH
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 234
000D         ?C0013:
000D 22                RET     
             ; FUNCTION Hook_NUMLED_ON (END)

             ; FUNCTION Hook_NUMLED_OFF (BEGIN)
                                           ; SOURCE LINE # 239
                                           ; SOURCE LINE # 240
                                           ; SOURCE LINE # 241
0000 120000      R     LCALL   L?0021
0003 20E007            JB      ACC.0,?C0015
                                           ; SOURCE LINE # 242
0006 900000      E     MOV     DPTR,#GPDRE
0009 E0                MOVX    A,@DPTR
000A 4480              ORL     A,#080H
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 243
000D         ?C0015:
000D 22                RET     
             ; FUNCTION Hook_NUMLED_OFF (END)

             ; FUNCTION Hook_CAPLED_ON (BEGIN)
                                           ; SOURCE LINE # 248
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 250
0000 120000      R     LCALL   L?0022
0003 20E007            JB      ACC.0,?C0017
                                           ; SOURCE LINE # 251
0006 900000      E     MOV     DPTR,#GPDRH
0009 E0                MOVX    A,@DPTR
000A 54F7              ANL     A,#0F7H
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 252
C51 COMPILER V8.12   OEM_GPIO                                                              07/28/2018 12:03:41 PAGE 9   

000D         ?C0017:
000D 22                RET     
             ; FUNCTION Hook_CAPLED_ON (END)

             ; FUNCTION Hook_CAPLED_OFF (BEGIN)
                                           ; SOURCE LINE # 257
                                           ; SOURCE LINE # 258
                                           ; SOURCE LINE # 259
0000 120000      R     LCALL   L?0022
0003 20E007            JB      ACC.0,?C0019
                                           ; SOURCE LINE # 260
0006 900000      E     MOV     DPTR,#GPDRH
0009 E0                MOVX    A,@DPTR
000A 4408              ORL     A,#08H
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 261
000D         ?C0019:
000D 22                RET     
             ; FUNCTION Hook_CAPLED_OFF (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    158    ----
   CONSTANT SIZE    =    288    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
